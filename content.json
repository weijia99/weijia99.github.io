[{"title":"mmseg代码课","date":"2023-06-14T07:45:40.000Z","path":"2023/06/14/mmseg代码课/","content":"<h1 id=\"图像分割简介\"><a href=\"#图像分割简介\" class=\"headerlink\" title=\"图像分割简介\"></a>图像分割简介</h1><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/1686729066208MMSEG.png\"></p>\n<p>主要介绍了图像分割发展历程。之前了解了一些图像分割，主要是使用调色板，png图像来进行保存图像。因此对每一个标签都需要绘画一种颜色。</p>\n<p>为了让每一个像素值都是一个类别，需要使用膨胀卷积，保存图像不变，输出 的是图像，不是类别</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/1686729232196MMseg%E4%BB%A3%E7%A0%81%E8%AF%BE.png\"></p>\n<p>因此在训练的时候，需要不仅仅写cfg，还需要再写dataset，这个是核心函数，定义颜色，还有类别，分割的显示</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 同济子豪兄 2023-2-15</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> mmseg.registry <span class=\"keyword\">import</span> DATASETS</span><br><span class=\"line\"><span class=\"keyword\">from</span> .basesegdataset <span class=\"keyword\">import</span> BaseSegDataset</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@DATASETS.register_module()</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">WatermelonDataset</span>(<span class=\"title class_ inherited__\">BaseSegDataset</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 类别和对应的可视化配色</span></span><br><span class=\"line\">    METAINFO = &#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;classes&#x27;</span>:[<span class=\"string\">&#x27;red&#x27;</span>, <span class=\"string\">&#x27;green&#x27;</span>, <span class=\"string\">&#x27;white&#x27;</span>, <span class=\"string\">&#x27;seed-black&#x27;</span>, <span class=\"string\">&#x27;seed-white&#x27;</span>, <span class=\"string\">&#x27;Unlabeled&#x27;</span>],</span><br><span class=\"line\">        <span class=\"string\">&#x27;palette&#x27;</span>:[[<span class=\"number\">132</span>,<span class=\"number\">41</span>,<span class=\"number\">246</span>], [<span class=\"number\">228</span>,<span class=\"number\">193</span>,<span class=\"number\">110</span>], [<span class=\"number\">152</span>,<span class=\"number\">16</span>,<span class=\"number\">60</span>], [<span class=\"number\">58</span>,<span class=\"number\">221</span>,<span class=\"number\">254</span>], [<span class=\"number\">41</span>,<span class=\"number\">169</span>,<span class=\"number\">226</span>], [<span class=\"number\">155</span>,<span class=\"number\">155</span>,<span class=\"number\">155</span>]]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 指定图像扩展名、标注扩展名</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self,</span></span><br><span class=\"line\"><span class=\"params\">                 img_suffix=<span class=\"string\">&#x27;.jpg&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"params\">                 seg_map_suffix=<span class=\"string\">&#x27;.png&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"params\">                 reduce_zero_label=<span class=\"literal\">False</span>, <span class=\"comment\"># 类别ID为0的类别是否需要除去</span></span></span><br><span class=\"line\"><span class=\"params\">                 **kwargs</span>) -&gt; <span class=\"literal\">None</span>:</span><br><span class=\"line\">        <span class=\"built_in\">super</span>().__init__(</span><br><span class=\"line\">            img_suffix=img_suffix,</span><br><span class=\"line\">            seg_map_suffix=seg_map_suffix,</span><br><span class=\"line\">            reduce_zero_label=reduce_zero_label,</span><br><span class=\"line\">            **kwargs)</span><br></pre></td></tr></table></figure>\n\n\n\n<p>之后进行设置cfg</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">norm_cfg = <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;BN&#x27;</span>, requires_grad=<span class=\"literal\">True</span>)</span><br><span class=\"line\">data_preprocessor = <span class=\"built_in\">dict</span>(</span><br><span class=\"line\">    <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;SegDataPreProcessor&#x27;</span>,</span><br><span class=\"line\">    mean=[<span class=\"number\">123.675</span>, <span class=\"number\">116.28</span>, <span class=\"number\">103.53</span>],</span><br><span class=\"line\">    std=[<span class=\"number\">58.395</span>, <span class=\"number\">57.12</span>, <span class=\"number\">57.375</span>],</span><br><span class=\"line\">    bgr_to_rgb=<span class=\"literal\">True</span>,</span><br><span class=\"line\">    pad_val=<span class=\"number\">0</span>,</span><br><span class=\"line\">    seg_pad_val=<span class=\"number\">255</span>,</span><br><span class=\"line\">    size=(<span class=\"number\">64</span>, <span class=\"number\">64</span>))</span><br><span class=\"line\">model = <span class=\"built_in\">dict</span>(</span><br><span class=\"line\">    <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;EncoderDecoder&#x27;</span>,</span><br><span class=\"line\">    data_preprocessor=<span class=\"built_in\">dict</span>(</span><br><span class=\"line\">        <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;SegDataPreProcessor&#x27;</span>,</span><br><span class=\"line\">        mean=[<span class=\"number\">123.675</span>, <span class=\"number\">116.28</span>, <span class=\"number\">103.53</span>],</span><br><span class=\"line\">        std=[<span class=\"number\">58.395</span>, <span class=\"number\">57.12</span>, <span class=\"number\">57.375</span>],</span><br><span class=\"line\">        bgr_to_rgb=<span class=\"literal\">True</span>,</span><br><span class=\"line\">        pad_val=<span class=\"number\">0</span>,</span><br><span class=\"line\">        seg_pad_val=<span class=\"number\">255</span>,</span><br><span class=\"line\">        size=(<span class=\"number\">256</span>, <span class=\"number\">256</span>)),</span><br><span class=\"line\">    pretrained=<span class=\"string\">&#x27;open-mmlab://resnet50_v1c&#x27;</span>,</span><br><span class=\"line\">    backbone=<span class=\"built_in\">dict</span>(</span><br><span class=\"line\">        <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;ResNetV1c&#x27;</span>,</span><br><span class=\"line\">        depth=<span class=\"number\">50</span>,</span><br><span class=\"line\">        num_stages=<span class=\"number\">4</span>,</span><br><span class=\"line\">        out_indices=(<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>),</span><br><span class=\"line\">        dilations=(<span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span>),</span><br><span class=\"line\">        strides=(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>),</span><br><span class=\"line\">        norm_cfg=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;BN&#x27;</span>, requires_grad=<span class=\"literal\">True</span>),</span><br><span class=\"line\">        norm_eval=<span class=\"literal\">False</span>,</span><br><span class=\"line\">        style=<span class=\"string\">&#x27;pytorch&#x27;</span>,</span><br><span class=\"line\">        contract_dilation=<span class=\"literal\">True</span>),</span><br><span class=\"line\">    decode_head=<span class=\"built_in\">dict</span>(</span><br><span class=\"line\">        <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;PSPHead&#x27;</span>,</span><br><span class=\"line\">        in_channels=<span class=\"number\">2048</span>,</span><br><span class=\"line\">        in_index=<span class=\"number\">3</span>,</span><br><span class=\"line\">        channels=<span class=\"number\">512</span>,</span><br><span class=\"line\">        pool_scales=(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">6</span>),</span><br><span class=\"line\">        dropout_ratio=<span class=\"number\">0.1</span>,</span><br><span class=\"line\">        num_classes=<span class=\"number\">6</span>,</span><br><span class=\"line\">        norm_cfg=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;BN&#x27;</span>, requires_grad=<span class=\"literal\">True</span>),</span><br><span class=\"line\">        align_corners=<span class=\"literal\">False</span>,</span><br><span class=\"line\">        loss_decode=<span class=\"built_in\">dict</span>(</span><br><span class=\"line\">            <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;CrossEntropyLoss&#x27;</span>, use_sigmoid=<span class=\"literal\">False</span>, loss_weight=<span class=\"number\">1.0</span>)),</span><br><span class=\"line\">    auxiliary_head=<span class=\"built_in\">dict</span>(</span><br><span class=\"line\">        <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;FCNHead&#x27;</span>,</span><br><span class=\"line\">        in_channels=<span class=\"number\">1024</span>,</span><br><span class=\"line\">        in_index=<span class=\"number\">2</span>,</span><br><span class=\"line\">        channels=<span class=\"number\">256</span>,</span><br><span class=\"line\">        num_convs=<span class=\"number\">1</span>,</span><br><span class=\"line\">        concat_input=<span class=\"literal\">False</span>,</span><br><span class=\"line\">        dropout_ratio=<span class=\"number\">0.1</span>,</span><br><span class=\"line\">        num_classes=<span class=\"number\">6</span>,</span><br><span class=\"line\">        norm_cfg=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;BN&#x27;</span>, requires_grad=<span class=\"literal\">True</span>),</span><br><span class=\"line\">        align_corners=<span class=\"literal\">False</span>,</span><br><span class=\"line\">        loss_decode=<span class=\"built_in\">dict</span>(</span><br><span class=\"line\">            <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;CrossEntropyLoss&#x27;</span>, use_sigmoid=<span class=\"literal\">False</span>, loss_weight=<span class=\"number\">0.4</span>)),</span><br><span class=\"line\">    train_cfg=<span class=\"built_in\">dict</span>(),</span><br><span class=\"line\">    test_cfg=<span class=\"built_in\">dict</span>(mode=<span class=\"string\">&#x27;whole&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">dataset_type = <span class=\"string\">&#x27;WatermelonDataset&#x27;</span></span><br><span class=\"line\">data_root = <span class=\"string\">&#x27;watermelon/Watermelon87_Semantic_Seg_Mask/&#x27;</span></span><br><span class=\"line\">crop_size = (<span class=\"number\">256</span>, <span class=\"number\">256</span>)</span><br><span class=\"line\">train_pipeline = [</span><br><span class=\"line\">    <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;LoadImageFromFile&#x27;</span>),</span><br><span class=\"line\">    <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;LoadAnnotations&#x27;</span>),</span><br><span class=\"line\">    <span class=\"built_in\">dict</span>(</span><br><span class=\"line\">        <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;RandomResize&#x27;</span>,</span><br><span class=\"line\">        scale=(<span class=\"number\">2048</span>, <span class=\"number\">1024</span>),</span><br><span class=\"line\">        ratio_range=(<span class=\"number\">0.5</span>, <span class=\"number\">2.0</span>),</span><br><span class=\"line\">        keep_ratio=<span class=\"literal\">True</span>),</span><br><span class=\"line\">    <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;RandomCrop&#x27;</span>, crop_size=(<span class=\"number\">64</span>, <span class=\"number\">64</span>), cat_max_ratio=<span class=\"number\">0.75</span>),</span><br><span class=\"line\">    <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;RandomFlip&#x27;</span>, prob=<span class=\"number\">0.5</span>),</span><br><span class=\"line\">    <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;PhotoMetricDistortion&#x27;</span>),</span><br><span class=\"line\">    <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;PackSegInputs&#x27;</span>)</span><br><span class=\"line\">]</span><br><span class=\"line\">test_pipeline = [</span><br><span class=\"line\">    <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;LoadImageFromFile&#x27;</span>),</span><br><span class=\"line\">    <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;Resize&#x27;</span>, scale=(<span class=\"number\">2048</span>, <span class=\"number\">1024</span>), keep_ratio=<span class=\"literal\">True</span>),</span><br><span class=\"line\">    <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;LoadAnnotations&#x27;</span>),</span><br><span class=\"line\">    <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;PackSegInputs&#x27;</span>)</span><br><span class=\"line\">]</span><br><span class=\"line\">img_ratios = [<span class=\"number\">0.5</span>, <span class=\"number\">0.75</span>, <span class=\"number\">1.0</span>, <span class=\"number\">1.25</span>, <span class=\"number\">1.5</span>, <span class=\"number\">1.75</span>]</span><br><span class=\"line\">tta_pipeline = [</span><br><span class=\"line\">    <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;LoadImageFromFile&#x27;</span>, file_client_args=<span class=\"built_in\">dict</span>(backend=<span class=\"string\">&#x27;disk&#x27;</span>)),</span><br><span class=\"line\">    <span class=\"built_in\">dict</span>(</span><br><span class=\"line\">        <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;TestTimeAug&#x27;</span>,</span><br><span class=\"line\">        transforms=[[&#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;type&#x27;</span>: <span class=\"string\">&#x27;Resize&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;scale_factor&#x27;</span>: <span class=\"number\">0.5</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;keep_ratio&#x27;</span>: <span class=\"literal\">True</span></span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;type&#x27;</span>: <span class=\"string\">&#x27;Resize&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;scale_factor&#x27;</span>: <span class=\"number\">0.75</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;keep_ratio&#x27;</span>: <span class=\"literal\">True</span></span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;type&#x27;</span>: <span class=\"string\">&#x27;Resize&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;scale_factor&#x27;</span>: <span class=\"number\">1.0</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;keep_ratio&#x27;</span>: <span class=\"literal\">True</span></span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;type&#x27;</span>: <span class=\"string\">&#x27;Resize&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;scale_factor&#x27;</span>: <span class=\"number\">1.25</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;keep_ratio&#x27;</span>: <span class=\"literal\">True</span></span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;type&#x27;</span>: <span class=\"string\">&#x27;Resize&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;scale_factor&#x27;</span>: <span class=\"number\">1.5</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;keep_ratio&#x27;</span>: <span class=\"literal\">True</span></span><br><span class=\"line\">        &#125;, &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;type&#x27;</span>: <span class=\"string\">&#x27;Resize&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;scale_factor&#x27;</span>: <span class=\"number\">1.75</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;keep_ratio&#x27;</span>: <span class=\"literal\">True</span></span><br><span class=\"line\">        &#125;],</span><br><span class=\"line\">                    [&#123;</span><br><span class=\"line\">                        <span class=\"string\">&#x27;type&#x27;</span>: <span class=\"string\">&#x27;RandomFlip&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"string\">&#x27;prob&#x27;</span>: <span class=\"number\">0.0</span>,</span><br><span class=\"line\">                        <span class=\"string\">&#x27;direction&#x27;</span>: <span class=\"string\">&#x27;horizontal&#x27;</span></span><br><span class=\"line\">                    &#125;, &#123;</span><br><span class=\"line\">                        <span class=\"string\">&#x27;type&#x27;</span>: <span class=\"string\">&#x27;RandomFlip&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"string\">&#x27;prob&#x27;</span>: <span class=\"number\">1.0</span>,</span><br><span class=\"line\">                        <span class=\"string\">&#x27;direction&#x27;</span>: <span class=\"string\">&#x27;horizontal&#x27;</span></span><br><span class=\"line\">                    &#125;], [&#123;</span><br><span class=\"line\">                        <span class=\"string\">&#x27;type&#x27;</span>: <span class=\"string\">&#x27;LoadAnnotations&#x27;</span></span><br><span class=\"line\">                    &#125;], [&#123;</span><br><span class=\"line\">                        <span class=\"string\">&#x27;type&#x27;</span>: <span class=\"string\">&#x27;PackSegInputs&#x27;</span></span><br><span class=\"line\">                    &#125;]])</span><br><span class=\"line\">]</span><br><span class=\"line\">train_dataloader = <span class=\"built_in\">dict</span>(</span><br><span class=\"line\">    batch_size=<span class=\"number\">8</span>,</span><br><span class=\"line\">    num_workers=<span class=\"number\">2</span>,</span><br><span class=\"line\">    persistent_workers=<span class=\"literal\">True</span>,</span><br><span class=\"line\">    sampler=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;InfiniteSampler&#x27;</span>, shuffle=<span class=\"literal\">True</span>),</span><br><span class=\"line\">    dataset=<span class=\"built_in\">dict</span>(</span><br><span class=\"line\">        <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;DubaiDataset&#x27;</span>,</span><br><span class=\"line\">        data_root=<span class=\"string\">&#x27;watermelon/Watermelon87_Semantic_Seg_Mask/&#x27;</span>,</span><br><span class=\"line\">        data_prefix=<span class=\"built_in\">dict</span>(</span><br><span class=\"line\">            img_path=<span class=\"string\">&#x27;img_dir/train&#x27;</span>, seg_map_path=<span class=\"string\">&#x27;ann_dir/train&#x27;</span>),</span><br><span class=\"line\">        pipeline=[</span><br><span class=\"line\">            <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;LoadImageFromFile&#x27;</span>),</span><br><span class=\"line\">            <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;LoadAnnotations&#x27;</span>),</span><br><span class=\"line\">            <span class=\"built_in\">dict</span>(</span><br><span class=\"line\">                <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;RandomResize&#x27;</span>,</span><br><span class=\"line\">                scale=(<span class=\"number\">2048</span>, <span class=\"number\">1024</span>),</span><br><span class=\"line\">                ratio_range=(<span class=\"number\">0.5</span>, <span class=\"number\">2.0</span>),</span><br><span class=\"line\">                keep_ratio=<span class=\"literal\">True</span>),</span><br><span class=\"line\">            <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;RandomCrop&#x27;</span>, crop_size=(<span class=\"number\">64</span>, <span class=\"number\">64</span>), cat_max_ratio=<span class=\"number\">0.75</span>),</span><br><span class=\"line\">            <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;RandomFlip&#x27;</span>, prob=<span class=\"number\">0.5</span>),</span><br><span class=\"line\">            <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;PhotoMetricDistortion&#x27;</span>),</span><br><span class=\"line\">            <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;PackSegInputs&#x27;</span>)</span><br><span class=\"line\">        ]))</span><br><span class=\"line\">val_dataloader = <span class=\"built_in\">dict</span>(</span><br><span class=\"line\">    batch_size=<span class=\"number\">1</span>,</span><br><span class=\"line\">    num_workers=<span class=\"number\">4</span>,</span><br><span class=\"line\">    persistent_workers=<span class=\"literal\">True</span>,</span><br><span class=\"line\">    sampler=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;DefaultSampler&#x27;</span>, shuffle=<span class=\"literal\">False</span>),</span><br><span class=\"line\">    dataset=<span class=\"built_in\">dict</span>(</span><br><span class=\"line\">        <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;DubaiDataset&#x27;</span>,</span><br><span class=\"line\">        data_root=<span class=\"string\">&#x27;watermelon/Watermelon87_Semantic_Seg_Mask/&#x27;</span>,</span><br><span class=\"line\">        data_prefix=<span class=\"built_in\">dict</span>(img_path=<span class=\"string\">&#x27;img_dir/val&#x27;</span>, seg_map_path=<span class=\"string\">&#x27;ann_dir/val&#x27;</span>),</span><br><span class=\"line\">        pipeline=[</span><br><span class=\"line\">            <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;LoadImageFromFile&#x27;</span>),</span><br><span class=\"line\">            <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;Resize&#x27;</span>, scale=(<span class=\"number\">2048</span>, <span class=\"number\">1024</span>), keep_ratio=<span class=\"literal\">True</span>),</span><br><span class=\"line\">            <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;LoadAnnotations&#x27;</span>),</span><br><span class=\"line\">            <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;PackSegInputs&#x27;</span>)</span><br><span class=\"line\">        ]))</span><br><span class=\"line\">test_dataloader = <span class=\"built_in\">dict</span>(</span><br><span class=\"line\">    batch_size=<span class=\"number\">1</span>,</span><br><span class=\"line\">    num_workers=<span class=\"number\">4</span>,</span><br><span class=\"line\">    persistent_workers=<span class=\"literal\">True</span>,</span><br><span class=\"line\">    sampler=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;DefaultSampler&#x27;</span>, shuffle=<span class=\"literal\">False</span>),</span><br><span class=\"line\">    dataset=<span class=\"built_in\">dict</span>(</span><br><span class=\"line\">        <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;DubaiDataset&#x27;</span>,</span><br><span class=\"line\">        data_root=<span class=\"string\">&#x27;watermelon/Watermelon87_Semantic_Seg_Mask/&#x27;</span>,</span><br><span class=\"line\">        data_prefix=<span class=\"built_in\">dict</span>(img_path=<span class=\"string\">&#x27;img_dir/val&#x27;</span>, seg_map_path=<span class=\"string\">&#x27;ann_dir/val&#x27;</span>),</span><br><span class=\"line\">        pipeline=[</span><br><span class=\"line\">            <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;LoadImageFromFile&#x27;</span>),</span><br><span class=\"line\">            <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;Resize&#x27;</span>, scale=(<span class=\"number\">2048</span>, <span class=\"number\">1024</span>), keep_ratio=<span class=\"literal\">True</span>),</span><br><span class=\"line\">            <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;LoadAnnotations&#x27;</span>),</span><br><span class=\"line\">            <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;PackSegInputs&#x27;</span>)</span><br><span class=\"line\">        ]))</span><br><span class=\"line\">val_evaluator = <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;IoUMetric&#x27;</span>, iou_metrics=[<span class=\"string\">&#x27;mIoU&#x27;</span>])</span><br><span class=\"line\">test_evaluator = <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;IoUMetric&#x27;</span>, iou_metrics=[<span class=\"string\">&#x27;mIoU&#x27;</span>])</span><br><span class=\"line\">default_scope = <span class=\"string\">&#x27;mmseg&#x27;</span></span><br><span class=\"line\">env_cfg = <span class=\"built_in\">dict</span>(</span><br><span class=\"line\">    cudnn_benchmark=<span class=\"literal\">True</span>,</span><br><span class=\"line\">    mp_cfg=<span class=\"built_in\">dict</span>(mp_start_method=<span class=\"string\">&#x27;fork&#x27;</span>, opencv_num_threads=<span class=\"number\">0</span>),</span><br><span class=\"line\">    dist_cfg=<span class=\"built_in\">dict</span>(backend=<span class=\"string\">&#x27;nccl&#x27;</span>))</span><br><span class=\"line\">vis_backends = [<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;LocalVisBackend&#x27;</span>)]</span><br><span class=\"line\">visualizer = <span class=\"built_in\">dict</span>(</span><br><span class=\"line\">    <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;SegLocalVisualizer&#x27;</span>,</span><br><span class=\"line\">    vis_backends=[<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;LocalVisBackend&#x27;</span>)],</span><br><span class=\"line\">    name=<span class=\"string\">&#x27;visualizer&#x27;</span>)</span><br><span class=\"line\">log_processor = <span class=\"built_in\">dict</span>(by_epoch=<span class=\"literal\">False</span>)</span><br><span class=\"line\">log_level = <span class=\"string\">&#x27;INFO&#x27;</span></span><br><span class=\"line\">load_from = <span class=\"literal\">None</span></span><br><span class=\"line\">resume = <span class=\"literal\">False</span></span><br><span class=\"line\">tta_model = <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;SegTTAModel&#x27;</span>)</span><br><span class=\"line\">optimizer = <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;SGD&#x27;</span>, lr=<span class=\"number\">0.01</span>, momentum=<span class=\"number\">0.9</span>, weight_decay=<span class=\"number\">0.0005</span>)</span><br><span class=\"line\">optim_wrapper = <span class=\"built_in\">dict</span>(</span><br><span class=\"line\">    <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;OptimWrapper&#x27;</span>,</span><br><span class=\"line\">    optimizer=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;SGD&#x27;</span>, lr=<span class=\"number\">0.01</span>, momentum=<span class=\"number\">0.9</span>, weight_decay=<span class=\"number\">0.0005</span>),</span><br><span class=\"line\">    clip_grad=<span class=\"literal\">None</span>)</span><br><span class=\"line\">param_scheduler = [</span><br><span class=\"line\">    <span class=\"built_in\">dict</span>(</span><br><span class=\"line\">        <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;PolyLR&#x27;</span>,</span><br><span class=\"line\">        eta_min=<span class=\"number\">0.0001</span>,</span><br><span class=\"line\">        power=<span class=\"number\">0.9</span>,</span><br><span class=\"line\">        begin=<span class=\"number\">0</span>,</span><br><span class=\"line\">        end=<span class=\"number\">40000</span>,</span><br><span class=\"line\">        by_epoch=<span class=\"literal\">False</span>)</span><br><span class=\"line\">]</span><br><span class=\"line\">train_cfg = <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;IterBasedTrainLoop&#x27;</span>, max_iters=<span class=\"number\">3000</span>, val_interval=<span class=\"number\">400</span>)</span><br><span class=\"line\">val_cfg = <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;ValLoop&#x27;</span>)</span><br><span class=\"line\">test_cfg = <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;TestLoop&#x27;</span>)</span><br><span class=\"line\">default_hooks = <span class=\"built_in\">dict</span>(</span><br><span class=\"line\">    timer=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;IterTimerHook&#x27;</span>),</span><br><span class=\"line\">    logger=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;LoggerHook&#x27;</span>, interval=<span class=\"number\">100</span>, log_metric_by_epoch=<span class=\"literal\">False</span>),</span><br><span class=\"line\">    param_scheduler=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;ParamSchedulerHook&#x27;</span>),</span><br><span class=\"line\">    checkpoint=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;CheckpointHook&#x27;</span>, by_epoch=<span class=\"literal\">False</span>, interval=<span class=\"number\">1500</span>),</span><br><span class=\"line\">    sampler_seed=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;DistSamplerSeedHook&#x27;</span>),</span><br><span class=\"line\">    visualization=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;SegVisualizationHook&#x27;</span>))</span><br><span class=\"line\">work_dir = <span class=\"string\">&#x27;./work_dirs/watermelon&#x27;</span></span><br><span class=\"line\">randomness = <span class=\"built_in\">dict</span>(seed=<span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>主要是参考子豪兄的代码</p>\n<p><a href=\"https://github.com/TommyZihao/MMSegmentation_Tutorials.git\">https://github.com/TommyZihao/MMSegmentation_Tutorials.git</a></p>\n","tags":[{"name":"pytorch","slug":"pytorch","permalink":"http://yoursite.com/tags/pytorch/"},{"name":"segmentation","slug":"segmentation","permalink":"http://yoursite.com/tags/segmentation/"}]},{"title":"mmdet代码实战","date":"2023-06-10T09:01:45.000Z","path":"2023/06/10/mmdet代码实战/","content":"<h1 id=\"MMDetection代码实战\"><a href=\"#MMDetection代码实战\" class=\"headerlink\" title=\"MMDetection代码实战\"></a>MMDetection代码实战</h1><p>这一届主要讲解了，如何构建cfg，如何在目标检测上设置自己的配置文件。主要的思维导图如下</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/1686387759691MMDetection%E4%BB%A3%E7%A0%81.png\"></p>\n<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1.安装\"></a>1.安装</h2><p>直接跳过</p>\n<h2 id=\"2-设置配置文件\"><a href=\"#2-设置配置文件\" class=\"headerlink\" title=\"2.设置配置文件\"></a>2.设置配置文件</h2><p>我们首先设置metainfo，因为只有一个猫类，所以我们只写猫，还有类别是1，那么head头输出就是1，然后设置dataset，首先是设置metainfo，然后就是设置json文件，还有iimg的文件，之后就是设置学习率，还有一些保存checkpoint的配置。</p>\n<p>为了验证模型的数据对不对，我们使用自定义代买来进行检查，传入到cfg，之后吧dataset进行可视化</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 现在是测试cfg对不对的</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> mmdet.registry <span class=\"keyword\">import</span> DATASETS,VISUALIZERS</span><br><span class=\"line\"><span class=\"keyword\">from</span> mmengine.config <span class=\"keyword\">import</span> Config</span><br><span class=\"line\"><span class=\"keyword\">from</span> mmengine.registry <span class=\"keyword\">import</span> init_default_scope</span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\">cfg = Config.fromfile(<span class=\"string\">&#x27;./rtmdet_tiny_1xb12-40e_balloon.py&#x27;</span>)</span><br><span class=\"line\">init_default_scope(cfg.get(<span class=\"string\">&#x27;default_scope&#x27;</span>,<span class=\"string\">&#x27;mmdet&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">dataset = DATASETS.build(cfg.train_dataloader.dataset)</span><br><span class=\"line\">visualizer = VISUALIZERS.build(cfg.visualizer)</span><br><span class=\"line\">visualizer.dataset_meta = dataset.metainfo</span><br><span class=\"line\"></span><br><span class=\"line\">plt.figure(figsize=(<span class=\"number\">16</span>,<span class=\"number\">5</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">8</span>):</span><br><span class=\"line\">    item = dataset[i]</span><br><span class=\"line\">    img = item[<span class=\"string\">&#x27;inputs&#x27;</span>].permute(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">0</span>).numpy()</span><br><span class=\"line\">    data_sample = item[<span class=\"string\">&#x27;data_samples&#x27;</span>].numpy()</span><br><span class=\"line\">    gt_instances =data_sample.gt_instances</span><br><span class=\"line\">    img_path = os.path.basename(item[<span class=\"string\">&#x27;data_samples&#x27;</span>].img_path)</span><br><span class=\"line\">    </span><br><span class=\"line\">    gt_bboxes = gt_instances.get(<span class=\"string\">&#x27;bboxes&#x27;</span>,<span class=\"literal\">None</span>)</span><br><span class=\"line\">    gt_instances.bboxes = gt_bboxes.tensor</span><br><span class=\"line\">    data_sample.gt_instances = gt_instances</span><br><span class=\"line\">    </span><br><span class=\"line\">    visualizer.add_datasample(</span><br><span class=\"line\">        os.path.basename(img_path),</span><br><span class=\"line\">        img,</span><br><span class=\"line\">        data_sample,</span><br><span class=\"line\">        draw_pred=<span class=\"literal\">False</span>,</span><br><span class=\"line\">        show = <span class=\"literal\">False</span>,</span><br><span class=\"line\">    )</span><br><span class=\"line\">    drawed_image = visualizer.get_image()</span><br><span class=\"line\">    </span><br><span class=\"line\">    plt.subplot(<span class=\"number\">2</span>,<span class=\"number\">4</span>,i+<span class=\"number\">1</span>)</span><br><span class=\"line\">    plt.imshow(drawed_image[...,[<span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">0</span>]])    </span><br><span class=\"line\">    plt.title(img_path)</span><br><span class=\"line\">    plt.xticks([])</span><br><span class=\"line\">    plt.yticks([])</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>之后就是训练阶段，使用train来进行训练</p>\n<h2 id=\"3-测试与分析\"><a href=\"#3-测试与分析\" class=\"headerlink\" title=\"3.测试与分析\"></a>3.测试与分析</h2><p>测试与之前一样，使用test来测，使用–show dir可以可视化。之后就是对图像进行特征化，这个时候需要借助mmyolo的功能，因此需要下载mmyolo</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python demo/featmap_vis_demo.py 5555705118_3390d70abe_b.jpg ../mmdetection/rtmdet_tiny_1xb12-40e_balloon.py ../mmdetection/work_dirs/rtmdet_tiny_1xb12-40e_balloon/best_coco_bbox_mAP_epoch_80.pth --channel-reduction squeeze_mean --target-layers neck</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python demo/boxam_vis_demo.py 5555705118_3390d70abe_b.jpg ../mmdetection/rtmdet_tiny_1xb12-40e_balloon.py ../mmdetection/work_dirs/rtmdet_tiny_1xb12-40e_balloon/best_coco_bbox_mAP_epoch_80.pth --target-layer neck.out_convs[2]</span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"pytorch","slug":"pytorch","permalink":"http://yoursite.com/tags/pytorch/"},{"name":"detection","slug":"detection","permalink":"http://yoursite.com/tags/detection/"}]},{"title":"mmpretrain实战","date":"2023-06-07T08:04:01.000Z","path":"2023/06/07/mmpretrain实战/","content":"<h1 id=\"mmpretrain实战\"><a href=\"#mmpretrain实战\" class=\"headerlink\" title=\"mmpretrain实战\"></a>mmpretrain实战</h1><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/1686128130571mmpretrain.png\"></p>\n<p>主要讲解了安装,还有使用教程.安装教程直接参考官网.下面讲解一下mmpretrain使用</p>\n<h2 id=\"实战教程\"><a href=\"#实战教程\" class=\"headerlink\" title=\"实战教程\"></a>实战教程</h2><h3 id=\"2-1简单使用\"><a href=\"#2-1简单使用\" class=\"headerlink\" title=\"2.1简单使用\"></a>2.1简单使用</h3><p>我们可以直接从定义好的模型来进行推理,首先list_model可以列出所有的分类,然后通过关键字可以识别出来resnet所有的模型,然后我们通过get_model,输入关键字就可以得到模型,之后,我们通过使用inference来进行传入模型,还有ckp,还有图形就可以直接来进行推理.</p>\n<h3 id=\"2-2自定义使用\"><a href=\"#2-2自定义使用\" class=\"headerlink\" title=\"2.2自定义使用\"></a>2.2自定义使用</h3><p>首先整个mmlab都是通过使用cfg来进行配置的,所以我们如果要进行自己的resnet50配置,我们可以从官网的cfg来进行参考.</p>\n<p>首先是模型,模型分为backbone骨干网络,head就是输出头,使用neck来进行连接网络.然后最后的loss,实在模型里就定义号了,使用的是topk</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># model settings</span></span><br><span class=\"line\">model = <span class=\"built_in\">dict</span>(</span><br><span class=\"line\">    <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;ImageClassifier&#x27;</span>,</span><br><span class=\"line\">    backbone=<span class=\"built_in\">dict</span>(</span><br><span class=\"line\">        <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;ResNet&#x27;</span>,</span><br><span class=\"line\">        depth=<span class=\"number\">50</span>,</span><br><span class=\"line\">        num_stages=<span class=\"number\">4</span>,</span><br><span class=\"line\">        out_indices=(<span class=\"number\">3</span>, ),</span><br><span class=\"line\">        style=<span class=\"string\">&#x27;pytorch&#x27;</span>),</span><br><span class=\"line\">    neck=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;GlobalAveragePooling&#x27;</span>),</span><br><span class=\"line\">    head=<span class=\"built_in\">dict</span>(</span><br><span class=\"line\">        <span class=\"built_in\">type</span>=<span class=\"string\">&#x27;LinearClsHead&#x27;</span>,</span><br><span class=\"line\">        num_classes=<span class=\"number\">33</span>,</span><br><span class=\"line\">        in_channels=<span class=\"number\">2048</span>,</span><br><span class=\"line\">        loss=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;CrossEntropyLoss&#x27;</span>, loss_weight=<span class=\"number\">1.0</span>),</span><br><span class=\"line\">        topk=(<span class=\"number\">1</span>, <span class=\"number\">5</span>),</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    init_cfg = <span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;Pretrained&#x27;</span>,checkpoint = <span class=\"string\">&#x27;https://download.openmmlab.com/mmclassification/v0/resnet/resnet50_8xb32_in1k_20210831-ea4938fc.pth&#x27;</span>)</span><br><span class=\"line\">    )</span><br></pre></td></tr></table></figure>\n\n<p>之后就是dataset的配置,我们使用的type是自定义的type,设置输入的train,还有val路径,之后设置val的评估指标,使用top1.</p>\n<p>下面就是训练时候的配置,循环次数,还有优化器</p>\n<p>最后就是训练时候的配置,自动保存权重最高的,还有值保留最近5个文件</p>\n<p>剩下的地方可以设置args参数 例如load_file还有work-dir</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">work_dir = <span class=\"string\">&#x27;./exp&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">checkpoint=<span class=\"built_in\">dict</span>(<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;CheckpointHook&#x27;</span>, interval=<span class=\"number\">1</span>,max_keep_ckpts=<span class=\"number\">5</span>,save_best=<span class=\"string\">&#x27;auto&#x27;</span>),</span><br></pre></td></tr></table></figure>\n","tags":[{"name":"mmlab","slug":"mmlab","permalink":"http://yoursite.com/tags/mmlab/"},{"name":"image classification","slug":"image-classification","permalink":"http://yoursite.com/tags/image-classification/"}]},{"title":"MMPose实战","date":"2023-06-03T11:33:33.000Z","path":"2023/06/03/MMPose实战/","content":"<h1 id=\"1-mmpose实战\"><a href=\"#1-mmpose实战\" class=\"headerlink\" title=\"1.mmpose实战\"></a>1.mmpose实战</h1><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/1685794454339MMPose%E5%AE%9E%E6%88%98.png\"></p>\n<p>主要包括安装，mmdet实战，mmpose实战等三部分</p>\n<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1.安装\"></a>1.安装</h2><p>安装方法，可以直接去看官网教程，主要是是首先下载pytorch，之后下载mmcv，使用mim来进行安装。然后在github下载源码，使用源码进行安装。难点包括网速原因（ladder或者是搜索加速网站）</p>\n<p>建议新装一个环境，pytorch和mmcv要一一对应。我之前是2.0.安装之后无法训练，是版本原因。所以重装了一个conda环境。</p>\n<h2 id=\"2-mmdet\"><a href=\"#2-mmdet\" class=\"headerlink\" title=\"2.mmdet\"></a>2.mmdet</h2><p>mmlab代码的整体训练流程</p>\n<ol>\n<li>数据集同意处理程coco的格式，使用lableme</li>\n<li>设置cfg配置文件，这个歌文件包括模型，优化器，超参数，数据集还有pipeline，和权重</li>\n<li>使用train来训练上述cfg或者是分布式训练使用bash脚本bash dist——train模型cfg</li>\n<li>之后就是使用test来进行验证文件 test 模型 +pth进行验证</li>\n<li>之后就是预测，一般使用命令行得到结果</li>\n</ol>\n<h2 id=\"3-mmpose\"><a href=\"#3-mmpose\" class=\"headerlink\" title=\"3.mmpose\"></a>3.mmpose</h2><p>与mmdet同理，还是多个步骤</p>\n<p>最后一步是集合mmdet的权重+mmpose的权重来指定向下来进行预测</p>\n<h2 id=\"4-作业\"><a href=\"#4-作业\" class=\"headerlink\" title=\"4.作业\"></a>4.作业</h2><p>关于中医耳朵</p>\n<ol>\n<li>首先是数据集下载，使用bypy这个python包进行下载</li>\n<li>使用mmdet的训练流程来进行训练</li>\n<li>使用mmposexunlliucheng进行训练</li>\n<li>使用test来进行计算准确率</li>\n<li>集合上述两个一起进行结果预测</li>\n</ol>\n","tags":[{"name":"mmlab","slug":"mmlab","permalink":"http://yoursite.com/tags/mmlab/"}]},{"title":"人体关键点检测","date":"2023-06-02T13:28:46.000Z","path":"2023/06/02/人体关键点检测/","content":"<h1 id=\"人体关键点检测\"><a href=\"#人体关键点检测\" class=\"headerlink\" title=\"人体关键点检测\"></a>人体关键点检测</h1><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/1685712470039%E4%BA%BA%E4%BD%93%E5%85%B3%E9%94%AE%E6%A3%80%E6%B5%8B.png\"></p>\n<p>今天，这一节课的内容主要可以看成，人体关键点检测的综述。包括2d，3d人天姿态检测。主要介绍上述的算法，还有包括常用评价指标。</p>\n<h2 id=\"1-检测思路\"><a href=\"#1-检测思路\" class=\"headerlink\" title=\"1.检测思路\"></a>1.检测思路</h2><h3 id=\"1-1自顶向下\"><a href=\"#1-1自顶向下\" class=\"headerlink\" title=\"1.1自顶向下\"></a>1.1自顶向下</h3><p>思路就是首先识别出人，之后在进行关键点识别，这样的缺点就是整体精度收到检测器算法，还有一个就是计算量太大了。</p>\n<h3 id=\"1-2自底向上\"><a href=\"#1-2自底向上\" class=\"headerlink\" title=\"1.2自底向上\"></a>1.2自底向上</h3><p>先识别关键点，之后再次识别人类。计算量就少很多。</p>\n<h3 id=\"1-3基于回归的\"><a href=\"#1-3基于回归的\" class=\"headerlink\" title=\"1.3基于回归的\"></a>1.3基于回归的</h3><p>根据图像直接回归出来坐标</p>\n<h3 id=\"1-4基于热力图\"><a href=\"#1-4基于热力图\" class=\"headerlink\" title=\"1.4基于热力图\"></a>1.4基于热力图</h3><p>热力图是输出与原图比例一样的图像，但是每一个通道里面，关键点的坐标是1.预测出关键点既可以进行绘制。同时关键点一般使用max，或者是进行求期望获得</p>\n<h2 id=\"2-2d检测\"><a href=\"#2-2d检测\" class=\"headerlink\" title=\"2.2d检测\"></a>2.2d检测</h2><h3 id=\"2-1自顶向下\"><a href=\"#2-1自顶向下\" class=\"headerlink\" title=\"2.1自顶向下\"></a>2.1自顶向下</h3><p>回归：包括DeepPOse（直接输出坐标），级联DeepPose，RLE（借鉴Flow思想，把分布运用多个高斯分布来进行拟合）</p>\n<p>热力图：HourGlass（跳连接，是对称的自己），baseline（resnet+反卷积），HRNET（高分辨率，自己生成高分辨率+低分辨率的）</p>\n<h3 id=\"2-2自底向上\"><a href=\"#2-2自底向上\" class=\"headerlink\" title=\"2.2自底向上\"></a>2.2自底向上</h3><p>openPose：先进行预测关键点，然后计算亲和度，高得就是同一个人</p>\n<h3 id=\"2-3单阶段\"><a href=\"#2-3单阶段\" class=\"headerlink\" title=\"2.3单阶段\"></a>2.3单阶段</h3><p>一个阶段就可以结算出来结果。</p>\n<p>包括：SPM（回归位置+方向向量），层级SPM（分部位来进行回归）</p>\n<h3 id=\"2-4TRansform\"><a href=\"#2-4TRansform\" class=\"headerlink\" title=\"2.4TRansform\"></a>2.4TRansform</h3><p>PPTR：都是用一套DeRT个骨干网络，先框选人，之后关键点预测的时候把transform里面的q换成关键点）</p>\n<p>TokenPose：cnn得到特征信息，之后在与pose信息一起add，然后放入到transform进行炼丹</p>\n<h2 id><a href=\"#\" class=\"headerlink\" title></a></h2><h2 id=\"3-3d检测\"><a href=\"#3-3d检测\" class=\"headerlink\" title=\"3.3d检测\"></a>3.3d检测</h2><p>难点就是如何从2位换源到3维</p>\n<p>解决思路：</p>\n<ol>\n<li>直接2d还原生成3d   coarse</li>\n<li>利用视频，首先生成单帧的2d ，之后2d再次生3d  cideoPOse</li>\n<li>利用多个视角   voxelPose</li>\n</ol>\n<h2 id=\"4-评价指标\"><a href=\"#4-评价指标\" class=\"headerlink\" title=\"4.评价指标\"></a>4.评价指标</h2><p>PCP：准确率</p>\n<p>PDJ：在一定比例</p>\n<p>PCK：在阈值范围里</p>\n<p>oks：计算公式</p>\n<h2 id=\"5-DensePOse\"><a href=\"#5-DensePOse\" class=\"headerlink\" title=\"5.DensePOse\"></a>5.DensePOse</h2><p>把人体划分成24块，每一个部分256*256，有14个关键点</p>\n<p>主要算法包括：rcnn+dense reg，SMPL，SMPLisy和HMR</p>\n","tags":[{"name":"MMPose","slug":"MMPose","permalink":"http://yoursite.com/tags/MMPose/"},{"name":"cv","slug":"cv","permalink":"http://yoursite.com/tags/cv/"}]},{"title":"mmlab简介","date":"2023-06-01T11:50:44.000Z","path":"2023/06/01/mmlab简介/","content":"<h1 id=\"mmlab简介\"><a href=\"#mmlab简介\" class=\"headerlink\" title=\"mmlab简介\"></a>mmlab简介</h1><p>mmlab算法库是mmlab实验室在github上开源的一系列算法。由港中文的汤晓鸥教授建立的。本节主要介绍mmlab算法库相关简介</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16856202144211685620214365.png\"></p>\n<p>思维导图如上。主要包括目标检测，3d点云，图像分割，图像识别，视频理解，还有AIGC等相关应用。最后还有部署的算法库mmdeploy。目前几乎涵盖了计算机视觉相关的所有领域。在学术界还有工业界都被广泛的使用</p>\n","tags":[{"name":"pytorch","slug":"pytorch","permalink":"http://yoursite.com/tags/pytorch/"},{"name":"mmlab","slug":"mmlab","permalink":"http://yoursite.com/tags/mmlab/"}]},{"title":"deepin安装docker和pytorch","date":"2023-06-01T09:28:58.000Z","path":"2023/06/01/deepin安装docker/","content":"<h1 id=\"deepin安装docker和pytorch\"><a href=\"#deepin安装docker和pytorch\" class=\"headerlink\" title=\"deepin安装docker和pytorch\"></a>deepin安装docker和pytorch</h1><p>总体的流程图大致如下，首先是安装linux，这个直接跳过，接下来就是安装docker，之后，安装docker之后，安装pytorch image，然后使用vscode来进行深度学习开发。这样。不需要每次都要进行配置环境，直接使用这个镜像，构建多个容器，可以互不影响。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/1685611681945deepin%E5%AE%89%E8%A3%85docker.png\"></p>\n<h2 id=\"1-docker相关设置\"><a href=\"#1-docker相关设置\" class=\"headerlink\" title=\"1.docker相关设置\"></a>1.docker相关设置</h2><h3 id=\"1-docker安装\"><a href=\"#1-docker安装\" class=\"headerlink\" title=\"1.docker安装\"></a>1.docker安装</h3><blockquote>\n<p>前情提示，由于dockerhub，最近几天已经被gfw给404了，建议首先安装好了就来进行更换镜像。</p>\n</blockquote>\n<p>由于deepin是Debian的分支，因此我们选择Debian的安装命令，详细教程参考<a href=\"https://www.runoob.com/docker/debian-docker-install.html\">Debian Docker 安装 | 菜鸟教程 (runoob.com)</a></p>\n<p>主要命令就是</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://get.docker.com -o get-docker.sh</span><br><span class=\"line\">sudo sh get-docker.sh</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意，安装完成之后，请务必换源</strong></p>\n<p><a href=\"https://www.runoob.com/docker/docker-mirror-acceleration.html\">Docker 镜像加速 | 菜鸟教程 (runoob.com)</a></p>\n<p>主要是在下面进行在  &#x2F;etc&#x2F;docker&#x2F;daemon.json 下面增加源，这个地方也可以修改，image默认下载的地方</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&quot;registry-mirrors&quot;:[&quot;https://reg-mirror.qiniu.com/&quot;]&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sudo systemctl daemon-reload</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sudo systemctl restart docker</span></span><br></pre></td></tr></table></figure>\n\n<p>之后执行重启。</p>\n<h3 id=\"1-2加入到docker用户组\"><a href=\"#1-2加入到docker用户组\" class=\"headerlink\" title=\"1.2加入到docker用户组\"></a>1.2加入到docker用户组</h3><p>之后，因为使用docker默认是需要特权docker组里的成员才能使用，所以我们需要把当前用户加入到docker组里面</p>\n<p>主要参考的是这个博文，首先查看是不是已经有了docker用户组，已经有了我们直接进行加入当前用户，然后进行重启。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cat /etc/group | grep docker</span><br><span class=\"line\"></span><br><span class=\"line\">sudo usermod -aG docker 要添加的user</span><br><span class=\"line\"></span><br><span class=\"line\">sudo chmod a+rw /var/run/docker.sock</span><br><span class=\"line\"></span><br><span class=\"line\">sudo systemctl restart docker</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"1-3附加内容（配置自己的images）\"><a href=\"#1-3附加内容（配置自己的images）\" class=\"headerlink\" title=\"1.3附加内容（配置自己的images）\"></a>1.3附加内容（配置自己的images）</h3><p>每次换到一个新电脑的时候，最麻烦的事情就是进行环境配置，下载所需要的安装软件，一个个的执行。现在有了docker，我们可以直接去dockerhub你输入命令来得到所需要的环境。例如java开发的环境（mysql，MongoDB和redis等）。</p>\n<p>参考下面的教程：</p>\n<p><a href=\"https://blog.chennn.com/docker-build-java-development-environment/\">Docker搭建Java开发环境 (chennn.com)</a></p>\n<p>现在我要构建一个属于自己的开发环境，例如只需要java和maven，那么我们改如何得到呢。现在，这里我们需要使用的是dockerfile这个文件，通过这个文件看我们可以构建出来哦自己的images。</p>\n<p>。dockerfile语法如下 ：<a href=\"https://www.runoob.com/docker/docker-dockerfile.html\">Docker Dockerfile | 菜鸟教程 (runoob.com)</a></p>\n<p>首先需要定义一个from，这个就相当于原始文件，我们首先定义from openjdk，来作为自己的原始image，之后根据自己的需要来进行修改。之后，我们需要使用maven，这里我们选择编译安装。分为下面几步。</p>\n<ol>\n<li>下载maven源码</li>\n<li>进行解压</li>\n<li>然后进行移动到local目录里面</li>\n<li>设置环境变量</li>\n</ol>\n<p>我们使用run 来执行每一个shell 命令，</p>\n<p>之后就是设置环境变量，因为gfw的原因，有时候，我们需要使用代理，还有吧上面的源码放入到env上面，所以需要使用或者其他端口隐射到envv来进行设置。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM openjdk:8</span><br><span class=\"line\"></span><br><span class=\"line\">RUN wget https://dlcdn.apache.org/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.zip</span><br><span class=\"line\">RUN unzip apache-maven-3.8.6-bin.zip</span><br><span class=\"line\">RUN mv apache-maven-3.8.6 /usr/local/maven</span><br><span class=\"line\">RUN rm -rf apache-maven-3.8.6-bin.zip</span><br><span class=\"line\"></span><br><span class=\"line\">ENV MAVEN_HOME=/usr/local/maven</span><br><span class=\"line\">ENV PATH=$MAVEN_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>\n\n<p>这样，我们就构建好了自己的开发包。</p>\n<p>上面的代码还可以精简，我们只需要使用一个run ，剩下的全部用&amp;&amp;连接shell命令就可以</p>\n<p>然后 我们进行构建，使用这个dockerfile</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker build -t java-env:8 .</span><br></pre></td></tr></table></figure>\n\n<p>最后我们就是启动容器</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -itd --name java-base-env java-env:8</span><br></pre></td></tr></table></figure>\n\n<p>如果需要进入到容器内部，我们可以使用docker exec -it 容器名称</p>\n<hr>\n<blockquote>\n<p>扩展：使用gateway来进行远程开发。我们可以在images里面安装openssherver，然后修改、etc&#x2F;ssh&#x2F;sshd_config里面的允许root登录还有密码登录，之后，设置这个为自动启动。</p>\n</blockquote>\n<p>参考下面这个连接：<a href=\"https://zhuanlan.zhihu.com/p/80099904\">VSCode+Docker: 打造最舒适的深度学习环境 - 知乎 (zhihu.com)</a></p>\n<p>之后，我们在docker启动的时候设置端口映射这个容器，吧9001或者其他端口映射到22，然后使用gateway进行远程连接，输入端口9001，账户密码，就可以进行开发了。</p>\n<h2 id=\"2-deepin配置pytorch镜像\"><a href=\"#2-deepin配置pytorch镜像\" class=\"headerlink\" title=\"2.deepin配置pytorch镜像\"></a>2.deepin配置pytorch镜像</h2><h3 id=\"2-1deepin的设置\"><a href=\"#2-1deepin的设置\" class=\"headerlink\" title=\"2.1deepin的设置\"></a>2.1deepin的设置</h3><p>首先，我们需要对deepin进行设置，默认没有安装cuda，我们直接使用deepin官方的命令，安装cuda-toolkit，还有nvidia-smi进行apt安装。之后就完成了。有些版本是需屏蔽自己显卡，然后才能安装，笔者目前没有与到，安装比较简单。命令都在开始的思维导图上面。</p>\n<h3 id=\"2-2（可选）配置proxychains\"><a href=\"#2-2（可选）配置proxychains\" class=\"headerlink\" title=\"2.2（可选）配置proxychains\"></a>2.2（可选）配置proxychains</h3><p>来进行国内访问加速，直接apt 进行安装就行，然后修改配置文件 &#x2F;etc&#x2F;proxychains.conf。</p>\n<p>参考这篇文章 <a href=\"https://zhuanlan.zhihu.com/p/166375631\">linux命令行代理神器-proxychains - 知乎 (zhihu.com)</a></p>\n<p>在.bashrc里面设置alias pr &#x3D;proxychains，进行缩短单词</p>\n<h3 id=\"2-3安装pytorch\"><a href=\"#2-3安装pytorch\" class=\"headerlink\" title=\"2.3安装pytorch\"></a>2.3安装pytorch</h3><p>直接根据沐神的github推荐的image来使用</p>\n<p><a href=\"https://github.com/mli/transformers-benchmarks\">mli&#x2F;transformers-benchmarks: real Transformer TeraFLOPS on various GPUs (github.com)</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run --gpus all -it --rm -p 8888:8888 -v ~:/workspace \\</span><br><span class=\"line\">\t--ipc=host --ulimit memlock=-1 --ulimit stack=67108864 \\</span><br><span class=\"line\">\tnvcr.io/nvidia/pytorch:22.07-py3</span><br></pre></td></tr></table></figure>\n\n<p>这样我们直接进入到容器里面了。我们使用screen 吧这个容器放入到后台执行。</p>\n<p>这样就安装完成。同事还把我们的home目录隐射到workdir里面，我们可以访问到workdir的文件来找到服务器的文件</p>\n<h2 id=\"3-vscode-x2F-idea-x2F-pycharm的使用\"><a href=\"#3-vscode-x2F-idea-x2F-pycharm的使用\" class=\"headerlink\" title=\"3.vscode&#x2F;idea&#x2F;pycharm的使用\"></a>3.vscode&#x2F;idea&#x2F;pycharm的使用</h2><h3 id=\"3-1vscode进行配置\"><a href=\"#3-1vscode进行配置\" class=\"headerlink\" title=\"3.1vscode进行配置\"></a>3.1vscode进行配置</h3><p>我们首先进去插件商店，安装dev dontainer。之后使用远程连接到docker宿主机上 </p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16856142119451685614211207.png\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16856142399431685614239438.png\"></p>\n<p>在宿主机上面选择开发容器，我们就可以进入到刚刚的pytorch容器里面</p>\n<h3 id=\"3-2idea的设置\"><a href=\"#3-2idea的设置\" class=\"headerlink\" title=\"3.2idea的设置\"></a>3.2idea的设置</h3><p>这里直接使用gateway来进行设置，选择新建一个ssh，我们输入之前映射到22的端口，还有账号密码（详情加1.3），然后进行连接，之后选择后端版本的idea，这样idea后端就部署到容器里面。之后，我们就可以进行远程及开发</p>\n<h3 id=\"3-2pycharm设置\"><a href=\"#3-2pycharm设置\" class=\"headerlink\" title=\"3.2pycharm设置\"></a>3.2pycharm设置</h3><p>对于pycharm，不需要上述那么复杂，我们直接进行远程开发，ssh到宿主机器的22端口，然后我们选择解释器interpret为docker里面的容器，就可以直接执行python代码，来进行调试开发了。</p>\n","tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"torch","slug":"torch","permalink":"http://yoursite.com/tags/torch/"},{"name":"docker","slug":"docker","permalink":"http://yoursite.com/tags/docker/"}]},{"title":"mysql学习","date":"2023-04-19T11:25:58.000Z","path":"2023/04/19/mysql学习/","content":"<h1 id=\"MySQL是怎样运行的\"><a href=\"#MySQL是怎样运行的\" class=\"headerlink\" title=\"MySQL是怎样运行的\"></a>MySQL是怎样运行的</h1><h2 id=\"0-语法篇\"><a href=\"#0-语法篇\" class=\"headerlink\" title=\"0.语法篇\"></a>0.语法篇</h2><p>常用的关键字:</p>\n<ol>\n<li>distinct,select distinct* from来进行去重</li>\n<li>排序order by id des(下降</li>\n<li>in(a,b)&#x3D;&#x3D;a or b</li>\n<li>查询的时候,列可以直接进行操作,如果我们要求对(欸一个分数+10)&#x3D;&#x3D;select score+10 from</li>\n<li>null无论什么操作还是null</li>\n<li>字符串函数啊,left,right,substr都是进行截取</li>\n<li>count(列名)就是来进行统计由多少个</li>\n<li>分组查询,这个相当于多个目录(省,市,县来进行分段)使用group by province</li>\n<li>例如求语文,英语,数学的平均分,写三个函数太累,select avg(subject) from group by subject</li>\n<li>分组之后先接着进行过滤,例如,只想统计分数平均值大于60,后面市having by(不能用where,因为这是计算后的结果)</li>\n<li>多表查询,外连接,分为做连接,还有右连接(核心就是完整的保留那一边),内连接就是只有都相等才进行保留</li>\n<li>子查询,select * where id&#x3D;(查询语句),根据查询语句返回的结果再次进行查询</li>\n<li>并集查询,使用union查询多个,会过滤重复的结果</li>\n<li>视图view,相当于自己预先定义函数,然后进行了查询的结果存放的地方,再视图里操作页会影响原始表</li>\n<li>储存程序,相当于函数,可以设定变量,@a来进行对变量a来进行赋值,会有返回值</li>\n<li>储存过程,没有返回值,直接进行操作</li>\n<li>下一个就是游标,相当于list</li>\n<li>trigger触发器,就是进行检查,可以自定义每次增加删除,检查分数是不是小于100</li>\n</ol>\n<h2 id=\"1-前言篇\"><a href=\"#1-前言篇\" class=\"headerlink\" title=\"1.前言篇\"></a>1.前言篇</h2><blockquote>\n<p>执行一条sql,都发生了什么</p>\n</blockquote>\n<p>主要包含一下流程,首先是连接启,之后查询缓存,缓存失败,进行语法分析,解析阿来就是对语法进行优化,然后才是执行,之后返回结果</p>\n<p><img src=\"https://cdn.xiaolincoding.com/gh/xiaolincoder/mysql/sql%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B/mysql%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B.png\" alt=\"查询语句执行流程\"></p>\n<ol>\n<li>server负责api的调用,分析还有执行sql,常用的存储过程还有触发器,视图都在这一层</li>\n<li>存储层负责的是数据的存放还读取,数据库的innodb索引都在这一层</li>\n</ol>\n<h3 id=\"1-连接器\"><a href=\"#1-连接器\" class=\"headerlink\" title=\"1.连接器\"></a>1.连接器</h3><p>负责身份认证还有权限相关的(登录mysql的时候)</p>\n<p>show processlist查看当前的连接数目,空闲时间超过wait_time会哦被断开,最大的连接再max_connection上面,</p>\n<h3 id=\"2-查询缓存\"><a href=\"#2-查询缓存\" class=\"headerlink\" title=\"2.查询缓存\"></a>2.查询缓存</h3><p>mysql8.0删除这个功能了因为对于更新比较频繁的表,这个缓存基本就没有用,更新一次就删除缓存一次.</p>\n<h3 id=\"3-分析器\"><a href=\"#3-分析器\" class=\"headerlink\" title=\"3.分析器\"></a>3.分析器</h3><p>作用就是对语句进行分析,看这条语句要干什么.主要包括语法分析还有此法分析,语法分析就是看你是不是输入错误的单词,此法分析就是提取关键词</p>\n<h3 id=\"4-执行器\"><a href=\"#4-执行器\" class=\"headerlink\" title=\"4.执行器\"></a>4.执行器</h3><p>执行sql查询语句,首先第一步就是看你有没有权限来查这个</p>\n<ol>\n<li>预处理器,检查是不是含有这个字段,把*替换成全表</li>\n<li>优化器主要确定查询方案,因为一个数据库可能有多条索引,查找时间最小的</li>\n<li>执行器执行,主键索引查询,全表查询,索引下推(建立二级索引agename,这个索引,直接根据开闭原则来进行判断)</li>\n</ol>\n<h2 id=\"2-mysql的一行记录是怎么存放的\"><a href=\"#2-mysql的一行记录是怎么存放的\" class=\"headerlink\" title=\"2.mysql的一行记录是怎么存放的\"></a>2.mysql的一行记录是怎么存放的</h2><blockquote>\n<p>可以看到，共有三个文件，这三个文件分别代表着：</p>\n<ul>\n<li>db.opt，用来存储当前数据库的默认字符集和字符校验规则。</li>\n<li>t_order.frm ，t_order 的<strong>表结构</strong>会保存在这个文件。在 MySQL 中建立一张表都会生成一个.frm 文件，该文件是用来保存每个表的元数据信息的，主要包含表结构定义。</li>\n<li>t_order.ibd，t_order 的<strong>表数据</strong>会保存在这个文件。表数据既可以存在共享表空间文件（文件名：ibdata1）里，也可以存放在独占表空间文件（文件名：表名字.ibd）。这个行为是由参数 innodb_file_per_table 控制的，若设置了参数 innodb_file_per_table 为 1，则会将存储的数据、索引等信息单独存储在一个独占表空间，从 MySQL 5.6.6 版本开始，它的默认值就是 1 了，因此从这个版本之后， MySQL 中每一张表的数据都存放在一个独立的 .ibd 文件。</li>\n</ul>\n<p>好了，现在我们知道了一张数据库表的数据是保存在「 表名字.ibd 」的文件里的，这个文件也称为独占表空间文件</p>\n</blockquote>\n<p>一张表的结构再frm里面,数据再ibd里面</p>\n<p><img src=\"https://cdn.xiaolincoding.com/gh/xiaolincoder/mysql/row_format/%E8%A1%A8%E7%A9%BA%E9%97%B4%E7%BB%93%E6%9E%84.drawio.png\" alt=\"img\"></p>\n<p>一个表空间可以由多个段组成,段是可以由多个不连续的区构成,区是由连续的页构成,页是由连续的记录进行组成</p>\n<p><strong>页:</strong></p>\n<p>​\t一个页大小是16kb,mysql的读写都是以页为单位,长江的页还有数据页面,undo页面,还有redo</p>\n<p>区:</p>\n<p>一个区的大小是1MB,那么就有64个页面,为了让相邻的两个页面的物理位置相邻,划分的一个1MB物理空间,这样就是顺序io</p>\n<blockquote>\n<p><strong>在表中数据量大的时候，为某个索引分配空间的时候就不再按照页为单位分配了，而是按照区（extent）为单位分配。每个区的大小为 1MB，对于 16KB 的页来说，连续的 64 个页会被划为一个区，这样就使得链表中相邻的页的物理位置也相邻，就能使用顺序 I&#x2F;O 了</strong>。</p>\n<h4 id><a href=\"#\" class=\"headerlink\" title></a></h4></blockquote>\n<p>段:</p>\n<p>段是由多个区间构成的,一般分为索引段</p>\n<p>​\t</p>\n<ul>\n<li>索引段：存放 B + 树的非叶子节点的区的集合；</li>\n<li>数据段：存放 B + 树的叶子节点的区的集合；</li>\n<li>回滚段：存放的是回滚数据的区的集合，之前讲<a href=\"https://xiaolincoding.com/mysql/transaction/mvcc.html\">事务隔离 (opens new window)</a>的时候就介绍到了 MVCC 利用了回滚段实现了多版本查询数据。</li>\n</ul>\n<p>索引都在非叶子节点上面,数据都在叶子上面,还有回滚数据</p>\n<h2 id=\"3-索引\"><a href=\"#3-索引\" class=\"headerlink\" title=\"3.索引\"></a>3.索引</h2><p><img src=\"https://cdn.xiaolincoding.com/gh/xiaolincoder/mysql/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E6%8F%90%E7%BA%B2.png\" alt=\"img\"></p>\n<h3 id=\"3-1索引简介\"><a href=\"#3-1索引简介\" class=\"headerlink\" title=\"3.1索引简介\"></a>3.1索引简介</h3><p>索引是一种排好序的数据结构,作用相当于数据的目录 </p>\n<p>优缺点:</p>\n<ol>\n<li>减少查询时间</li>\n<li>但是数据增删改的时候会更新索引</li>\n<li>会浪费一定的物理空间</li>\n</ol>\n<h3 id=\"3-2索引的分类\"><a href=\"#3-2索引的分类\" class=\"headerlink\" title=\"3.2索引的分类\"></a>3.2索引的分类</h3><p>数据结构;b+,hash,full-text</p>\n<p>物理结构:主键索引,耳机索引(两个关键字何在一起)</p>\n<p>字段:主键,唯一(unique),普通,前</p>\n<p>数据结构:</p>\n<p><img src=\"https://cdn.xiaolincoding.com/gh/xiaolincoder/mysql/%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%88%86%E7%B1%BB.drawio.png\" alt=\"img\"></p>\n<p>主键查询,</p>\n<p><img src=\"https://cdn.xiaolincoding.com/gh/xiaolincoder/mysql/%E7%B4%A2%E5%BC%95/%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95btree.drawio.png\" alt=\"二级索引 B+Tree\"></p>\n<p>最后一层才是数据节点,主键索引的是全部数据,耳机索引知识主键值,然后进行徽标才能得到值</p>\n<blockquote>\n<ul>\n<li>主键索引的 B+Tree 的叶子节点存放的是实际数据，所有完整的用户记录都存放在主键索引的 B+Tree 的叶子节点里；</li>\n<li>二级索引的 B+Tree 的叶子节点存放的是主键值，而不是实际数据。</li>\n</ul>\n</blockquote>\n<p><img src=\"https://cdn.xiaolincoding.com/gh/xiaolincoder/mysql/%E7%B4%A2%E5%BC%95/%E5%9B%9E%E8%A1%A8.drawio.png\" alt=\"回表\"></p>\n<h3 id=\"3-3B树与B-树\"><a href=\"#3-3B树与B-树\" class=\"headerlink\" title=\"3.3B树与B+树\"></a>3.3B树与B+树</h3><ol>\n<li>B树每个节点都有数据,b+树只有页节点才有数据</li>\n<li>b树的叶节点是单独存在的,但是b+树是用单链表连接到下一个的</li>\n</ol>\n<p><img src=\"https://mmbiz.qpic.cn/mmbiz_png/J0g14CUwaZdgV8QoMTlAsFLK9yrPWQiapWzXLEtpJD3IsGAXyTsJQvXibTAnIYHKkIekK7licSTVftymQZ2gs4kEw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1\" alt=\"图片\"></p>\n<blockquote>\n<p>因为 <strong>B+ 树所有叶子节点间还有一个链表进行连接，这种设计对范围查找非常有帮助</strong>，比如说我们想知道 12 月 1 日和 12 月 12 日之间的订单，这个时候可以先查找到 12 月 1 日所在的叶子节点，然后利用链表向右遍历，直到找到 12 月12 日的节点，这样就不需要从根节点查询了，进一步节省查询需要的时间</p>\n</blockquote>\n<h2 id=\"索引下推\"><a href=\"#索引下推\" class=\"headerlink\" title=\"索引下推:\"></a>索引下推:</h2><blockquote>\n<ul>\n<li>在 MySQL 5.6 之前，只能从 ID2 （主键值）开始一个个回表，到「主键索引」上找出数据行，再对比 b 字段值。</li>\n<li>而 MySQL 5.6 引入的<strong>索引下推优化</strong>（index condition pushdown)， <strong>可以在联合索引遍历过程中，对联合索引中包含的字段先做判断，直接过滤掉不满足条件的记录，减少回表次数</strong>。</li>\n</ul>\n</blockquote>\n<p>就是说,可以直接用联合索引来进行提权哦判断不符合的数据</p>\n<h3 id=\"3-4什么时候需要索引\"><a href=\"#3-4什么时候需要索引\" class=\"headerlink\" title=\"3.4什么时候需要索引\"></a>3.4什么时候需要索引</h3><ol>\n<li>id唯一</li>\n<li>经常使用where,order by,groupby的字段</li>\n</ol>\n<p>不用的情况:不用where的字段,大量重复数据sex</p>\n<h2 id=\"4-InnoDB引擎\"><a href=\"#4-InnoDB引擎\" class=\"headerlink\" title=\"4.InnoDB引擎\"></a>4.InnoDB引擎</h2><blockquote>\n<p>这一章主要是讲MySQL默认引擎，包括基本单位，还有管理的基本单位</p>\n</blockquote>\n<h3 id=\"4-1简介\"><a href=\"#4-1简介\" class=\"headerlink\" title=\"4.1简介\"></a>4.1简介</h3><ol>\n<li>盘与内存使用的是页，一个页大小是16kB</li>\n<li>innoDB存放每一条记录叫做行</li>\n<li>行是由头信息还有数据信息组成</li>\n<li>主要有下面四种格式，compact，redunnat</li>\n<li>首先是compact，（前面得到头信息，记录可变唱的字段，然后从小到大来记录，每一个字段的长度）</li>\n<li>第二个就是记录这一行的null的数量（记录方法是one-hot方法，每一个列都是01表示）</li>\n</ol>\n<p>插入代码块如下</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alterr table student row_format = compact</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://cdn.xiaolincoding.com/gh/xiaolincoder/mysql/row_format/%E8%AE%B0%E5%BD%95%E7%9A%84%E7%9C%9F%E5%AE%9E%E6%95%B0%E6%8D%AE.png\" alt=\"img\"></p>\n<p>记录的真实数据,包含三个隐藏列,默认idrow,trx表示食物id,是哪一个事务生成的,roll point代表回滚的</p>\n<p><strong>varchar(n) 中 n 最大取值为多少？</strong></p>\n<p>一行记录最大能存储 <strong>65535 字节的数据</strong>，但是这个是包含「变长字段字节数列表所占用的字节数」和「NULL值列表所占用的字节数」。所以， 我们在算 varchar(n) 中 n 最大值时，需要减去这两个列表所占用的字节数。</p>\n<p>如果一张表只有一个 varchar(n) 字段，且允许为 NULL，字符集为 ascii。varchar(n) 中 n 最大取值为 65532。</p>\n<p>计算公式：65535 - 变长字段字节数列表所占用的字节数 - NULL<strong>值列表所占用的字</strong>节数 &#x3D; 65535 - 2 - 1 &#x3D; 65532。</p>\n<p>如果有多个字段的话，要保证所有字段的长度 + 变长字段字节数列表所占用的字节数 + NULL值列表所占用的字节数 &lt;&#x3D; 65535。</p>\n<blockquote>\n<p>MySQL 中磁盘和内存交互的基本单位是页，一个页的大小一般是 <code>16KB</code>，也就是 <code>16384字节</code>，而一个 varchar(n) 类型的列最多可以存储 <code>65532字节</code>，一些大对象如 TEXT、BLOB 可能存储更多的数据，这时一个页可能就存不了一条记录。这个时候就会<strong>发生行溢出，多的数据就会存到另外的「溢出页」中</strong>。</p>\n</blockquote>\n<h3 id=\"4-2INnoDB数据页结构\"><a href=\"#4-2INnoDB数据页结构\" class=\"headerlink\" title=\"4.2INnoDB数据页结构\"></a>4.2INnoDB数据页结构</h3><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16819843724461681984371693.png\"></p>\n<blockquote>\n<p>这一张主要讲解的是数据页，还有B+树的实现，介绍数据页的结构，包括记录，还有头结构</p>\n</blockquote>\n<ol>\n<li>每一条记录都是存放在user record</li>\n<li>n_owned 记录拥有的小弟</li>\n<li>next记录吓一跳页面</li>\n<li>还有两条虚拟记录，一个是infir+super</li>\n<li>free space是记录空闲空间</li>\n<li>page dir表示这是不是叶子节点</li>\n</ol>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16819844104451681984409840.png\">****</p>\n<p>这是一条记录头信息，有包括id，还有拥有的小弟</p>\n<p><strong>头信息：</strong>del——flag，next record吓一跳记录，heap_no相对记录在堆，还有一个type，表示是</p>\n<p>删除记录：并不是在页面实际删除，而是设置一个del标记为1</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16819846234451681984623071.png\"></p>\n<blockquote>\n<p>主每一条记录都用于n——cow这个适用于分组的，然后del代表为是不删除，还有相对位置，之后就是下一个记录的位置</p>\n</blockquote>\n<p>然后有两条虚拟记录，一个是最小的，还有一个是最大记录，当相当于虚拟头结点还有虚拟尾结点</p>\n<p>这两个位置是最靠前的一个是0，一个是1，</p>\n<p>page dire：这个作用就是为了把之前的记录进行3-4个一组来进行结合，记录最后一个索引最大的值为slot，n_row代表的是还有几个小弟</p>\n<p>每一个slot代表</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16819850594441681985058988.png\"></p>\n<p>每一个slot代表一个地址</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16819852004481681985200031.png\"></p>\n<ol>\n<li>一个页面是包含多个记录的</li>\n<li>一个页面要进行分组,最小记录还有最大记录,之后就是数据记录来进行分组</li>\n<li>分组最大的放入slot里面,他记录自己包含的小弟</li>\n</ol>\n<blockquote>\n<p>从图可以看到，<strong>页目录就是由多个槽组成的，槽相当于分组记录的索引</strong>。然后，因为记录是按照「主键值」从小到大排序的，所以<strong>我们通过槽查找记录时，可以使用二分法快速定位要查询的记录在哪个槽（哪个记录分组），定位到槽后，再遍历槽内的所有记录，找到对应的记录</strong>，无需从最小记录开始遍历整个页中的记录链表。</p>\n</blockquote>\n<p>B+树每一个节点都是数据页</p>\n<blockquote>\n<ul>\n<li>只有叶子节点（最底层的节点）才存放了数据，非叶子节点（其他上层节）仅用来存放目录项作为索引。</li>\n<li>非叶子节点分为不同层次，通过分层来降低每一层的搜索量；</li>\n<li>所有节点按照索引键大小排序，构成一个双向链表，便于范围查询；</li>\n</ul>\n</blockquote>\n<h2 id=\"5-事务\"><a href=\"#5-事务\" class=\"headerlink\" title=\"5.事务\"></a>5.事务</h2><p>事务是逻辑上一组操作,要么执行,要么不执行.实现事务,要遵循4个特性,aicd(原子性,一致性,隔离性,最后就是持久性)一只猩猩,就是操作完成,还是满足约束,隔离性,不会对其他事务进行影响.</p>\n<h3 id=\"5-1并发事务带来的影响\"><a href=\"#5-1并发事务带来的影响\" class=\"headerlink\" title=\"5.1并发事务带来的影响\"></a>5.1并发事务带来的影响</h3><p>会出现,脏读,不可重复,幻读.</p>\n<p>脏读:读取没有提交的值,然后值又进行回滚了</p>\n<p><img src=\"https://cdn.xiaolincoding.com//mysql/other/10b513008ea35ee880c592a88adcb12f.png\" alt=\"图片\"></p>\n<p>不可重复读:</p>\n<p>读取的值被修改,两次读取不一样</p>\n<p><img src=\"https://cdn.xiaolincoding.com//mysql/other/f5b4f8f0c0adcf044b34c1f300a95abf.png\" alt=\"图片\"></p>\n<p>幻读:</p>\n<p>读取了值,结果下一次读取的时候被删除了</p>\n<p><img src=\"https://cdn.xiaolincoding.com//mysql/other/d19a1019dc35dfe8cfe7fbff8cd97e31.png\" alt=\"图片\"></p>\n<p>四种隔离级别:</p>\n<ol>\n<li>未提交读(脏读,幻读,可重复)</li>\n<li>提交读(幻读,可重复)</li>\n<li>可重复读(幻读)</li>\n<li>可串行化</li>\n</ol>\n<p>可重复读很大程度避免了幻读</p>\n<p>并发事务 的控制方法:基于锁还有mvcc(多版本并发控制)乐观</p>\n<p>mvcc:hi一份数据多个版本,可以通过事务id,查找之前的版本</p>\n<blockquote>\n<h3 id=\"MySQL-的隔离级别是基于锁实现的吗？\"><a href=\"#MySQL-的隔离级别是基于锁实现的吗？\" class=\"headerlink\" title=\"MySQL 的隔离级别是基于锁实现的吗？\"></a>MySQL 的隔离级别是基于锁实现的吗？</h3></blockquote>\n<p>MySQL 的隔离级别基于锁和 MVCC 机制共同实现的。</p>\n<p>SERIALIZABLE 隔离级别是通过锁来实现的，READ-COMMITTED 和 REPEATABLE-READ 隔离级别是基于 MVCC 实现的。不过， SERIALIZABLE 之外的其他隔离级别可能也需要用到锁机制，就比如 REPEATABLE-READ 在当前读情况下需要使用加锁读来保证不会出现幻读。</p>\n<hr>\n<p><strong>对于四种隔离事务的实现方法</strong></p>\n<ol>\n<li>读未提交:直接读取最新的就行</li>\n<li>可串行化通过枷锁来进行读取</li>\n<li>读提交,使用read view来进行创建快照,读取事务处理王的结果.可重复读是只读取,生成时候的视图值</li>\n</ol>\n<p><strong>mvcc版本控制的实现</strong></p>\n<blockquote>\n<p>在内部，<code>InnoDB</code> 存储引擎为每行数据添加了三个 <a href=\"https://dev.mysql.com/doc/refman/5.7/en/innodb-multi-versioning.html\">隐藏字段open in new window</a>：</p>\n<ul>\n<li><code>DB_TRX_ID（6字节）</code>：表示最后一次插入或更新该行的事务 id。此外，<code>delete</code> 操作在内部被视为更新，只不过会在记录头 <code>Record header</code> 中的 <code>deleted_flag</code> 字段将其标记为已删除</li>\n<li><code>DB_ROLL_PTR（7字节）</code> 回滚指针，指向该行的 <code>undo log</code> 。如果该行未被更新，则为空</li>\n<li><code>DB_ROW_ID（6字节）</code>：如果没有设置主键且该表没有唯一非空索引时，<code>InnoDB</code> 会使用该 id 来生成聚簇索引</li>\n</ul>\n<hr>\n</blockquote>\n<p><img src=\"https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/mysql/%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB/readview%E7%BB%93%E6%9E%84.drawio.png\" alt=\"img\"></p>\n<ol>\n<li>create:创建的时候的id</li>\n<li>m_id,当前的事务id列表(启动了,但是没有提交的事务)</li>\n<li>min是最小的事务id</li>\n<li>max是下一次事务的id</li>\n</ol>\n<p><img src=\"https://cdn.xiaolincoding.com//mysql/other/f595d13450878acd04affa82731f76c5.png\" alt=\"图片\"></p>\n<p>每次进行事务操作的时候,会把trx_id更新为当前id,然后roll_point只想前一个版本,同时把前一个版本写入到undo文件里面</p>\n<blockquote>\n<p>undo文件:用来回滚的,还有一个作用就是mvcc</p>\n</blockquote>\n<ol>\n<li>小于min的事务都可见</li>\n<li>大于max的都不可见</li>\n<li>处于min与max之间的,需要判断是不是再ids列表里面,不在就是可见</li>\n</ol>\n<blockquote>\n<p>可重复读是如何实现的</p>\n</blockquote>\n<p><img src=\"https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/mysql/%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB/%E4%BA%8B%E5%8A%A1ab%E7%9A%84%E8%A7%86%E5%9B%BE-new.png\" alt=\"img\"></p>\n<p>开始的时候createid是自己,列表也是只有自己,所以a是可以一直</p>\n<p><img src=\"https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/mysql/%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB/%E4%BA%8B%E5%8A%A1ab%E7%9A%84%E8%A7%86%E5%9B%BE2.png\" alt=\"img\"></p>\n<p> B 第一次读小林的账户余额记录，在找到记录后，它会先看这条记录的 trx_id，此时<strong>发现 trx_id 为 50，比事务 B 的 Read View 中的 min_trx_id 值（51）还小，这意味着修改这条记录的事务早就在事务 B 启动前提交过了，所以该版本的记录对事务 B 可见的</strong>，也就是事务 B 可以获取到这条记录。</p>\n<p>接着，事务 A 通过 update 语句将这条记录修改了（还未提交事务），将小林的余额改成 200 万，这时 MySQL 会记录相应的 undo log，并以链表的方式串联起来，形成<strong>版本链</strong>，如下图：</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16823261923071682326191600.png\"></p>\n<blockquote>\n<p>你可以在上图的「记录的字段」看到，由于事务 A 修改了该记录，以前的记录就变成旧版本记录了，于是最新记录和旧版本记录通过链表的方式串起来，而且最新记录的 trx_id 是事务 A 的事务 id（trx_id &#x3D; 51）。</p>\n<p>然后事务 B 第二次去读取该记录，<strong>发现这条记录的 trx_id 值为 51，在事务 B 的 Read View 的 min_trx_id 和 max_trx_id 之间，则需要判断 trx_id 值是否在 m_ids 范围内，判断的结果是在的，那么说明这条记录是被还未提交的事务修改的，这时事务 B 并不会读取这个版本的记录。而是沿着 undo log 链条往下找旧版本的记录，直到找到 trx_id 「小于」事务 B 的 Read View 中的 min_trx_id 值的第一条记录</strong>，所以事务 B 能读取到的是 trx_id 为 50 的记录，也就是小林余额是 100 万的这条记录。</p>\n<p>最后，当事物 A 提交事务后，<strong>由于隔离级别时「可重复读」，所以事务 B 再次读取记录时，还是基于启动事务时创建的 Read View 来判断当前版本的记录是否可见。所以，即使事物 A 将小林余额修改为 200 万并提交了事务， 事务 B 第三次读取记录时，读到的记录都是小林余额是 100 万的这条记录</strong>。</p>\n</blockquote>\n<p><strong>就是说:对于事务a已经完成了,他的记录里面的trx更新为51,但是51再事务b里面,所以他要往前寻找第一个小于事务b的min的trx,然后就是50,因此取出50来作为记录</strong></p>\n<blockquote>\n<p>读提交是怎么实现的</p>\n</blockquote>\n<p><strong>读提交隔离级别是在每次读取数据时，都会生成一个新的 Read View</strong>。</p>\n<p><img src=\"https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/mysql/%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB/%E8%AF%BB%E6%8F%90%E4%BA%A4%E4%BA%8B%E5%8A%A1.png\" alt=\"img\"></p>\n<p><img src=\"https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/mysql/%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB/%E8%AF%BB%E6%8F%90%E4%BA%A4%E4%BA%8B%E5%8A%A12.drawio.png\" alt=\"img\"></p>\n<blockquote>\n<p>而对于幻读现象，不建议将隔离级别升级为串行化，因为这会导致数据库并发时性能很差。MySQL InnoDB 引擎的默认隔离级别虽然是「可重复读」，但是它很大程度上避免幻读现象（并不是完全解决了，详见这篇<a href=\"https://xiaolincoding.com/mysql/transaction/phantom.html\">文章 (opens new window)</a>），解决的方案有两种：</p>\n<ul>\n<li>针对<strong>快照读</strong>（普通 select 语句），是<strong>通过 MVCC 方式解决了幻读</strong>，因为可重复读隔离级别下，事务执行过程中看到的数据，一直跟这个事务启动时看到的数据是一致的，即使中途有其他事务插入了一条数据，是查询不出来这条数据的，所以就很好了避免幻读问题。</li>\n<li>针对<strong>当前读</strong>（select … for update 等语句），是<strong>通过 next-key lock（记录锁+间隙锁）方式解决了幻读</strong>，因为当执行 select … for update 语句的时候，会加上 next-key lock，如果有其他事务在 next-key lock 锁范围内插入了一条记录，那么这个插入语句就会被阻塞，无法成功插入，所以就很好了避免幻读问题。</li>\n</ul>\n<p>对于「读提交」和「可重复读」隔离级别的事务来说，它们是通过 Read View 来实现的，它们的区别在于创建 Read View 的时机不同：</p>\n<ul>\n<li>「读提交」隔离级别是在每个 select 都会生成一个新的 Read View，也意味<strong>着，事务期间的多次读取同一条数据，前后两次读的数据可能会出现不一致，</strong>因为可能这期间另外一个事务修改了该记录，并提交了事务。</li>\n<li>「可重复读」隔离级别是<strong>启动事务时生成一个 Read View，然后整个事务期间都在用这个 Read View</strong>，这样就保证了在事务期间读到的数据都是事务启动前的记录。</li>\n</ul>\n<p>这两个隔离级别实现是通过「事务的 Read View 里的字段」和「记录中的两个隐藏列」的比对，来控制并发事务访问同一个记录时的行为，这就叫 MVCC（多版本并发控制）。</p>\n<p>在可重复读隔离级别中，普通的 select 语句就是基于 MVCC 实现的快照读，也就是不会加锁的。而 select .. for update 语句就不是快照读了，而是当前读了，也就是每次读都是拿到最新版本的数据，但是它会对读到的记录加上 next-key lock 锁。</p>\n</blockquote>\n","tags":[{"name":"mysql","slug":"mysql","permalink":"http://yoursite.com/tags/mysql/"}]},{"title":"pve折腾","date":"2023-04-15T13:31:59.000Z","path":"2023/04/15/pve折腾/","content":"<h1 id=\"pve折腾\"><a href=\"#pve折腾\" class=\"headerlink\" title=\"pve折腾\"></a>pve折腾</h1><p>自己的老电脑用了5年了，cpu还是4核心的，显卡是1050.硬盘还是1t的机械，都没多少剩余空间了。随着最近的硬盘内存大降价，我就凑巨资300买了一个1t的SATA固态，谁能想到，现在的nvme比SATA还便宜（我当初可是花费500元买的500g的nvme），然后硬盘前几天就到了。于是我就直接安装虚拟机了，想着在虚拟机你运行多个系统，目前已经完成的有openwrt，kali，deepin，安卓x86还有win11.但是win11没有进行显卡直通，其余都接近完美了。下面就对这几天的行为进行一次复盘。</p>\n<h2 id=\"1-pve安装\"><a href=\"#1-pve安装\" class=\"headerlink\" title=\"1.pve安装\"></a>1.pve安装</h2><p>直接去官网进行下载，连接是选择<a href=\"https://pve.proxmox.com/wiki/Downloads%EF%BC%8C%E9%80%89%E6%8B%A9%E6%9C%80%E6%96%B0%E7%9A%84%E7%89%88%E6%9C%AC%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E4%B8%8B%E8%BD%BD%EF%BC%8C%E7%84%B6%E5%90%8E%E5%AE%89%E8%A3%85%E7%9A%84%E8%AF%9D%E4%BD%BF%E7%94%A8ventoy%EF%BC%8C%E5%8F%AA%E9%9C%80%E8%A6%81%E6%8A%8Apve%E6%94%BE%E5%85%A5%E5%88%B0u%E7%9B%98%E5%B0%B1%E5%8F%AF%E4%BB%A5%E3%80%82\">https://pve.proxmox.com/wiki/Downloads，选择最新的版本就可以进行下载，然后安装的话使用ventoy，只需要把pve放入到u盘就可以。</a></p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/510216630\">https://zhuanlan.zhihu.com/p/510216630</a></p>\n<p>可以参考上面的教程，只不过需要注意的是，要填写的ip,是需要和你的局域网在一个网段里面。我自己定义的网络是192.168.100.2，gate：192.168.100.1。</p>\n<h2 id=\"2-openwrt安装\"><a href=\"#2-openwrt安装\" class=\"headerlink\" title=\"2.openwrt安装\"></a>2.openwrt安装</h2><p>固件是在这个大神的网站下载的，自动编译，还可以进行自定义插件。<a href=\"https://supes.top/\">https://supes.top/</a></p>\n<ol>\n<li>首先把img上传到pve上面</li>\n<li>然后就是新建一个虚拟机，但是不要创建iso</li>\n<li>之后使用img2iso，记住我们的磁盘id，使用qm importdisk 100 &#x2F;openwrt.img local-lvm</li>\n<li>然后再启动项，把这个磁盘进行加入。</li>\n<li>之后进行启动，设置网络ip vim etc</li>\n</ol>\n<p><a href=\"https://post.smzdm.com/p/a7nqp3r9/\">https://post.smzdm.com/p/a7nqp3r9/</a></p>\n<p>参考上面的安装流程</p>\n<p><strong>2.1op作为主路由</strong></p>\n<p>在openwrt里面进行PPPoE拨号，那么op就是要进行桥接2个电脑的网口，一个作为lan，一个作为lan，wan口连接宽带，然后去进行pppoe拨号。</p>\n<p><strong>2.2op作为胖路由</strong></p>\n<p>只需要桥接一个网络口，然后连接主路由的时候，需要进行设置。进入接口里面的lan设置ip为静态ip，然后gate设置为192.168.100.1（主路由的ip），然后dns也是主路由的ip，同时关闭DHCP，这样就不会干扰DHCP。</p>\n<p>主要的痛点就是看你要做旁路由还是主路由，主路由就是没有</p>\n<h2 id=\"3-deepin安装\"><a href=\"#3-deepin安装\" class=\"headerlink\" title=\"3.deepin安装\"></a>3.deepin安装</h2><p>deepin安装就是普通的linux安装流程，但是有一点就是安装pcie直通（把wifi）给deepin，无限网卡教程参考如下</p>\n<p><a href=\"https://www.orcy.net.cn/185.html\">https://www.orcy.net.cn/185.html</a></p>\n<ol>\n<li>修改grup，允许iommu</li>\n<li>更新grub</li>\n<li>重启</li>\n<li>之后增加模块在module里面</li>\n<li>然后就直接在虚拟机上添加pcie设备就行</li>\n</ol>\n<h2 id=\"4-primeos安装\"><a href=\"#4-primeos安装\" class=\"headerlink\" title=\"4.primeos安装\"></a>4.primeos安装</h2><p>目前测试了几个x86的系统在虚拟机上，都无法进行安装，只有三哥的这个才可以，选择的系统是classical版本，安卓7.0，然后也是正常的安装流程，要注意的是在安装的使用，你需要新建一个分区，然后再次写入。就可以了。然后功能都有，play商店也有。</p>\n<h2 id=\"5-win10-x2F-11的坑\"><a href=\"#5-win10-x2F-11的坑\" class=\"headerlink\" title=\"5.win10&#x2F;11的坑\"></a>5.win10&#x2F;11的坑</h2><p>主要是为了远程玩游戏，但是看知乎这篇文章说，原神，不让用虚拟机，然后显卡直通弄了半天也没有成功，可能是win11的问题吧，等有时间了换成win10 ltsc试试。主要参考如下的教程</p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/571224296\">https://zhuanlan.zhihu.com/p/571224296</a></p>\n<p>这个大佬的目前还没有成功</p>\n<p><a href=\"https://www.youtube.com/watch?v=00GxKDGUhxA&amp;ab_channel=VedioTalk\">https://www.youtube.com/watch?v=00GxKDGUhxA&amp;ab_channel=VedioTalk</a></p>\n<p>有关这个大佬得到是核显进行驱动</p>\n<p><a href=\"https://blog.csdn.net/Qwertyuiop2016/article/details/127940349\">https://blog.csdn.net/Qwertyuiop2016/article/details/127940349</a></p>\n<p>这个大佬是直接进行ltsc驱动的，不知道是不是我的版本原因，下次再试试吧</p>\n","tags":[{"name":"pve，虚拟机","slug":"pve，虚拟机","permalink":"http://yoursite.com/tags/pve%EF%BC%8C%E8%99%9A%E6%8B%9F%E6%9C%BA/"}]},{"title":"对抗无聊","date":"2023-04-12T07:49:53.000Z","path":"2023/04/12/对抗无聊/","content":"<h1 id=\"对抗无聊\"><a href=\"#对抗无聊\" class=\"headerlink\" title=\"对抗无聊\"></a>对抗无聊</h1><p><a href=\"https://www.bilibili.com/video/BV1RM4y117yB?share_source=copy_web\">https://www.bilibili.com/video/BV1RM4y117yB?share_source=copy_web</a></p>\n<p>视频来源于上方,为什么我们总是感觉到无聊,市因为我们的阈值越来越高了了,很难在感到高兴了. </p>\n<h2 id=\"1-原因\"><a href=\"#1-原因\" class=\"headerlink\" title=\"1.原因\"></a>1.原因</h2><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16812861701951681286169442.png\"></p>\n<p>及时满足了乐趣,立刻产生了多巴胺,但是每一次产生的阈值都会减少,这就是为什么我们的乐趣越来越多,但会越来越感觉到无聊.(没有延迟满足,)</p>\n<h2 id=\"2-方法\"><a href=\"#2-方法\" class=\"headerlink\" title=\"2.方法\"></a>2.方法</h2><p><strong>提升多巴胺基准线</strong></p>\n<ol>\n<li>长期每天有接触到阳光(10-20分钟的阳光散步)</li>\n<li>充足的睡眠(减少褪黑素的摄入)</li>\n<li>多吃芝麻,牛肉,鱼肉,奶酪</li>\n<li>多适量的咖啡因(早上开始来喝)</li>\n</ol>\n<p><strong>应对多巴胺低估</strong></p>\n<p>做更难受的事情</p>\n<ol>\n<li>洗冷水澡</li>\n<li>健身</li>\n<li>看书(比当前更难受)</li>\n</ol>\n","tags":[{"name":"心理学","slug":"心理学","permalink":"http://yoursite.com/tags/%E5%BF%83%E7%90%86%E5%AD%A6/"}]},{"title":"mitos","date":"2023-04-06T14:24:59.000Z","path":"2023/04/06/mitos/","content":"<h1 id=\"6-S081\"><a href=\"#6-S081\" class=\"headerlink\" title=\"6.S081\"></a>6.S081</h1><p>这是mit的公开课，使用xv6来自己实现一个小的操作系统。</p>\n<h2 id=\"0-预备环节\"><a href=\"#0-预备环节\" class=\"headerlink\" title=\"0.预备环节\"></a>0.预备环节</h2><h3 id=\"0-1安装linux\"><a href=\"#0-1安装linux\" class=\"headerlink\" title=\"0.1安装linux\"></a>0.1安装linux</h3><p>本人直接使用的是wsl，安装的是debian系统，可以参照官网的实验步骤。唯一的坑点就是git残酷使用的ssh，不知道是梯子问题，还是校园网问题，一直git不了，课允许lan，一直没有反应，最后还是直接在windows下使用git http才弄下来。</p>\n<h3 id=\"0-2安装vscode\"><a href=\"#0-2安装vscode\" class=\"headerlink\" title=\"0.2安装vscode\"></a>0.2安装vscode</h3><p>vscode主要是讲解如何来配置wsl。需要安装2个插件，一个wsl还有一个是c语言插件。然后重点就是下面三个文件的配置，一个task，一个launch，还有一个是c++——properties，参考下面的连接</p>\n<p><a href=\"https://code.visualstudio.com/docs/cpp/config-wsl\">Visual Studio Code 中的 Linux C++ 和 Windows 子系统入门</a></p>\n<ol>\n<li>tasks。json（配置编译器的位置，还有编译时候所需要的参数-o，-g</li>\n<li>这个是调试选项launch，这个是放入gdb的，有工作目录，还有调试的程序</li>\n<li>最后一个properties就是配置gcc还有gdb的位置</li>\n</ol>\n<hr>\n<p>开始扩展:</p>\n<p>参考这个视频</p>\n<p><a href=\"https://www.bilibili.com/video/BV1Lv411g7EV/?vd_source=ba1e1ba13062afebe588f7479b936272\">mit6s081 通过vscode来debug kernel_哔哩哔哩_bilibili</a></p>\n<p>一直以来的vscode的配置都是直接抄的别人配置好的,对vscode 的task.json haiyou launch.json都有一种莫名的不要输系感觉.并且对使用用gdb来进行调试c制作的make程序都深恶痛绝.直到今天,看完这个视频,才发现并没有多么的可怕.</p>\n<p>下面将要来介绍一下launch.json的配置是为什么</p>\n<ol>\n<li>首先launch.json这个是用来调试的</li>\n<li>调试那么就需要调试器吧,调试器就是gdb</li>\n<li>i那位这个riscv,一般的gdb是只能x64,所以需要使用gdb-mul</li>\n<li>然后调试的话,你也需要调试的文件吧,文件就是kernel&#x2F;kernel,因为xv6最开始是从kernel启动的</li>\n<li>miDebuggerServerAddress这个是远程调试的后端,就是输入make qemu-gdb产生的地址</li>\n<li>然后按住F5就可以启动</li>\n</ol>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;0.2.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"comment\">// configuration 包含了 gdb 启动的相关信息</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;configurations&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;debug xv6&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"comment\">// 如果没有下载c/pp插件 这个type会报错</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;cppdbg&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;request&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;launch&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"comment\">// 你需要的调试的二进制文件 , 默认是kernel/kernel ,因为你先得把xv6启动 你才有机会调试xv6上的用户程序</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;program&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;$&#123;workspaceFolder&#125;/kernel/kernel&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;args&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"comment\">// 是否在kernel的main函数中 打个断点</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;stopAtEntry&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;cwd&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;$&#123;workspaceFolder&#125;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"comment\">// make qemu-gdb 会启动一个 gdbserver ,你需要指定一个端口,来连接上这个gdb server, 具体端口可以查看.gdbinit</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;miDebuggerServerAddress&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;localhost:26001&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"comment\">// gdb的路径,  gdb可以是gdb-multiarch 也可以是riscv64-linux-gnu-gdb 具体看你安装的是哪个, 如果是ubuntu的话 </span></span><br><span class=\"line\">          <span class=\"comment\">// 应该是gdb-multiarch 比较多</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;miDebuggerPath&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;/usr/bin/gdb-multiarch&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;environment&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;externalConsole&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;MIMode&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;gdb&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;setupCommands&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">                <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                    <span class=\"attr\">&quot;description&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;pretty printing&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    <span class=\"attr\">&quot;text&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;-enable-pretty-printing&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    <span class=\"attr\">&quot;ignoreFailures&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">                <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">            <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;logging&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                 <span class=\"attr\">&quot;engineLogging&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                 <span class=\"attr\">&quot;programOutput&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>问题来了,每次我要进行调试,都要自己手动输入一次make qemu-gdb,那么这就相当于一次任务,我们可以值在执行调试的时候,先执行这个,那么可以顶一个pretask,task.json的任务就是制作一个任务,同理,我们如果按照之前,手工运行的话,可以直接制作一个task,就可以直接运行了</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// launch.json</span></span><br><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;0.2.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;configurations&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;xv6debug&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;cppdbg&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;request&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;launch&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;program&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;$&#123;workspaceFolder&#125;/kernel/kernel&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;stopAtEntry&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;cwd&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;$&#123;workspaceFolder&#125;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;miDebuggerServerAddress&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;127.0.0.1:25000&quot;</span><span class=\"punctuation\">,</span> <span class=\"comment\">//见.gdbinit 中 target remote xxxx:xx</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;miDebuggerPath&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;/usr/bin/gdb-multiarch&quot;</span><span class=\"punctuation\">,</span> <span class=\"comment\">// which gdb-multiarch</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;MIMode&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;gdb&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;preLaunchTask&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;xv6build&quot;</span></span><br><span class=\"line\">            #这里的xv6build就是task的定义</span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// tasks.json</span></span><br><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;options&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span> <span class=\"comment\">//指定make qemu的执行位置</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;cwd&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;$&#123;workspaceFolder&#125;&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tasks&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;label&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;xv6build&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;shell&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;isBackground&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;command&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;make qemu-gdb&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;problemMatcher&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">                <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                    <span class=\"attr\">&quot;pattern&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">                        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                            <span class=\"attr\">&quot;regexp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;.&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                            <span class=\"attr\">&quot;file&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                            <span class=\"attr\">&quot;location&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                            <span class=\"attr\">&quot;message&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">3</span></span><br><span class=\"line\">                        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">                    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    <span class=\"attr\">&quot;background&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                        <span class=\"attr\">&quot;beginsPattern&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;.*Now run &#x27;gdb&#x27; in another window.&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                        <span class=\"attr\">&quot;endsPattern&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;.&quot;</span></span><br><span class=\"line\">                    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">                <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">            <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;group&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;kind&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;build&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;isDefault&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">作者<span class=\"punctuation\">:</span> 扎克蕉</span><br><span class=\"line\">链接<span class=\"punctuation\">:</span> https<span class=\"punctuation\">:</span><span class=\"comment\">//www.515code.com/posts/r1eiw7kt/#1-4-VSCode%E8%B0%83%E8%AF%95</span></span><br><span class=\"line\">来源<span class=\"punctuation\">:</span> <span class=\"number\">515</span>code-实验室</span><br><span class=\"line\">著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</span><br></pre></td></tr></table></figure>\n\n<p>常规的c定义</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"comment\">// Use IntelliSense to learn about possible attributes.</span></span><br><span class=\"line\">    <span class=\"comment\">// Hover to view descriptions of existing attributes.</span></span><br><span class=\"line\">    <span class=\"comment\">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;0.2.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;configurations&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;(gdb) Launch&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;preLaunchTask&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;g++.exe build active file&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\">//调试前执行的任务，就是之前配置的tasks.json中的label字段</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;cppdbg&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\">//配置类型，只能为cppdbg</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;request&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;launch&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\">//请求配置类型，可以为launch（启动）或attach（附加）</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;program&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;$&#123;fileDirname&#125;\\\\$&#123;fileBasenameNoExtension&#125;.exe&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\">//调试程序的路径名称</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;args&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span><span class=\"comment\">//调试传递参数</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;stopAtEntry&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;cwd&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;$&#123;workspaceFolder&#125;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;environment&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;externalConsole&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span><span class=\"comment\">//true显示外置的控制台窗口，false显示内置终端</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;MIMode&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;gdb&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;miDebuggerPath&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;D:\\\\mingw-w64\\\\x86_64-8.1.0-win32-seh-rt_v6-rev0\\\\mingw64\\\\bin\\\\gdb.exe&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;setupCommands&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">                <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                    <span class=\"attr\">&quot;description&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Enable pretty-printing for gdb&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    <span class=\"attr\">&quot;text&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;-enable-pretty-printing&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                    <span class=\"attr\">&quot;ignoreFailures&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">                <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">            <span class=\"punctuation\">]</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">#相当于gcc -g file -o x.exe</span><br><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"comment\">// See https://go.microsoft.com/fwlink/?LinkId=733558 </span></span><br><span class=\"line\">    <span class=\"comment\">// for the documentation about the tasks.json format</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tasks&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;shell&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;label&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;g++.exe build active file&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\">//任务的名字，就是刚才在命令面板中选择的时候所看到的，可以自己设置</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;command&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;D:/mingw-w64/x86_64-8.1.0-win32-seh-rt_v6-rev0/mingw64/bin/g++.exe&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;args&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"comment\">//编译时候的参数</span></span><br><span class=\"line\">                <span class=\"string\">&quot;-g&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\">//添加gdb调试选项</span></span><br><span class=\"line\">                <span class=\"string\">&quot;$&#123;file&#125;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"string\">&quot;-o&quot;</span><span class=\"punctuation\">,</span><span class=\"comment\">//指定生成可执行文件的名称</span></span><br><span class=\"line\">                <span class=\"string\">&quot;$&#123;fileDirname&#125;\\\\$&#123;fileBasenameNoExtension&#125;.exe&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;options&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;cwd&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;D:/mingw-w64/x86_64-8.1.0-win32-seh-rt_v6-rev0/mingw64/bin&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;problemMatcher&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">                <span class=\"string\">&quot;$gcc&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;group&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;kind&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;build&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;isDefault&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"comment\">//表示快捷键Ctrl+Shift+B可以运行该任务</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"1-lab-util\"><a href=\"#1-lab-util\" class=\"headerlink\" title=\"1.lab util\"></a>1.lab util</h2><p><a href=\"https://pdos.csail.mit.edu/6.S081/2020/labs/util.html\">Lab: Xv6 and Unix utilities (mit.edu)</a></p>\n<p><a href=\"https://mit-public-courses-cn-translatio.gitbook.io/mit6-s081/lec01-introduction-and-examples\">Lec01 Introduction and Examples (Robert) - MIT6.S081 (gitbook.io)</a></p>\n<p><a href=\"http://xv6.dgs.zone/tranlate_books/book-riscv-rev1/c1/s0.html\">第一章 操作系统接口 · 6.S081 All-In-One (dgs.zone)</a></p>\n<p><a href=\"https://blog.rayzhang.top/2022/06/27/mit-6.s081-lab-util/\">MIT 6.S081 Lab Util 实验 | Ray’s Blog (rayzhang.top)</a></p>\n<p>本次实验主要参考以上四个网站,视频没有看,直接看的博主翻译的文稿,感觉翻译的文稿比视频好很多.</p>\n<p>考研的时候学过操作系统了的,就没怎么看视频,直接找的几个重点章节看了一下.现在复习一下基础知识.</p>\n<p><a href=\"http://xv6.dgs.zone/tranlate_books/book-riscv-rev1/c1/s0.html\">第一章 操作系统接口 · 6.S081 All-In-One (dgs.zone)</a></p>\n<p>直接看这本书就行,主要第一张江的是进程相关的内容,应该算进程管理吧.</p>\n<h3 id=\"1-1进程和内存\"><a href=\"#1-1进程和内存\" class=\"headerlink\" title=\"1.1进程和内存\"></a>1.1进程和内存</h3><p>用户态通过调用内核态的fork接口来进行创建内存,对于子进程来讲,自己的pid是0,但是对于父进程来讲,自己的pid是大于0的,因此,我们考研来进行判断</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// fork()在父进程中返回子进程的PID</span></span><br><span class=\"line\"><span class=\"comment\">// 在子进程中返回0</span></span><br><span class=\"line\"><span class=\"type\">int</span> pid = fork();</span><br><span class=\"line\"><span class=\"keyword\">if</span>(pid &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;parent: child=%d\\n&quot;</span>, pid);</span><br><span class=\"line\">    pid = wait((<span class=\"type\">int</span> *) <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;child %d is done\\n&quot;</span>, pid);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(pid == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;child: exiting\\n&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">exit</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;fork error\\n&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>这个是会反应两个结果的,一个是父进程输出parent,通过调用fork达到子进程,此时自己的pid是0,所以输出child</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">parent: child=1234</span><br><span class=\"line\">child: exiting</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>同时我们可以使用exec来执行相关shell命令,直接在用户太执行.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">char* argv[3];</span><br><span class=\"line\">argv[0] = &quot;echo&quot;;</span><br><span class=\"line\">argv[1] = &quot;hello&quot;;</span><br><span class=\"line\">argv[2] = 0;</span><br><span class=\"line\">exec(&quot;/bin/echo&quot;, argv);</span><br><span class=\"line\">printf(&quot;exec error\\n&quot;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-I-x2F-O和文件描述符\"><a href=\"#1-2-I-x2F-O和文件描述符\" class=\"headerlink\" title=\"1.2 I&#x2F;O和文件描述符\"></a>1.2 I&#x2F;O和文件描述符</h3><p>主要讲的是io的读取和写入的api使用,使用write还有read.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">n = read(<span class=\"number\">0</span>, buf, <span class=\"keyword\">sizeof</span> buf);</span><br></pre></td></tr></table></figure>\n\n<p>0代表标准输入流,就是我们输入的东西,buf就是要接受储存的字符串,最后一个是长度,我要接受多长的字符串.</p>\n<p>同理,write就是写入,这个是写入到标准输出流.第一个是要写的保存的地方,然后就是要写的字符串,还有长度.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">write(<span class=\"number\">1</span>, <span class=\"string\">&quot;hello &quot;</span>, <span class=\"number\">6</span>);</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"1-3-管道\"><a href=\"#1-3-管道\" class=\"headerlink\" title=\"1.3 管道\"></a>1.3 管道</h3><p>管道就是用于进程通信的,一个用来读取,一个写入 .只能单向联通,半双工.写入的时候读取必须关闭.</p>\n<p>使用方法就是创建一个二位数组,通过pipe来进行调用创建管道,使用close来关闭管道一端然后调用上次的read还有write方法来进行读取还有写入.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> p[<span class=\"number\">2</span>];</span><br><span class=\"line\"><span class=\"type\">char</span> *argv[<span class=\"number\">2</span>];</span><br><span class=\"line\">argv[<span class=\"number\">0</span>] = <span class=\"string\">&quot;wc&quot;</span>;</span><br><span class=\"line\">argv[<span class=\"number\">1</span>] = <span class=\"number\">0</span>;</span><br><span class=\"line\">pipe(p);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (fork() == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    close(<span class=\"number\">0</span>);</span><br><span class=\"line\">    dup(p[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    close(p[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    close(p[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    exec(<span class=\"string\">&quot;/bin/wc&quot;</span>, argv);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    close(p[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    write(p[<span class=\"number\">1</span>], <span class=\"string\">&quot;hello world\\n&quot;</span>, <span class=\"number\">12</span>);</span><br><span class=\"line\">    close(p[<span class=\"number\">1</span>]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>程序调用<code>pipe</code>，创建一个新的管道，并在数组p中记录读写文件描述符。在<code>fork</code>之后，父子进程都有指向管道的文件描述符。子进程调用<code>close</code>和<code>dup</code>使文件描述符0指向管道的读取端（前面说过优先分配最小的未使用的描述符），然后关闭p中所存的文件描述符，并调用<code>exec</code>运行<code>wc</code>。当<code>wc</code>从它的标准输入读取时，就是从管道读取。父进程关闭管道的读取端，写入管道，然后关闭写入端。</p>\n<blockquote>\n<p>接起来。然后对管道的左端调用<code>fork</code>和<code>runcmd</code>，对管道的右端调用<code>fork</code>和<code>runcmd</code>，并等待两者都完成。管道的右端可能是一个命令，该命令本身包含一个管道(例如，<code>a | b | c</code>)，该管道本身<code>fork</code>为两个新的子进程(一个用于b，一个用于c)。因此，shell可以创建一个进程树。这个树的叶子是命令，内部节点是等待左右两个子进程完成的进程。</p>\n</blockquote>\n<p>队友左右节点都是自己进行创建一个新的fork然后执行之后来返回</p>\n<h3 id=\"1-4-文件系统\"><a href=\"#1-4-文件系统\" class=\"headerlink\" title=\"1.4 文件系统\"></a>1.4 文件系统</h3><p>文件系统就是文件分为文件还有文件夹,文件夹是一个特殊的数据结构,里面包含当前文件夹的所有名称还有他的大小.</p>\n<p>通过调用这个方法来得到答案</p>\n<p>这个stat是类型,如果是文件夹还有一个数据结构</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> T_DIR 1    <span class=\"comment\">// Directory</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> T_FILE 2   <span class=\"comment\">// File</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> T_DEVICE 3 <span class=\"comment\">// Device</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">stat</span> &#123;</span></span><br><span class=\"line\">    <span class=\"type\">int</span> dev;     <span class=\"comment\">// 文件系统的磁盘设备</span></span><br><span class=\"line\">    uint ino;    <span class=\"comment\">// Inode编号</span></span><br><span class=\"line\">    <span class=\"type\">short</span> type;  <span class=\"comment\">// 文件类型</span></span><br><span class=\"line\">    <span class=\"type\">short</span> nlink; <span class=\"comment\">// 指向文件的链接数</span></span><br><span class=\"line\">    uint64 size; <span class=\"comment\">// 文件字节数</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"1-5实验\"><a href=\"#1-5实验\" class=\"headerlink\" title=\"1.5实验\"></a>1.5实验</h3><h4 id=\"1-5-1boot\"><a href=\"#1-5-1boot\" class=\"headerlink\" title=\"1.5.1boot\"></a>1.5.1boot</h4><p>启动过程,首先就是git’数据,直接登录网页使用github来进行下载,使用ssh一直卡死.之后切换分支到util就行,然后执行 make qemu.毕竟这个实验是在qemu上进行模拟的</p>\n<h4 id=\"1-5-2sleep-easy\"><a href=\"#1-5-2sleep-easy\" class=\"headerlink\" title=\"1.5.2sleep (easy)\"></a>1.5.2sleep (<a href=\"https://pdos.csail.mit.edu/6.S081/2020/labs/guidance.html\">easy</a>)</h4><p>实现sleep函数.我们可以根据下面提示来进行做</p>\n<blockquote>\n<ul>\n<li>Before you start coding, read Chapter 1 of the <a href=\"https://pdos.csail.mit.edu/6.S081/2020/xv6/book-riscv-rev1.pdf\">xv6 book</a>.</li>\n<li>Look at some of the other programs in <code>user/</code> (e.g., <code>user/echo.c</code>, <code>user/grep.c</code>, and <code>user/rm.c</code>) to see how you can obtain the command-line arguments passed to a program.</li>\n<li>If the user forgets to pass an argument, sleep should print an error message.</li>\n<li>The command-line argument is passed as a string; you can convert it to an integer using <code>atoi</code> (see user&#x2F;ulib.c).</li>\n<li>Use the system call <code>sleep</code>.</li>\n<li>See <code>kernel/sysproc.c</code> for the xv6 kernel code that implements the <code>sleep</code> system call (look for <code>sys_sleep</code>), <code>user/user.h</code> for the C definition of <code>sleep</code> callable from a user program, and <code>user/usys.S</code> for the assembler code that jumps from user code into the kernel for <code>sleep</code>.</li>\n<li>Make sure <code>main</code> calls <code>exit()</code> in order to exit your program.</li>\n<li>Add your <code>sleep</code> program to <code>UPROGS</code> in Makefile; once you’ve done that, <code>make qemu</code> will compile your program and you’ll be able to run it from the xv6 shell.</li>\n<li>Look at Kernighan and Ritchie’s book <em>The C programming language (second edition)</em> (K&amp;R) to learn about C.</li>\n</ul>\n</blockquote>\n<p>看ls是如何获取到参数的,如果没有参数,直接反悔哦失败,传递的参数是字符串,你需要使用atoi,直接使用系统调用的sleep功能.然后调用exit来推出这个程序.最后把这个给功能加入到makefile里面.</p>\n<p>上面已经给出了了具体思路,我们只需要写代码就行.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;kernel/types.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;kernel/stat.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;user/user.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span> **argv)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (argc != <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Usage: sleep &lt;ticks&gt;\\n&quot;</span>);  <span class=\"comment\">//参数数量不正确，打印错误信息</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">int</span> time = atoi(argv[<span class=\"number\">1</span>]);  <span class=\"comment\">//使用atoi转换，见user.h和ulib.c</span></span><br><span class=\"line\">    sleep(time);</span><br><span class=\"line\">    <span class=\"built_in\">exit</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>argc是参数个数,argv是参数字符串列表,如果c&lt;2就是不合法,然后直接进行执行调用系统api.之后就是加入到makefile里面.</p>\n<h4 id=\"1-5-3pingpong-easy\"><a href=\"#1-5-3pingpong-easy\" class=\"headerlink\" title=\"1.5.3pingpong (easy)\"></a>1.5.3pingpong (<a href=\"https://pdos.csail.mit.edu/6.S081/2020/labs/guidance.html\">easy</a>)</h4><p>实现pingpong功能就是,具体要求就是两个管道,一个父亲写,儿子读取,一个儿子读取谷歌的父亲管道,然后写入到自己的管道,父亲来读取.使用wait可以保真先后顺序.</p>\n<blockquote>\n<p>Write a program that uses UNIX system calls to ‘’ping-pong’’ a byte between two processes over a pair of pipes, one for each direction. The parent should send a byte to the child; the child should print “<pid>: received ping”, where <pid> is its process ID, write the byte on the pipe to the parent, and exit; the parent should read the byte from the child, print “<pid>: received pong”, and exit. Your solution should be in the file <code>user/pingpong.c</code>.</pid></pid></pid></p>\n</blockquote>\n<blockquote>\n<ul>\n<li>Use <code>pipe</code> to create a pipe.</li>\n<li>Use <code>fork</code> to create a child.</li>\n<li>Use <code>read</code> to read from the pipe, and <code>write</code> to write to the pipe.</li>\n<li>Use <code>getpid</code> to find the process ID of the calling process.</li>\n<li>Add the program to <code>UPROGS</code> in Makefile.</li>\n<li>User programs on xv6 have a limited set of library functions available to them. You can see the list in <code>user/user.h</code>; the source (other than for system calls) is in <code>user/ulib.c</code>, <code>user/printf.c</code>, and <code>user/umalloc.c</code>.</li>\n</ul>\n</blockquote>\n<p>根据上面提示,使用pipe创建两个管道,然后使用fork创建孩子进程,之后是以哦那个read来读取,和write来写入.注意要进行关闭管道的一端.只允许单项流通.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;kernel/types.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;kernel/stat.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;user/user.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span> *argv[])</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">char</span> buf[] = &#123;<span class=\"string\">&#x27;P&#x27;</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">int</span> parent2child[<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"type\">int</span> child2parent[<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pipe(parent2child) == <span class=\"number\">-1</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Failed to create pipe parent2child\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pipe(child2parent) == <span class=\"number\">-1</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Failed to create pipe child2parent\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">int</span> pid = fork();  <span class=\"comment\">// create child process</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pid &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Failed to create the child process!\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (pid == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// child process, read from pipe parent2child,</span></span><br><span class=\"line\">        <span class=\"comment\">// write to pipe child2parent</span></span><br><span class=\"line\">        close(parent2child[<span class=\"number\">1</span>]);</span><br><span class=\"line\">        close(child2parent[<span class=\"number\">0</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (read(parent2child[<span class=\"number\">0</span>], buf, <span class=\"number\">1</span>) != <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Child: Failed to read from pipe parent2child!\\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d: received ping\\n&quot;</span>, getpid());</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (write(child2parent[<span class=\"number\">1</span>], buf, <span class=\"number\">1</span>) != <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Child: Failed to write to pipe child2parent!\\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// parent process, write to pipe parent2child,</span></span><br><span class=\"line\">        <span class=\"comment\">// read from pipe child2parent</span></span><br><span class=\"line\">        close(parent2child[<span class=\"number\">0</span>]);</span><br><span class=\"line\">        close(child2parent[<span class=\"number\">1</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (write(parent2child[<span class=\"number\">1</span>], buf, <span class=\"number\">1</span>) != <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Parent: Failed to write to pipe parent2child!\\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (read(child2parent[<span class=\"number\">0</span>], buf, <span class=\"number\">1</span>) != <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Parent: Fail to read from pipe child2parent!\\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d: received pong\\n&quot;</span>, getpid());</span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>首先if的是孩子进程,所以我们关闭父亲写入的,来进行读取,同时关闭孩子的读取来进行写入,把读取的写入到矮子里面.之后就是父亲,父亲是自己先进行写入,然后读取孩子的,也要进行关闭程序.</p>\n<h4 id=\"1-5-4primes-moderate-x2F-hard\"><a href=\"#1-5-4primes-moderate-x2F-hard\" class=\"headerlink\" title=\"1.5.4primes (moderate)&#x2F;(hard)\"></a>1.5.4primes (<a href=\"https://pdos.csail.mit.edu/6.S081/2020/labs/guidance.html\">moderate</a>)&#x2F;(<a href=\"https://pdos.csail.mit.edu/6.S081/2020/labs/guidance.html\">hard</a>)</h4><blockquote>\n<h4 id=\"write-a-concurrent-version-of-prime-sieve-using-pipes-This-idea-is-due-to-Doug-McIlroy-inventor-of-Unix-pipes-The-picture-halfway-down-this-page-and-the-surrounding-text-explain-how-to-do-it-Your-solution-should-be-in-the-file-user-primes-c\"><a href=\"#write-a-concurrent-version-of-prime-sieve-using-pipes-This-idea-is-due-to-Doug-McIlroy-inventor-of-Unix-pipes-The-picture-halfway-down-this-page-and-the-surrounding-text-explain-how-to-do-it-Your-solution-should-be-in-the-file-user-primes-c\" class=\"headerlink\" title=\"write a concurrent version of prime sieve using pipes. This idea is due to Doug McIlroy, inventor of Unix pipes. The picture halfway down this page and the surrounding text explain how to do it. Your solution should be in the file user/primes.c.\"></a>write a concurrent version of prime sieve using pipes. This idea is due to Doug McIlroy, inventor of Unix pipes. The picture halfway down <a href=\"http://swtch.com/~rsc/thread/\">this page</a> and the surrounding text explain how to do it. Your solution should be in the file <code>user/primes.c</code>.</h4></blockquote>\n<p>题目要求,并发使用管道来进行读取输出2-35的素数.思路是一个写入2-35的管道,另外一个管道来进行输出.</p>\n<blockquote>\n<ul>\n<li>Be careful to close file descriptors that a process doesn’t need, because otherwise your program will run xv6 out of resources before the first process reaches 35.</li>\n<li>Once the first process reaches 35, it should wait until the entire pipeline terminates, including all children, grandchildren, &amp;c. Thus the main primes process should only exit after all the output has been printed, and after all the other primes processes have exited.</li>\n<li>Hint: <code>read</code> returns zero when the write-side of a pipe is closed.</li>\n<li>It’s simplest to directly write 32-bit (4-byte) <code>int</code>s to the pipes, rather than using formatted ASCII I&#x2F;O.</li>\n<li>You should create the processes in the pipeline only as they are needed.</li>\n<li>Add the program to <code>UPROGS</code> in Makefile.</li>\n</ul>\n</blockquote>\n<p>这个提示没什么用,直接看的大佬的版本,思路就是使用快速筛,蠡口上有讲解.主要思路就是第一遍把2的倍数全被设置true,剩下的从false里面读取,如果是当前的倍数的,也设置成true,指导到最后一个值.(这个给可以使用并发执行).</p>\n<blockquote>\n<p>所以这个问题就像是流水线一样，第一个进程将 <code>2~n</code> 依次写给第二个进程，第二个进程筛选非 <code>2</code> 倍数的数输出给第三个进程，第三个进程筛选非 <code>3</code> 倍数的数给第四个进程… 以此类推，单个阶段不一定要全部做完才交给后一阶段，完全可以像流水线一样进行。</p>\n<p>我们的目标是使用 <code>pipe</code> 和 <code>fork</code> 来实现这样的流水线，我们将处理 <code>2~35</code> 的数字，进行素数筛。由于 xv6 的文件描述符和进程数量有限，第一个进程可以在 <code>35</code> 时停止。</p>\n</blockquote>\n<p>使用wait来保真先后顺序,父亲之后才是孩子.在每一个管道的最后一端加入-1,代表管道内容已经结束了.</p>\n<p>整体代码,蠡口刷多了,写起来不是会很费力的.读取老的管道,同时把数字写入到新的管道,创建新进程调用新的管道作为输入,注意也要在最后加入-1作为结尾</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;kernel/types.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;kernel/stat.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;user/user.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> prime_num 35</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">run_child</span><span class=\"params\">(<span class=\"type\">int</span> *read_pipe)</span> &#123;</span><br><span class=\"line\">    close(read_pipe[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    <span class=\"type\">int</span> n, status;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((status = read(read_pipe[<span class=\"number\">0</span>], &amp;n, <span class=\"keyword\">sizeof</span>(<span class=\"type\">int</span>))) == <span class=\"number\">0</span>) &#123; <span class=\"comment\">// fetch the first number in the row</span></span><br><span class=\"line\">        close(read_pipe[<span class=\"number\">0</span>]);  <span class=\"comment\">// no more numbers in the pipeline</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(status == <span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Parent: Fail to read from pipe!\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;prime %d\\n&quot;</span>, n);  <span class=\"comment\">// print out the first number as the prime</span></span><br><span class=\"line\">    <span class=\"type\">int</span> parent_pipe[<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pipe(parent_pipe) == <span class=\"number\">-1</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Failed to create pipe!\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">int</span> pid = fork();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pid &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Failed to create child process!\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (pid == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        close(read_pipe[<span class=\"number\">0</span>]);</span><br><span class=\"line\">        run_child(parent_pipe);  <span class=\"comment\">// receive number in the new child process</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        close(parent_pipe[<span class=\"number\">0</span>]);</span><br><span class=\"line\">        <span class=\"type\">int</span> num;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> ((status = read(read_pipe[<span class=\"number\">0</span>], &amp;num, <span class=\"keyword\">sizeof</span>(<span class=\"type\">int</span>))) &gt; <span class=\"number\">0</span>) &#123; </span><br><span class=\"line\">            <span class=\"comment\">// filter and send numbers to new child process</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (num % n != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(write(parent_pipe[<span class=\"number\">1</span>], &amp;num, <span class=\"keyword\">sizeof</span>(<span class=\"type\">int</span>)) == <span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">                    <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Parent: Fail to write to pipe!\\n&quot;</span>);</span><br><span class=\"line\">                    <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(status == <span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Parent: Fail to read from pipe!\\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        close(parent_pipe[<span class=\"number\">1</span>]);</span><br><span class=\"line\">        wait((<span class=\"type\">int</span> *) <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span> *argv[])</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> input_pipe[<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pipe(input_pipe) == <span class=\"number\">-1</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Failed to create pipe!\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">int</span> pid = fork();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pid &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Failed to create child process!\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (pid == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        run_child(input_pipe); <span class=\"comment\">// child process to filter the numbers</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        close(input_pipe[<span class=\"number\">0</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">2</span>; i &lt;= prime_num; i++) &#123; <span class=\"comment\">// send 2~35 to the child process</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(write(input_pipe[<span class=\"number\">1</span>], &amp;i, <span class=\"keyword\">sizeof</span>(<span class=\"type\">int</span>)) == <span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">                <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Parent: Fail to write to pipe!\\n&quot;</span>);</span><br><span class=\"line\">                <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        close(input_pipe[<span class=\"number\">1</span>]);</span><br><span class=\"line\">        wait((<span class=\"type\">int</span> *) <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">exit</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"1-5-5find-moderate\"><a href=\"#1-5-5find-moderate\" class=\"headerlink\" title=\"1.5.5find (moderate)\"></a>1.5.5find (<a href=\"https://pdos.csail.mit.edu/6.S081/2020/labs/guidance.html\">moderate</a>)</h4><p>实现查找功能</p>\n<blockquote>\n<ul>\n<li>Look at user&#x2F;ls.c to see how to read directories.</li>\n<li>Use recursion to allow find to descend into sub-directories.</li>\n<li>Don’t recurse into “.” and “..”.</li>\n<li>Changes to the file system persist across runs of qemu; to get a clean file system run make clean and then make qemu.</li>\n<li>You’ll need to use C strings. Have a look at K&amp;R (the C book), for example Section 5.5.</li>\n<li>Note that &#x3D;&#x3D; does not compare strings like in Python. Use strcmp() instead.</li>\n<li>Add the program to <code>UPROGS</code> in Makefile</li>\n</ul>\n</blockquote>\n<p>提示是要我们区看ls的实现,ls把通过switch来对不同的来做判断,我们的现在要求就是根据判断末尾是不是要查找的目标,来进行输出.那么这一个题目就是变成字符串的截取题目.因为对c不是很熟.所以对这个题的代码卡了很久.char *a&#x3D;p.a&#x3D;a+strlen(a).这个意思是把a得到位置移动到最末尾,通过这样就变成截取字符串的操作.</p>\n<ol>\n<li>首先对与目标我们加上&#x2F;,因为每一个文件都是&#x2F;a&#x2F;a&#x2F;b这样的</li>\n<li>然后我们使用ls一样的测策略,对于文件,移动到和目标文件一样长的地方,看他们想不想等,相等就进行输出</li>\n<li>对于文件夹,我们使用递归,但是对于&#x2F;..还有&#x2F;.这个文件夹我们就不在进行递归 </li>\n<li></li>\n</ol>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Directory is a file containing a sequence of dirent structures.</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> DIRSIZ 14</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dirent</span> &#123;</span></span><br><span class=\"line\">  ushort inum;</span><br><span class=\"line\">  <span class=\"type\">char</span> name[DIRSIZ];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>文件夹的数据结构</p>\n<p>实现代码</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;kernel/types.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;kernel/stat.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;user/user.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;kernel/fs.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">char</span> *<span class=\"title function_\">fmtname</span><span class=\"params\">(<span class=\"type\">char</span> *path)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">char</span> *p;</span><br><span class=\"line\">    <span class=\"comment\">// Find first character after last slash.</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (p = path + <span class=\"built_in\">strlen</span>(path); p &gt;= path &amp;&amp; *p != <span class=\"string\">&#x27;/&#x27;</span>; p--)</span><br><span class=\"line\">        ;</span><br><span class=\"line\">    p++;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p; <span class=\"comment\">//返回末尾的文件名</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">find</span><span class=\"params\">(<span class=\"type\">char</span> *directory, <span class=\"type\">char</span> *filename)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">char</span> buf[<span class=\"number\">512</span>], *p;</span><br><span class=\"line\">    <span class=\"type\">int</span> fd;</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dirent</span> <span class=\"title\">de</span>;</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">stat</span> <span class=\"title\">st</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((fd = open(directory, <span class=\"number\">0</span>)) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;ls: cannot open %s\\n&quot;</span>, directory);</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (fstat(fd, &amp;st) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;ls: cannot stat %s\\n&quot;</span>, directory);</span><br><span class=\"line\">        close(fd);</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (st.type) &#123; <span class=\"comment\">//查看路径类型</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> T_FILE: <span class=\"comment\">//是文件</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">strcmp</span>(fmtname(directory), filename) == <span class=\"number\">0</span>) &#123; <span class=\"comment\">//比较路径末尾文件名和查找的文件名</span></span><br><span class=\"line\">                <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%s \\n&quot;</span>, directory);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> T_DIR: <span class=\"comment\">//是目录</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">strlen</span>(directory) + <span class=\"number\">1</span> + DIRSIZ + <span class=\"number\">1</span> &gt; <span class=\"keyword\">sizeof</span> buf) &#123;</span><br><span class=\"line\">                <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;find: path is too long \\n&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">strcpy</span>(buf, directory);</span><br><span class=\"line\">            p = buf + <span class=\"built_in\">strlen</span>(buf);</span><br><span class=\"line\">            *p++ = <span class=\"string\">&#x27;/&#x27;</span>; <span class=\"comment\">//拼凑当前目录路径</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (read(fd, &amp;de, <span class=\"keyword\">sizeof</span>(de)) == <span class=\"keyword\">sizeof</span>(de)) &#123; <span class=\"comment\">//遍历目录</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (de.inum == <span class=\"number\">0</span> || <span class=\"built_in\">strcmp</span>(<span class=\"string\">&quot;.&quot;</span>, de.name) == <span class=\"number\">0</span> ||</span><br><span class=\"line\">                    <span class=\"built_in\">strcmp</span>(<span class=\"string\">&quot;..&quot;</span>, de.name) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                memmove(p, de.name, DIRSIZ); <span class=\"comment\">//拼凑当前文件路径</span></span><br><span class=\"line\">                p[DIRSIZ] = <span class=\"number\">0</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (stat(buf, &amp;st) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;ls: cannot stat %s\\n&quot;</span>, buf);</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                find(buf, filename); <span class=\"comment\">//调用find递归查找</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    close(fd);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span> *argv[])</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (argc != <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Usage: find &lt;directory&gt; &lt;filename&gt;\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    find(argv[<span class=\"number\">1</span>], argv[<span class=\"number\">2</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">exit</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"2-lab-syscall\"><a href=\"#2-lab-syscall\" class=\"headerlink\" title=\"2.lab syscall\"></a>2.lab syscall</h2><p><a href=\"http://xv6.dgs.zone/tranlate_books/book-riscv-rev1/c2/s2.html\">2.2 用户态，核心态，以及系统调用 · 6.S081 All-In-One (dgs.zone)</a></p>\n<p>操作系统的作用是抽象系统同资源,最基本的目的就是互不影响程序,当一个程序出现问题不会影响下一个程序.所以系统管理员是操作系统,他与硬件打交道.</p>\n<h3 id=\"2-2用户态，核心态，以及系统调用\"><a href=\"#2-2用户态，核心态，以及系统调用\" class=\"headerlink\" title=\"2.2用户态，核心态，以及系统调用\"></a>2.2用户态，核心态，以及系统调用</h3><p>用户态和和心态,和心态就是直接与硬件打交道的</p>\n<p>核心态可以使用特权指令,用户通过条用内核函数的程序,把用户态转移到和心态,然后 在内核指定的路口,进入内核(ecall函数)需要写entry(write),然后通过设置一个数字作为这个函数的映射,内核太调用这个数字实际对那个内核里面的函数来实现方法</p>\n<p><img src=\"https://blog.rayzhang.top/2022/07/05/mit-6.s081-lab-syscall/syscall_fork.png\"></p>\n<p>syscall调用sysproc实际方法</p>\n<h3 id=\"2-3内核组织\"><a href=\"#2-3内核组织\" class=\"headerlink\" title=\"2.3内核组织\"></a>2.3内核组织</h3><p>分为大内核还有小内核,大内核就是和Windows差不多,所以的硬件功能都已经实现,小内核就是自己要实现文件这中内核操作,通过组合操作.</p>\n<h3 id=\"2-4进程\"><a href=\"#2-4进程\" class=\"headerlink\" title=\"2.4进程\"></a>2.4进程</h3><p>进程都有自己的结构体,有自己的状态,还有自己的页表(页表,就是一个进程的虚拟地址空间)</p>\n<h3 id=\"2-5实验\"><a href=\"#2-5实验\" class=\"headerlink\" title=\"2.5实验\"></a>2.5实验</h3><h4 id=\"2-5-1System-call-tracing-moderate\"><a href=\"#2-5-1System-call-tracing-moderate\" class=\"headerlink\" title=\"2.5.1System call tracing (moderate)\"></a>2.5.1System call tracing (<a href=\"https://pdos.csail.mit.edu/6.S081/2020/labs/guidance.html\">moderate</a>)</h4><p>实现追踪功能,然后追踪的进程的mask是这样得到 <code>trace(1 &lt;&lt; SYS_fork)</code>,这个参数可以通过argint得到</p>\n<blockquote>\n<ul>\n<li>Add <code>$U/_trace</code> to UPROGS in Makefile</li>\n<li>Run make qemu and you will see that the compiler cannot compile <code>user/trace.c</code>, because the user-space stubs for the system call don’t exist yet: add a prototype for the system call to <code>user/user.h</code>, a stub to <code>user/usys.pl</code>, and a syscall number to <code>kernel/syscall.h</code>. The Makefile invokes the perl script <code>user/usys.pl</code>, which produces <code>user/usys.S</code>, the actual system call stubs, which use the RISC-V <code>ecall</code> instruction to transition to the kernel. Once you fix the compilation issues, run trace 32 grep hello README; it will fail because you haven’t implemented the system call in the kernel yet.</li>\n<li>Add a <code>sys_trace()</code> function in <code>kernel/sysproc.c</code> that implements the new system call by remembering its argument in a new variable in the <code>proc</code> structure (see <code>kernel/proc.h</code>). The functions to retrieve system call arguments from user space are in <code>kernel/syscall.c</code>, and you can see examples of their use in <code>kernel/sysproc.c</code>.</li>\n<li>Modify <code>fork()</code> (see <code>kernel/proc.c</code>) to copy the trace mask from the parent to the child process.</li>\n<li></li>\n</ul>\n</blockquote>\n<p>给定的提示,我们直接运行make是无法编译成功的.提示是因为无法编译trace.c,因为这个给用户态的功能trace在内核态没有对应实现,我们需要实现.首先就是在userh里面添加trace功能(申明,系统提供的api).之后区usys添加入口,这是上面的陷入,然后添加一个数值在syscall</p>\n<blockquote>\n<p>because the user-space stubs for the system call don’t exist yet: add a prototype for the system call to <code>user/user.h</code>, a stub to <code>user/usys.pl</code>, and a syscall number to <code>kernel/syscall.h</code>. The Makefile invokes the perl script <code>user/usys.pl</code>, which produces <code>user/usys.S</code>, the actual system call stubs, which use the RISC-V <code>ecall</code> instruction to transition to the kernel. </p>\n</blockquote>\n<p>尽管添加了之后,你还是没有办法实现,因为你要实现systrace功能在sysproc里面,我们需要把追踪的进程的掩码设置成传入的参数,通过argint得到mask,之后对于该进程创建的子进程,我们也许奥把掩码设置成先对应的mask(复制操作,只需要更改fork的逻辑就行),最后我们把掩码一样的在syscall里进行输出.</p>\n<p><strong>这个题的主要重点,就是让我们了解到系统调用的流程,首先是在user里面注册系统调用函数,然后通过entry进行陷入这个函数,之后调用特殊的数值,来作为系统调用的参数.然后我们在sysproc具体实现这个功能</strong></p>\n<p>主要 的流程就是上图所示</p>\n<blockquote>\n<p>所以，需要有一种方式能够让应用程序可以将控制权转移给内核（Entering Kernel）。</p>\n<p>在RISC-V中，有一个专门的指令用来实现这个功能，叫做ECALL。ECALL接收一个数字参数，当一个用户程序想要将程序执行的控制权转移到内核，它只需要执行ECALL指令，并传入一个数字。这里的数字参数代表了应用程序想要调用的System Call。</p>\n<p><img src=\"https://906337931-files.gitbook.io/~/files/v0/b/gitbook-legacy-files/o/assets%2F-MHZoT2b_bcLghjAOPsJ%2F-MJX963vbIPHKetjGrZN%2F-MJXAkJxD8pTZOm1Tay_%2Fimage.png?alt=media&token=cf3e26a2-3c26-43b8-aee0-6d5787f8dcf5\" alt=\"img\"></p>\n<p>ECALL会跳转到内核中一个特定，由内核控制的位置。我们在这节课的最后可以看到在XV6中存在一个唯一的系统调用接入点，每一次应用程序执行ECALL指令，应用程序都会通过这个接入点进入到内核中。举个例子，不论是Shell还是其他的应用程序，当它在用户空间执行fork时，它并不是直接调用操作系统中对应的函数，而是调用ECALL指令，并将fork对应的数字作为参数传给ECALL。之后再通过ECALL跳转到内核。</p>\n<p>下图中通过一根竖线来区分用户空间和内核空间，左边是用户空间，右边是内核空间。在内核侧，有一个位于syscall.c的函数syscall，每一个从应用程序发起的系统调用都会调用到这个syscall函数，syscall函数会检查ECALL的参数，通过这个参数内核可以知道需要调用的是fork（3.9会有相应的代码跟踪介绍）。</p>\n<p><img src=\"https://906337931-files.gitbook.io/~/files/v0/b/gitbook-legacy-files/o/assets%2F-MHZoT2b_bcLghjAOPsJ%2F-MJX963vbIPHKetjGrZN%2F-MJXO2n90L0ziqU8mTcg%2Fimage.png?alt=media&token=754f49c1-58a2-42d5-9427-094fc95ab613\" alt=\"img\"></p>\n</blockquote>\n<ol>\n<li>在makefile进行注册</li>\n<li>在user里面进行注册函数trace在sys里面进行进入entry</li>\n<li>之后在syscall里面进行设置特殊的数值</li>\n<li>然后调用这个sys_trace,之后在sysproc里实现(思路就是调用新的trace函数)</li>\n<li>trace函数就是把当前mask传给当前进程</li>\n<li>然后在syscall调用,调用结束后.我们来对这个掩码做比较,相同就进行输出</li>\n</ol>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uint64 <span class=\"title function_\">sys_trace</span><span class=\"params\">(<span class=\"type\">void</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> mask;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (argint(<span class=\"number\">0</span>, &amp;mask) &lt; <span class=\"number\">0</span>) &#123;  <span class=\"comment\">//获取trace的参数</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;               <span class=\"comment\">//获取失败返回-1</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> trace(mask);  <span class=\"comment\">//调用核心函数</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这个trace函数还需要在defs进行申明,不然没发实现</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">trace</span><span class=\"params\">(<span class=\"type\">int</span> mask)</span> &#123; </span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">proc</span> *<span class=\"title\">p</span> =</span> myproc();</span><br><span class=\"line\">  p-&gt;mask = mask;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>对fork的修改,就是把父进程的mask传授那个给子进程</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Create a new process, copying the parent.</span></span><br><span class=\"line\"><span class=\"comment\">// Sets up child kernel stack to return as if from fork() system call.</span></span><br><span class=\"line\"><span class=\"type\">int</span></span><br><span class=\"line\"><span class=\"title function_\">fork</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"type\">int</span> i, pid;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">proc</span> *<span class=\"title\">np</span>;</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">proc</span> *<span class=\"title\">p</span> =</span> myproc();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Allocate process.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>((np = allocproc()) == <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Copy user memory from parent to child.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(uvmcopy(p-&gt;pagetable, np-&gt;pagetable, p-&gt;sz) &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    freeproc(np);</span><br><span class=\"line\">    release(&amp;np-&gt;lock);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  np-&gt;sz = p-&gt;sz;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// copy saved user registers.</span></span><br><span class=\"line\">  *(np-&gt;trapframe) = *(p-&gt;trapframe);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Cause fork to return 0 in the child.</span></span><br><span class=\"line\">  np-&gt;trapframe-&gt;a0 = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// increment reference counts on open file descriptors.</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span>(i = <span class=\"number\">0</span>; i &lt; NOFILE; i++)</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(p-&gt;ofile[i])</span><br><span class=\"line\">      np-&gt;ofile[i] = filedup(p-&gt;ofile[i]);</span><br><span class=\"line\">  np-&gt;cwd = idup(p-&gt;cwd);</span><br><span class=\"line\"></span><br><span class=\"line\">  safestrcpy(np-&gt;name, p-&gt;name, <span class=\"keyword\">sizeof</span>(p-&gt;name));</span><br><span class=\"line\"></span><br><span class=\"line\">  np-&gt;mask = p-&gt;mask; <span class=\"comment\">//复制mask掩码</span></span><br><span class=\"line\"></span><br><span class=\"line\">  pid = np-&gt;pid;</span><br><span class=\"line\"></span><br><span class=\"line\">  release(&amp;np-&gt;lock);</span><br><span class=\"line\"></span><br><span class=\"line\">  acquire(&amp;wait_lock);</span><br><span class=\"line\">  np-&gt;parent = p;</span><br><span class=\"line\">  release(&amp;wait_lock);</span><br><span class=\"line\"></span><br><span class=\"line\">  acquire(&amp;np-&gt;lock);</span><br><span class=\"line\">  np-&gt;state = RUNNABLE;</span><br><span class=\"line\">  release(&amp;np-&gt;lock);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> pid;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>最后根据提示,我们在这里进行符合的输出</p>\n<blockquote>\n<p>The 32 is <code>1&lt;&lt;SYS_read</code>. In the second exam</p>\n</blockquote>\n<p>他的逻辑就是把这个给进程进行移动系统的位数,所以我们只要一回来,然后与1,还是1,就说明这个是需要最终的,我们就进行输出</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if(p-&gt;mask &gt;&gt; num &amp; 1) &#123;</span><br><span class=\"line\">      printf(&quot;%d: syscall %s -&gt; %d\\n&quot;,p-&gt;pid, syscalls_name[num], p-&gt;trapframe-&gt;a0);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span></span><br><span class=\"line\"><span class=\"title function_\">syscall</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"type\">int</span> num;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">proc</span> *<span class=\"title\">p</span> =</span> myproc();</span><br><span class=\"line\"></span><br><span class=\"line\">  num = p-&gt;trapframe-&gt;a7;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(num &gt; <span class=\"number\">0</span> &amp;&amp; num &lt; NELEM(syscalls) &amp;&amp; syscalls[num]) &#123;</span><br><span class=\"line\">    p-&gt;trapframe-&gt;a0 = syscalls[num]();</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(p-&gt;mask &gt;&gt; num &amp; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d: syscall %s -&gt; %d\\n&quot;</span>,p-&gt;pid, syscalls_name[num], p-&gt;trapframe-&gt;a0);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d %s: unknown sys call %d\\n&quot;</span>,</span><br><span class=\"line\">            p-&gt;pid, p-&gt;name, num);</span><br><span class=\"line\">    p-&gt;trapframe-&gt;a0 = <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h2 id=\"3-lab-pgtble\"><a href=\"#3-lab-pgtble\" class=\"headerlink\" title=\"3.lab pgtble\"></a>3.lab pgtble</h2><h3 id=\"3-1基础知识\"><a href=\"#3-1基础知识\" class=\"headerlink\" title=\"3.1基础知识\"></a>3.1基础知识</h3><p><img src=\"https://blog.rayzhang.top/2022/07/22/mit-6.s081-lab-pgtbl/pgtbl-3-level.png\" alt=\"img\"></p>\n<p>虚拟地址,通过页表来获取得到ppn(页表项),之后通过页表项目+offset得到最后的物理低值.这是一个三级页表,我没得到的前面两个ppn是下一个页面的地址.转化教程如下walk,让hi偶我们再看每一个pte是不是有效,获得pte使用的全相联,直接把这个虚拟地址进行映射到页表上面,最终与1ff想与,就是在512个里面找到是那一项</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">pte_t</span> *</span><br><span class=\"line\"><span class=\"title function_\">walk</span><span class=\"params\">(<span class=\"type\">pagetable_t</span> pagetable, uint64 va, <span class=\"type\">int</span> alloc)</span> </span><br><span class=\"line\">  <span class=\"comment\">//pagetable表示一级页表的地址，va为虚拟内存地址，alloc表示是否创建条目</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(va &gt;= MAXVA) <span class=\"comment\">//虚拟内存地址越界，报错</span></span><br><span class=\"line\">    panic(<span class=\"string\">&quot;walk&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"type\">int</span> level = <span class=\"number\">2</span>; level &gt; <span class=\"number\">0</span>; level--) &#123; <span class=\"comment\">//分三级地址</span></span><br><span class=\"line\">    <span class=\"type\">pte_t</span> *pte = &amp;pagetable[PX(level, va)]; <span class=\"comment\">//使用位运算获取L2/L1/L0，计算索引位置</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(*pte &amp; PTE_V) &#123;</span><br><span class=\"line\">      pagetable = (<span class=\"type\">pagetable_t</span>)PTE2PA(*pte); <span class=\"comment\">//若条目有效，将页表指针指向下级页表</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(!alloc || (pagetable = (<span class=\"type\">pde_t</span>*)kalloc()) == <span class=\"number\">0</span>) <span class=\"comment\">//若无效，且alloc有设置，创建相关条目</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"built_in\">memset</span>(pagetable, <span class=\"number\">0</span>, PGSIZE);</span><br><span class=\"line\">      *pte = PA2PTE(pagetable) | PTE_V;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &amp;pagetable[PX(<span class=\"number\">0</span>, va)]; <span class=\"comment\">//最后返回三级页表中映射的物理地址</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>初始化流程</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16876974250271687697424363.png\" alt=\"16876974250271687697424363.png\"></p>\n<p>首先kinit是初始化锁,之后的kvmint初始化内核页表</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span></span><br><span class=\"line\"><span class=\"title function_\">kvminit</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  kernel_pagetable = kvmmake();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Make a direct-map page table for the kernel.</span></span><br><span class=\"line\"><span class=\"type\">pagetable_t</span></span><br><span class=\"line\"><span class=\"title function_\">kvmmake</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"type\">pagetable_t</span> kpgtbl;</span><br><span class=\"line\"></span><br><span class=\"line\">  kpgtbl = (<span class=\"type\">pagetable_t</span>) kalloc();</span><br><span class=\"line\">  <span class=\"built_in\">memset</span>(kpgtbl, <span class=\"number\">0</span>, PGSIZE);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// uart registers</span></span><br><span class=\"line\">  kvmmap(kpgtbl, UART0, UART0, PGSIZE, PTE_R | PTE_W);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// virtio mmio disk interface</span></span><br><span class=\"line\">  kvmmap(kpgtbl, VIRTIO0, VIRTIO0, PGSIZE, PTE_R | PTE_W);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// PLIC</span></span><br><span class=\"line\">  kvmmap(kpgtbl, PLIC, PLIC, <span class=\"number\">0x400000</span>, PTE_R | PTE_W);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// map kernel text executable and read-only.</span></span><br><span class=\"line\">  kvmmap(kpgtbl, KERNBASE, KERNBASE, (uint64)etext-KERNBASE, PTE_R | PTE_X);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// map kernel data and the physical RAM we&#x27;ll make use of.</span></span><br><span class=\"line\">  kvmmap(kpgtbl, (uint64)etext, (uint64)etext, PHYSTOP-(uint64)etext, PTE_R | PTE_W);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// map the trampoline for trap entry/exit to</span></span><br><span class=\"line\">  <span class=\"comment\">// the highest virtual address in the kernel.</span></span><br><span class=\"line\">  kvmmap(kpgtbl, TRAMPOLINE, (uint64)trampoline, PGSIZE, PTE_R | PTE_X);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// map kernel stacks</span></span><br><span class=\"line\">  proc_mapstacks(kpgtbl);</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">return</span> kpgtbl;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>主要看kvmake的,她的作用就是映射pa,与设备在内存的地址上面</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// add a mapping to the kernel page table.</span></span><br><span class=\"line\"><span class=\"comment\">// only used when booting.</span></span><br><span class=\"line\"><span class=\"comment\">// does not flush TLB or enable paging.</span></span><br><span class=\"line\"><span class=\"type\">void</span></span><br><span class=\"line\"><span class=\"title function_\">kvmmap</span><span class=\"params\">(<span class=\"type\">pagetable_t</span> kpgtbl, uint64 va, uint64 pa, uint64 sz, <span class=\"type\">int</span> perm)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(mappages(kpgtbl, va, sz, pa, perm) != <span class=\"number\">0</span>)</span><br><span class=\"line\">    panic(<span class=\"string\">&quot;kvmmap&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Create PTEs for virtual addresses starting at va that refer to</span></span><br><span class=\"line\"><span class=\"comment\">// physical addresses starting at pa. va and size might not</span></span><br><span class=\"line\"><span class=\"comment\">// be page-aligned. Returns 0 on success, -1 if walk() couldn&#x27;t</span></span><br><span class=\"line\"><span class=\"comment\">// allocate a needed page-table page.</span></span><br><span class=\"line\"><span class=\"type\">int</span></span><br><span class=\"line\"><span class=\"title function_\">mappages</span><span class=\"params\">(<span class=\"type\">pagetable_t</span> pagetable, uint64 va, uint64 size, uint64 pa, <span class=\"type\">int</span> perm)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  uint64 a, last;</span><br><span class=\"line\">  <span class=\"type\">pte_t</span> *pte;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(size == <span class=\"number\">0</span>)</span><br><span class=\"line\">    panic(<span class=\"string\">&quot;mappages: size&quot;</span>);</span><br><span class=\"line\">  </span><br><span class=\"line\">  a = PGROUNDDOWN(va);</span><br><span class=\"line\">  last = PGROUNDDOWN(va + size - <span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(;;)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>((pte = walk(pagetable, a, <span class=\"number\">1</span>)) == <span class=\"number\">0</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(*pte &amp; PTE_V)</span><br><span class=\"line\">      panic(<span class=\"string\">&quot;mappages: remap&quot;</span>);</span><br><span class=\"line\">    *pte = PA2PTE(pa) | perm | PTE_V;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(a == last)</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    a += PGSIZE;</span><br><span class=\"line\">    pa += PGSIZE;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>主要使用的map来进行操作,map就是设置映射最底层的实现了，参数分别为页表地址 <code>pagetable</code>，虚拟地址 <code>va</code>，映射大小 <code>sz</code>，物理地址 <code>pa</code> 和访问标志位 <code>perm</code>：</p>\n<p>代码的含义:对虚拟地址首先下面对齐,结尾的扼要进行最下面的页面对齐</p>\n<p>使用walk返回的值是一个地址,还需要*pte才是最后的值,返回的是物理地址.然后在使用    *pte &#x3D; PA2PTE(pa) | perm | PTE_V;填入值</p>\n<hr>\n<p>用户地址基础知识</p>\n<p><img src=\"https://blog.rayzhang.top/2022/07/22/mit-6.s081-lab-pgtbl/user-addr-space.png\" alt=\"img\"></p>\n<p>构建第一个用户程序</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Set up first user process.</span></span><br><span class=\"line\"><span class=\"type\">void</span></span><br><span class=\"line\"><span class=\"title function_\">userinit</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">proc</span> *<span class=\"title\">p</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  p = allocproc();</span><br><span class=\"line\">  initproc = p;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// allocate one user page and copy init&#x27;s instructions</span></span><br><span class=\"line\">  <span class=\"comment\">// and data into it.</span></span><br><span class=\"line\">  uvminit(p-&gt;pagetable, initcode, <span class=\"keyword\">sizeof</span>(initcode));</span><br><span class=\"line\">  p-&gt;sz = PGSIZE;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// prepare for the very first &quot;return&quot; from kernel to user.</span></span><br><span class=\"line\">  p-&gt;trapframe-&gt;epc = <span class=\"number\">0</span>;      <span class=\"comment\">// user program counter</span></span><br><span class=\"line\">  p-&gt;trapframe-&gt;sp = PGSIZE;  <span class=\"comment\">// user stack pointer</span></span><br><span class=\"line\"></span><br><span class=\"line\">  safestrcpy(p-&gt;name, <span class=\"string\">&quot;initcode&quot;</span>, <span class=\"keyword\">sizeof</span>(p-&gt;name));</span><br><span class=\"line\">  p-&gt;cwd = namei(<span class=\"string\">&quot;/&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  p-&gt;state = RUNNABLE;</span><br><span class=\"line\"></span><br><span class=\"line\">  release(&amp;p-&gt;lock);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>对用户程序分配pagetable,epc,sp,状态,重点看alloc</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Look in the process table for an UNUSED proc.</span></span><br><span class=\"line\"><span class=\"comment\">// If found, initialize state required to run in the kernel,</span></span><br><span class=\"line\"><span class=\"comment\">// and return with p-&gt;lock held.</span></span><br><span class=\"line\"><span class=\"comment\">// If there are no free procs, or a memory allocation fails, return 0.</span></span><br><span class=\"line\"><span class=\"type\">static</span> <span class=\"keyword\">struct</span> proc*</span><br><span class=\"line\"><span class=\"title function_\">allocproc</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">proc</span> *<span class=\"title\">p</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span>(p = proc; p &lt; &amp;proc[NPROC]; p++) &#123;</span><br><span class=\"line\">    acquire(&amp;p-&gt;lock);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(p-&gt;state == UNUSED) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">goto</span> found;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      release(&amp;p-&gt;lock);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">found:</span><br><span class=\"line\">  p-&gt;pid = allocpid();</span><br><span class=\"line\">  p-&gt;state = USED;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Allocate a trapframe page.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>((p-&gt;trapframe = (<span class=\"keyword\">struct</span> trapframe *)kalloc()) == <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    freeproc(p);</span><br><span class=\"line\">    release(&amp;p-&gt;lock);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// An empty user page table.</span></span><br><span class=\"line\">  p-&gt;pagetable = proc_pagetable(p);</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(p-&gt;pagetable == <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    freeproc(p);</span><br><span class=\"line\">    release(&amp;p-&gt;lock);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Set up new context to start executing at forkret,</span></span><br><span class=\"line\">  <span class=\"comment\">// which returns to user space.</span></span><br><span class=\"line\">  <span class=\"built_in\">memset</span>(&amp;p-&gt;context, <span class=\"number\">0</span>, <span class=\"keyword\">sizeof</span>(p-&gt;context));</span><br><span class=\"line\">  p-&gt;context.ra = (uint64)forkret;</span><br><span class=\"line\">  p-&gt;context.sp = p-&gt;kstack + PGSIZE;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> p;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>通过查找 空闲的来进行分配</p>\n<p>看用户页表的实现</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Create a user page table for a given process,</span></span><br><span class=\"line\"><span class=\"comment\">// with no user memory, but with trampoline pages.</span></span><br><span class=\"line\"><span class=\"type\">pagetable_t</span></span><br><span class=\"line\"><span class=\"title function_\">proc_pagetable</span><span class=\"params\">(<span class=\"keyword\">struct</span> proc *p)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"type\">pagetable_t</span> pagetable;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// An empty page table.</span></span><br><span class=\"line\">  pagetable = uvmcreate();</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(pagetable == <span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// map the trampoline code (for system call return)</span></span><br><span class=\"line\">  <span class=\"comment\">// at the highest user virtual address.</span></span><br><span class=\"line\">  <span class=\"comment\">// only the supervisor uses it, on the way</span></span><br><span class=\"line\">  <span class=\"comment\">// to/from user space, so not PTE_U.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(mappages(pagetable, TRAMPOLINE, PGSIZE,</span><br><span class=\"line\">              (uint64)trampoline, PTE_R | PTE_X) &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    uvmfree(pagetable, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// map the trapframe just below TRAMPOLINE, for trampoline.S.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(mappages(pagetable, TRAPFRAME, PGSIZE,</span><br><span class=\"line\">              (uint64)(p-&gt;trapframe), PTE_R | PTE_W) &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    uvmunmap(pagetable, TRAMPOLINE, <span class=\"number\">1</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    uvmfree(pagetable, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> pagetable;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>保留两个空间一个是trapframe(陷入的时候用的),然后放入到页表里面</p>\n<h3 id=\"3-2实现系统调用的加速\"><a href=\"#3-2实现系统调用的加速\" class=\"headerlink\" title=\"3.2实现系统调用的加速\"></a>3.2实现系统调用的加速</h3><h4 id=\"要求和提示\"><a href=\"#要求和提示\" class=\"headerlink\" title=\"要求和提示\"></a>要求和提示</h4><p>在这个部分中，我们要通过调整页表的映射来实现对特定的系统调用的加速。</p>\n<p>在部分操作系统（例如 Linux 中），会使用用户空间和内核空间之间的一块只读区域用来进行数据共享，以此来达到加速特定的系统调用的目的，这样就消除了与内核交互产生的开销。在本部分中，我们将实现对 <code>getpid</code> 系统调用的优化。</p>\n<p>当一个进程被创建时，我们需要将一个只读的内存页映射到 <code>USYSCALL</code> 上，其中 <code>USYSCALL</code> 是一个虚拟内存地址，见 <code>kernel/memlayout.h</code>。在该内存页上我们需要存储一个叫 <code>struct usyscall</code> 的结构体，见 <code>kernel/memlayout.h</code>，然后将其初始化使其存储当前进程的 PID。下面是 <code>memlayout.h</code> 的节选部分：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C</span><br><span class=\"line\">#define USYSCALL (TRAPFRAME - PGSIZE)</span><br><span class=\"line\">struct usyscall &#123;</span><br><span class=\"line\">  int pid;  // Process ID</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>在这个 Lab 中，系统在用户空间部分已经提供了 <code>ugetpid()</code>，并会自动使用 <code>USYSCALL</code> 的映射，<code>ugetpid</code> 函数就是我们测试时的函数，<strong>为了使得他工作正常我们需要完成相关修改</strong>。这段见 <code>user/ulib.c</code>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C</span><br><span class=\"line\">#ifdef LAB_PGTBL</span><br><span class=\"line\">int</span><br><span class=\"line\">ugetpid(void)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  struct usyscall *u = (struct usyscall *)USYSCALL;</span><br><span class=\"line\">  return u-&gt;pid;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">#endif</span><br></pre></td></tr></table></figure>\n\n<p>相关提示：</p>\n<ul>\n<li>可以在 <code>kernel/proc.c</code> 下的 <code>proc_pagetable</code> 中处理内存映射问题。</li>\n<li>注意处理访问标志位使得该内存页对用户空间来说是只读的。</li>\n<li>了解 <code>mappages()</code> 的使用方法会很有帮助。</li>\n<li>不要忘记在 <code>allocproc()</code> 中分配和初始化内存页。</li>\n<li>确保在 <code>freeproc()</code> 中正确地释放了内存页。</li>\n</ul>\n<blockquote>\n<p>大致的意识就是要求我们使用用户空间和内核空间之间的一块只读区域用来进行数据共享，以此来达到加速特定的系统调用的目的，这样就消除了与内核交互产生的开销。</p>\n</blockquote>\n<p><img src=\"https://blog.rayzhang.top/2022/07/22/mit-6.s081-lab-pgtbl/usyscall.png\" alt=\"img\"></p>\n<blockquote>\n<p>要求我们在usyspage这个里面进行设置我们的信息都存放在这个空间里面</p>\n</blockquote>\n<p>根据我们上面的基础知识,我们知道页表初始化**,实在proc_pagetable(p);**这个函数里面,我们在这里进行映射usys这个地址到页表.</p>\n<p>和trapoframe一样的流程,分配之后,然后才是分配页表</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Allocate a trapframe page.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>((p-&gt;trapframe = (<span class=\"keyword\">struct</span> trapframe *)kalloc()) == <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    freeproc(p);</span><br><span class=\"line\">    release(&amp;p-&gt;lock);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Allocate a usyscall page</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>((p-&gt;usyspage = (<span class=\"keyword\">struct</span> usyscall *)kalloc()) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      freeproc(p);</span><br><span class=\"line\">      release(&amp;p-&gt;lock);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// Init the usyscall page</span></span><br><span class=\"line\">  p-&gt;usyspage-&gt;pid = p-&gt;pid;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//页表函数</span></span><br><span class=\"line\"><span class=\"comment\">// map the usyscall page</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(mappages(pagetable, USYSCALL, PGSIZE,</span><br><span class=\"line\">              (uint64)(p-&gt;usyspage), PTE_R | PTE_U) &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    uvmunmap(pagetable, USYSCALL, <span class=\"number\">1</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    uvmfree(pagetable, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//释放</span></span><br><span class=\"line\">按照trapframe释放方法</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(p-&gt;trapframe)</span><br><span class=\"line\">    kfree((<span class=\"type\">void</span>*)p-&gt;trapframe);</span><br><span class=\"line\">  p-&gt;trapframe = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (p-&gt;usyspage) </span><br><span class=\"line\">    kfree((<span class=\"type\">void</span> *)p-&gt;usyspage);</span><br><span class=\"line\">  p-&gt;usyspage = <span class=\"number\">0</span>;  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (p-&gt;pagetable) proc_freepagetable(p-&gt;pagetable, p-&gt;sz);</span><br></pre></td></tr></table></figure>\n\n<p>注意到释放过程,调用页表,那么页表项,我们也要释放</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uvmunmap(pagetable, USYSCALL, <span class=\"number\">1</span>, <span class=\"number\">0</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-3实现页表打印\"><a href=\"#3-3实现页表打印\" class=\"headerlink\" title=\"3.3实现页表打印\"></a>3.3实现页表打印</h3><h4 id=\"要求和提示-1\"><a href=\"#要求和提示-1\" class=\"headerlink\" title=\"要求和提示\"></a>要求和提示</h4><p>在本部分中，我们需要将 RISC-V 的页表可视化，也就是实现一个页表内容的打印功能，作为后续调试的辅助工具。</p>\n<p>我们需要定义一个叫做 <code>vmprint()</code> 的函数，这个函数应当传入一个类型为 <code>pagetable_t</code> 的参数，也是页表的指针，然后将页表的全部有效信息打印出来。题目要求在 <code>kernel/exec.c</code> 下的 <code>exec()</code> 中，在最后的 <code>return argc</code> 前加入一行（疯狂暗示，喂到嘴巴里）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C</span><br><span class=\"line\">if(p-&gt;pid==1) vmprint(p-&gt;pagetable);</span><br></pre></td></tr></table></figure>\n\n<p>来实现对第一个进程的页表的打印。</p>\n<p>题目中给出了示例，当第一个进程刚完成 <code>exec()</code> 执行了 <code>/init</code> 时的页表状态：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PLAINTEXT</span><br><span class=\"line\"></span><br><span class=\"line\">page table <span class=\"number\">0x0000000087f6e000</span></span><br><span class=\"line\"> .<span class=\"number\">.0</span>: pte <span class=\"number\">0x0000000021fda801</span> pa <span class=\"number\">0x0000000087f6a000</span></span><br><span class=\"line\"> .. .<span class=\"number\">.0</span>: pte <span class=\"number\">0x0000000021fda401</span> pa <span class=\"number\">0x0000000087f69000</span></span><br><span class=\"line\"> .. .. .<span class=\"number\">.0</span>: pte <span class=\"number\">0x0000000021fdac1f</span> pa <span class=\"number\">0x0000000087f6b000</span></span><br><span class=\"line\"> .. .. .<span class=\"number\">.1</span>: pte <span class=\"number\">0x0000000021fda00f</span> pa <span class=\"number\">0x0000000087f68000</span></span><br><span class=\"line\"> .. .. .<span class=\"number\">.2</span>: pte <span class=\"number\">0x0000000021fd9c1f</span> pa <span class=\"number\">0x0000000087f67000</span></span><br><span class=\"line\"> .<span class=\"number\">.255</span>: pte <span class=\"number\">0x0000000021fdb401</span> pa <span class=\"number\">0x0000000087f6d000</span></span><br></pre></td></tr></table></figure>\n\n<p>相关提示：</p>\n<ul>\n<li>可以把 <code>vmprint()</code> 放在 <code>kernel/vm.c</code> 里面</li>\n<li>记得使用 <code>kernel/riscv.h</code> 最后添加的宏定义，包括但不限于 <code>PTE2PA</code> 等</li>\n<li>强烈建议参考 <code>vm.c</code> 文件中的 <code>freewalk</code> 函数（疯狂暗示，喂嘴巴里了）</li>\n<li>记得在 <code>kernel/defs.h</code> 中定义 <code>vmprint</code> 函数，以便在 <code>exec.c</code> 中成功调用</li>\n<li>在 <code>printf</code> 中使用 <code>%p</code> 来打印完整的 16 进制 64 位地址和 PTE 信息</li>\n</ul>\n<p><img src=\"https://blog.rayzhang.top/2022/07/22/mit-6.s081-lab-pgtbl/pgtbl-3-level.png\" alt=\"img\"></p>\n<p>这个很明显就是递归的效果,我们参考freewalk,首先得到page,之后根据二级页表得到页表项,再继续递归</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">pgtblprint</span><span class=\"params\">(<span class=\"type\">pagetable_t</span> pagetable, <span class=\"type\">int</span> depth)</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">512</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"type\">pte_t</span> pte = pagetable[i];</span><br><span class=\"line\">    <span class=\"comment\">// if PTE is valid</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(pte &amp; PTE_V) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"type\">int</span> t = <span class=\"number\">0</span>; t &lt; depth; t++)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot; ..&quot;</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d: pte %p pa %p\\n&quot;</span>, i, pte, PTE2PA(pte));</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// if this PTE points to a lower-level page table</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>((pte &amp; (PTE_R|PTE_W|PTE_X)) == <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">// start with new child PTE addr</span></span><br><span class=\"line\">        <span class=\"type\">pagetable_t</span> child = (<span class=\"type\">pagetable_t</span>)PTE2PA(pte);</span><br><span class=\"line\">        pgtblprint(child, depth + <span class=\"number\">1</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">vmprint</span><span class=\"params\">(<span class=\"type\">pagetable_t</span> pagetable)</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;page table %p\\n&quot;</span>, pagetable);</span><br><span class=\"line\">  pgtblprint(pagetable, <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-4查询内存页访问情况\"><a href=\"#3-4查询内存页访问情况\" class=\"headerlink\" title=\"3.4查询内存页访问情况\"></a>3.4查询内存页访问情况</h3><h4 id=\"要求和提示-2\"><a href=\"#要求和提示-2\" class=\"headerlink\" title=\"要求和提示\"></a>要求和提示</h4><p>一些垃圾回收器可以根据内存页被访问情况的信息来进行工作。</p>\n<p>在本部分中，我们将主要考虑为 xv6 实现一个新的功能，也就是检测用户空间的内存访问情况，并将信息返回给用户空间。我们需要通过检查 RISC-V 页表中的 <code>A</code> 标识位来实现，RISC-V 硬件每当尝试解决 TLB 未命中问题时，访问内存页的时候就会在页表中将对应 PTE 的标志位置为有效。</p>\n<p>我们的目标是实现一个叫做 <code>pgaccess</code> 的系统调用，以此来查看哪些内存页被访问过了。这个系统调用需要传入三个参数，第一个参数是开始的要查看的用户空间内存页地址，第二个参数是需要查看的内存页数量，最后传入的是一个用户地址空间，好让我们将结果写到用户地址空间，结果以 bitmask 的形式存储，每一位和各个内存页一一对应，第一个内存页对应最小的比特位。</p>\n<p>相关提示：</p>\n<ul>\n<li>考虑在 <code>kernel/sysproc.c</code> 下实现 <code>sys_pgaccess()</code> 系统调用主要功能。</li>\n<li>需要使用 <code>argaddr()</code> 和 <code>argint()</code> 来获取系统调用传入的参数，这一块可以详见上次的 <a href=\"https://blog.rayzhang.top/2022/07/05/mit-6.s081-lab-syscall/\">Lab syscall: System calls</a>。</li>\n<li>由于我们需要将结果返回给用户态的地址，因此有必要使用内核态中的临时缓冲区进行结果的处理，然后使用 <code>copyout()</code> 函数将结果复制到用户态，这段也可见 Lab Syscall 中相关内容。</li>\n<li>可以设置扫描的内存页数上限。</li>\n<li>在 <code>kernel/vm.c</code> 下的 <code>walk()</code> 函数会对找到正确的 PTE 很有帮助。</li>\n<li>需要在 <code>kernel/riscv.h</code> 中额外定义一下 <code>PTE_A</code>，也就是访问标记的比特位。（不敢相信他们居然原来没有加）</li>\n<li>确保在扫描内存页结束后将标志位 <code>PTE_A</code> 清零，不然下次扫描这个页的时候你看到标志位就乱了，不知道有没有被访问过了。</li>\n<li>在调试页表的时候可以使用 <code>vmprint()</code>，活学活用了属于是。</li>\n</ul>\n<p><img src=\"https://blog.rayzhang.top/2022/07/22/mit-6.s081-lab-pgtbl/pte.png\" alt=\"img\"></p>\n<p>数，第一个参数是开始的要查看的用户空间内存页地址，第二个参数是需要查看的内存页数量，最后传入的是一个用户地址空间，好让我们将结果写到用户地址空间，结果以 bitmask 的形式存储，</p>\n<p>参照这个图,我们自己来进行设置access</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>可以参照这个代码块</p>\n<ol>\n<li>首先arg获得参数</li>\n<li>然后是指读取条目数</li>\n<li>之后就是对地址来求pte,看pte之后来进行清楚</li>\n</ol>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">ifdef</span> LAB_PGTBL</span></span><br><span class=\"line\"><span class=\"type\">int</span></span><br><span class=\"line\"><span class=\"title function_\">sys_pgaccess</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  uint64 va;</span><br><span class=\"line\">  <span class=\"type\">int</span> page_nums;</span><br><span class=\"line\">  uint64 out_addr;</span><br><span class=\"line\">  <span class=\"comment\">// get syscall params</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(argaddr(<span class=\"number\">0</span>, &amp;va) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(argint(<span class=\"number\">1</span>, &amp;page_nums) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(argaddr(<span class=\"number\">2</span>, &amp;out_addr) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// check if the page numbers to scan is valid</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(page_nums &lt; <span class=\"number\">0</span> || page_nums &gt; <span class=\"number\">64</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  uint64 bitmask = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"type\">pte_t</span> *pte;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">proc</span> *<span class=\"title\">p</span> =</span> myproc();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; page_nums; i++) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// check if va is out of range</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(va &gt;= MAXVA) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// get pte addr by va</span></span><br><span class=\"line\">    pte = walk(p-&gt;pagetable, va, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!pte) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// check if accessed</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(*pte &amp; PTE_A) &#123;</span><br><span class=\"line\">      bitmask |= (<span class=\"number\">1</span> &lt;&lt; i);</span><br><span class=\"line\">      <span class=\"comment\">// clear the bit afterwards</span></span><br><span class=\"line\">      *pte ^= PTE_A;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// move va to next mem page</span></span><br><span class=\"line\">    va += PGSIZE;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// copy bitmask to user space</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(copyout(p-&gt;pagetable, out_addr, (<span class=\"type\">char</span> *)&amp;bitmask, <span class=\"keyword\">sizeof</span>(bitmask)) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-5总结\"><a href=\"#3-5总结\" class=\"headerlink\" title=\"3.5总结\"></a>3.5总结</h3><p>终于填完所有的坑了,重点就是包含xv6的启动过程,首先kvinit(lock),之后就是kvm.内核启动,包括空间分配还有内核启动时候页表的操作,着重的讲解是如何使用pte来得到物理地址,使用walk可以得到当前va的pte地址,通过指针可以得到值,然后使用maparg来进行映射</p>\n<ol>\n<li>页表简介</li>\n<li>内核态简介</li>\n<li>用户空间简介</li>\n</ol>\n<h2 id=\"4-lab-trap\"><a href=\"#4-lab-trap\" class=\"headerlink\" title=\"4.lab trap\"></a>4.lab trap</h2><h3 id=\"实验\"><a href=\"#实验\" class=\"headerlink\" title=\"实验\"></a>实验</h3><h3 id=\"4-1回答问题\"><a href=\"#4-1回答问题\" class=\"headerlink\" title=\"4.1回答问题\"></a>4.1回答问题</h3><p>Read the code in call.asm for the functions <code>g</code>, <code>f</code>, and <code>main</code>. The instruction manual for RISC-V is on the <a href=\"https://pdos.csail.mit.edu/6.S081/2020/reference.html\">reference page</a>. Here are some questions that you should answer (store the answers in a file answers-traps.txt):</p>\n<blockquote>\n<p>Which registers contain arguments to functions? For example, which register holds 13 in main’s call to <code>printf</code>?</p>\n</blockquote>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16816327874591681632783414.png\"></p>\n<p>a2</p>\n<blockquote>\n<p>Where is the call to function <code>f</code> in the assembly code for <code>main</code>? Where is the call to <code>g</code>? (Hint: the compiler may inline functions.)</p>\n</blockquote>\n<p>显的可以看到在 <code>0x26</code> 位置，程序直接将 <code>12</code> 写入了 <code>a1</code> 寄存器的位置（也就是第二参数 <code>f(8)+1</code> 的位置），在处理完所有的寄存器参数后直接就调用了 <code>printf</code>。那只有一种解释，就是编译器直接计算出了 <code>f(8)+1</code> 的结果是 <code>12</code>，主函数中并没直接调用这两个函数</p>\n<blockquote>\n<p> At what address is the function <code>printf</code> located?</p>\n</blockquote>\n<p>根据提示他在628，我们直接收地址628</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16816337731131681633772533.png\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16816338091161681633808486.png\"></p>\n<blockquote>\n<p>What value is in the register <code>ra</code> just after the <code>jalr</code> to <code>printf</code> in <code>main</code>?</p>\n</blockquote>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16816340951881681634095159.png\"></p>\n<p><img src=\"https://blog.rayzhang.top/2022/09/27/mit-6.s081-lab-traps/jalr.png\" alt=\"img\"></p>\n<p>34是pc地址，后面的是指令，手册的pc+4，就是34+4&#x3D;38是ra</p>\n<blockquote>\n<p>Run the following code.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unsigned int i = 0x00646c72;</span><br><span class=\"line\">printf(&quot;H%x Wo%s&quot;, 57616, &amp;i);</span><br><span class=\"line\">     </span><br></pre></td></tr></table></figure>\n\n<p>What is the output? <a href=\"http://web.cs.mun.ca/~michael/c/ascii-table.html\">Here’s an ASCII table</a> that maps bytes to characters.</p>\n<p>The output depends on that fact that the RISC-V is little-endian. If the RISC-V were instead big-endian what would you set to in order to yield the same output? Would you need to change to a different value?<code>i``57616</code></p>\n<p><a href=\"http://www.webopedia.com/TERM/b/big_endian.html\">Here’s a description of little- and big-endian</a> and <a href=\"http://www.networksorcery.com/enp/ien/ien137.txt\">a more whimsical description</a>.</p>\n</blockquote>\n<p>57616十六进制是e110</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16816344351111681634434489.png\"></p>\n<p>下一个是小段对齐（就是最开始第一位是末尾2个字节，最后的才是开始）</p>\n<p><img src=\"https://blog.rayzhang.top/2022/09/27/mit-6.s081-lab-traps/hello-world.jpeg\" alt=\"img\"></p>\n<blockquote>\n<p>In the following code, what is going to be printed after ? (note: the answer is not a specific value.) Why does this happen? <code>&#39;y=&#39;</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">printf(&quot;x=%d y=%d&quot;, 3);</span><br></pre></td></tr></table></figure>\n</blockquote>\n<p>a2寄存器没有值，随便产生</p>\n<h3 id=\"4-2函数调用栈打印\"><a href=\"#4-2函数调用栈打印\" class=\"headerlink\" title=\"4.2函数调用栈打印\"></a>4.2函数调用栈打印</h3><h4 id=\"要求和提示-3\"><a href=\"#要求和提示-3\" class=\"headerlink\" title=\"要求和提示\"></a>要求和提示</h4><p>我们在代码调试的过程中为了定位错误的位置，经常需要使用到函数的调用栈打印。当错误发生时，会打印出一系列之前的函数调用信息。</p>\n<p>在这里要求我们需要在 <code>kernel/printf.c</code> 下实现函数 <code>backtrace()</code>，并在 <code>sys_sleep</code> 中插入对此函数的一个调用。当我们在终端中调用 <code>bttest</code> 测试时，该命令会调起 <code>sleep</code> 系统调用，从而触发打印，运行 <code>bttest</code> 时打印结果示例为：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PLAINTEXT</span><br><span class=\"line\">backtrace:</span><br><span class=\"line\">0x0000000080002cda</span><br><span class=\"line\">0x0000000080002bb6</span><br><span class=\"line\">0x0000000080002898</span><br></pre></td></tr></table></figure>\n\n<p>在 <code>bttest</code> 退出了 QEMU 之后，在终端下，我们也可以使用 <code>addr2line</code> 命令来将指令地址转化为具体的代码位置，例如我们使用指令 <code>addr2line -e kernel/kernel</code>：</p>\n<p>我们的目标是从顶部开始遍历各个栈帧，并将<strong>各个栈帧中保存的返回地址</strong>打印出来。（讲道理感觉做个 <code>-4</code> 打印调用函数的地址可能会更直观一点，但是他说是就是吧）</p>\n<p>相关提示：</p>\n<ul>\n<li><p>需要在 <code>kernel/defs.h</code> 中添加 <code>backtrace</code> 的声明，使得我们可以在 <code>sys_sleep</code> 下调用 <code>backtrace</code>。</p>\n</li>\n<li><p>GCC 编译器将当前执行的函数的栈帧指针 frame pointer 存储在 <code>s0</code> 寄存器中，为此我们需要在 <code>kernel/riscv.h</code> 下加入代码：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C</span><br><span class=\"line\">static inline uint64</span><br><span class=\"line\">r_fp()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  uint64 x;</span><br><span class=\"line\">  asm volatile(&quot;mv %0, s0&quot; : &quot;=r&quot; (x) );</span><br><span class=\"line\">  return x;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>以方便我们在 <code>backtrace</code> 中调用来读取栈帧的底部地址。</p>\n<blockquote>\n<p>P.S. <code>sp</code> 和 <code>fp</code> 是典型的堆栈寄存器，用来标注当前栈帧的底部和顶部地址，由于我们在描述的时候对顶部和底部往往有自己的理解，因为栈地址是向下增长的，这里还是放一张图会比较好：</p>\n<p><a href=\"https://blog.rayzhang.top/2022/09/27/mit-6.s081-lab-traps/stack-registers.png\"><img src=\"https://blog.rayzhang.top/2022/09/27/mit-6.s081-lab-traps/stack-registers.png\" alt=\"img\"></a></p>\n</blockquote>\n</li>\n<li><p>由刚才贴出的图可见，注意到当前函数的返回地址和当前的 <code>fp</code> 存在一个 <code>-8</code> 的地址偏移量，上一个栈帧的 <code>fp</code> 保存位置和当前的 <code>fp</code> 存在一个 <code>-16</code> 的偏移量。</p>\n</li>\n<li><p>在 xv6 中，操作系统内核会为每个栈分配一个页面的空间，并地址对齐。因此我们可以使用 <code>PGROUNDDOWN(fp)</code> 和 <code>PGROUNDUP(fp)</code> 来寻找栈所在页面的顶部和底部地址，<code>PGROUNDDOWN</code> 和 <code>PGROUNDUP</code> 的定义可以看下 <code>kernel/riscv.h</code>：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> PGSIZE 4096 <span class=\"comment\">// bytes per page</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> PGSHIFT 12  <span class=\"comment\">// bits of offset within a page</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> PGROUNDUP(sz)  (((sz)+PGSIZE-1) &amp; ~(PGSIZE-1))</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> PGROUNDDOWN(a) (((a)) &amp; ~(PGSIZE-1))</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<blockquote>\n<p>函数调用栈的实现,我们可以通过这个图可以看到每一个栈的大小是不固定,因为参数可能不一样,但是返回地址,还有上一个节点的地址是ra,和上一个fp是固定的,都是当前的fp-8,还有fp-16,得到这两个的值</p>\n<ol>\n<li>因此我们只需要进行递归地道道当前fp,是不是最上面的地址(pgup(fp))(这是第一个fp),就代表结束</li>\n</ol>\n</blockquote>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">backtrace</span><span class=\"params\">(<span class=\"type\">void</span>)</span> &#123; </span><br><span class=\"line\">  <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;backtrace:\\n&quot;</span>);</span><br><span class=\"line\">  uint64 fp = r_fp();</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (fp != PGROUNDUP(fp)) &#123; <span class=\"comment\">// until get to stack bottom</span></span><br><span class=\"line\">      <span class=\"comment\">// get return addr in current stack frame</span></span><br><span class=\"line\">      uint64 ra = *(uint64 *)(fp - <span class=\"number\">8</span>);</span><br><span class=\"line\">      <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%p\\n&quot;</span>, ra);</span><br><span class=\"line\">      <span class=\"comment\">// go to prev stack frame</span></span><br><span class=\"line\">      fp = *(uint64 *)(fp - <span class=\"number\">16</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"4-3实现定时器\"><a href=\"#4-3实现定时器\" class=\"headerlink\" title=\"4.3实现定时器\"></a>4.3实现定时器</h3><h4 id=\"要求和提示-4\"><a href=\"#要求和提示-4\" class=\"headerlink\" title=\"要求和提示\"></a>要求和提示</h4><p>在本部分中，我们将为 xv6 添加一个新的功能，使得当一个进程使用 CPU 时间的时候周期性的发出警告。这种功能对于想要限制它们占用多少 CPU 时间的计算型进程，或者对于想要计算但又想采取一些定期行动的进程，可能是很有用的。更广泛地说，我们将实现一个原始形式的用户级中断 &#x2F; 故障处理程序；例如，我们可以使用类似的东西来处理应用程序中的页面故障。我们需要通过 <code>alarmtest</code> 来完成该部分。</p>\n<p>我们需要在 xv6 中添加一个新的系统调用 <code>sigalarm(interval, handler)</code>，例如当程序调用 <code>sigalarm(n, fn)</code> 的时候，那么接下来程序每消耗 <code>n</code> 个 ticks 的 CPU 时间后，内核应该调用 <code>fn</code>。当 <code>fn</code> 成功返回时，程序应当继续不受影响的运行，这部分由需要添加的系统调用 <code>sigreturn</code> 负责完成。如果应用程序调用 <code>sigalarm(0, 0)</code>，内核应该停止产生周期性的调用。</p>\n<blockquote>\n<p>P.S. 在 xv6 中，tick 是一个相当随意的时间单位，由硬件定时器产生中断的频率决定。</p>\n</blockquote>\n<p><code>alarmtest</code> 的相关代码在 <code>user/alarmtest.c</code> 中可见，为了使得其能够被正确识别，我们需要将其加入到 Makefile 中，如果对这块已经有点不记得的小伙伴可以看看 Lab Utils，可能可以记起来。</p>\n<p>由于 <code>alarmtest</code> 文件中使用了两个我们待实现的系统调用 <code>sigalarm</code> 和 <code>sigreturn</code>，务必将系统调用正确添加，记不得的小伙伴可以再去看看 Lab Syscall… 后面也会继续提</p>\n<p>在 <code>alarmtest</code> 中在 <code>test0</code> 调用了 <code>sigalarm(2, periodic)</code>，要求内核每隔 2 个 ticks 强制调用 <code>periodic()</code>，然后尝试自旋一段时间。我们可以在 <code>user/alarmtest.asm</code> 中看到 <code>alarmtest</code> 的汇编代码，这可能对调试很有帮助。</p>\n<p>正确运行 <code>alarmtest</code> 和 <code>usertests</code> 的示例结果如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PLAINTEXT</span><br><span class=\"line\"></span><br><span class=\"line\">$ alarmtest</span><br><span class=\"line\">test0 start</span><br><span class=\"line\">........alarm!</span><br><span class=\"line\">test0 passed</span><br><span class=\"line\">test1 start</span><br><span class=\"line\">...alarm!</span><br><span class=\"line\">..alarm!</span><br><span class=\"line\">...alarm!</span><br><span class=\"line\">..alarm!</span><br><span class=\"line\">...alarm!</span><br><span class=\"line\">..alarm!</span><br><span class=\"line\">...alarm!</span><br><span class=\"line\">..alarm!</span><br><span class=\"line\">...alarm!</span><br><span class=\"line\">..alarm!</span><br><span class=\"line\">test1 passed</span><br><span class=\"line\">test2 start</span><br><span class=\"line\">................alarm!</span><br><span class=\"line\">test2 passed</span><br><span class=\"line\">$ usertests</span><br><span class=\"line\">...</span><br><span class=\"line\">ALL TESTS PASSED</span><br><span class=\"line\">$</span><br></pre></td></tr></table></figure>\n\n<p>这块内容分为两部分完成，我们首先实现 <code>test0</code>，再实现 <code>test1</code> 和 <code>test2</code>。</p>\n<p>对于 <code>test0</code> 而言，其功能是测试 handler 函数是否被正确执行了，首先我们需要修改内核代码使得内核可以跳转到用户空间中的 <code>periodic</code> 函数，从而打印出 <code>&quot;alarm!&quot;</code>。我们在这里暂时不考虑打印之后怎么处理，如果你在打印出 <code>&quot;alarm!&quot;</code> 程序直接 crash 也是完全正常的。以下是关于 <code>test0</code> 的相关提示：</p>\n<ul>\n<li><p>请将 <code>alarmtest.c</code> 加入 Makefile 中，使得其能够被正常编译。</p>\n</li>\n<li><p>两个系统调用需要在 <code>user/user.h</code> 中声明：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C</span><br><span class=\"line\">int sigalarm(int ticks, void (*handler)());</span><br><span class=\"line\">int sigreturn(void);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>你需要更新 <code>user/usys.pl</code>，<code>kernel/syscall.h</code> 和 <code>kernel/syscall.c</code> 来使得 <code>alarmtest</code> 可以正确的触发 <code>sigslarm</code> 和 <code>sigreturn</code> 系统调用。这块不记得的可以看看 Lab Syscall。</p>\n</li>\n<li><p><code>test0</code> 中对 <code>sys_sigreturn</code> 暂时没有要求，可以返回 <code>0</code> 完事。</p>\n</li>\n<li><p>你的 <code>sys_sigalarm()</code> 需要在 <code>kernel/proc.h</code> 下的 <code>proc</code> 结构体中开辟新的空间额外存储间隔时间和 handler 函数的指针。</p>\n</li>\n<li><p>你需要跟踪从最后一次调用直到下一次调用，过去了（或者说还剩下）多少时间，因此我们也需要在 <code>proc</code> 结构体中开辟额外的空间来实现。初始化 <code>proc</code> 结构体参数的方法详见 <code>kernel/proc.c</code> 下的 <code>allocproc()</code>。</p>\n</li>\n<li><p>每一次 tick 周期，硬件始终都会强制中断，这块的逻辑代码由 <code>kernel/trap.c</code> 下的 <code>usertrap()</code> 实现。</p>\n</li>\n<li><p>在 <code>usertrap()</code> 下，如果我们要控制硬件定时器中断发生时的行为，例如修改 <code>proc</code> 中存储的时间参数，我们只需要关注如下代码下的改动：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C</span><br><span class=\"line\">if(which_dev == 2)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>请当进程有一个未完成的定时器时才可调用 handler 函数。注意到 handler 函数的地址可能是 <code>0</code>，例如在 <code>user/alarmtest.asm</code> 中，<code>periodic</code> 位于地址 <code>0</code>。</p>\n</li>\n<li><p>请修改 <code>usertrap()</code> 使得当进程的定时间隔过期时，用户进程可以执行 handler 函数。另外请思考，当在 RISC-V 上的陷阱返回到用户空间时，是什么决定了接下来用户空间代码开始执行的位置？</p>\n</li>\n<li><p>为了方便使用 GDB 观察陷阱的运行，我们可以让 QEMU 只使用一个 CPU，例如运行如下代码：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BASH</span><br><span class=\"line\">make CPUS=1 qemu-gdb</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在本阶段中，只要 <code>alarmtest</code> 成功打印出 <code>&quot;alarm!.&quot;</code> 即为成功</p>\n</li>\n</ul>\n<p>对于 <code>test1</code> 和 <code>test2</code> 而言，其功能主要是测试被中断的代码接下来是否能够继续运行。为了确保程序接下来能够继续正确的运行，我们需要在 handler 函数执行完毕时，返回至被定时器中断的代码位置，同时保证寄存器内容被正确的存储并恢复了。最后我们需要在每次计时结束后重置计时器的计数器，使得 handler 函数能不断的被周期调用。</p>\n<p>我们假定如下的设计：用户空间的 handler 函数在结束时需要调用 <code>sigreturn</code> 系统调用，参考 <code>user/alarmtest.c</code> 的 <code>periodic</code> 函数。这意味着我们需要在 <code>usertrap</code> 和 <code>sys_sigreturn</code> 中进行修改，使得用户空间进程可以正确的继续执行下去。如下为关于 <code>test1</code> 和 <code>test2</code> 的相关提示：</p>\n<ul>\n<li>为了保证被中断程序的正确运行，你需要保存和恢复寄存器。请思考一下，哪些寄存器需要你进行存储和恢复呢？</li>\n<li>在 <code>usertrap</code> 中需要向 <code>proc</code> 结构体中保存一些状态信息，以方便 <code>sigreturn</code> 正确返回到原先的代码位置。</li>\n<li>禁止可重入的调用 handler 函数，在 handler 函数没有返回之前，内核不应当再次调起。关于这块的测试将在 <code>test2</code> 中有所体现。</li>\n</ul>\n<h4 id=\"题解\"><a href=\"#题解\" class=\"headerlink\" title=\"题解\"></a>题解</h4><p><img src=\"https://blog.rayzhang.top/2022/09/27/mit-6.s081-lab-traps/alarm.png\" alt=\"img\"></p>\n<p>陷入流程:</p>\n<ol>\n<li>首先是调用systemcall,我们首先设置handler,还有时间</li>\n<li>之后就是始终的定时中断</li>\n<li>我们首先可以在dev&#x3D;2这个地方捕捉到中断信号,我们需要把当前运行pc设置成handler来进行处理,如果当时间满了的情况下</li>\n<li>之后,这个中断结束,但是可能会被其他程序抢走,所以这个程序的trapframe也需要保存下来</li>\n</ol>\n<p>让我们梳理一下题意</p>\n<ol>\n<li>首先完成用户态到内核态陷入,之前的已经写过,跳过</li>\n<li>需要我们在proc的结构体里面添加处理函数handler</li>\n<li>距离下一次调用的时间也需要进行设置</li>\n<li>然后userttrap下面的dev就是定时中断锁需要进行的操作</li>\n<li>现在我们来回顾一下陷入流程</li>\n</ol>\n<hr>\n<p><strong>完成sys_sigalarm</strong></p>\n<p>添加下列参数到proc里面</p>\n<p> p-&gt;alarm_interval &#x3D; ticks;<br>  p-&gt;alarm_handler &#x3D; handler;<br>  p-&gt;alarm_ticks_left &#x3D; ticks;</p>\n<p>主要就是获取参数,然后设置到proc里面</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uint64 sys_sigalarm(void) &#123; </span><br><span class=\"line\">  int n;</span><br><span class=\"line\">  uint64 fn;</span><br><span class=\"line\">  if(argint(0, &amp;n) &lt; 0) &#123;</span><br><span class=\"line\">      return -1;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  if(argaddr(1, &amp;fn) &lt; 0) &#123;</span><br><span class=\"line\">      return -1;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  return sigalarm(n, (void(*)())(fn));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">int sigalarm(int ticks, void (*handler)()) &#123; </span><br><span class=\"line\">  struct proc *p = myproc();</span><br><span class=\"line\">  p-&gt;alarm_interval = ticks;</span><br><span class=\"line\">  p-&gt;alarm_handler = handler;</span><br><span class=\"line\">  p-&gt;alarm_ticks_left = ticks;</span><br><span class=\"line\">  return 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>完成trap陷入操作</strong></p>\n<p>每一次中断,我们都会让时间减少,而且还要看是不是已经运行了</p>\n<p>所以需要lock参数,我们需要备份trapframe,按照之前的样子,所以还需要</p>\n<p>backtrap,还有lock</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// give up the CPU if this is a timer interrupt.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(which_dev == <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(p-&gt;alarm_interval) &#123; <span class=\"comment\">// if alarm is enalbled</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>(--p-&gt;alarm_ticks_left &lt;= <span class=\"number\">0</span>) &#123; <span class=\"comment\">// if ticks expired, trigger the handler func</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!p-&gt;alarm_handler_lock) &#123; <span class=\"comment\">// if the handler func is not running</span></span><br><span class=\"line\">          <span class=\"comment\">// save the current trapframe</span></span><br><span class=\"line\">          *p-&gt;alarm_backup = *p-&gt;trapframe;</span><br><span class=\"line\">          <span class=\"comment\">// modify return address</span></span><br><span class=\"line\">          p-&gt;trapframe-&gt;epc = (uint64)p-&gt;alarm_handler;</span><br><span class=\"line\">          <span class=\"comment\">// set reentrant lock</span></span><br><span class=\"line\">          p-&gt;alarm_handler_lock = <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    yield();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">    </span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<hr>\n<p><strong>恢复操作</strong></p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">sigreturn</span><span class=\"params\">()</span> &#123; </span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">proc</span> *<span class=\"title\">p</span> =</span> myproc();</span><br><span class=\"line\">  <span class=\"comment\">// restore trapframe</span></span><br><span class=\"line\">  *p-&gt;trapframe = *p-&gt;alarm_backup;</span><br><span class=\"line\">  <span class=\"comment\">// release reentrant lock</span></span><br><span class=\"line\">  p-&gt;alarm_handler_lock = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h3 id=\"4-4总结\"><a href=\"#4-4总结\" class=\"headerlink\" title=\"4.4总结\"></a>4.4总结</h3><p><img src=\"https://906337931-files.gitbook.io/~/files/v0/b/gitbook-legacy-files/o/assets%2F-MHZoT2b_bcLghjAOPsJ%2F-MKFsfImgYCtnwA1d2hO%2F-MKHxleUqYy-y0mrS48w%2Fimage.png?alt=media&token=ab7c66bc-cf61-4af4-90fd-1fefc96c7b5f\" alt=\"img\"></p>\n<p>总体流程</p>\n<ol>\n<li>首先调用ecall</li>\n<li>之后是uservec(内核执行的第一个程序,trampoline是一部分,保存页表)</li>\n<li>然后才是转到c语言的usertrap,开始查看是什么类型的原因到内核态(trap,interupt还是page fault)</li>\n<li>陷入之后是system call,调用实际的底层函数</li>\n</ol>\n<p>ecall作用详解:</p>\n<ol>\n<li><p>第一，ecall将代码从user mode改到supervisor mode。</p>\n</li>\n<li><p>第二，ecall将程序计数器的值保存在了SEPC寄存器。我们可以通过打印程序计数器看到这里的效果，</p>\n</li>\n<li><p>ecall跳转到stvec</p>\n</li>\n</ol>\n<p>在trampoline page详解:</p>\n<ol>\n<li>修改vec的代码</li>\n<li>保存寄存器等其他信息trapframe</li>\n</ol>\n<p>主要就是保存你用户的页表</p>\n<p>usertrap详解:</p>\n<p>找到是什么类型,来进行对应出路i</p>\n<p><img src=\"https://906337931-files.gitbook.io/~/files/v0/b/gitbook-legacy-files/o/assets%2F-MHZoT2b_bcLghjAOPsJ%2F-MLhY-FzqA_AFTTcuD6U%2F-MLjZNai3dy2h5fFhLXf%2Fimage.png?alt=media&token=f1e670c2-97f6-471a-a0f1-76dace363806\" alt=\"img\"></p>\n<p>sertrap函数的最后调用了usertrapret函数，来设置好我之前说过的，在返回到用户空间之前内核要做的工作</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span></span><br><span class=\"line\"><span class=\"title function_\">usertrapret</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">proc</span> *<span class=\"title\">p</span> =</span> myproc();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// we&#x27;re about to switch the destination of traps from</span></span><br><span class=\"line\">  <span class=\"comment\">// kerneltrap() to usertrap(), so turn off interrupts until</span></span><br><span class=\"line\">  <span class=\"comment\">// we&#x27;re back in user space, where usertrap() is correct.</span></span><br><span class=\"line\">  intr_off();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// send syscalls, interrupts, and exceptions to trampoline.S</span></span><br><span class=\"line\">  w_stvec(TRAMPOLINE + (uservec - trampoline));</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// set up trapframe values that uservec will need when</span></span><br><span class=\"line\">  <span class=\"comment\">// the process next re-enters the kernel.</span></span><br><span class=\"line\">  p-&gt;trapframe-&gt;kernel_satp = r_satp();         <span class=\"comment\">// kernel page table</span></span><br><span class=\"line\">  p-&gt;trapframe-&gt;kernel_sp = p-&gt;kstack + PGSIZE; <span class=\"comment\">// process&#x27;s kernel stack</span></span><br><span class=\"line\">  p-&gt;trapframe-&gt;kernel_trap = (uint64)usertrap;</span><br><span class=\"line\">  p-&gt;trapframe-&gt;kernel_hartid = r_tp();         <span class=\"comment\">// hartid for cpuid()</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// set up the registers that trampoline.S&#x27;s sret will use</span></span><br><span class=\"line\">  <span class=\"comment\">// to get to user space.</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// set S Previous Privilege mode to User.</span></span><br><span class=\"line\">  <span class=\"type\">unsigned</span> <span class=\"type\">long</span> x = r_sstatus();</span><br><span class=\"line\">  x &amp;= ~SSTATUS_SPP; <span class=\"comment\">// clear SPP to 0 for user mode</span></span><br><span class=\"line\">  x |= SSTATUS_SPIE; <span class=\"comment\">// enable interrupts in user mode</span></span><br><span class=\"line\">  w_sstatus(x);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// set S Exception Program Counter to the saved user pc.</span></span><br><span class=\"line\">  w_sepc(p-&gt;trapframe-&gt;epc);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// tell trampoline.S the user page table to switch to.</span></span><br><span class=\"line\">  uint64 satp = MAKE_SATP(p-&gt;pagetable);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// jump to trampoline.S at the top of memory, which </span></span><br><span class=\"line\">  <span class=\"comment\">// switches to the user page table, restores user registers,</span></span><br><span class=\"line\">  <span class=\"comment\">// and switches to user mode with sret.</span></span><br><span class=\"line\">  uint64 fn = TRAMPOLINE + (userret - trampoline);</span><br><span class=\"line\">  ((<span class=\"type\">void</span> (*)(uint64,uint64))fn)(TRAPFRAME, satp);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>保存相关的内核信息到trapframe,然后再次进入到trampoline,进行恢复用户的页表</p>\n<p><img src=\"https://906337931-files.gitbook.io/~/files/v0/b/gitbook-legacy-files/o/assets%2F-MHZoT2b_bcLghjAOPsJ%2F-MLhY-FzqA_AFTTcuD6U%2F-MLjbaxkbJ9sBUszhiaX%2Fimage.png?alt=media&token=fefe6012-0e8b-4f4d-b044-c25b62d5f0fd\" alt=\"img\"></p>\n<p>接下来的几行填入了trapframe的内容，这些内容对于执行trampoline代码非常有用。这里的代码就是：</p>\n<p>- </p>\n<p>  存储了kernel page table的指针</p>\n<p>- </p>\n<p>  存储了当前用户进程的kernel stack</p>\n<p>- </p>\n<p>  存储了usertrap函数的指针，这样trampoline代码才能跳转到这个函数（注，详见6.5中 <em>ld t0 (16)a0</em> 指令）</p>\n<p>- </p>\n<p>  从tp寄存器中读取当前的CPU核编号，并存储在trapframe中，这样trampoline代码才能恢复这个数字，因为用户代码可能会修改这个数字</p>\n<p>实际上，我们会在汇编代码trampoline中完成page table的切换，并且也只能在trampoline中完成切换，因为只有trampoline中代码是同时在用户和内核空间中映射</p>\n<p><img src=\"https://img2023.cnblogs.com/blog/1942408/202303/1942408-20230301194532035-432919191.png\" alt=\"img\"></p>\n<h2 id=\"5-cow\"><a href=\"#5-cow\" class=\"headerlink\" title=\"5.cow\"></a>5.cow</h2><p>写时候分配,大致意识fork的时候,不进行分配,使用与父亲的一起共享的内存,当这篇内存要写入的时候,出发page fault,在进行分配,分配主要包括,给内存释放权限,还有重新进行开辟一个新空间</p>\n<p><img src=\"https://blog.rayzhang.top/2022/10/01/mit-6.s081-lab-cow/cow.png\" alt=\"img\"></p>\n<h3 id=\"5-1实现-COW-下的-fork\"><a href=\"#5-1实现-COW-下的-fork\" class=\"headerlink\" title=\"5.1实现 COW 下的 fork\"></a>5.1实现 COW 下的 <code>fork</code></h3><h4 id=\"要求和提示-5\"><a href=\"#要求和提示-5\" class=\"headerlink\" title=\"要求和提示\"></a>要求和提示</h4><p>在本部分中，我们的任务是在 xv6 操作系统中实现一个写时复制的 <code>fork</code>。完成的代码需要通过 <code>cowtest</code> 和 <code>usertests</code> 测试。<code>cowtest</code> 中的相关测试样例详见 <code>user/cowtest.c</code>。</p>\n<p>例如，如果我们对 xv6 操作系统一开始什么都没做修改，就直接执行 <code>cowtest</code>，我们会得到如下结果：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PLAINTEXT</span><br><span class=\"line\">$ cowtest</span><br><span class=\"line\">simple: fork() failed</span><br><span class=\"line\">$ </span><br></pre></td></tr></table></figure>\n\n<p>这是因为在 <code>simple</code> 测试样例中，它分配了超过一半的可用物理内存空间，随后调用 <code>fork</code>。在没有实现 COW 的 xv6 下，操作系统会采取 eager 策略，立即为子进程创建对应用户空间并着手复制，这会直接导致物理内存空间的耗尽。</p>\n<p>为了实现 COW 我们要在以下几处完成修改：</p>\n<ul>\n<li>修改 <code>kernel/vm.c</code> 下的 <code>uvmcopy()</code> 函数，我们需要共享父进程和子进程的用户空间，而非重新分配新的内存。此外，我们还需要将子进程和父进程的 PTE 置为只读，以触发缺页中断 page fault。</li>\n<li>修改 <code>kernel/trap.c</code> 下的 <code>usertrap()</code> 函数，使得内核可以正确的判断出发生了缺页中断 page fault。一旦内核识别出在一个 COW 内存页上发生了缺页中断，就需要使用 <code>kalloc()</code> 开辟新的内存页，并将原内存页的数据拷贝到新的内存页上，并设置新的映射关系，将 PTE 下的可读 <code>PTE_W</code> 置位。</li>\n<li>我们需要确保当该物理页面最后的 PTE 引用 ref count 清零了才可将其进行释放。当 <code>kernel/kalloc.c</code> 下的 <code>kalloc()</code> 分配该内存页时我们就将其 ref count 设置为 <code>1</code>，每当有 <code>fork</code> 操作使得子进程共享该内存页时我们就将 ref count 加一，同理每当一个进程将对应映射关系从其页表中删除时，我们就要将 ref count 减一。只有当 ref count 清零的时候我们才可以将当前内存页使用 <code>kernel/kalloc.c</code> 下的 <code>kfree()</code> 放置在空闲列表中。我们可以把这些计数的 ref count 放在一个固定大小的整数数组中，例如我们可以使用页面的物理地址除以 <code>4096</code> 来索引数组，然后给数组一个等同于 <code>kalloc.c</code> 中 <code>kinit()</code> 放置在空闲列表中页面的最高物理地址的元素数。</li>\n<li>不要忘记修改 <code>kernel/vm.c</code> 下的 <code>copyout()</code>，来适应 COW 的内存页，因为可能有用户空间下的内存页暂未被分配，原先的 <code>copyout</code> 也会触发 page fault。</li>\n</ul>\n<p>相关提示：</p>\n<ul>\n<li><p>我们很有可能需要标记当前的 PTE 为 COW 内存页映射，因此我们可以使用 RSW（reserved for software）标识位来实现：</p>\n<p><a href=\"https://blog.rayzhang.top/2022/10/01/mit-6.s081-lab-cow/rsw-bits.png\"><img src=\"https://blog.rayzhang.top/2022/10/01/mit-6.s081-lab-cow/rsw-bits.png\" alt=\"img\"></a></p>\n</li>\n<li><p>一些有用的宏和定义可以方便处理 PTE 的相关标识位，这些代码在 <code>kernel/riscv.h</code> 的最后可以找到。</p>\n</li>\n<li><p>如果 COW 下的缺页中断产生了，但是也没有足够的物理内存空间，那么进程应当被杀死。</p>\n</li>\n</ul>\n<h4 id=\"题解-1\"><a href=\"#题解-1\" class=\"headerlink\" title=\"题解\"></a>题解</h4><p>提示已经给了很多信息,我们把提示在进行翻译一遍</p>\n<p>这个rsw标记需要我们自己手动来做</p>\n<p><img src=\"https://blog.rayzhang.top/2022/10/01/mit-6.s081-lab-cow/rsw-bits.png\" alt=\"img\"></p>\n<ol>\n<li>首先修改uvmcopy,不是分配,二十把这个新地址还是映射到同一个物理地址,之前的map函数,同时设置不能写,符号</li>\n<li>然后修改trap,因为会出发page_fault,这样我们需要解开原来的映射,然后进行kalloc分配,新的还要加入写入权限**(注意,解开原来映射的时候,会消灭原始内存,因此需要引用计数)**</li>\n<li>之后就是应用计数的相关设置</li>\n<li>然后设置copy的配置</li>\n</ol>\n<blockquote>\n<p>们可以把这些计数的 ref count 放在一个固定大小的整数数组中，例如我们可以使用页面的物理地址除以 <code>4096</code> 来索引数组，然后给数组一个等同于 <code>kalloc.c</code> 中 <code>kinit()</code> 放置在空闲列表中页面的最高物理地址的元素数。</p>\n</blockquote>\n<p>设置页面数组,来统计每一个页面使用的次数,当然还是要进行枷锁</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> &#123;</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">spinlock</span> <span class=\"title\">lock</span>;</span></span><br><span class=\"line\">  <span class=\"type\">int</span> refcount_arr[(PHYSTOP - KERNBASE) / PGSIZE];</span><br><span class=\"line\">&#125; refcount;</span><br></pre></td></tr></table></figure>\n\n<p>刚开始就是初始化,维1此使用,之后就是设置++</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">refcount_add</span><span class=\"params\">(uint64 va, <span class=\"type\">int</span> add)</span> &#123; </span><br><span class=\"line\">  <span class=\"type\">int</span> index = (va - KERNBASE) / PGSIZE;</span><br><span class=\"line\">  acquire(&amp;refcount.lock);</span><br><span class=\"line\">  <span class=\"type\">int</span> res = refcount.refcount_arr[index];</span><br><span class=\"line\">  res += add;</span><br><span class=\"line\">  refcount.refcount_arr[index] = res;</span><br><span class=\"line\">  release(&amp;refcount.lock);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">refcount_set</span><span class=\"params\">(uint64 va, <span class=\"type\">int</span> ref)</span> &#123; </span><br><span class=\"line\">  <span class=\"type\">int</span> index = (va - KERNBASE) / PGSIZE; </span><br><span class=\"line\">  acquire(&amp;refcount.lock);</span><br><span class=\"line\">  refcount.refcount_arr[index] = ref;</span><br><span class=\"line\">  release(&amp;refcount.lock);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>之后就是freerange来开始设置</p>\n<p>,因为他调用了kfree</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int refcount_add(uint64 va, int add) &#123; </span><br><span class=\"line\">  int index = (va - KERNBASE) / PGSIZE;</span><br><span class=\"line\">  acquire(&amp;refcount.lock);</span><br><span class=\"line\">  int res = refcount.refcount_arr[index];</span><br><span class=\"line\">  res += add;</span><br><span class=\"line\">  refcount.refcount_arr[index] = res;</span><br><span class=\"line\">  release(&amp;refcount.lock);</span><br><span class=\"line\">  return res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void refcount_set(uint64 va, int ref) &#123; </span><br><span class=\"line\">  int index = (va - KERNBASE) / PGSIZE; </span><br><span class=\"line\">  acquire(&amp;refcount.lock);</span><br><span class=\"line\">  refcount.refcount_arr[index] = ref;</span><br><span class=\"line\">  release(&amp;refcount.lock);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>首先是设置uvmcopy</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#define PTE_V (1L &lt;&lt; 0) // valid</span><br><span class=\"line\">#define PTE_R (1L &lt;&lt; 1)</span><br><span class=\"line\">#define PTE_W (1L &lt;&lt; 2)</span><br><span class=\"line\">#define PTE_X (1L &lt;&lt; 3)</span><br><span class=\"line\">#define PTE_U (1L &lt;&lt; 4) // 1 -&gt; user can access</span><br><span class=\"line\">#define PTE_COW (1L &lt;&lt; 8) // 1 -&gt; set as cow page</span><br></pre></td></tr></table></figure>\n\n<p>设置维rsw,并且只能读取,还有进行映射地址,还有应用加一</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span></span><br><span class=\"line\"><span class=\"title function_\">uvmcopy</span><span class=\"params\">(<span class=\"type\">pagetable_t</span> old, <span class=\"type\">pagetable_t</span> new, uint64 sz)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"type\">pte_t</span> *pte;</span><br><span class=\"line\">  uint64 pa, i;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span>(i = <span class=\"number\">0</span>; i &lt; sz; i += PGSIZE)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>((pte = walk(old, i, <span class=\"number\">0</span>)) == <span class=\"number\">0</span>)</span><br><span class=\"line\">      panic(<span class=\"string\">&quot;uvmcopy: pte should exist&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>((*pte &amp; PTE_V) == <span class=\"number\">0</span>)</span><br><span class=\"line\">      panic(<span class=\"string\">&quot;uvmcopy: page not present&quot;</span>);</span><br><span class=\"line\">    pa = PTE2PA(*pte);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (*pte &amp; PTE_W) &#123; <span class=\"comment\">// if the page is writable</span></span><br><span class=\"line\">        *pte ^= PTE_W; <span class=\"comment\">// disable write flag</span></span><br><span class=\"line\">        *pte |= PTE_COW; <span class=\"comment\">//setup COW flag</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// map pagetable to same physical addr in the new processs</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(mappages(new, i, PGSIZE, (uint64)pa, PTE_FLAGS(*pte)) != <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">      uvmunmap(new, <span class=\"number\">0</span>, i / PGSIZE, <span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// increace ref for page share</span></span><br><span class=\"line\">    refcount_add(pa, <span class=\"number\">1</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们在这里对这个物理页面进行加1此使用</p>\n<p><img src=\"https://blog.rayzhang.top/2022/10/01/mit-6.s081-lab-cow/scause.png\" alt=\"img\"></p>\n<p>通过这个我们知道13还有15是page fault原因,我们新建一个copycow来进行解决</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">else if (r_scause() == 15) &#123;</span><br><span class=\"line\">    uint64 va = r_stval();</span><br><span class=\"line\">    if(copycow(p-&gt;pagetable, va) &lt; 0) &#123;</span><br><span class=\"line\">      p-&gt;killed = 1;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>copycow,才是真实的</p>\n<p>分配代码</p>\n<ol>\n<li>检查pte的标识</li>\n<li>接触原始映射</li>\n<li>然后kalloc</li>\n<li>copy内容</li>\n<li>之后在世新的映射,和之前原来的uvmcopy差不多</li>\n</ol>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Copy cow page,</span></span><br><span class=\"line\"><span class=\"comment\">// Return 0 on success, -1 on failure, -2 on invalid va</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">copycow</span><span class=\"params\">(<span class=\"type\">pagetable_t</span> pagetable, uint64 va)</span> &#123; </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (va &gt;= MAXVA) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;va cannot be greater than MAXVA: %p\\n&quot;</span>, va);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-2</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  uint64 mem;</span><br><span class=\"line\">  va = PGROUNDDOWN(va);</span><br><span class=\"line\">  <span class=\"type\">pte_t</span> *pte = walk(pagetable, va, <span class=\"number\">0</span>);</span><br><span class=\"line\">  uint64 pa = PTE2PA(*pte);</span><br><span class=\"line\">  uint flags = PTE_FLAGS(*pte);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!(*pte &amp; PTE_COW))&#123; <span class=\"comment\">// check if page is COW page</span></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Not a COW page. Invalid va: %p\\n&quot;</span>, va);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-2</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!(mem = (uint64)kalloc()))&#123; <span class=\"comment\">// kalloc new page</span></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Failed to allocate physical page.\\n&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  memmove((<span class=\"type\">void</span> *)mem, (<span class=\"type\">void</span> *)pa, PGSIZE); <span class=\"comment\">//copy to new page</span></span><br><span class=\"line\">  flags ^= PTE_COW | PTE_W; <span class=\"comment\">// setup write flag, disable COW flag</span></span><br><span class=\"line\">  uvmunmap(pagetable, va, <span class=\"number\">1</span>, <span class=\"number\">1</span>); <span class=\"comment\">// cancel original pagetable map which caused page fault</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (mappages(pagetable, va, PGSIZE, mem, flags) != <span class=\"number\">0</span>) &#123; <span class=\"comment\">// remap va to new page</span></span><br><span class=\"line\">    kfree((<span class=\"type\">void</span>*)mem);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>调用了kalloc,还有kfree,会对这个页面进行初始化维1,然后减少一次,知道这个页面还有用,才不会清楚</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>(refcount_add((uint64)pa,<span class=\"number\">-1</span>,<span class=\"number\">0</span>)&gt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 还有引用直接推出</span></span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Allocate one 4096-byte page of physical memory.</span></span><br><span class=\"line\"><span class=\"comment\">// Returns a pointer that the kernel can use.</span></span><br><span class=\"line\"><span class=\"comment\">// Returns 0 if the memory cannot be allocated.</span></span><br><span class=\"line\"><span class=\"type\">void</span> *</span><br><span class=\"line\"><span class=\"title function_\">kalloc</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">run</span> *<span class=\"title\">r</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  acquire(&amp;kmem.lock);</span><br><span class=\"line\">  r = kmem.freelist;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(r)</span><br><span class=\"line\">    kmem.freelist = r-&gt;next;</span><br><span class=\"line\">  release(&amp;kmem.lock);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(r)</span><br><span class=\"line\">    <span class=\"built_in\">memset</span>((<span class=\"type\">char</span>*)r, <span class=\"number\">5</span>, PGSIZE); <span class=\"comment\">// fill with junk</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (r) </span><br><span class=\"line\">    refcount_set((uint64)r, <span class=\"number\">1</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"keyword\">return</span> (<span class=\"type\">void</span>*)r;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// Free the page of physical memory pointed at by v,</span><br><span class=\"line\">// which normally should have been returned by a</span><br><span class=\"line\">// call to kalloc().  (The exception is when</span><br><span class=\"line\">// initializing the allocator; see kinit above.)</span><br><span class=\"line\">void</span><br><span class=\"line\">kfree(void *pa)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  struct run *r;</span><br><span class=\"line\"></span><br><span class=\"line\">  if(((uint64)pa % PGSIZE) != 0 || (char*)pa &lt; end || (uint64)pa &gt;= PHYSTOP)</span><br><span class=\"line\">    panic(&quot;kfree&quot;);</span><br><span class=\"line\">  </span><br><span class=\"line\">  if (refcount_add((uint64)pa, -1) &gt; 0) &#123;</span><br><span class=\"line\">    return;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  // Fill with junk to catch dangling refs.</span><br><span class=\"line\">  memset(pa, 1, PGSIZE);</span><br><span class=\"line\"></span><br><span class=\"line\">  r = (struct run*)pa;</span><br><span class=\"line\"></span><br><span class=\"line\">  acquire(&amp;kmem.lock);</span><br><span class=\"line\">  r-&gt;next = kmem.freelist;</span><br><span class=\"line\">  kmem.freelist = r;</span><br><span class=\"line\">  release(&amp;kmem.lock);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>修改 <code>copyout</code> 函数</strong></p>\n<p>这点也在刚才的提示中贴心的点出<strong>来了，由于我们的 COW 页面是只读状态，那么在 <code>kernel/vm.c</code> 下的 <code>copyout</code> 函数需要进行修改。因为这个函数负责的是将一些数据从内核态复制到用户态，按照原先 xv6 的设置，<code>copyout</code> 是不可能预见到内存空间中的内存页只读的。</strong></p>\n<p>修改的办法也说不上很难，在我们通过 walk 页表取得 PTE 后先不着急转化成物理地址，而是先看一下这个 PTE 的 COW 标识位，如果有标识位那直接使用刚才的 <code>copycow</code> 函数，一通操作，复制到新页面修改，映射到新的物理地址映射，再继续接下来的操作：</p>\n<ol>\n<li>首先得到pte</li>\n<li>看pte有没有rsw,悠久调用cow来进行分配</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pte_t *pte = walk(pagetable, va0, 0);</span><br><span class=\"line\">    if(!pte) &#123;</span><br><span class=\"line\">      printf(&quot;Failed to get pa from pgtbl. va: %p\\n&quot;, va0);</span><br><span class=\"line\">      return -1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if(*pte &amp; PTE_cow)&#123;</span><br><span class=\"line\">      if(copycow(pagetable, va0) &lt; 0)&#123;</span><br><span class=\"line\">        return -1;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Copy from kernel to user.</span></span><br><span class=\"line\"><span class=\"comment\">// Copy len bytes from src to virtual address dstva in a given page table.</span></span><br><span class=\"line\"><span class=\"comment\">// Return 0 on success, -1 on error.</span></span><br><span class=\"line\"><span class=\"type\">int</span></span><br><span class=\"line\"><span class=\"title function_\">copyout</span><span class=\"params\">(<span class=\"type\">pagetable_t</span> pagetable, uint64 dstva, <span class=\"type\">char</span> *src, uint64 len)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  uint64 n, va0, pa0;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">while</span>(len &gt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(dstva &gt;= MAXVA)&#123;</span><br><span class=\"line\">      <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;dstva cannot be greater than MAXVA: %p\\n&quot;</span>, dstva);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    va0 = PGROUNDDOWN(dstva);</span><br><span class=\"line\">    <span class=\"type\">pte_t</span> *pte = walk(pagetable, va0, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!pte) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Failed to get pa from pgtbl. va: %p\\n&quot;</span>, va0);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(*pte &amp; PTE_COW)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(copycow(pagetable, va0) &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    pa0 = walkaddr(pagetable, va0);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(pa0 == <span class=\"number\">0</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    n = PGSIZE - (dstva - va0);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(n &gt; len)</span><br><span class=\"line\">      n = len;</span><br><span class=\"line\">    memmove((<span class=\"type\">void</span> *)(pa0 + (dstva - va0)), src, n);</span><br><span class=\"line\"></span><br><span class=\"line\">    len -= n;</span><br><span class=\"line\">    src += n;</span><br><span class=\"line\">    dstva = va0 + PGSIZE;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h4><p>总体来说，这一个是抄的别人写的博客。大致的原理，就是不分配内存，通过cow来分配，但是细节太麻烦了。</p>\n<h2 id=\"6-thread\"><a href=\"#6-thread\" class=\"headerlink\" title=\"6.thread\"></a>6.thread</h2><h3 id=\"用户线程切换\"><a href=\"#用户线程切换\" class=\"headerlink\" title=\"用户线程切换\"></a>用户线程切换</h3><h4 id=\"要求和提示-6\"><a href=\"#要求和提示-6\" class=\"headerlink\" title=\"要求和提示\"></a>要求和提示</h4><p>在本部分中我们将设计并实现用户级别下的线程上下文切换。开始前可以阅读 <code>user/uthread.c</code> 和 <code>uthread_switch.S</code> 下的代码，这两个文件实现了线程切换的大致框架和简单的功能测试代码，我们需要补全剩余部分。</p>\n<p>注意到我们需要想办法创造线程并在线程切换的过程中尝试保存 &#x2F; 恢复寄存器，事后如果功能实现，可以在 xv6 下运行 <code>uthread</code>，正确运行示例如下（三个线程的顺序可能会有出入）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PLAINTEXT</span><br><span class=\"line\"></span><br><span class=\"line\">$ make qemu</span><br><span class=\"line\">...</span><br><span class=\"line\">$ uthread</span><br><span class=\"line\">thread_a started</span><br><span class=\"line\">thread_b started</span><br><span class=\"line\">thread_c started</span><br><span class=\"line\">thread_c 0</span><br><span class=\"line\">thread_a 0</span><br><span class=\"line\">thread_b 0</span><br><span class=\"line\">thread_c 1</span><br><span class=\"line\">thread_a 1</span><br><span class=\"line\">thread_b 1</span><br><span class=\"line\">...</span><br><span class=\"line\">thread_c 99</span><br><span class=\"line\">thread_a 99</span><br><span class=\"line\">thread_b 99</span><br><span class=\"line\">thread_c: exit after 100</span><br><span class=\"line\">thread_a: exit after 100</span><br><span class=\"line\">thread_b: exit after 100</span><br><span class=\"line\">thread_schedule: no runnable threads</span><br><span class=\"line\">$</span><br></pre></td></tr></table></figure>\n\n<p>终端上的输出来自三个测试线程，每个线程都会进入一个循环，在循环中打印一行随后让出 CPU 给其他线程。但是由于现在我们还没有加入实现上下文切换的代码，我们是看不到输出的。</p>\n<p>我们需要向 <code>user/uthread.c</code> 下的 <code>thread_create()</code> 和 <code>thread_schedule()</code> 中，以及 <code>user/uthread_switch.S</code> 下的 <code>thread_switch</code> 加入代码，从名字里看得出来，我们需要实现线程的创建和切换功能…</p>\n<p>我们有两个目标需要实现，一个是我们需要确保当 <code>thread_schedule()</code> 第一次运行一个给定的线程时，该线程在自己的堆栈中执行 <code>thread_create()</code> 中给定的函数参数；另外一个是，确保 <code>thread_switch</code> 保存被切换走的线程寄存器，并恢复被切换到的线程寄存器，随后返回到切换过来的线程的指令中最后离开的位置。</p>\n<p>我们需要决定在哪里存储 &#x2F; 恢复寄存器，尝试修改结构体 <code>struct thread</code> 会是一个很好的主意。此外，我们需要在 <code>thread_switch</code> 中加入调用 <code>thread_schedule</code>（这玩意儿只有汇编代码），可以在调用时传入我们想要的任何参数，只要能从线程 <code>t</code> 切换到 <code>next_thread</code>。</p>\n<p>相关提示：</p>\n<ul>\n<li>在 <code>thread_switch</code> 中我们只需要保存和恢复 callee-save 寄存器。</li>\n<li>我们可以参考编译后根据 <code>uthread.c</code> 生成的 <code>user/uthread.asm</code> 汇编代码，以方便调试。</li>\n<li>为了测试代码，使用 <code>riscv64-linux-gnu-gdb</code> 单步浏览 <code>thread_switch</code> 可能会有帮助。相关的 GDB 调试技巧，已经在 Lecture 5 介绍过了，也可以再去熟悉下。</li>\n</ul>\n<h4 id=\"题解-2\"><a href=\"#题解-2\" class=\"headerlink\" title=\"题解\"></a>题解</h4><p>写这一个代码就是为了让我们更深入的了解，线程是如何进行切换。</p>\n<p><img src=\"https://pic2.zhimg.com/v2-b732485b8ee0ccae1cc989d7d426959d_b.jpg\" alt=\"img\"></p>\n<p>基础知识：线程切换</p>\n<ol>\n<li>shell通过中断进入内核态</li>\n<li>执行yield操作，进行让位</li>\n<li>使用swtch算法找到一个合适的</li>\n<li>最后使用usertrapret进行返回</li>\n</ol>\n<p>因为要和寄存器直接打交道，所以 xv6 选择汇编来完成，而不是 C 。相比于 C ，汇编更适合操纵寄存器，使用swtch来进行保存</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Context switch</span><br><span class=\"line\">#</span><br><span class=\"line\">#   void swtch(struct context *old, struct context *new);</span><br><span class=\"line\"># </span><br><span class=\"line\"># Save current registers in old. Load from new. </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">.globl swtch</span><br><span class=\"line\">swtch:</span><br><span class=\"line\">        sd ra, 0(a0)</span><br><span class=\"line\">        sd sp, 8(a0)</span><br><span class=\"line\">        sd s0, 16(a0)</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        sd s11, 104(a0)</span><br><span class=\"line\"></span><br><span class=\"line\">        ld ra, 0(a1)</span><br><span class=\"line\">        ld sp, 8(a1)</span><br><span class=\"line\">        ld s0, 16(a1)</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        ld s11, 104(a1)</span><br><span class=\"line\"></span><br><span class=\"line\">        ret</span><br></pre></td></tr></table></figure>\n\n<p>保存当前的上下文，之后就是调度</p>\n<p>理解了上面知识，我们知道我们这一届需要做什么了。我们就是自己模仿swtch操作，因为进程信息只有内核态可以看见，所以我们需要把这个信息传入到外面的线程数组，直接用数组来进行调用。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">struct thread_context &#123;</span><br><span class=\"line\">  uint64 ra;</span><br><span class=\"line\">  uint64 sp;</span><br><span class=\"line\"></span><br><span class=\"line\">  // callee-saved</span><br><span class=\"line\">  uint64 s0;</span><br><span class=\"line\">  uint64 s1;</span><br><span class=\"line\">  uint64 s2;</span><br><span class=\"line\">  uint64 s3;</span><br><span class=\"line\">  uint64 s4;</span><br><span class=\"line\">  uint64 s5;</span><br><span class=\"line\">  uint64 s6;</span><br><span class=\"line\">  uint64 s7;</span><br><span class=\"line\">  uint64 s8;</span><br><span class=\"line\">  uint64 s9;</span><br><span class=\"line\">  uint64 s10;</span><br><span class=\"line\">  uint64 s11;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">struct thread &#123;</span><br><span class=\"line\">  char       stack[STACK_SIZE]; /* the thread&#x27;s stack */</span><br><span class=\"line\">  int        state;             /* FREE, RUNNING, RUNNABLE */</span><br><span class=\"line\">  struct thread_context context; /* thread context to save/restore reg */</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>之后的调度程序直接抄汇编的swtch</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\t.text</span><br><span class=\"line\"></span><br><span class=\"line\">\t/*</span><br><span class=\"line\">         * save the old thread&#x27;s registers,</span><br><span class=\"line\">         * restore the new thread&#x27;s registers.</span><br><span class=\"line\">         */</span><br><span class=\"line\"></span><br><span class=\"line\">\t.globl thread_switch</span><br><span class=\"line\">thread_switch:</span><br><span class=\"line\">\t/* YOUR CODE HERE */</span><br><span class=\"line\">    sd ra, 0(a0)</span><br><span class=\"line\">    sd sp, 8(a0)</span><br><span class=\"line\">    sd s0, 16(a0)</span><br><span class=\"line\">    sd s1, 24(a0)</span><br><span class=\"line\">    sd s2, 32(a0)</span><br><span class=\"line\">    sd s3, 40(a0)</span><br><span class=\"line\">    sd s4, 48(a0)</span><br><span class=\"line\">    sd s5, 56(a0)</span><br><span class=\"line\">    sd s6, 64(a0)</span><br><span class=\"line\">    sd s7, 72(a0)</span><br><span class=\"line\">    sd s8, 80(a0)</span><br><span class=\"line\">    sd s9, 88(a0)</span><br><span class=\"line\">    sd s10, 96(a0)</span><br><span class=\"line\">    sd s11, 104(a0)</span><br><span class=\"line\"></span><br><span class=\"line\">    ld ra, 0(a1)</span><br><span class=\"line\">    ld sp, 8(a1)</span><br><span class=\"line\">    ld s0, 16(a1)</span><br><span class=\"line\">    ld s1, 24(a1)</span><br><span class=\"line\">    ld s2, 32(a1)</span><br><span class=\"line\">    ld s3, 40(a1)</span><br><span class=\"line\">    ld s4, 48(a1)</span><br><span class=\"line\">    ld s5, 56(a1)</span><br><span class=\"line\">    ld s6, 64(a1)</span><br><span class=\"line\">    ld s7, 72(a1)</span><br><span class=\"line\">    ld s8, 80(a1)</span><br><span class=\"line\">    ld s9, 88(a1)</span><br><span class=\"line\">    ld s10, 96(a1)</span><br><span class=\"line\">    ld s11, 104(a1)</span><br><span class=\"line\">\tret    /* return to ra */</span><br></pre></td></tr></table></figure>\n\n<p>实现Switch操作</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">void </span><br><span class=\"line\">thread_schedule(void)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  struct thread *t, *next_thread;</span><br><span class=\"line\"></span><br><span class=\"line\">  /* Find another runnable thread. */</span><br><span class=\"line\">  next_thread = 0;</span><br><span class=\"line\">  t = current_thread + 1;</span><br><span class=\"line\">  for(int i = 0; i &lt; MAX_THREAD; i++)&#123;</span><br><span class=\"line\">    if(t &gt;= all_thread + MAX_THREAD)</span><br><span class=\"line\">      t = all_thread;</span><br><span class=\"line\">    if(t-&gt;state == RUNNABLE) &#123;</span><br><span class=\"line\">      next_thread = t;</span><br><span class=\"line\">      break;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    t = t + 1;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  if (next_thread == 0) &#123;</span><br><span class=\"line\">    printf(&quot;thread_schedule: no runnable threads\\n&quot;);</span><br><span class=\"line\">    exit(-1);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  if (current_thread != next_thread) &#123;         /* switch threads?  */</span><br><span class=\"line\">    next_thread-&gt;state = RUNNING;</span><br><span class=\"line\">    t = current_thread;</span><br><span class=\"line\">    current_thread = next_thread;</span><br><span class=\"line\">    /* YOUR CODE HERE</span><br><span class=\"line\">     * Invoke thread_switch to switch from t to next_thread:</span><br><span class=\"line\">     * thread_switch(??, ??);</span><br><span class=\"line\">     */</span><br><span class=\"line\">    thread_switch((uint64)&amp;t-&gt;context, (uint64)&amp;next_thread-&gt;context);</span><br><span class=\"line\">  &#125; else</span><br><span class=\"line\">    next_thread = 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"多线程编程\"><a href=\"#多线程编程\" class=\"headerlink\" title=\"多线程编程\"></a>多线程编程</h3><h4 id=\"要求和提示-7\"><a href=\"#要求和提示-7\" class=\"headerlink\" title=\"要求和提示\"></a>要求和提示</h4><p><strong>注意：本部分实验需要在有多核心处理器的 Linux&#x2F;macOS 电脑中完成，而不是在 xv6&#x2F;QEMU 下完成。</strong></p>\n<p>在本部分实验中，我们将使用多线程编程和锁来实现一个 HashTable 哈希表。在本次作业中我们将使用 UNIX 下的 <code>pthread</code> 库函数，关于 <code>pthreads</code> 的更多用法，可以查询 man 手册，终端上输入 <code>man pthreads</code> 即可，也可查询相关网页。</p>\n<p>文件 <code>notxv6/ph.c</code> 中实现了一个仅在单线程下可行的哈希表，但是在多线程下运行就会产生错误。我们在主目录下运行 <code>make ph</code>，随后向可执行文件中传入线程数量作为参数，例如单线程执行<code>./ph 1</code> 即可。示例如下：</p>\n<p><code>ph</code> 程序中主要尝试运行两项测试，首先它通过 <code>put()</code> 尝试向哈希表中加入大量的 key，并打印出平均每秒钟执行 <code>put</code> 的数量，随后它尝试使用 <code>get()</code> 从哈希表中将 key 取出，并打印出哈希表中的 key 的数量。但是很显然目前由于没有对多线程去做额外的实现，部分的 <code>put</code> 操作丢失了，如下是程序未修改的情况下两个线程执行 <code>ph</code> 的结果，我们看到线程 <code>put()</code> 操作丢失了一些 key：</p>\n<p>虽然使用两个线程使得哈希表插入的平均速度翻倍，但是带来了严重的数据丢失问题，这就是个很严重的问题需要我们解决。请仔细阅读 <code>notxv6/ph.c</code>，尤其是文件下的 <code>put()</code> 和 <code>insert()</code> 函数。</p>\n<p>两个线程同时执行 <code>put()</code> 导致 key 丢失的原因是什么？请将作业答案保存在主目录下 <code>answers-thread.txt</code> 下。</p>\n<p>为了确保相关时间的有序执行，我们需要在 <code>put()</code> 和 <code>get()</code> 中引入加锁和解锁机制。相关的 <code>pthread</code> 函数调用有：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C</span><br><span class=\"line\">pthread_mutex_t lock;            // declare a lock</span><br><span class=\"line\">pthread_mutex_init(&amp;lock, NULL); // initialize the lock</span><br><span class=\"line\">pthread_mutex_lock(&amp;lock);       // acquire lock</span><br><span class=\"line\">pthread_mutex_unlock(&amp;lock);     // release lock</span><br></pre></td></tr></table></figure>\n\n<p>记得不要忘记调用 <code>pthread_mutex_init()</code>。在这部分操作结束后，你应该可以顺利通过 <code>ph_safe</code> 测试，即不会有 key 丢失的状况存在。</p>\n<p>接下来，我们尝试对哈希表的速度进行优化，在操作中有部分 <code>put()</code> 对内存的操作并无重叠部分，也许不需要一把很大的锁来保护哈希表（疯狂暗示减小锁的粒度），我们需要对 <code>ph.c</code> 做出额外的变动进而加速 <code>put()</code> 操作（提示：可以对每个哈希桶 bucket 各设置一把锁）。在这部分操作结束后，我们将通过 <code>ph_fast</code> 测试，该测试要求两个线程产生的 <code>put()</code> 速率是一个线程的 1.25 倍。</p>\n<h4 id=\"题解-3\"><a href=\"#题解-3\" class=\"headerlink\" title=\"题解\"></a>题解</h4><blockquote>\n<ol>\n<li>优化成多线程</li>\n<li>资源共享（需要加锁）</li>\n<li>只有在oput的时候才需要上锁</li>\n<li>注意到这里分块了bucket，所以每一个bucket都要上锁</li>\n<li>每次对于一个bucket进行操作的时候，上锁put</li>\n</ol>\n</blockquote>\n<p>struct entry {</p>\n<p> int key;</p>\n<p> int value;</p>\n<p> struct entry *next;</p>\n<p>};</p>\n<p>struct entry *table[NBUCKET];</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">struct entry &#123;</span><br><span class=\"line\">  int key;</span><br><span class=\"line\">  int value;</span><br><span class=\"line\">  struct entry *next;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">struct entry *table[NBUCKET];</span><br><span class=\"line\"></span><br><span class=\"line\">static </span><br><span class=\"line\">void put(int key, int value)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  int i = key % NBUCKET;</span><br><span class=\"line\">  // 对每一个bucket上锁</span><br><span class=\"line\">   pthread_mutex_lock(&amp;locks[i]);</span><br><span class=\"line\">  // is the key already present?</span><br><span class=\"line\">  struct entry *e = 0;</span><br><span class=\"line\">  for (e = table[i]; e != 0; e = e-&gt;next) &#123;</span><br><span class=\"line\">    if (e-&gt;key == key)</span><br><span class=\"line\">      break;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  if(e)&#123;</span><br><span class=\"line\">    // update the existing key.</span><br><span class=\"line\">    e-&gt;value = value;</span><br><span class=\"line\">  &#125; else &#123;</span><br><span class=\"line\">    // the new is new.</span><br><span class=\"line\">    insert(key, value, &amp;table[i], table[i]);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  // release</span><br><span class=\"line\">    pthread_mutex_unlock(&amp;locks[i]);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"实现同步屏障\"><a href=\"#实现同步屏障\" class=\"headerlink\" title=\"实现同步屏障\"></a>实现同步屏障</h3><h4 id=\"要求和提示-8\"><a href=\"#要求和提示-8\" class=\"headerlink\" title=\"要求和提示\"></a>要求和提示</h4><p><strong>注意：本部分实验需要在有多核心处理器的 Linux&#x2F;macOS 电脑中完成，而不是在 xv6&#x2F;QEMU 下完成。</strong></p>\n<p>在这个部分中，我们需要实现一个同步屏障。也就是程序中的一个位置，所有参与的线程都需要等待直到所有其他线程都到达这个位置。我们将使用 <code>pthread</code> 提供的条件变量，他的机制类似于 xv6 中的 <code>sleep</code> 和 <code>wakeup</code>，我们将使用到下面这两个调用：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C</span><br><span class=\"line\">pthread_cond_wait(&amp;cond, &amp;mutex);  // go to sleep on cond, releasing lock mutex, acquiring upon wake up</span><br><span class=\"line\">pthread_cond_broadcast(&amp;cond);     // wake up every thread sleeping on cond</span><br></pre></td></tr></table></figure>\n\n<p>其中，<code>pthread_cond_wait</code> 在被调用时释放了 <code>mutex</code>，并在返回前重新获取了 <code>mutex</code>。</p>\n<p>在 <code>notxv6/barrier.c</code> 下存在一个没有实现好的同步屏障，如果在没有修改的情况下运行，运行就会报错：</p>\n<p><a href=\"https://blog.rayzhang.top/2022/10/07/mit-6.s081-lab-thread/barrier-err.png\"><img src=\"https://blog.rayzhang.top/2022/10/07/mit-6.s081-lab-thread/barrier-err.png\" alt=\"img\"></a></p>\n<p>其中我们给 <code>barrier</code> 传入的第二个参数表示的是需要在同步屏障上进行同步的线程数量。每个线程都在执行一个循环，在每个循环中线程会调用 <code>barrier()</code> 然后随机睡眠若干微秒。刚才未修改的代码导致断言被触发，是因为一个线程在另一个线程到达同步屏障前就离开了。我们希望每个线程都在 <code>barrier()</code> 位置阻塞，直到 <code>nthreads</code> 个线程都调用过了 <code>barrier()</code>。</p>\n<p>在 <code>notxv6/barrier.c</code> 中，<code>barrier_init()</code> 已经被给出，结构体 <code>struct barrier</code> 已经定义，仅供参考。我们只需要实现 <code>barrier()</code> 相关功能，以此来确保不会报错。</p>\n<p>注意两个较难实现的点：</p>\n<ul>\n<li>我们需要处理一连串的 <code>barrier()</code> 调用，我们把这个叫做一轮。<code>bstate.round</code> 中记录了轮数，因此每当所有线程到达内存屏障的时候我们就需要将计数加一。</li>\n<li>小心处理 <code>bstate.nthread</code>，尤其这种情形：一个线程离开了同步屏障，其他线程还没反应过来，就进入了下一轮循环，然后又遇到了同步屏障，直接对计数加一。上一轮和下一轮的计数要分清楚。</li>\n</ul>\n<blockquote>\n<p>打字已实施，只有人气了，才会对论述进行+1，不齐就是阻塞。只有齐了才全部唤醒，操作也要上锁</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static void </span><br><span class=\"line\">barrier()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  // YOUR CODE HERE</span><br><span class=\"line\">  //</span><br><span class=\"line\">  // Block until all threads have called barrier() and</span><br><span class=\"line\">  // then increment bstate.round.</span><br><span class=\"line\">  //</span><br><span class=\"line\">  </span><br><span class=\"line\">  // protect nthread counter</span><br><span class=\"line\">  pthread_mutex_lock(&amp;bstate.barrier_mutex);</span><br><span class=\"line\">  if (++bstate.nthread &lt; nthread) &#123;</span><br><span class=\"line\">    // sleep if not all threads have reached the barrier</span><br><span class=\"line\">    pthread_cond_wait(&amp;bstate.barrier_cond, &amp;bstate.barrier_mutex);</span><br><span class=\"line\">  &#125; else &#123;</span><br><span class=\"line\">    // clear bstate.nthread</span><br><span class=\"line\">    bstate.nthread = 0;</span><br><span class=\"line\">    // imcrement on round count</span><br><span class=\"line\">    bstate.round++;</span><br><span class=\"line\">    // wake up all other threads</span><br><span class=\"line\">    pthread_cond_broadcast(&amp;bstate.barrier_cond);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  pthread_mutex_unlock(&amp;bstate.barrier_mutex);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"总结-1\"><a href=\"#总结-1\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>今天的实验还是比较简单，都是直接按照的讲授的内容锁撰写的。只需要明lock还有调度相关原理即可，基本可以实现。</p>\n<h2 id=\"7-lock\"><a href=\"#7-lock\" class=\"headerlink\" title=\"7.lock\"></a>7.lock</h2><h3 id=\"内存分配器加速\"><a href=\"#内存分配器加速\" class=\"headerlink\" title=\"内存分配器加速\"></a>内存分配器加速</h3><h4 id=\"要求和提示-9\"><a href=\"#要求和提示-9\" class=\"headerlink\" title=\"要求和提示\"></a>要求和提示</h4><p>在 <code>user/kalloctest.c</code> 下我们实现了一个测试，在这个测试中针对 xv6 的内存分配器进行了重点测试，使用了三个进程大量的对地址空间进行增加和缩小，导致大量对 <code>kalloc</code> 和 <code>kfree</code> 的调用，其中 <code>kalloc</code> 和 <code>kfree</code> 在执行时均需要获取锁 <code>kmem.lock</code>。在这里我们使用 <code>kalloctest</code> 打印了由于另一进程已经持有了锁而在尝试自旋获取的次数，在这里使用<code>#fetch-and-add</code> 打印进行表示。需要指出的是，自旋的次数只能作为锁冲突的一种粗略的衡量。如果我们还没有对当前的 Lab 做出修改，我们执行 <code>kalloctest</code> 会得到如下类似的结果：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PLAINTEXT</span><br><span class=\"line\"></span><br><span class=\"line\">$ kalloctest</span><br><span class=\"line\">start test1</span><br><span class=\"line\">test1 results:</span><br><span class=\"line\">--- lock kmem/bcache stats</span><br><span class=\"line\">lock: kmem: #fetch-and-add 83375 #acquire() 433015</span><br><span class=\"line\">lock: bcache: #fetch-and-add 0 #acquire() 1260</span><br><span class=\"line\">--- top 5 contended locks:</span><br><span class=\"line\">lock: kmem: #fetch-and-add 83375 #acquire() 433015</span><br><span class=\"line\">lock: proc: #fetch-and-add 23737 #acquire() 130718</span><br><span class=\"line\">lock: virtio_disk: #fetch-and-add 11159 #acquire() 114</span><br><span class=\"line\">lock: proc: #fetch-and-add 5937 #acquire() 130786</span><br><span class=\"line\">lock: proc: #fetch-and-add 4080 #acquire() 130786</span><br><span class=\"line\">tot= 83375</span><br><span class=\"line\">test1 FAIL</span><br></pre></td></tr></table></figure>\n\n<p>可以看到 <code>acquire</code> 针对每一个锁，打印出了当前锁的调用次数（<code>#acquire()</code> 后），以及为了获取锁失败而产生的自旋次数（<code>#fetch-and-add()</code> 后）。<code>kalloctest</code> 通过调用系统调用，要求内核为 <code>kmem</code> 和 <code>bcache</code> 打印相关的计数信息，以及 5 个竞争最激烈的锁。如果发生了锁竞争，那么自旋的次数就会很大。由于在这部分实验中，我们比较关心 <code>kmem</code> 和 <code>bcache</code> 两个锁的性能，系统调用最后会返回这两个锁上发生的自旋次数的总和。</p>\n<p>需要注意到的是，为了完成当前的 Lab，我们需要使用一台多核心独立无负载的机器。如果使用的机器上面有其他的工作负载，<code>kalloctest</code> 打印出的计数次数就会失去意义。</p>\n<p>现在让我们来关注代码，在 <code>kalloctest</code> 中产生大量锁冲突的根本原因是 <code>kalloc()</code> 只有一个空闲列表。为了尽可能的规避锁冲突，我们需要重新设计内存分配器来避免一个唯一的锁和空闲列表。有一个很简单的想法，我们在每个 CPU 核心中都维护一个空闲列表，每个空闲列表有自己的锁。这样下来，在不同 CPU 下的内存分配和释放就可以并行运行，因为每个 CPU 都操作的是不同的空闲列表。这个想法实现下来最大的困难是，如何处理如下情形，一个 CPU 的空闲列表已经空了，但是另一个 CPU 仍然有空闲的内存。为了处理这样的情形，我们的 CPU 需要从别的 CPU 的空闲列表中 “偷出” 一部分空闲内存。这种 “偷窃内存” 也有可能引入锁冲突，但是希望这样会少频繁一些。</p>\n<p>我们需要做的事情总结下来就是为每个 CPU 维护空闲列表，并当空闲列表空时从其他 CPU 处 “偷取” 空余内存。也就是说，我们需要为我们的每一个列表的锁都调用 <code>initlock</code>，并将名字设置为 <code>kmem</code> 开头。我们需要运行 <code>kalloctest</code> 来查看我们的实现是否减少了锁的竞争，此外为了确保实现没有问题我们还能正确分配所有的内存，我们需要运行 <code>usertests sbrkmuch</code> 测试。我们需要通过 <code>test1</code> 和 <code>test2</code> 测试，测试的相关输出示例如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PLAINTEXT</span><br><span class=\"line\"></span><br><span class=\"line\">$ kalloctest</span><br><span class=\"line\">start test1</span><br><span class=\"line\">test1 results:</span><br><span class=\"line\">--- lock kmem/bcache stats</span><br><span class=\"line\">lock: kmem: #fetch-and-add 0 #acquire() 42843</span><br><span class=\"line\">lock: kmem: #fetch-and-add 0 #acquire() 198674</span><br><span class=\"line\">lock: kmem: #fetch-and-add 0 #acquire() 191534</span><br><span class=\"line\">lock: bcache: #fetch-and-add 0 #acquire() 1242</span><br><span class=\"line\">--- top 5 contended locks:</span><br><span class=\"line\">lock: proc: #fetch-and-add 43861 #acquire() 117281</span><br><span class=\"line\">lock: virtio_disk: #fetch-and-add 5347 #acquire() 114</span><br><span class=\"line\">lock: proc: #fetch-and-add 4856 #acquire() 117312</span><br><span class=\"line\">lock: proc: #fetch-and-add 4168 #acquire() 117316</span><br><span class=\"line\">lock: proc: #fetch-and-add 2797 #acquire() 117266</span><br><span class=\"line\">tot= 0</span><br><span class=\"line\">test1 OK</span><br><span class=\"line\">start test2</span><br><span class=\"line\">total free number of pages: 32499 (out of 32768)</span><br><span class=\"line\">.....</span><br><span class=\"line\">test2 OK</span><br><span class=\"line\">$ usertests sbrkmuch</span><br><span class=\"line\">usertests starting</span><br><span class=\"line\">test sbrkmuch: OK</span><br><span class=\"line\">ALL TESTS PASSED</span><br><span class=\"line\">$ usertests</span><br><span class=\"line\">...</span><br><span class=\"line\">ALL TESTS PASSED</span><br><span class=\"line\">$</span><br></pre></td></tr></table></figure>\n\n<p>相关提示：</p>\n<ul>\n<li>我们可以使用 <code>kernel/param.h</code> 下的 <code>NCPU</code> 常量表示 CPU 数量。</li>\n<li>使用 <code>freerange</code> 为当前运行 <code>freerange</code> 的 CPU 提供所有空余内存。</li>\n<li>函数 <code>cpuid</code> 可以返回当前的 CPU 核心编号，但是只有在中断处于关闭状态时调用才是安全的，我们需要使用 <code>push_off()</code> 和 <code>pop_off()</code> 来控制中断的关和开。</li>\n<li>可以看看在 <code>kernel/sprintf.c</code> 下是怎么实现格式化字符串的。当然，我们将空闲列表锁的名称设置为 <code>kmem</code> 也是完全可以的</li>\n</ul>\n<h4 id=\"题解-4\"><a href=\"#题解-4\" class=\"headerlink\" title=\"题解\"></a>题解</h4><blockquote>\n<p>1.，我们在每个 CPU 核心中都维护一个空闲列表，每个空闲列表有自己的锁。这样下来，在不同 CPU 下的内存分配和释放就可以并行运行，因为每个 CPU 都操作的是不同的空闲列表。</p>\n<p>2.一个 CPU 的空闲列表已经空了，但是另一个 CPU 仍然有空闲的内存。为了处理这样的情形，我们的 CPU 需要从别的 CPU 的空闲列表中 “偷出” 一部分空闲内存。这种 “偷窃内存” 也有可能引入锁冲突，但是希望这样会少频繁一些。</p>\n</blockquote>\n<p>根据题意我们锁需要做的就是</p>\n<ol>\n<li>对每一个cpu都进行设置kmem</li>\n<li>使用 <code>freerange</code> 为当前运行 <code>freerange</code> 的 CPU 提供所有空余内存。</li>\n<li>如果当前cpu不够就进行偷取其他的，同事要跳过当前cpu</li>\n</ol>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> &#123;</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">spinlock</span> <span class=\"title\">lock</span>;</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">run</span> *<span class=\"title\">freelist</span>;</span></span><br><span class=\"line\">&#125; kmem[NCPU];</span><br></pre></td></tr></table></figure>\n\n<p>首先是设置cpu个数，然后初始化锁，还有刚开始，吧所有线程分给0号，之后在进行偷取</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kinit()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"comment\">// initlock(&amp;kmem.lock, &quot;kmem&quot;);</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; NCPU; i++)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* code */</span></span><br><span class=\"line\">    initlock(&amp;kmem[i].lock, <span class=\"string\">&quot;kmem&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  freerange(end, (<span class=\"type\">void</span>*)PHYSTOP);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>根据之前我们讲到的有，首先需要freerange，吧这个内存放到当前的cpu，需要重新写一个程序，因为kfree这个函数被多个其他函数调用。我们需要修改这个kfree—cpu，按照kfree的写法修改</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void</span><br><span class=\"line\">freerange(void *pa_start, void *pa_end)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  char *p;</span><br><span class=\"line\">  p = (char*)PGROUNDUP((uint64)pa_start);</span><br><span class=\"line\">  // 获取当前cpu，当前直接全部吃掉</span><br><span class=\"line\">  push_off();</span><br><span class=\"line\">  int cpu = cpuid();</span><br><span class=\"line\">  pop_off();</span><br><span class=\"line\"></span><br><span class=\"line\">  for(; p + PGSIZE &lt;= (char*)pa_end; p += PGSIZE)</span><br><span class=\"line\">    kfree_cpu(cpu,p);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">void kfree(void *pa) &#123; </span><br><span class=\"line\">  push_off();</span><br><span class=\"line\">  int cpu = cpuid();</span><br><span class=\"line\">  pop_off();</span><br><span class=\"line\">  kfree_cpu(cpu,pa);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">// Free the page of physical memory pointed at by v,</span><br><span class=\"line\">// which normally should have been returned by a</span><br><span class=\"line\">// call to kalloc().  (The exception is when</span><br><span class=\"line\">// initializing the allocator; see kinit above.)</span><br><span class=\"line\">void</span><br><span class=\"line\">kfree_cpu(int cpu,void *pa)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  struct run *r;</span><br><span class=\"line\"></span><br><span class=\"line\">  if(((uint64)pa % PGSIZE) != 0 || (char*)pa &lt; end || (uint64)pa &gt;= PHYSTOP)</span><br><span class=\"line\">    panic(&quot;kfree&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">  // Fill with junk to catch dangling refs.</span><br><span class=\"line\">  memset(pa, 1, PGSIZE);</span><br><span class=\"line\"></span><br><span class=\"line\">  r = (struct run*)pa;</span><br><span class=\"line\">  // huoqu dangqian de cpu</span><br><span class=\"line\">  // 需要终端</span><br><span class=\"line\">  acquire(&amp;kmem[cpu].lock);</span><br><span class=\"line\">  r-&gt;next = kmem[cpu].freelist;</span><br><span class=\"line\">  kmem[cpu].freelist = r;</span><br><span class=\"line\">  release(&amp;kmem[cpu].lock);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>最后就是kalloc的实现，主要就是实现偷取，进行遍历</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> *</span><br><span class=\"line\"><span class=\"title function_\">kalloc</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">run</span> *<span class=\"title\">r</span>;</span></span><br><span class=\"line\">  <span class=\"comment\">// 获取当前线程</span></span><br><span class=\"line\">  push_off();</span><br><span class=\"line\">  <span class=\"type\">int</span> cpu = cpuid();</span><br><span class=\"line\">  pop_off();</span><br><span class=\"line\"></span><br><span class=\"line\">  acquire(&amp;kmem[cpu].lock);</span><br><span class=\"line\">  r = kmem[cpu].freelist;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(r)&#123;</span><br><span class=\"line\">    kmem[cpu].freelist = r-&gt;next;</span><br><span class=\"line\">  release(&amp;kmem[cpu].lock);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 借鉴别人的一些</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; NCPU; i++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"comment\">/* code */</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (i==cpu)</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">/* code */</span></span><br><span class=\"line\">        <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      acquire(&amp;kmem[i].lock);</span><br><span class=\"line\">      r = kmem[i].freelist;</span><br><span class=\"line\">      <span class=\"comment\">// 开始stolen</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (r)</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">/* code */</span></span><br><span class=\"line\">         kmem[i].freelist = r-&gt;next;</span><br><span class=\"line\">          release(&amp;kmem[i].lock);</span><br><span class=\"line\">         </span><br><span class=\"line\">         <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      release(&amp;kmem[i].lock);</span><br><span class=\"line\">      </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">      release(&amp;kmem[cpu].lock);</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(r)</span><br><span class=\"line\">    <span class=\"built_in\">memset</span>((<span class=\"type\">char</span>*)r, <span class=\"number\">5</span>, PGSIZE); <span class=\"comment\">// fill with junk</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (<span class=\"type\">void</span>*)r;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h3 id=\"磁盘缓存加速\"><a href=\"#磁盘缓存加速\" class=\"headerlink\" title=\"磁盘缓存加速\"></a>磁盘缓存加速</h3><h4 id=\"要求和提示-10\"><a href=\"#要求和提示-10\" class=\"headerlink\" title=\"要求和提示\"></a>要求和提示</h4><p>在本部分中实验与上半部分互相独立，如果愿意也可以先做这部分，前部分结果并不会影响当前部分的完成。</p>\n<p>当多个进程尝试大量的使用文件系统时，锁 <code>bcache.lock</code> 就会产生大量的冲突，这个锁的功能就是在 <code>kernel/bio.c</code> 中保护磁盘块缓存。我们的测试程序 <code>bcachetest</code> 会创建多个进程，并不断的读取不同的文件来触发锁 <code>bcache.lock</code> 上的冲突，在我们还没有完成 Lab 前，<code>bcachetest</code> 输出类似如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PLAINTEXT</span><br><span class=\"line\"></span><br><span class=\"line\">$ bcachetest</span><br><span class=\"line\">start test0</span><br><span class=\"line\">test0 results:</span><br><span class=\"line\">--- lock kmem/bcache stats</span><br><span class=\"line\">lock: kmem: #fetch-and-add 0 #acquire() 33035</span><br><span class=\"line\">lock: bcache: #fetch-and-add 16142 #acquire() 65978</span><br><span class=\"line\">--- top 5 contended locks:</span><br><span class=\"line\">lock: virtio_disk: #fetch-and-add 162870 #acquire() 1188</span><br><span class=\"line\">lock: proc: #fetch-and-add 51936 #acquire() 73732</span><br><span class=\"line\">lock: bcache: #fetch-and-add 16142 #acquire() 65978</span><br><span class=\"line\">lock: uart: #fetch-and-add 7505 #acquire() 117</span><br><span class=\"line\">lock: proc: #fetch-and-add 6937 #acquire() 73420</span><br><span class=\"line\">tot= 16142</span><br><span class=\"line\">test0: FAIL</span><br><span class=\"line\">start test1</span><br><span class=\"line\">test1 OK</span><br></pre></td></tr></table></figure>\n\n<p>具体输出的数字可能有所差异，但是肯定可以看到 <code>bcache</code> 锁由于不断 <code>acquire</code> 产生的自旋尝试次数会变得很高。在 <code>kernel/bio.c</code> 中，我们可以看到 <code>bcache.lock</code> 保护了缓存块列表，包括每个块中的引用数 <code>b-&gt;refcnt</code> 以及缓存块的信息（<code>b-&gt;dev</code> 和 <code>b-&gt;blockno</code>）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C</span><br><span class=\"line\"></span><br><span class=\"line\">struct &#123;</span><br><span class=\"line\">  struct spinlock lock;</span><br><span class=\"line\">  struct buf buf[NBUF];</span><br><span class=\"line\"></span><br><span class=\"line\">  // Linked list of all buffers, through prev/next.</span><br><span class=\"line\">  // Sorted by how recently the buffer was used.</span><br><span class=\"line\">  // head.next is most recent, head.prev is least.</span><br><span class=\"line\">  struct buf head;</span><br><span class=\"line\">&#125; bcache;</span><br><span class=\"line\"></span><br><span class=\"line\">struct buf &#123;</span><br><span class=\"line\">  int valid;   // has data been read from disk?</span><br><span class=\"line\">  int disk;    // does disk &quot;own&quot; buf?</span><br><span class=\"line\">  uint dev;</span><br><span class=\"line\">  uint blockno;</span><br><span class=\"line\">  struct sleeplock lock;</span><br><span class=\"line\">  uint refcnt;</span><br><span class=\"line\">  struct buf *prev; // LRU cache list</span><br><span class=\"line\">  struct buf *next;</span><br><span class=\"line\">  uchar data[BSIZE];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>我们的目标是修改缓存块使得在 <code>bcachetest</code> 测试中，由于对尝试锁 <code>acquire</code> 产生的自旋次数尽可能的少且接近零。理想状态下，块缓存中涉及所有锁的尝试自旋次数之和应该为 <code>0</code>，但是总和小于 <code>500</code> 也是可以接受的。我们需要修改 <code>bget</code> 和 <code>brelse</code>，使得 <code>bcache</code> 中的涉及不同缓存块的查找和释放时更不容易在锁上发生冲突（例如，不需要所有操作都等待 <code>bcache.lock</code>）。同时，我们需要确保每个磁盘块只会有一份缓存。</p>\n<p>当完成时，我们的输出示例如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PLAINTEXT</span><br><span class=\"line\"></span><br><span class=\"line\">$ bcachetest</span><br><span class=\"line\">start test0</span><br><span class=\"line\">test0 results:</span><br><span class=\"line\">--- lock kmem/bcache stats</span><br><span class=\"line\">lock: kmem: #fetch-and-add 0 #acquire() 32954</span><br><span class=\"line\">lock: kmem: #fetch-and-add 0 #acquire() 75</span><br><span class=\"line\">lock: kmem: #fetch-and-add 0 #acquire() 73</span><br><span class=\"line\">lock: bcache: #fetch-and-add 0 #acquire() 85</span><br><span class=\"line\">lock: bcache.bucket: #fetch-and-add 0 #acquire() 4159</span><br><span class=\"line\">lock: bcache.bucket: #fetch-and-add 0 #acquire() 2118</span><br><span class=\"line\">lock: bcache.bucket: #fetch-and-add 0 #acquire() 4274</span><br><span class=\"line\">lock: bcache.bucket: #fetch-and-add 0 #acquire() 4326</span><br><span class=\"line\">lock: bcache.bucket: #fetch-and-add 0 #acquire() 6334</span><br><span class=\"line\">lock: bcache.bucket: #fetch-and-add 0 #acquire() 6321</span><br><span class=\"line\">lock: bcache.bucket: #fetch-and-add 0 #acquire() 6704</span><br><span class=\"line\">lock: bcache.bucket: #fetch-and-add 0 #acquire() 6696</span><br><span class=\"line\">lock: bcache.bucket: #fetch-and-add 0 #acquire() 7757</span><br><span class=\"line\">lock: bcache.bucket: #fetch-and-add 0 #acquire() 6199</span><br><span class=\"line\">lock: bcache.bucket: #fetch-and-add 0 #acquire() 4136</span><br><span class=\"line\">lock: bcache.bucket: #fetch-and-add 0 #acquire() 4136</span><br><span class=\"line\">lock: bcache.bucket: #fetch-and-add 0 #acquire() 2123</span><br><span class=\"line\">--- top 5 contended locks:</span><br><span class=\"line\">lock: virtio_disk: #fetch-and-add 158235 #acquire() 1193</span><br><span class=\"line\">lock: proc: #fetch-and-add 117563 #acquire() 3708493</span><br><span class=\"line\">lock: proc: #fetch-and-add 65921 #acquire() 3710254</span><br><span class=\"line\">lock: proc: #fetch-and-add 44090 #acquire() 3708607</span><br><span class=\"line\">lock: proc: #fetch-and-add 43252 #acquire() 3708521</span><br><span class=\"line\">tot= 128</span><br><span class=\"line\">test0: OK</span><br><span class=\"line\">start test1</span><br><span class=\"line\">test1 OK</span><br><span class=\"line\">$ usertests</span><br><span class=\"line\">  ...</span><br><span class=\"line\">ALL TESTS PASSED</span><br><span class=\"line\">$</span><br></pre></td></tr></table></figure>\n\n<p>在 <code>initlock</code> 中，我们需要给我们创建的每个锁一个名字，以 <code>bcache</code> 开头，。</p>\n<p>相比刚才的 <code>kalloc</code> 内存分配，这里处理减少对于缓存块的竞争问题更加棘手，因为 <code>bcache</code> 缓冲区是在进程、CPU 之间共享的。对于 <code>kalloc</code> 来说，我们可以为每个 CPU 安排一个空闲列表来解决，在这里却是行不通的。我们需要使用一个哈希表来查询块编号，并给每一个 bucket 桶设置一把锁。</p>\n<p>这些情况下，如果发生锁冲突我们认定是可以接受的：</p>\n<ul>\n<li>当两个进程同时操作相同的块编号时，在 <code>bcachetest</code> 中的 <code>test0</code> 我们不会这样测试。</li>\n<li>当两个进程同时没有命中缓存，并需要寻找一块没有被使用的缓存块进行替换时。我们在 <code>bcachetest</code> 中的 <code>test0</code> 下也不会这样测试。</li>\n<li>当两个进程操作的块编号在你用来划分区块和锁的方案中发生冲突时；例如，两个进程给定的块编号映射到了同一个哈希表的 bucket 桶中。这是完全有可能的，<code>bcachetest</code> 中的 <code>test0</code> 有可能会这样做，这完全取决于我们的设计，但我们应该尝试调整方案的细节以避免冲突（例如，改变哈希表的大小）。</li>\n</ul>\n<p>和 <code>test0</code> 相比之下，<code>test1</code> 中将测试操作更多不同的块编号，并大量使用文件系统的代码路径。</p>\n<p>相关提示：</p>\n<ul>\n<li>请阅读 xv6 教材 PDF 中关于块缓存的描述（见 8.1~8.3 节）</li>\n<li>为哈希表设置固定数量的桶是可以的，可以不去动态调整哈希表的大小。另外可以使用质数数量的桶（例如 13）来减少散列冲突。</li>\n<li>在哈希表中搜索块编号，如果没有命中我们再重新分配条目，这两个操作需要是原子的。</li>\n<li>我们需要删除所有缓存块列表（<code>bcache.head</code> 等），改为使用缓冲区的最后时间（即使用 <code>kernel/trap.c</code> 下的 <code>ticks</code> 来记录时间戳）。这样修改后，<code>brelse</code> 就不需要获取 <code>bcache</code> 锁，<code>bget</code> 也可以根据时间戳选择最久没有使用的块。</li>\n<li>在 <code>bget</code> 中序列化地进行驱逐是可行的（即 <code>bget</code> 中选择缓存块的部分，当查找缓存未命中时可以选择一个缓存块重新使用）。</li>\n<li>我们的答案在一些情形下需要使用两把锁；例如，在驱逐缓存块期间，我们可能需要持有 <code>bcache</code> 和哈希表 bucket 下的锁。请确保不会发生死锁。</li>\n<li>当我们尝试替换一个缓存块，我们可能需要将一个缓冲块从一个桶 bucket 转移到另一个桶 bucket。我们可能会遇到棘手的问题，也就是新的块可能哈希到与旧的块相同的桶，务必注意不要发生死锁。</li>\n<li>一些调试小技巧：实现 bucket 锁的时候，可以先在 <code>bget</code> 的开始和结束位置留下全局的 <code>bcache.lock</code> 的加锁解锁。当我们尝试解决了竞争问题，尝试运行测试的时候再去掉全局锁，处理并发问题。我们也可以使用 <code>make CPUS=1 qemu</code> 来使用单独一个核心来进行测试。</li>\n</ul>\n<h4 id=\"题解-5\"><a href=\"#题解-5\" class=\"headerlink\" title=\"题解\"></a>题解</h4><blockquote>\n<ul>\n<li>哈希表设置固定数量的桶是可以的，可以不去动态调整哈希表的大小。另外可以使用质数数量的桶（例如 13）来减少散列冲突。</li>\n<li>希表中搜索块编号，如果没有命中我们再重新分配条目，这两个操作需要是原子的</li>\n</ul>\n</blockquote>\n<p>这一节需要我们对磁盘有一定的了解</p>\n<p><img src=\"https://pica.zhimg.com/v2-395ac352730e6573b0e71d02e177205a_720w.jpg?source=d16d100b\" alt=\"「实验记录」MIT 6.S081 Lab8 locks\"></p>\n<p>文件的基本构造，首先最下面进行操作 的是disk，之后我们通过对bcache进行操作，然后写入disk，logging是负责记录操作的日子，为了房子电脑停电crash，inode则是每一个虚拟dev对应的数据结构，通过对pathname我们来得到文件夹dinode</p>\n<p>现在我们来看buf cache的数据结构</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> &#123;</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">spinlock</span> <span class=\"title\">lock</span>;</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">buf</span> <span class=\"title\">buf</span>[<span class=\"title\">NBUF</span>];</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Linked list of all buffers, through prev/next.</span></span><br><span class=\"line\">  <span class=\"comment\">// Sorted by how recently the buffer was used.</span></span><br><span class=\"line\">  <span class=\"comment\">// head.next is most recent, head.prev is least.</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">buf</span> <span class=\"title\">head</span>;</span></span><br><span class=\"line\">&#125; bcache;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">buf</span> &#123;</span></span><br><span class=\"line\">  <span class=\"type\">int</span> valid;   <span class=\"comment\">// has data been read from disk?</span></span><br><span class=\"line\">  <span class=\"type\">int</span> disk;    <span class=\"comment\">// does disk &quot;own&quot; buf?</span></span><br><span class=\"line\">  uint dev;</span><br><span class=\"line\">  uint blockno;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sleeplock</span> <span class=\"title\">lock</span>;</span></span><br><span class=\"line\">  uint refcnt;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">buf</span> *<span class=\"title\">prev</span>;</span> <span class=\"comment\">// LRU cache list</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">buf</span> *<span class=\"title\">next</span>;</span></span><br><span class=\"line\">  uchar data[BSIZE];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>可以看出则是一个双向链表，则是实现lru来进行构造的，buf数组是所有的缓存区文件，head是为了好进行lru才构造的。我们现在的目的是制作多个head，发散到不同的头上面，然后来进行删除</p>\n<p>根据上面的提示，我们把这一整个链表分成多个段，使用13座为三列值，三列函数，使用dev+blockno，来得到</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">  <span class=\"comment\">// struct spinlock lock;</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">buf</span> <span class=\"title\">buf</span>[<span class=\"title\">NBUF</span>];</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Linked list of all buffers, through prev/next.</span></span><br><span class=\"line\">  <span class=\"comment\">// Sorted by how recently the buffer was used.</span></span><br><span class=\"line\">  <span class=\"comment\">// head.next is most recent, head.prev is least.</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">buf</span> <span class=\"title\">hashtable</span>[<span class=\"title\">NBUCKET</span>];</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">spinlock</span> <span class=\"title\">lks</span>[<span class=\"title\">NBUCKET</span>];</span></span><br><span class=\"line\">&#125; bcache;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置hash函数，用于get得到对应的bucket</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">hash</span><span class=\"params\">(uint dev, uint blockno)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (dev + blockno) % NBUCKET;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>真正的底层操作还是在hashtable，每一个hashtable都是单独的一个双向链表，我们还是在单独的双向链表进行操作，但是初始化，吧所有的节点还是挂到0号，之后和上面一样进行偷取</p>\n<p>首先还是进行lock初始化</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">binit</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">buf</span> *<span class=\"title\">b</span>;</span></span><br><span class=\"line\">  <span class=\"comment\">// 初始化所有的锁</span></span><br><span class=\"line\">  <span class=\"comment\">// initlock(&amp;bcache.lock, &quot;bcache&quot;);</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; NBUCKET; i++)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* code */</span></span><br><span class=\"line\">    initlock(&amp;bcache.lks[i], <span class=\"string\">&quot;bcache&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 对bucket来进行</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; NBUCKET; i++)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* code */</span></span><br><span class=\"line\">    bcache.hashtable[i].prev = &amp;bcache.hashtable[i];</span><br><span class=\"line\">    bcache.hashtable[i].next = &amp;bcache.hashtable[i];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 对每一个buf，进行设置为单独的节点，不是数组</span></span><br><span class=\"line\">  <span class=\"comment\">// Create linked list of buffers</span></span><br><span class=\"line\">  <span class=\"comment\">//</span></span><br><span class=\"line\">  <span class=\"comment\">// 一次性分配给0号bucket</span></span><br><span class=\"line\">  <span class=\"comment\">/* code */</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (b = bcache.buf; b &lt; bcache.buf + NBUF; b++)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    b-&gt;next = bcache.hashtable[<span class=\"number\">0</span>].next;</span><br><span class=\"line\">    b-&gt;prev = &amp;bcache.hashtable[<span class=\"number\">0</span>];</span><br><span class=\"line\">    initsleeplock(&amp;b-&gt;lock, <span class=\"string\">&quot;buffer&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 初始化每一个buf的</span></span><br><span class=\"line\">    <span class=\"comment\">// 头插法</span></span><br><span class=\"line\">    bcache.hashtable[<span class=\"number\">0</span>].next-&gt;prev = b;</span><br><span class=\"line\">    bcache.hashtable[<span class=\"number\">0</span>].next = b;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>接下来就是什么时候更新会见戳，当我们这个这个数据结构引用次数是0的时候，就需要进行更新了，之前是直接自己进行lru算法实现，现在我们只需要吧这个变成当前时间就可以</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">brelse</span><span class=\"params\">(<span class=\"keyword\">struct</span> buf *b)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!holdingsleep(&amp;b-&gt;lock))</span><br><span class=\"line\">    panic(<span class=\"string\">&quot;brelse&quot;</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 通过buf获取bucket</span></span><br><span class=\"line\">  <span class=\"type\">int</span> index = hash(b-&gt;dev, b-&gt;blockno);</span><br><span class=\"line\">  releasesleep(&amp;b-&gt;lock);</span><br><span class=\"line\"></span><br><span class=\"line\">  acquire(&amp;bcache.lks[index]);</span><br><span class=\"line\">  b-&gt;refcnt--;</span><br><span class=\"line\">  <span class=\"comment\">// 不需要进行移动了，更新时间就行</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (b-&gt;refcnt == <span class=\"number\">0</span>)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">// no one is waiting for it.</span></span><br><span class=\"line\">    <span class=\"comment\">// b-&gt;next-&gt;prev = b-&gt;prev;</span></span><br><span class=\"line\">    <span class=\"comment\">// b-&gt;prev-&gt;next = b-&gt;next;</span></span><br><span class=\"line\">    <span class=\"comment\">// b-&gt;next = bcache.hashtable[index].next;</span></span><br><span class=\"line\">    <span class=\"comment\">// b-&gt;prev = &amp;bcache.hashtable[index];</span></span><br><span class=\"line\">    <span class=\"comment\">// bcache.hashtable[index].next-&gt;prev = b;</span></span><br><span class=\"line\">    <span class=\"comment\">// bcache.hashtable[index].next = b;</span></span><br><span class=\"line\">    <span class=\"comment\">// 最左边的是要进行删除的</span></span><br><span class=\"line\"></span><br><span class=\"line\">    acquire(&amp;tickslock);</span><br><span class=\"line\">    b-&gt;timestamp = ticks;</span><br><span class=\"line\">    release(&amp;tickslock);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 更新时间</span></span><br><span class=\"line\"></span><br><span class=\"line\">  release(&amp;bcache.lks[index]);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span></span><br><span class=\"line\"><span class=\"title function_\">bpin</span><span class=\"params\">(<span class=\"keyword\">struct</span> buf *b)</span> </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"type\">int</span> id = myhash(b-&gt;blockno);</span><br><span class=\"line\"></span><br><span class=\"line\">  acquire(&amp;bcache.lks[id]);</span><br><span class=\"line\">  b-&gt;refcnt++;</span><br><span class=\"line\">  release(&amp;bcache.lks[id]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span></span><br><span class=\"line\"><span class=\"title function_\">bunpin</span><span class=\"params\">(<span class=\"keyword\">struct</span> buf *b)</span> </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"type\">int</span> id = myhash(b-&gt;blockno);</span><br><span class=\"line\"></span><br><span class=\"line\">  acquire(&amp;bcache.lks[id]);</span><br><span class=\"line\">  b-&gt;refcnt--;</span><br><span class=\"line\">  release(&amp;bcache.lks[id]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>最后就是如何进行偷取，bget的任务就是根据给定dev还有blockno来进行得到所需要的buf。下面是2中解决</p>\n<p>我们是首先根据他的id，来算出他是哪一个bucket里面的，之后对这个bucket来进行遍历，看这个buf存不存在。不存在，就是用lru策略，使用时间戳来进行换出。如果是没有空闲节点，那就需要进行偷取，遍历其他bucket，然后找到空闲的，之后修改这个空闲的dev还有no来进行偷取</p>\n<ol>\n<li>获取当前的bucket</li>\n<li>查看有没有他</li>\n<li>没有就查看有没有空闲节点，使用lru换出</li>\n<li>也没有，就使用lru偷取别人的</li>\n</ol>\n<p>1.查找bucket，看有没有缓存可以使用的</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">truct buf *b;</span><br><span class=\"line\">  <span class=\"type\">int</span> index = hash(dev, blockno);</span><br><span class=\"line\"></span><br><span class=\"line\">  acquire(&amp;bcache.lks[index]);</span><br><span class=\"line\">  <span class=\"comment\">// 锁index的bucket</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 通过head查找不是数组</span></span><br><span class=\"line\">  <span class=\"comment\">// Is the block already cached?</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (b = bcache.hashtable[index].next; b != &amp;bcache.hashtable[index]; b = b-&gt;next)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (b-&gt;dev == dev &amp;&amp; b-&gt;blockno == blockno)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      b-&gt;refcnt++;</span><br><span class=\"line\">      release(&amp;bcache.lks[index]);</span><br><span class=\"line\">      <span class=\"comment\">// 自旋转锁</span></span><br><span class=\"line\">      acquiresleep(&amp;b-&gt;lock);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>2.没有，就从自己的空闲使用lru</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Not cached.</span></span><br><span class=\"line\"> <span class=\"comment\">// Recycle the least recently used (LRU) unused buffer.</span></span><br><span class=\"line\"> <span class=\"comment\">// 这里是直接使用时间戳</span></span><br><span class=\"line\"> <span class=\"comment\">// todo: 修改</span></span><br><span class=\"line\"> <span class=\"comment\">// 还是和之前一样，开始查找，没有就开始偷取</span></span><br><span class=\"line\"> <span class=\"comment\">//  使用时间戳来进行比较</span></span><br><span class=\"line\"> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">buf</span> *<span class=\"title\">victm</span> =</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"> acquire(&amp;tickslock);</span><br><span class=\"line\"> uint minticks = ticks;</span><br><span class=\"line\"> release(&amp;tickslock);</span><br><span class=\"line\"> <span class=\"comment\">// 找到最小的，进行替换</span></span><br><span class=\"line\"> <span class=\"keyword\">for</span> (b = bcache.hashtable[index].next; b != &amp;bcache.hashtable[index]; b = b-&gt;next)</span><br><span class=\"line\"> &#123;</span><br><span class=\"line\">   <span class=\"comment\">/* code */</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> (b-&gt;refcnt == <span class=\"number\">0</span> &amp;&amp; b-&gt;timestamp &lt;=minticks)</span><br><span class=\"line\">   &#123;</span><br><span class=\"line\">     <span class=\"comment\">/* code */</span></span><br><span class=\"line\">     victm = b;</span><br><span class=\"line\">     minticks = b-&gt;timestamp;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n<p>还是没找到，就偷取别人，找到就break’</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (!victm)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 找不到就开始偷取</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; NBUCKET; i++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"comment\">/* code */</span></span><br><span class=\"line\">      <span class=\"comment\">// 从不同的bucket的查找</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (i == index)</span><br><span class=\"line\">        <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">      <span class=\"comment\">// huoqu lock</span></span><br><span class=\"line\">      acquire(&amp;bcache.lks[i]);</span><br><span class=\"line\">      <span class=\"comment\">// 接着查找</span></span><br><span class=\"line\">      <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">      复制上面的代码</span></span><br><span class=\"line\"><span class=\"comment\">      */</span></span><br><span class=\"line\">      acquire(&amp;tickslock);</span><br><span class=\"line\">      minticks = ticks;</span><br><span class=\"line\">      release(&amp;tickslock);</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">// 找到最小的，进行替换</span></span><br><span class=\"line\">      <span class=\"keyword\">for</span> (b = bcache.hashtable[i].next; b != &amp;bcache.hashtable[i]; b = b-&gt;next)</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">/* code */</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (b-&gt;refcnt == <span class=\"number\">0</span> &amp;&amp; b-&gt;timestamp &lt;= minticks)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"comment\">/* code */</span></span><br><span class=\"line\">          victm = b;</span><br><span class=\"line\">          minticks = b-&gt;timestamp;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">       release(&amp;bcache.lks[i]);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (victm)</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">       </span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// 开锁</span></span><br><span class=\"line\">     </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>最后就是如果找到了，就进行初始化，更换dev，还有block，还有ref，同事还有进行打开和释放链表，双向链表得到操作</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"keyword\">if</span> (victm)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   <span class=\"comment\">/* code */</span></span><br><span class=\"line\">      <span class=\"comment\">// 找到就进行break</span></span><br><span class=\"line\">      <span class=\"comment\">// 吧他翘出来，放到inde</span></span><br><span class=\"line\">      b=victm;</span><br><span class=\"line\">      b-&gt;next-&gt;prev = b-&gt;prev;</span><br><span class=\"line\">      b-&gt;prev-&gt;next = b-&gt;next;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 初始化这个锁信息</span></span><br><span class=\"line\">      <span class=\"comment\">// 更新</span></span><br><span class=\"line\">      b-&gt;blockno = blockno;</span><br><span class=\"line\">      b-&gt;dev = dev;</span><br><span class=\"line\">      b-&gt;refcnt = <span class=\"number\">1</span>;</span><br><span class=\"line\">      b-&gt;valid = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 放入到index 头插法</span></span><br><span class=\"line\">      b-&gt;next = bcache.hashtable[index].next;</span><br><span class=\"line\">      bcache.hashtable[index].next-&gt;prev = b;</span><br><span class=\"line\">      bcache.hashtable[index].next = victm;</span><br><span class=\"line\">      b-&gt;prev = &amp;bcache.hashtable[index];</span><br><span class=\"line\"></span><br><span class=\"line\">  acquiresleep(&amp;b-&gt;lock);</span><br><span class=\"line\"></span><br><span class=\"line\">  release(&amp;bcache.lks[index]);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> b;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>下面是全部操作的代码</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">static</span> <span class=\"keyword\">struct</span> buf *</span><br><span class=\"line\"><span class=\"title function_\">bget</span><span class=\"params\">(uint dev, uint blockno)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">buf</span> *<span class=\"title\">b</span>;</span></span><br><span class=\"line\">  <span class=\"type\">int</span> index = hash(dev, blockno);</span><br><span class=\"line\"></span><br><span class=\"line\">  acquire(&amp;bcache.lks[index]);</span><br><span class=\"line\">  <span class=\"comment\">// 锁index的bucket</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 通过head查找不是数组</span></span><br><span class=\"line\">  <span class=\"comment\">// Is the block already cached?</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (b = bcache.hashtable[index].next; b != &amp;bcache.hashtable[index]; b = b-&gt;next)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (b-&gt;dev == dev &amp;&amp; b-&gt;blockno == blockno)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      b-&gt;refcnt++;</span><br><span class=\"line\">      release(&amp;bcache.lks[index]);</span><br><span class=\"line\">      <span class=\"comment\">// 自旋转锁</span></span><br><span class=\"line\">      acquiresleep(&amp;b-&gt;lock);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Not cached.</span></span><br><span class=\"line\">  <span class=\"comment\">// Recycle the least recently used (LRU) unused buffer.</span></span><br><span class=\"line\">  <span class=\"comment\">// 这里是直接使用时间戳</span></span><br><span class=\"line\">  <span class=\"comment\">// todo: 修改</span></span><br><span class=\"line\">  <span class=\"comment\">// 还是和之前一样，开始查找，没有就开始偷取</span></span><br><span class=\"line\">  <span class=\"comment\">//  使用时间戳来进行比较</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">buf</span> *<span class=\"title\">victm</span> =</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  acquire(&amp;tickslock);</span><br><span class=\"line\">  uint minticks = ticks;</span><br><span class=\"line\">  release(&amp;tickslock);</span><br><span class=\"line\">  <span class=\"comment\">// 找到最小的，进行替换</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (b = bcache.hashtable[index].next; b != &amp;bcache.hashtable[index]; b = b-&gt;next)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* code */</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (b-&gt;refcnt == <span class=\"number\">0</span> &amp;&amp; b-&gt;timestamp &lt;=minticks)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"comment\">/* code */</span></span><br><span class=\"line\">      victm = b;</span><br><span class=\"line\">      minticks = b-&gt;timestamp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!victm)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 找不到就开始偷取</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; NBUCKET; i++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"comment\">/* code */</span></span><br><span class=\"line\">      <span class=\"comment\">// 从不同的bucket的查找</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (i == index)</span><br><span class=\"line\">        <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">      <span class=\"comment\">// huoqu lock</span></span><br><span class=\"line\">      acquire(&amp;bcache.lks[i]);</span><br><span class=\"line\">      <span class=\"comment\">// 接着查找</span></span><br><span class=\"line\">      <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">      复制上面的代码</span></span><br><span class=\"line\"><span class=\"comment\">      */</span></span><br><span class=\"line\">      acquire(&amp;tickslock);</span><br><span class=\"line\">      minticks = ticks;</span><br><span class=\"line\">      release(&amp;tickslock);</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">// 找到最小的，进行替换</span></span><br><span class=\"line\">      <span class=\"keyword\">for</span> (b = bcache.hashtable[i].next; b != &amp;bcache.hashtable[i]; b = b-&gt;next)</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">/* code */</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (b-&gt;refcnt == <span class=\"number\">0</span> &amp;&amp; b-&gt;timestamp &lt;= minticks)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"comment\">/* code */</span></span><br><span class=\"line\">          victm = b;</span><br><span class=\"line\">          minticks = b-&gt;timestamp;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">       release(&amp;bcache.lks[i]);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (victm)</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">       </span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// 开锁</span></span><br><span class=\"line\">     </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">      <span class=\"keyword\">if</span> (victm)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">     <span class=\"comment\">/* code */</span></span><br><span class=\"line\">        <span class=\"comment\">// 找到就进行break</span></span><br><span class=\"line\">        <span class=\"comment\">// 吧他翘出来，放到inde</span></span><br><span class=\"line\">        b=victm;</span><br><span class=\"line\">        b-&gt;next-&gt;prev = b-&gt;prev;</span><br><span class=\"line\">        b-&gt;prev-&gt;next = b-&gt;next;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 初始化这个锁信息</span></span><br><span class=\"line\">        <span class=\"comment\">// 更新</span></span><br><span class=\"line\">        b-&gt;blockno = blockno;</span><br><span class=\"line\">        b-&gt;dev = dev;</span><br><span class=\"line\">        b-&gt;refcnt = <span class=\"number\">1</span>;</span><br><span class=\"line\">        b-&gt;valid = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 放入到index 头插法</span></span><br><span class=\"line\">        b-&gt;next = bcache.hashtable[index].next;</span><br><span class=\"line\">        bcache.hashtable[index].next-&gt;prev = b;</span><br><span class=\"line\">        bcache.hashtable[index].next = victm;</span><br><span class=\"line\">        b-&gt;prev = &amp;bcache.hashtable[index];</span><br><span class=\"line\"></span><br><span class=\"line\">    acquiresleep(&amp;b-&gt;lock);</span><br><span class=\"line\">  </span><br><span class=\"line\">    release(&amp;bcache.lks[index]);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> b;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  release(&amp;bcache.lks[index]);</span><br><span class=\"line\">  panic(<span class=\"string\">&quot;bget: no buffers&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"总结-2\"><a href=\"#总结-2\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>第一个内存分配的题目是送分题目，基本上只要看懂题目就知道如何理解。第二个这个也是参考别人的实现，有的是没使用单链表，这个博主的思路和之前代码基本一样比较好理解，就对这个博主的代码进行了参考。</p>\n<h2 id=\"8-fs\"><a href=\"#8-fs\" class=\"headerlink\" title=\"8.fs\"></a>8.fs</h2><h3 id=\"大文件实现\"><a href=\"#大文件实现\" class=\"headerlink\" title=\"大文件实现\"></a>大文件实现</h3><h4 id=\"要求和提示-11\"><a href=\"#要求和提示-11\" class=\"headerlink\" title=\"要求和提示\"></a>要求和提示</h4><p>在这个部分中，我们将为 xv6 提高其文件系统所能支持的最大文件大小。当前 xv6 所支持的最大文件大小被限制在 268 个块，也就是 <code>268*BSIZE</code> 个字节（在 xv6 中 <code>BSIZE</code> 块内存大小为 1024）。这个限制的原因来自在 xv6 的 inode 中，存储有 12 个 “直接” 块编号和一个 “间接” 块编号，在 “间接” 块编号指向的块中又可以存储 256 个块编号。因此，一个文件最多可以对应 12+256&#x3D;26812+256&#x3D;26812+256&#x3D;268 个块。</p>\n<p>这是在 PDF 中图 8.3，很好的表示了这一结构：</p>\n<p><img src=\"https://blog.rayzhang.top/2022/10/19/mit-6.s081-lab-fs/inode.png\" alt=\"img\"></p>\n<p>在这部分作业中，我们将使用 <code>bigfile</code> 进行测试能创建的最大文件，如果我们暂时还没有对当前 xv6 修改，我们会获得这样的结果：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">plaintext</span><br><span class=\"line\">$ bigfile</span><br><span class=\"line\">..</span><br><span class=\"line\">wrote 268 blocks</span><br><span class=\"line\">bigfile: file is too s</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"题解-6\"><a href=\"#题解-6\" class=\"headerlink\" title=\"题解\"></a>题解</h4><p>这一个题目是408考了很多次的题目，直接看提示就可以写的。首先设置最大的文件块长度，是直接+一级+二级，二级索引是一级*一级。之后把地址进行变成addr+2，0 -addr-1是直接，addr是一级，addr+1下标代表的是二级。同事inode还有dinode也要更新，之后就是进行分配。</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> NDIRECT 11</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> NINDIRECT (BSIZE / sizeof(uint))</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MAXFILE (NDIRECT + NINDIRECT + NINDIRECT * NINDIRECT)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// On-disk inode structure</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dinode</span> &#123;</span></span><br><span class=\"line\">  <span class=\"type\">short</span> type;           <span class=\"comment\">// File type</span></span><br><span class=\"line\">  <span class=\"type\">short</span> major;          <span class=\"comment\">// Major device number (T_DEVICE only)</span></span><br><span class=\"line\">  <span class=\"type\">short</span> minor;          <span class=\"comment\">// Minor device number (T_DEVICE only)</span></span><br><span class=\"line\">  <span class=\"type\">short</span> nlink;          <span class=\"comment\">// Number of links to inode in file system</span></span><br><span class=\"line\">  uint size;            <span class=\"comment\">// Size of file (bytes)</span></span><br><span class=\"line\">  uint addrs[NDIRECT+<span class=\"number\">2</span>];   <span class=\"comment\">// Data block addresses</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// in-memory copy of an inode</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">inode</span> &#123;</span></span><br><span class=\"line\">  uint dev;           <span class=\"comment\">// Device number</span></span><br><span class=\"line\">  uint inum;          <span class=\"comment\">// Inode number</span></span><br><span class=\"line\">  <span class=\"type\">int</span> ref;            <span class=\"comment\">// Reference count</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sleeplock</span> <span class=\"title\">lock</span>;</span> <span class=\"comment\">// protects everything below here</span></span><br><span class=\"line\">  <span class=\"type\">int</span> valid;          <span class=\"comment\">// inode has been read from disk?</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"type\">short</span> type;         <span class=\"comment\">// copy of disk inode</span></span><br><span class=\"line\">  <span class=\"type\">short</span> major;</span><br><span class=\"line\">  <span class=\"type\">short</span> minor;</span><br><span class=\"line\">  <span class=\"type\">short</span> nlink;</span><br><span class=\"line\">  uint size;</span><br><span class=\"line\">  uint addrs[NDIRECT+<span class=\"number\">2</span>];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>分配，是在一级之后来进行二级</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Inode content</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// The content (data) associated with each inode is stored</span></span><br><span class=\"line\"><span class=\"comment\">// in blocks on the disk. The first NDIRECT block numbers</span></span><br><span class=\"line\"><span class=\"comment\">// are listed in ip-&gt;addrs[].  The next NINDIRECT blocks are</span></span><br><span class=\"line\"><span class=\"comment\">// listed in block ip-&gt;addrs[NDIRECT].</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Return the disk block address of the nth block in inode ip.</span></span><br><span class=\"line\"><span class=\"comment\">// If there is no such block, bmap allocates one.</span></span><br><span class=\"line\"><span class=\"type\">static</span> uint</span><br><span class=\"line\"><span class=\"title function_\">bmap</span><span class=\"params\">(<span class=\"keyword\">struct</span> inode *ip, uint bn)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  uint addr, *a;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">buf</span> *<span class=\"title\">bp</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(bn &lt; NDIRECT)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>((addr = ip-&gt;addrs[bn]) == <span class=\"number\">0</span>)</span><br><span class=\"line\">      ip-&gt;addrs[bn] = addr = balloc(ip-&gt;dev);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> addr;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  bn -= NDIRECT;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(bn &lt; NINDIRECT)&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Load indirect block, allocating if necessary.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>((addr = ip-&gt;addrs[NDIRECT]) == <span class=\"number\">0</span>)</span><br><span class=\"line\">      ip-&gt;addrs[NDIRECT] = addr = balloc(ip-&gt;dev);</span><br><span class=\"line\">    bp = bread(ip-&gt;dev, addr);</span><br><span class=\"line\">    a = (uint*)bp-&gt;data;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>((addr = a[bn]) == <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">      a[bn] = addr = balloc(ip-&gt;dev);</span><br><span class=\"line\">      log_write(bp);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    brelse(bp);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> addr;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  bn -= NINDIRECT;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(bn &lt; NINDIRECT * NINDIRECT)&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Load doubly-indirect block, allocating if necessary</span></span><br><span class=\"line\">    <span class=\"type\">int</span> index = bn / NINDIRECT; <span class=\"comment\">// Determine which indirect block</span></span><br><span class=\"line\">    <span class=\"type\">int</span> offset = bn % NINDIRECT; <span class=\"comment\">// Determine offset of the data block in the indirect block</span></span><br><span class=\"line\">    <span class=\"comment\">// Create the doubly-indirect block if not exists</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>((addr = ip-&gt;addrs[NDIRECT + <span class=\"number\">1</span>]) == <span class=\"number\">0</span>)</span><br><span class=\"line\">      ip-&gt;addrs[NDIRECT + <span class=\"number\">1</span>] = addr = balloc(ip-&gt;dev);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Create the indirect block if not exists</span></span><br><span class=\"line\">    bp = bread(ip-&gt;dev, addr);</span><br><span class=\"line\">    a = (uint*)bp-&gt;data;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>((addr = a[index]) == <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">      a[index] = addr = balloc(ip-&gt;dev);</span><br><span class=\"line\">      log_write(bp);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    brelse(bp);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Create the data block if not exists</span></span><br><span class=\"line\">    bp = bread(ip-&gt;dev, addr);</span><br><span class=\"line\">    a = (uint*)bp-&gt;data;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>((addr = a[offset]) == <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">      a[offset] = addr = balloc(ip-&gt;dev);</span><br><span class=\"line\">      log_write(bp);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    brelse(bp);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> addr;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  panic(<span class=\"string\">&quot;bmap: out of range&quot;</span>)</span><br><span class=\"line\">      </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<p>删除也是一样的操作，首先获取地址，然后对这个网页在进行遍历，之后再次进行删除，直接抄袭一级索引就行</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Truncate inode (discard contents).</span></span><br><span class=\"line\"><span class=\"comment\">// Caller must hold ip-&gt;lock.</span></span><br><span class=\"line\"><span class=\"type\">void</span></span><br><span class=\"line\"><span class=\"title function_\">itrunc</span><span class=\"params\">(<span class=\"keyword\">struct</span> inode *ip)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"type\">int</span> i, j, k;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">buf</span> *<span class=\"title\">bp</span>, *<span class=\"title\">ibp</span>;</span></span><br><span class=\"line\">  uint *a, *b;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span>(i = <span class=\"number\">0</span>; i &lt; NDIRECT; i++)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(ip-&gt;addrs[i])&#123;</span><br><span class=\"line\">      bfree(ip-&gt;dev, ip-&gt;addrs[i]);</span><br><span class=\"line\">      ip-&gt;addrs[i] = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(ip-&gt;addrs[NDIRECT])&#123;</span><br><span class=\"line\">    bp = bread(ip-&gt;dev, ip-&gt;addrs[NDIRECT]);</span><br><span class=\"line\">    a = (uint*)bp-&gt;data;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j = <span class=\"number\">0</span>; j &lt; NINDIRECT; j++)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(a[j])</span><br><span class=\"line\">        bfree(ip-&gt;dev, a[j]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    brelse(bp);</span><br><span class=\"line\">    bfree(ip-&gt;dev, ip-&gt;addrs[NDIRECT]);</span><br><span class=\"line\">    ip-&gt;addrs[NDIRECT] = <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Locate doubly-indirect block</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(ip-&gt;addrs[NDIRECT + <span class=\"number\">1</span>])&#123;</span><br><span class=\"line\">    bp = bread(ip-&gt;dev, ip-&gt;addrs[NDIRECT + <span class=\"number\">1</span>]);</span><br><span class=\"line\">    a = (uint*)bp-&gt;data;</span><br><span class=\"line\">    <span class=\"comment\">// Traverse indirect blocks</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j = <span class=\"number\">0</span>; j &lt; NINDIRECT; j++)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(a[j])&#123;</span><br><span class=\"line\">        ibp = bread(ip-&gt;dev, a[j]);</span><br><span class=\"line\">        b = (uint*)ibp-&gt;data;</span><br><span class=\"line\">        <span class=\"comment\">// Traverse data blocks</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(k = <span class=\"number\">0</span>; k &lt; NINDIRECT; k++)&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(b[k])</span><br><span class=\"line\">            bfree(ip-&gt;dev, b[k]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        brelse(ibp);</span><br><span class=\"line\">        bfree(ip-&gt;dev, a[j]);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    brelse(bp);</span><br><span class=\"line\">    bfree(ip-&gt;dev, ip-&gt;addrs[NDIRECT + <span class=\"number\">1</span>]);</span><br><span class=\"line\">    ip-&gt;addrs[NDIRECT + <span class=\"number\">1</span>] = <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  ip-&gt;size = <span class=\"number\">0</span>;</span><br><span class=\"line\">  iupdate(ip);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"符号链接实现\"><a href=\"#符号链接实现\" class=\"headerlink\" title=\"符号链接实现\"></a>符号链接实现</h3><h4 id=\"要求和提示-12\"><a href=\"#要求和提示-12\" class=\"headerlink\" title=\"要求和提示\"></a>要求和提示</h4><p>在这一部分中，我们将为 xv6 添加符号链接（软链接）功能。符号链接通过路径名指向一个被链接的文件；当一个符号链接被打开时，内核会跟踪符号链接访问对应的文件。符号链接类似于硬链接，但是硬链接只仅限于指向同一磁盘的文件，而符号链接可以跨越磁盘。虽然 xv6 不支持多设备，但是实现这个系统调用是一个很好的练习，可以帮助我们了解路径名查询的工作原理。</p>\n<p>我们的目标是实现系统调用 <code>symlink(char *target, char *path)</code>，他将在指定路径上创建一个新的符号链接，指向由目标命名的文件。想了解更多用法，我们可以查看 <code>symlink</code> 的 man 页面。为了测试 <code>symlink</code> 系统调用，我们需要向主目录下 <code>Makefile</code> 文件中加入 <code>symlinktest</code>（添加系统调用的基操，忘记了的话去重温下 Lab Syscall）。成功的 <code>symlinktest</code> 运行结果示例如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C</span><br><span class=\"line\">$ symlinktest</span><br><span class=\"line\">Start: test symlinks</span><br><span class=\"line\">test symlinks: ok</span><br><span class=\"line\">Start: test concurrent symlinks</span><br><span class=\"line\">test concurrent symlinks: ok</span><br><span class=\"line\">$ usertests</span><br><span class=\"line\">...</span><br><span class=\"line\">ALL TESTS PASSED</span><br><span class=\"line\">$ </span><br></pre></td></tr></table></figure>\n\n<p>相关提示：</p>\n<ul>\n<li>首先，为 <code>symlink</code> 创建一个新的系统调用编号，在 <code>user/usys.pl</code> 和 <code>user/user.h</code> 中添加条目，并在 <code>kernel/sysfile.c</code> 中实现 <code>sys_symlink</code>。（不记得的强烈建议重新去看一下 Lab Syscall）</li>\n<li>向 <code>kernel/stat.h</code> 中添加一个新的文件类型 <code>T_SYMLINK</code>，以表示符号链接。</li>\n<li>我们需要在 <code>kernel/fcntl.h</code> 中添加一个新的标志 <code>O_NOFOLLOW</code>，我们可以与 <code>open</code> 系统调用一起使用。请注意，传递给 <code>open</code> 的标志是按照位检测的，所以新标志不应当与现有的标志位重叠。在添加标志位之后，只要我们将 <code>symlinktest</code> 加入到 Makefile 中，<code>user/symlinktest.c</code> 就可以顺利通过编译。</li>\n<li>我们将实现 <code>symlink(target, path)</code> 系统调用，在指定目录下创建一个指向目标的新符号链接。需要注意的是，系统调用的成功并不需要目标的存在。因此，我们需要选择一个地方来存储符号链接的目标路径（例如，在 inode 下的数据块中）。最后 <code>symlink</code> 应当返回一个整数，代表成功（0）或者失败（-1），类似于 <code>link</code> 和 <code>unlink</code>。</li>\n<li>我们需要修改 <code>open</code> 系统调用，以处理路径指向符号链接的情况。如果该文件不存在，<code>open</code> 系统调用需要返回失败。当一个进程在打开标志中指定 <code>O_NOFOLLOW</code> 标志位时，<code>open</code> 应当打开链接（但不跟踪符号链接）。</li>\n<li>如果被链接的文件也是一个符号链接，我们必须递归地跟踪他，直到到达一个非链接文件。如果链接形成了一个循环，我们需要返回一个错误代码。我们也可以提前设定一个阈值（例如 10），当链接的深度到达阈值就返回错误代码来近似地处理这个问题。</li>\n<li>其他系统调用（例如 <code>link</code> 和 <code>unlink</code>）则不能跟踪符号链接，这些系统调用只能操作符号链接本身。</li>\n<li>在这个 Lab 中，我们不需要处理指向文件夹的符号链接。</li>\n</ul>\n<h4 id=\"题解-7\"><a href=\"#题解-7\" class=\"headerlink\" title=\"题解\"></a>题解</h4><ol>\n<li>首先是设置symlin，这个之前就讲了很多就不在讲了</li>\n<li>之后添加文件类型</li>\n<li>然后对symlink进行实现，得到两个str</li>\n<li>通过create来进行穿件文件类型，之后就是写入targetpath到这个inode里面</li>\n<li>之后对open操作，进行修改，加入判断是不是软连接，然后次数要不要进行递归</li>\n</ol>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uint64 <span class=\"title function_\">sys_symlink</span><span class=\"params\">(<span class=\"type\">void</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">inode</span> *<span class=\"title\">ip</span>;</span></span><br><span class=\"line\">  <span class=\"type\">char</span> target[MAXPATH], path[MAXPATH];</span><br><span class=\"line\">  <span class=\"type\">int</span> n;</span><br><span class=\"line\">  <span class=\"comment\">// Get params from user space</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>((n = argstr(<span class=\"number\">0</span>, target, MAXPATH)) &lt; <span class=\"number\">0</span> || argstr(<span class=\"number\">1</span>, path, MAXPATH) &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  begin_op();</span><br><span class=\"line\">  <span class=\"comment\">// Create inode of the symlink</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>((ip = create(path, T_SYMLINK, <span class=\"number\">0</span>, <span class=\"number\">0</span>)) == <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    end_op();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// Save the target path to the first data block</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(writei(ip, <span class=\"number\">0</span>, (uint64)target, <span class=\"number\">0</span>, n) != n) &#123;</span><br><span class=\"line\">    iunlockput(ip);</span><br><span class=\"line\">    end_op();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  iunlockput(ip);</span><br><span class=\"line\">  end_op();</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>(ip-&gt;type == T_SYMLINK &amp;&amp; !(omode &amp; O_NOFOLLOW))&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> depth = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// Follow the symlink recursively</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(ip-&gt;type == T_SYMLINK)&#123;</span><br><span class=\"line\">      <span class=\"comment\">// Return failure if max recursive depth exceeded</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>(++depth == MAX_SYMLINK_DEPTH)&#123;</span><br><span class=\"line\">        iunlockput(ip);</span><br><span class=\"line\">        end_op();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// Else read new target path from current symlink inode</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>(readi(ip, <span class=\"number\">0</span>, (uint64)path, <span class=\"number\">0</span>, MAXPATH) &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        iunlockput(ip);</span><br><span class=\"line\">        end_op();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      iunlockput(ip);</span><br><span class=\"line\">      <span class=\"comment\">// Check if target is valid</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>((ip = namei(path)) == <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        end_op();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>; <span class=\"comment\">// target not exist</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      ilock(ip);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"总结-3\"><a href=\"#总结-3\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>终于写完大部分的6.s081，从4月份开始写，一直拖到现在，才填完坑。羞愧。中间一个月去复习软考了。</p>\n<p>本身自己是非科班跨考408的，对于操作系统还有计算机组成都只停留在背诵还有做题阶段。对原理却是什么都不知道。</p>\n<p>当第一次写第一个作业的时候，我连如何使用ide来辅助编写代码都不会。文件是make文件，我之前之后使用集成IDE来进行一键编译调试，但是第一次我都不知道如何进行调试代码，看着视频里的教授使用gdb调试代码。我都不知道这到底是怎么实现的。</p>\n<p>我只好从网上搜索vscode调试6.s081.但是大多数人都知识给了一个一个task还有一个launch.json没有解释是为什么可以调试成功。然后直接复制粘贴进行运行，按住f5来进行调试，再加上前面的题目我几乎都没有自己思考的过程，于是5月份我就准备软考，没有接着写了。</p>\n<p>6月份，考完之后，我有重新开始把这之前了题目在做一遍。同时，我具体进行了研究一下，vscode的两个json文件到底是干什么。首先第一个task，顾名思义就是你自己想要进行的任务操作，例如编译就可以是gcc a.c -o a.out直接进行简化，相当于配置好了手动输入的麻烦。接下来的launch.json才是重点</p>\n<p>，我们可以设置gdb来进行调试，调试的文件是kernel（因为操作系统最开始初始化的文件就是kernel，首先进行内存加载</p>\n<p>，之后设置远程调用gdb，这个是作业里面教授设置的，然后就可以按住f5来进行调试。相当于真正的启动程序。注意还需要我们手动输入make qemu-gdb在命令行。这个任务正好可以被我之前讲解的task来解决，我们只要在task新加一个任务输入 make就行。到这里才真正明白是如何进行调试gdb的。</p>\n<p>之后差不多到了那种全忘了的境界，然后去上考场，重新写入题目，可能也是因为软考也复习了一下操作系统吧，做起题目来，比之前好多了，之前没有理解的视频也逐渐就豁然开朗的感觉，重新做会题目前4个，就感觉很快。后面的文件部分，就做的比较慢一点，可能是当初也没复习好文件。</p>\n<p>总的来说xv6这个操作系统还是让我对内，存加载，页表操作，陷入内核态，进程切换，这些概念有实打实的认识。不想之前学408只知道什么调度算法，什么直接相连，全相连这种概念性的东西对整个操作系统如何启动，如何使用系统调用，程序如何中断，为什么要换页，出现page falut，还有如何进行线程切换都有了一个打字的了解，可能果断时间就会网络吧。所以记录一下。</p>\n<p>最后感谢，网络上这些大佬的题解，不然，我几乎就就有可能放弃了，有些 题目都是参考大佬的题解才实现的。</p>\n<p><a href=\"https://blog.rayzhang.top/\">Ray’s Blog - Welcome to my space btw~ (rayzhang.top)</a></p>\n<p><a href=\"https://www.zhihu.com/people/wan2njupt/posts\">(54 封私信 &#x2F; 81 条消息) 士全 - 知乎 (zhihu.com)</a></p>\n","tags":[{"name":"操作系统","slug":"操作系统","permalink":"http://yoursite.com/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"},{"name":"公开课","slug":"公开课","permalink":"http://yoursite.com/tags/%E5%85%AC%E5%BC%80%E8%AF%BE/"}]},{"title":"深度学习代码小结","date":"2023-03-16T12:03:58.000Z","path":"2023/03/16/深度学习代码小结/","content":"<h1 id=\"0-预备知识\"><a href=\"#0-预备知识\" class=\"headerlink\" title=\"0.预备知识\"></a>0.预备知识</h1><p>收先我们知道，一般大型公司都有一台机器才能够外网访问，其他机器都只能访问内网，我们把进行外网访问的机器称为跳板机，他的作用就是，我们通过这个机器来远程俩连接到内网的跳板机，然后再这个跳板机上进行连接到真正的内网机器。我们可以使用端口转发，ssh -N来进行转发内网得到机器端口到本地的机器端口，可以转发内网机器node5的端口准发到我自己的windows的 10086端口，字样，我们如果需要连接到内网的机器node5，就不需要通过跳板机连接。<strong>注意，如果需要使用之恩重方案，一般都需要把自己的公钥上传到跳板机还有内网机器上的authority——key’才可以，等待我们自己的机器进行重亲就可以</strong>。以后我们只需要下面代码就可以连接node5机器</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh -p 1008600 root@localhost</span><br></pre></td></tr></table></figure>\n\n<p>本文是首先讲解的是如何进行远程连接，所以作为预备知识。目前远程连接主要是是使用以下两种方案，一种是vscode的 remote ssh还有一种是使用jetbrain 的gateway。下面介绍这两种方案：</p>\n<p>1.vscode进行连接.我们只需要在上面我们已近做好的内网转发上面，进行新建一个vscode远程连接，输入我们 远程连接的上述代码，然后选择我们需要的项目目录就可以了。此时，我们还需要进行设置python解释器，我们一般都是使用自己的虚拟环境，我们我们找到自己虚拟环境所在的vene包里面，然后进行选择到python，就可以了，</p>\n<p>主要优点：连接消耗的内存就比较少，但是代码补全还有debug能力不如gateway。一般我们可以直接在vscode进行修改，然后直接在windterm里面来进行执行代码，使用screen</p>\n<p>2.使用gateway，这个就是jetbrain推出的远程pycharm，可以这么理解，相当于，我们前端只是进行修改 代码，但是真正的操作都是在服务器的后端服务器上，只不过，这个gateway也还是需要授权才可以使用的，我使用的是教育邮箱，所以可以进行使用。</p>\n<p>优点：和我们之前在自己电脑使用pycharm一样，但是由于使用的是远程连接，会造成服务器不稳定，偶尔出现多次断链的情况，也会出现卡死服务器cpu的情况。但是一般都是比较正常（推荐使用gateway）</p>\n<h1 id=\"1-datasets方面\"><a href=\"#1-datasets方面\" class=\"headerlink\" title=\"1.datasets方面\"></a>1.datasets方面</h1><p>深度学习的第一步就是学习如何写数据集,对于深度学习现在已经变成搭积木的游戏,我们只需要根据之前的官网文件,来对我们的自定义我们的数据集，我们只有知道我们的输入输出后，才可以定制自己的模型。由于我们的是分类模型，所以我们的输入是图片的tensor，输出是图片的类型，使用数字就可以。</p>\n<p>对于这个数据集获取器，我们可以使用继承nn的datasets来实现，需要我们写的只有三个函数，一个init，一个len，还有一个getitem。</p>\n<p>下面是通用得到实现方法：</p>\n<blockquote>\n<p>在此之前我们自己制作一个通用的csv，奇艺列是图片的地址，第二列就是属性值，我们的dataset就只需要从csv来读取图片还有表示，就可以了，主要使用load——csv来进行读取csv</p>\n</blockquote>\n<ol>\n<li>首先写init，需要传入的参数有，resize，mode，path，三个是图片的大小，当前是什么模式，还有一个是csv存在的地址，之后我们就进行切割数据集，使用6:2:2来进行切分，主要思路，就是把从loadcsv得到完整的列表，然后进行切分</li>\n<li>之后就是getitem，我们只需要按照给定的idx，返回对应的图片还有属性值就可以，一般transform可以在外面写好，也可以在dataset你写好，使用transform来进行组合所需要的操作，然后对图片来进行执行就可以了，最后返回图片还有属性值</li>\n<li>返回len只需要返回图片列表长度就可以</li>\n</ol>\n<p>这是最简单的dataset，我们只需要想明白我们需要的输入还有输出到底是什么就可以了，然后重点就是如何得到这个csv表格，我们可以使用os还有glob这些包来进行对文件夹操作，然后放入到csv里面</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\t\t</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">\tself.resize = resize</span><br><span class=\"line\">    self.mode = mode</span><br><span class=\"line\">    self.cur_images ,self.syn_images,self.labels = self.load_csv(<span class=\"string\">&#x27;./p2p.csv&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#划分训练集</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> mode == <span class=\"string\">&quot;train&quot;</span>:</span><br><span class=\"line\">        self.cur_images = self.cur_images[:<span class=\"built_in\">int</span>(<span class=\"number\">0.6</span> * <span class=\"built_in\">len</span>(self.cur_images))]</span><br><span class=\"line\">        self.syn_images = self.syn_images[:<span class=\"built_in\">int</span>(<span class=\"number\">0.6</span> * <span class=\"built_in\">len</span>(self.syn_images))]</span><br><span class=\"line\">        self.labels = self.labels[:<span class=\"built_in\">int</span>(<span class=\"number\">0.6</span> * <span class=\"built_in\">len</span>(self.labels))]</span><br><span class=\"line\">    <span class=\"keyword\">elif</span> mode == <span class=\"string\">&#x27;val&#x27;</span>:  <span class=\"comment\"># 20% = 60%-&gt;80%</span></span><br><span class=\"line\">        self.cur_images = self.cur_images[<span class=\"built_in\">int</span>(<span class=\"number\">0.6</span> * <span class=\"built_in\">len</span>(self.cur_images)):<span class=\"built_in\">int</span>(<span class=\"number\">0.8</span> * <span class=\"built_in\">len</span>(self.cur_images))]</span><br><span class=\"line\">        self.syn_images = self.syn_images[<span class=\"built_in\">int</span>(<span class=\"number\">0.6</span> * <span class=\"built_in\">len</span>(self.syn_images)):<span class=\"built_in\">int</span>(<span class=\"number\">0.8</span> * <span class=\"built_in\">len</span>(self.syn_images))]</span><br><span class=\"line\">        self.labels = self.labels[<span class=\"built_in\">int</span>(<span class=\"number\">0.6</span> * <span class=\"built_in\">len</span>(self.labels)):<span class=\"built_in\">int</span>(<span class=\"number\">0.8</span> * <span class=\"built_in\">len</span>(self.labels))]</span><br><span class=\"line\">    <span class=\"keyword\">elif</span> mode == <span class=\"string\">&#x27;test&#x27;</span>:  <span class=\"comment\"># 20% = 80%-&gt;9999%</span></span><br><span class=\"line\">        self.cur_images = self.cur_images[<span class=\"built_in\">int</span>(<span class=\"number\">0.8</span> * <span class=\"built_in\">len</span>(self.cur_images)):<span class=\"built_in\">int</span>(<span class=\"number\">0.99999</span> * <span class=\"built_in\">len</span>(self.cur_images))]</span><br><span class=\"line\">        self.syn_images = self.syn_images[<span class=\"built_in\">int</span>(<span class=\"number\">0.8</span> * <span class=\"built_in\">len</span>(self.syn_images)):<span class=\"built_in\">int</span>(<span class=\"number\">0.99999</span> * <span class=\"built_in\">len</span>(self.syn_images))]</span><br><span class=\"line\">        self.labels = self.labels[<span class=\"built_in\">int</span>(<span class=\"number\">0.8</span> * <span class=\"built_in\">len</span>(self.labels)):<span class=\"built_in\">int</span>(<span class=\"number\">0.99999</span> * <span class=\"built_in\">len</span>(self.labels))]</span><br><span class=\"line\">        </span><br><span class=\"line\">        </span><br><span class=\"line\">         <span class=\"keyword\">def</span> <span class=\"title function_\">load_csv</span>(<span class=\"params\">self, data_csv</span>):</span><br><span class=\"line\">    cur_img = []</span><br><span class=\"line\">    syn_img = []</span><br><span class=\"line\">    labels = []</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(data_csv, <span class=\"string\">&#x27;r&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        reader = csv.reader(f)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> reader:</span><br><span class=\"line\">            old, new, label = row</span><br><span class=\"line\">            label = <span class=\"built_in\">int</span>(label)</span><br><span class=\"line\">            cur_img.append(old)</span><br><span class=\"line\">            syn_img.append(new)</span><br><span class=\"line\">            labels.append(label)</span><br><span class=\"line\">    <span class=\"keyword\">assert</span> <span class=\"built_in\">len</span>(syn_img) == <span class=\"built_in\">len</span>(cur_img)</span><br><span class=\"line\">    <span class=\"keyword\">assert</span> <span class=\"built_in\">len</span>(labels) == <span class=\"built_in\">len</span>(syn_img)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cur_img, syn_img, labels</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">__len__</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">len</span>(self.labels)</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">__getitem__</span>(<span class=\"params\">self, idx</span>):</span><br><span class=\"line\">    img, syn_image,label = self.cur_images[idx],self.syn_images[idx], self.labels[idx]</span><br><span class=\"line\"></span><br><span class=\"line\">    tf_cnn = transforms.Compose([</span><br><span class=\"line\">        <span class=\"keyword\">lambda</span> x:Image.<span class=\"built_in\">open</span>(x).convert(<span class=\"string\">&#x27;RGB&#x27;</span>),  <span class=\"comment\"># string path= &gt; image data</span></span><br><span class=\"line\">        transforms.Resize((<span class=\"built_in\">int</span>(self.resize*<span class=\"number\">1.25</span>), <span class=\"built_in\">int</span>(self.resize*<span class=\"number\">1.25</span>))),</span><br><span class=\"line\">        transforms.RandomRotation(<span class=\"number\">15</span>),</span><br><span class=\"line\">        transforms.CenterCrop(self.resize),</span><br><span class=\"line\">        transforms.ToTensor(),</span><br><span class=\"line\">        transforms.Normalize(mean=[<span class=\"number\">0.485</span>, <span class=\"number\">0.456</span>, <span class=\"number\">0.406</span>],</span><br><span class=\"line\">                             std=[<span class=\"number\">0.229</span>, <span class=\"number\">0.224</span>, <span class=\"number\">0.225</span>])</span><br><span class=\"line\">    ])</span><br><span class=\"line\">    tf_swin = transforms.Compose([</span><br><span class=\"line\">        <span class=\"keyword\">lambda</span> x: Image.<span class=\"built_in\">open</span>(x).convert(<span class=\"string\">&#x27;RGB&#x27;</span>),  <span class=\"comment\"># string path= &gt; image data</span></span><br><span class=\"line\">        transforms.Resize((<span class=\"built_in\">int</span>(<span class=\"number\">256</span>), <span class=\"built_in\">int</span>(<span class=\"number\">256</span>))),</span><br><span class=\"line\"></span><br><span class=\"line\">        transforms.ToTensor(),</span><br><span class=\"line\">        transforms.Normalize(mean=[<span class=\"number\">0.485</span>, <span class=\"number\">0.456</span>, <span class=\"number\">0.406</span>],</span><br><span class=\"line\">                             std=[<span class=\"number\">0.229</span>, <span class=\"number\">0.224</span>, <span class=\"number\">0.225</span>])</span><br><span class=\"line\">    ])</span><br><span class=\"line\">    img = tf_cnn(img)</span><br><span class=\"line\">    syn_image1 = tf_cnn(syn_image)</span><br><span class=\"line\">    syn_swin = tf_swin(syn_image)</span><br><span class=\"line\">    label = torch.tensor(label)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> img,syn_image1,syn_swin,label</span><br><span class=\"line\">        </span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"2-模型方面\"><a href=\"#2-模型方面\" class=\"headerlink\" title=\"2.模型方面\"></a>2.模型方面</h1><p>模型方面，我改的比较少，只能说还是需要两个，一个是forward函数，一个init来进行初始化，我们在init进行设置所需要的cnn，fc层，设计模型架构，然后再forward里面来进行传入图片，吧图片在上面的架构走一次，我们就得到模型所产生的结果了。这个地方改的不是很多，需要日后来讲解。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">def forward(self, x_old, x_new):</span><br><span class=\"line\">    x_old = self.old_features(x_old)</span><br><span class=\"line\">    x_new = self.new_features(x_new)</span><br><span class=\"line\">    x = x_old + x_new</span><br><span class=\"line\">    heads = []</span><br><span class=\"line\">    for i in range(self.num_head):</span><br><span class=\"line\">        heads.append(getattr(self, &quot;cat_head%d&quot; % i)(x))</span><br><span class=\"line\"></span><br><span class=\"line\">    heads = torch.stack(heads).permute([1, 0, 2])</span><br><span class=\"line\">    if heads.size(1) &gt; 1:</span><br><span class=\"line\">        heads = F.log_softmax(heads, dim=1)</span><br><span class=\"line\"></span><br><span class=\"line\">    out = self.fc(heads.sum(dim=1))</span><br><span class=\"line\">    out = self.bn(out)</span><br><span class=\"line\"></span><br><span class=\"line\">    return out, x, heads</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h1 id=\"3-train方面\"><a href=\"#3-train方面\" class=\"headerlink\" title=\"3.train方面\"></a>3.train方面</h1><p>train方面这个代码是需要我自己来进行重构的，耦合比较严重。</p>\n<h2 id=\"3-1参数解析\"><a href=\"#3-1参数解析\" class=\"headerlink\" title=\"3.1参数解析\"></a>3.1参数解析</h2><p>首先就是设置相关的参数使用argparser来进行设置，一般我都是直接抄之前的代码，资格不需要自己修改，可以直接看绵绵这个，这个就是我们在服务器你启动代码所需在后面进行添加的参数</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_args_parser</span>():</span><br><span class=\"line\">    parser = argparse.ArgumentParser(<span class=\"string\">&#x27;MAE pre-training&#x27;</span>, add_help=<span class=\"literal\">False</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--batch_size&#x27;</span>, default=<span class=\"number\">200</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">int</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;Batch size per GPU (effective batch size is batch_size * accum_iter * # gpus&#x27;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--epochs&#x27;</span>, default=<span class=\"number\">200</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">int</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--accum_iter&#x27;</span>, default=<span class=\"number\">1</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">int</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;Accumulate gradient iterations (for increasing the effective batch size under memory &#x27;</span></span><br><span class=\"line\">                             <span class=\"string\">&#x27;constraints)&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Model parameters</span></span><br><span class=\"line\">    <span class=\"comment\"># parser.add_argument(&#x27;--model&#x27;, default=&#x27;mae_vit_large_patch16&#x27;, type=str, metavar=&#x27;MODEL&#x27;,</span></span><br><span class=\"line\">    <span class=\"comment\">#                     help=&#x27;Name of model to train&#x27;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--input_size&#x27;</span>, default=<span class=\"number\">224</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">int</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;images input size&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Optimizer parameters</span></span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--weight_decay&#x27;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">float</span>, default=<span class=\"number\">0.0001</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;weight decay (default: 0.05)&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--lr&#x27;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">float</span>, default=<span class=\"number\">0.0001</span>, metavar=<span class=\"string\">&#x27;LR&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;learning rate (absolute lr)&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--warmup_epochs&#x27;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">int</span>, default=<span class=\"number\">40</span>, metavar=<span class=\"string\">&#x27;N&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;epochs to warmup LR&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Dataset parameters</span></span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--root_path&#x27;</span>, default=<span class=\"string\">&#x27;/home/tonnn/.nas/weijia/datasets/face_dataset/Oulu_CASIA_NIR_VIS/NI&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">type</span>=<span class=\"built_in\">str</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;dataset path&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--output_dir&#x27;</span>, default=<span class=\"string\">&#x27;./output_dir&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;path where to save, empty for no saving&#x27;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--pth_path&#x27;</span>, default=<span class=\"string\">&#x27;./checkpoint/image1k/accuracy_loss_change_train_2.pth&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;path where to save, empty for no saving&#x27;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--log_dir&#x27;</span>, default=<span class=\"string\">&#x27;./output_dir&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;path where to tensorboard log&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 自定义的模型加载</span></span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--seed&#x27;</span>, default=<span class=\"number\">3407</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">int</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--resume&#x27;</span>, default=<span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;resume from checkpoint&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--start_epoch&#x27;</span>, default=<span class=\"number\">77</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">int</span>, metavar=<span class=\"string\">&#x27;N&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;start epoch&#x27;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--num_workers&#x27;</span>, default=<span class=\"number\">8</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">int</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--pin_memory&#x27;</span>, action=<span class=\"string\">&#x27;store_true&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;Pin CPU memory in DataLoader for more efficient (sometimes) transfer to GPU.&#x27;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--no_pin_mem&#x27;</span>, action=<span class=\"string\">&#x27;store_false&#x27;</span>, dest=<span class=\"string\">&#x27;pin_mem&#x27;</span>)</span><br><span class=\"line\">    parser.set_defaults(pin_mem=<span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># distributed training parameters</span></span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--world_size&#x27;</span>, default=<span class=\"number\">1</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">int</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;number of distributed processes&#x27;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--local_rank&#x27;</span>, default=-<span class=\"number\">1</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">int</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--dist_on_itp&#x27;</span>, action=<span class=\"string\">&#x27;store_true&#x27;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;--dist_url&#x27;</span>, default=<span class=\"string\">&#x27;env://&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"built_in\">help</span>=<span class=\"string\">&#x27;url used to set up distributed training&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> parser</span><br></pre></td></tr></table></figure>\n\n<p>上面就是需要的参数，我们可以对着上面来修改epoch还有学习率等其他内容，还有resume等，来进行加载</p>\n<h2 id=\"3-2构建数据集\"><a href=\"#3-2构建数据集\" class=\"headerlink\" title=\"3.2构建数据集\"></a>3.2构建数据集</h2><p>我们使用函数来进行抽取构建数据集这个操作，这样，我们以后更换数据集，只需要更改build’datasest就可以了，方法还是和之前一样的</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">build_datasets</span>(<span class=\"params\">mode, args</span>):</span><br><span class=\"line\">    dataset = FaceEmotionRecognize(args.root_path, args.input_size, mode)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> dataset</span><br></pre></td></tr></table></figure>\n\n<p>上面那个face可以换成其他任意的dataset</p>\n<h2 id=\"3-3分布式训练\"><a href=\"#3-3分布式训练\" class=\"headerlink\" title=\"3.3分布式训练\"></a>3.3分布式训练</h2><p>我们首先是需要把os的enviroment环境设置为0,1表示是在两个显卡上进行训练，之后我们还需要使用dataparallel还有cuda，来把模型传入到显卡上面</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  </span><br><span class=\"line\">os.environ[<span class=\"string\">&#x27;CUDA_VISIBLE_DEVICES&#x27;</span>] = <span class=\"string\">&#x27;0,1&#x27;</span></span><br><span class=\"line\">model_swin = nn.DataParallel(model_swin)</span><br><span class=\"line\">model_swin = model_swin.cuda()</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"3-3main函数的构建\"><a href=\"#3-3main函数的构建\" class=\"headerlink\" title=\"3.3main函数的构建\"></a>3.3main函数的构建</h2><p>main函数主要写的是整体流程，我们首先是是来进行构建数据集还有dataloader，对于train，我们一般使用shuffle，对于val，我们一般是使用不进行shuffle的。</p>\n<p>之后就是进行构建模型，这一步，下一步就是进行设置loss函数我们一般使用交叉熵就可以了，然后之后就是使用优化器来优化模型，一般使用adam还有sgd，<strong>注意我们需要把模型的参数全部传入到优化器上面才可以（对于想cyclegan’这种，需要联合有何的参数，我们使用uitertools来进行连接两个模型的参数，到这个尤其来进行优化</strong></p>\n<p>之后就是来进行构建tensorboard，我们需要来构建tensorboard所在文件目录，之后就是设置log，还有度量值，这个我们直接使用util来进行设置（不用自己写）</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">   os.makedirs(args.log_dir, exist_ok=<span class=\"literal\">True</span>)</span><br><span class=\"line\">        log_writer = SummaryWriter(log_dir=args.log_dir)</span><br><span class=\"line\">        loss_scaler = NativeScaler()</span><br><span class=\"line\"><span class=\"comment\">#加载模型</span></span><br><span class=\"line\">misc.load_model(args=args, model_without_ddp=model, optimizer=optimizer, loss_scaler=loss_scaler)</span><br></pre></td></tr></table></figure>\n\n<p>下一步就是加载模型，也是使用何开明写好的直接进行加载，我们只需要传入模型，优化器，还有记录的scaler</p>\n<p>这一步是我直接把模型进行保存了，然后直接使用load就可以加载出模型，之后我们还是需要把模型移动到显卡上面</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pth_path = <span class=\"string\">&#x27;./checkpoint/swin2_base/accuracy_loss_change_train_11cnn.pth&#x27;</span></span><br><span class=\"line\">   <span class=\"comment\"># pth_path = args.pth_path</span></span><br><span class=\"line\">   <span class=\"comment\"># model = resnet18(pretrained=False)</span></span><br><span class=\"line\">   model_cnn = torch.load(pth_path)</span><br></pre></td></tr></table></figure>\n\n\n\n<p>对于加载好的模型，我们想修改值的话，可以修改最后一层的圈连接层，对于前面的层数我们全部保留，最后一层的fc，我们来使用linear来进行修改就可以</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model_conv = convnext_tiny(pretrained=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"comment\"># print(model_conv.head.fc.in_features)</span></span><br><span class=\"line\">    <span class=\"comment\"># exit()</span></span><br><span class=\"line\">    model_conv_ftrs = model_conv.head.fc.in_features</span><br><span class=\"line\">    model_conv.head.fc = nn.Linear(model_conv_ftrs,<span class=\"number\">6</span>)</span><br></pre></td></tr></table></figure>\n\n<p>之后就是开始for epoch，首先我们进入到验证阶段</p>\n<ol>\n<li>我们第一步就是设置模型为eval模式，</li>\n<li>然后进入到验证阶段，传入的是数据集，还有模型</li>\n<li>返回的就是记录的misc，之后我们对记录的值，传入到log里面，让他写入到tensorboard里面</li>\n</ol>\n<p>之后我们就是进行train模式，对于train模式，我们首先就是把model的train来进行打开</p>\n<ol>\n<li>传入大还是模型，数据集，还有loss，优化器，log直接在train里面记录到tensor里面</li>\n</ol>\n<h3 id=\"3-3-1验证阶段代码\"><a href=\"#3-3-1验证阶段代码\" class=\"headerlink\" title=\"3.3.1验证阶段代码\"></a>3.3.1验证阶段代码</h3><p>这一步，我们需要设置为torch nograd才可以进行操作，下面是需要学习的，使用装饰器进行让代码处于在nograd状态下，使用misc来进行记录，接下来就是开始进行评估，得到图像还有属性，传入到显卡上面，使用model来得到结果，之后就是使用soft来得到最大的值（这个就是可能的属性），然后就是top1，top5的计算这个直接使用timm的库可以计算。</p>\n<p>之后就是记录在tensorboard里面，记录loss还有acc1还有acc5</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">criterion = torch.nn.CrossEntropyLoss()</span><br><span class=\"line\"></span><br><span class=\"line\">   metric_logger = misc.MetricLogger(delimiter=<span class=\"string\">&quot; &quot;</span>)</span><br><span class=\"line\">   header = <span class=\"string\">&quot;Test:&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\"># 转入到评测模式</span></span><br><span class=\"line\">   model.<span class=\"built_in\">eval</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">for</span> batch <span class=\"keyword\">in</span> metric_logger.log_every(data_loader, <span class=\"number\">10</span>, header):</span><br><span class=\"line\">       images = batch[<span class=\"number\">0</span>]</span><br><span class=\"line\">       target = batch[-<span class=\"number\">1</span>]</span><br><span class=\"line\">       images = images.to(device, non_blocking=<span class=\"literal\">True</span>)</span><br><span class=\"line\">       target = target.to(device, non_blocking=<span class=\"literal\">True</span>)</span><br><span class=\"line\">       <span class=\"comment\"># 计算loss，统计得分</span></span><br><span class=\"line\">       <span class=\"keyword\">with</span> torch.no_grad():</span><br><span class=\"line\">           output = model(images)</span><br><span class=\"line\">           loss = criterion(output, target)</span><br><span class=\"line\"></span><br><span class=\"line\">       output = torch.nn.functional.softmax(output, dim=<span class=\"number\">1</span>)</span><br><span class=\"line\">       acc1, acc5 = accuracy(output, target, topk=(<span class=\"number\">1</span>, <span class=\"number\">5</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">       batch_size = images.shape[<span class=\"number\">0</span>]</span><br><span class=\"line\">       <span class=\"comment\"># 写下在tensorboard</span></span><br><span class=\"line\">       metric_logger.update(loss=loss.item())</span><br><span class=\"line\">       metric_logger.meters[<span class=\"string\">&#x27;acc1&#x27;</span>].update(acc1.item(), n=batch_size)</span><br><span class=\"line\">       metric_logger.meters[<span class=\"string\">&#x27;acc5&#x27;</span>].update(acc5.item(), n=batch_size)</span><br><span class=\"line\">       </span><br><span class=\"line\">        metric_logger.synchronize_between_processes()</span><br><span class=\"line\">   <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;acc1:<span class=\"subst\">&#123;metric_logger.acc1&#125;</span>, acc5:<span class=\"subst\">&#123;metric_logger.acc5&#125;</span>&#x27;</span>)</span><br><span class=\"line\">   <span class=\"comment\"># return &#123;k: meter.global_avg for k, meter in metric_logger.items()&#125;</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> &#123;k: meter.global_avg <span class=\"keyword\">for</span> k, meter <span class=\"keyword\">in</span> metric_logger.meters.items()&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>返回的是misc记录的</p>\n<h3 id=\"3-3-2训练函数代码\"><a href=\"#3-3-2训练函数代码\" class=\"headerlink\" title=\"3.3.2训练函数代码\"></a>3.3.2训练函数代码</h3><p>首先是和之前一样的，把图片还有属性传入到显卡上面，之后使用模型来进行预测，然后设置优化器，之后就是计算交叉熵，迭代次数一般是在batch开始来进行zero_grad，这个修改的我有点看不懂，应该是在求loss的时候就进行更新。</p>\n<p>最后一步就是log来进行就misc</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16789737524861678973751741.png\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">train_one_epoch</span>(<span class=\"params\">model: torch.nn.Module, criterion: torch.nn.Module,</span></span><br><span class=\"line\"><span class=\"params\">                    data_loader: Iterable, optimizer: torch.optim.Optimizer,</span></span><br><span class=\"line\"><span class=\"params\">                    device: torch.device, epoch: <span class=\"built_in\">int</span>, loss_scaler, max_norm: <span class=\"built_in\">float</span> = <span class=\"number\">0</span>, log_writer=<span class=\"literal\">None</span>,</span></span><br><span class=\"line\"><span class=\"params\">                    args=<span class=\"literal\">None</span></span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> log_writer <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;log_dir <span class=\"subst\">&#123;log_writer.log_dir&#125;</span>&#x27;</span>)</span><br><span class=\"line\">    model.train(<span class=\"literal\">True</span>)</span><br><span class=\"line\">    print_feq = <span class=\"number\">2</span></span><br><span class=\"line\">    accum_iter = args.accum_iter</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> data_iter_step, (samples, targets) <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(data_loader):</span><br><span class=\"line\">        samples = samples.to(device, non_blocking=<span class=\"literal\">True</span>)</span><br><span class=\"line\">        targets = targets.to(device, non_blocking=<span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        output = model(samples)</span><br><span class=\"line\"></span><br><span class=\"line\">        warmup_lr = args.lr</span><br><span class=\"line\">        optimizer.param_groups[<span class=\"number\">0</span>][<span class=\"string\">&quot;lr&quot;</span>] = warmup_lr</span><br><span class=\"line\"></span><br><span class=\"line\">        loss = criterion(output, targets)</span><br><span class=\"line\">        loss /= accum_iter</span><br><span class=\"line\"></span><br><span class=\"line\">        loss_scaler(loss, optimizer, clip_grad=max_norm,</span><br><span class=\"line\">                    parameters=model.parameters(), create_graph=<span class=\"literal\">False</span>,</span><br><span class=\"line\">                    update_grad=(data_iter_step + <span class=\"number\">1</span>) % accum_iter == <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        loss_val = loss.item()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 完成一次epoch就进行置为，走</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (data_iter_step + <span class=\"number\">1</span>) % accum_iter == <span class=\"number\">0</span>:</span><br><span class=\"line\">            optimizer.zero_grad()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> math.isfinite(loss_val):</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;loss is <span class=\"subst\">&#123;loss_val&#125;</span> &amp; stop training&quot;</span>)</span><br><span class=\"line\">            sys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> log_writer <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span> <span class=\"keyword\">and</span> (data_iter_step + <span class=\"number\">1</span>) % accum_iter == <span class=\"number\">0</span>:</span><br><span class=\"line\">            epoch_1000x = <span class=\"built_in\">int</span>((data_iter_step / <span class=\"built_in\">len</span>(data_loader) + epoch) * <span class=\"number\">1000</span>)</span><br><span class=\"line\">            log_writer.add_scalar(<span class=\"string\">&quot;loss&quot;</span>, loss, epoch_1000x)</span><br><span class=\"line\">            log_writer.add_scalar(<span class=\"string\">&quot;lr&quot;</span>, warmup_lr, epoch_1000x)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Epoch:<span class=\"subst\">&#123;epoch&#125;</span>,loss:<span class=\"subst\">&#123;loss&#125;</span>,step:<span class=\"subst\">&#123;data_iter_step&#125;</span>,lr:<span class=\"subst\">&#123;warmup_lr&#125;</span>&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># # gather the stats from all processes</span></span><br><span class=\"line\">    <span class=\"comment\"># log_writer.synchronize_between_processes()</span></span><br><span class=\"line\">    <span class=\"comment\"># print(&quot;Averaged stats:&quot;, log_writer)</span></span><br><span class=\"line\">    <span class=\"comment\"># return &#123;k: meter.global_avg for k, meter in log_writer.meters.items()&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>上面的代码逻辑，可以多次复用不同的模型</p>\n<p>如果要保存模型，使用save就可以</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> args.output_dir:</span><br><span class=\"line\">                   <span class=\"built_in\">print</span>(<span class=\"string\">&quot;saving checkpoints....&quot;</span>)</span><br><span class=\"line\">                   misc.save_model(</span><br><span class=\"line\">                       args=args, model=model, model_without_ddp=model,</span><br><span class=\"line\">                       optimizer=optimizer, epoch=epoch, loss_scaler=loss_scaler</span><br><span class=\"line\">                   )</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h1 id=\"4-test阶段\"><a href=\"#4-test阶段\" class=\"headerlink\" title=\"4.test阶段\"></a>4.test阶段</h1><p>我们可以直接仿照val阶段来进行计算，就可以，变成eval，数据放到test里面，然后使用模型来进行计算</p>\n","tags":[{"name":"深度学习","slug":"深度学习","permalink":"http://yoursite.com/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"},{"name":"pytorch","slug":"pytorch","permalink":"http://yoursite.com/tags/pytorch/"},{"name":"python","slug":"python","permalink":"http://yoursite.com/tags/python/"}]},{"title":"jvm小结","date":"2023-03-03T09:11:40.000Z","path":"2023/03/03/jvm小结/","content":"<h1 id=\"1-类文件结构详解\"><a href=\"#1-类文件结构详解\" class=\"headerlink\" title=\"1.类文件结构详解\"></a>1.类文件结构详解</h1><p><img src=\"https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/bg/desktop%E7%B1%BB%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E6%A6%82%E8%A7%88.png\"></p>\n<p>JVM只认识class文件所有的虚拟机都只支持字节码。在 Java 中，JVM 可以理解的代码就叫做<code>字节码</code>（即扩展名为 <code>.class</code> 的文件），它不面向任何特定的处理器，只面向虚拟机。而且JVM虚拟机</p>\n<p>可以说<code>.class</code>文件是不同的语言在 Java 虚拟机之间的重要桥梁，同时也是支持 Java 跨平台很重要的一个原因。</p>\n<p>所以 jvm是跨语言的平台。</p>\n<h2 id=\"1-2class类文件的结构\"><a href=\"#1-2class类文件的结构\" class=\"headerlink\" title=\"1.2class类文件的结构\"></a>1.2class类文件的结构</h2><p>主要包括魔数，class的版本号，常量池，访问标志，当前值，字段表，方法表，睡醒吧IAO</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ClassFile &#123;</span><br><span class=\"line\">    u4             magic; //Class 文件的标志</span><br><span class=\"line\">    u2             minor_version;//Class 的小版本号</span><br><span class=\"line\">    u2             major_version;//Class 的大版本号</span><br><span class=\"line\">    u2             constant_pool_count;//常量池的数量</span><br><span class=\"line\">    cp_info        constant_pool[constant_pool_count-1];//常量池</span><br><span class=\"line\">    u2             access_flags;//Class 的访问标记</span><br><span class=\"line\">    u2             this_class;//当前类</span><br><span class=\"line\">    u2             super_class;//父类</span><br><span class=\"line\">    u2             interfaces_count;//接口</span><br><span class=\"line\">    u2             interfaces[interfaces_count];//一个类可以实现多个接口</span><br><span class=\"line\">    u2             fields_count;//Class 文件的字段属性</span><br><span class=\"line\">    field_info     fields[fields_count];//一个类可以有多个字段</span><br><span class=\"line\">    u2             methods_count;//Class 文件的方法数量</span><br><span class=\"line\">    method_info    methods[methods_count];//一个类可以有个多个方法</span><br><span class=\"line\">    u2             attributes_count;//此类的属性表中的属性数</span><br><span class=\"line\">    attribute_info attributes[attributes_count];//属性表集合</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"1-2-1魔数\"><a href=\"#1-2-1魔数\" class=\"headerlink\" title=\"1.2.1魔数\"></a>1.2.1魔数</h3><p>魔数就是进行判断验证，这个文件是不是能被jvm接受的</p>\n<h3 id=\"1-2-2版本号\"><a href=\"#1-2-2版本号\" class=\"headerlink\" title=\"1.2.2版本号\"></a>1.2.2版本号</h3><p>首先是小版本号，接着就是大版本号</p>\n<h3 id=\"1-2-3常量池\"><a href=\"#1-2-3常量池\" class=\"headerlink\" title=\"1.2.3常量池\"></a>1.2.3常量池</h3><p>常量池从1开始，到n-1。</p>\n<p>常量池主要存放两大常量：字面量和符号引用。字面量比较接近于 Java 语言层面的的常量概念，如文本字符串、声明为 final 的常量值等。而符号引用则属于编译原理方面的概念。包括下面三类常量：</p>\n<ul>\n<li>类和接口的全限定名</li>\n<li>字段的名称和描述符</li>\n<li>方法的名称和描述符</li>\n</ul>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16780000496321678000048909.png\"></p>\n<p>1个word是tag，然后看不同的类型。不同的属性，有name还有length。以utf8位例子，首先是tage，接着2个word是length之后就是这些长度的byte。</p>\n<h3 id=\"1-2-4访问标志-Access-Flags\"><a href=\"#1-2-4访问标志-Access-Flags\" class=\"headerlink\" title=\"1.2.4访问标志(Access Flags)\"></a>1.2.4访问标志(Access Flags)</h3><p>这个就是来进行判断方法是不是抽象类还是公开类，或者是函数是不是抽象的，这个只需要把正确的表示，进行想或</p>\n<p><img src=\"https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-6/%E6%9F%A5%E7%9C%8B%E7%B1%BB%E7%9A%84%E8%AE%BF%E9%97%AE%E6%A0%87%E5%BF%97.png\"></p>\n<h3 id=\"1-2-5-当前类（This-Class）、父类（Super-Class）、接口（Interfaces）索引集合\"><a href=\"#1-2-5-当前类（This-Class）、父类（Super-Class）、接口（Interfaces）索引集合\" class=\"headerlink\" title=\"1.2.5 当前类（This Class）、父类（Super Class）、接口（Interfaces）索引集合\"></a>1.2.5 当前类（This Class）、父类（Super Class）、接口（Interfaces）索引集合</h3><p>顺序的</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">u2             this_class;//当前类</span><br><span class=\"line\">u2             super_class;//父类</span><br><span class=\"line\">u2             interfaces_count;//接口</span><br><span class=\"line\">u2             interfaces[interfaces_count];//一个类可以实现多个接口</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>类索引用于确定这个类的全限定名，父类索引用于确定这个类的父类的全限定名，由于 Java 语言的单继承，所以父类索引只有一个，除了 <code>java.lang.Object</code> 之外，所有的 java 类都有父类，因此除了 <code>java.lang.Object</code> 外，所有 Java 类的父类索引都不为 0。</p>\n<p>接口索引集合用来描述这个类实现了那些接口，这些被实现的接口将按 <code>implements</code> (如果这个类本身是接口的话则是<code>extends</code>) 后的接口顺序从左到右排列在接口索引集合中</p>\n<hr>\n<h3 id=\"1-2-6字段表\"><a href=\"#1-2-6字段表\" class=\"headerlink\" title=\"1.2.6字段表\"></a>1.2.6字段表</h3><p>描述的接口生命的变量。然后看他是不静态变量，类变量还是final修饰的</p>\n<p><strong>access_flags:</strong> 字段的作用域（<code>public</code> ,<code>private</code>,<code>protected</code>修饰符），是实例变量还是类变量（<code>static</code>修饰符）,可否被序列化（transient 修饰符）,可变性（final）,可见性（volatile 修饰符，是否强制从主内存读写）。</p>\n<p><strong>name_index:</strong> 对常量池的引用，表示的字段的名称；（ 从常量池检查到）</p>\n<p><strong>descriptor_index:</strong> 对常量池的引用，表示字段和方法的描述符；</p>\n<p><strong>attributes_count:</strong> 一个字段还会拥有一些额外的属性，attributes_count 存放属性的个数；</p>\n<p><strong>attributes[attributes_count]:</strong> 存放具体属性具体内容。</p>\n<h3 id=\"1-2-7方法表\"><a href=\"#1-2-7方法表\" class=\"headerlink\" title=\"1.2.7方法表\"></a>1.2.7方法表</h3><p>和字段表一样 ，不过这个就是在方法上面了，还是访问表示，名称索引，描述</p>\n<p><img src=\"https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-6/%E6%96%B9%E6%B3%95%E8%A1%A8%E7%9A%84%E7%BB%93%E6%9E%84.png\"></p>\n<h3 id=\"1-2-8属性表\"><a href=\"#1-2-8属性表\" class=\"headerlink\" title=\"1.2.8属性表\"></a>1.2.8属性表</h3><p>在 Class 文件，字段表，方法表中都可以携带自己的属性表集合，以用于描述某些场景专有的信息。与 Class 文件中其它的数据项目要求的顺序、长度和内容不同，属性表集合的限制稍微宽松一些，不再要求各个属性表具有严格的顺序，并且只要不与已有的属性名重复，任何人实现的编译器都可以向属性表中写 入自己定义的属性信息，Java 虚拟机运行时会忽略掉它不认识的属性。</p>\n<hr>\n<h2 id=\"1-3虚拟机类加载机制\"><a href=\"#1-3虚拟机类加载机制\" class=\"headerlink\" title=\"1.3虚拟机类加载机制\"></a>1.3虚拟机类加载机制</h2><p>首先记住加载流程</p>\n<p>加载-linking-初始化-使用</p>\n<h3 id=\"1-3-1加载\"><a href=\"#1-3-1加载\" class=\"headerlink\" title=\"1.3.1加载\"></a>1.3.1加载</h3><p>加载就是把磁盘上的内容存到内存上去</p>\n<p>主动加载（包括new，invoke，静态变量，使用静态方法）</p>\n<p>被动加载：初次之外都是被动</p>\n<h3 id=\"1-3-2加载过程\"><a href=\"#1-3-2加载过程\" class=\"headerlink\" title=\"1.3.2加载过程\"></a>1.3.2加载过程</h3><p>通过类的路径来获得类文件class，讲这个二进制转化俄日运行内存里面的数据结构，最后在内存生成一个对象，作为入口</p>\n<ol>\n<li>通过全类名获取定义此类的二进制字节流</li>\n<li>将字节流所代表的静态存储结构转换为方法区的运行时数据结构</li>\n<li>在内存中生成一个代表该类的 <code>Class</code> 对象，作为方法区这些数据的访问入口</li>\n</ol>\n<h3 id=\"1-3-3链接-验证\"><a href=\"#1-3-3链接-验证\" class=\"headerlink\" title=\"1.3.3链接-验证\"></a>1.3.3链接-验证</h3><p>验证代码文件是不是满足class文件的标准，还有语法验证，语义验证（本来是int类型，却是用long的方法），最后一个是符号验证（通常来讲，就是是不是访问了被进制的类，protect对象子类的）</p>\n<p><img src=\"https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-6/%E9%AA%8C%E8%AF%81%E9%98%B6%E6%AE%B5.png\"></p>\n<h3 id=\"1-3-4准备\"><a href=\"#1-3-4准备\" class=\"headerlink\" title=\"1.3.4准备\"></a>1.3.4准备</h3><p>准备阶段就是进行填入初始值，质包括被static修饰的变量，初始化为全0</p>\n<p><strong>比如我们定义了<code>public static int value=111</code> ，那么 value 变量在准备阶段的初始值就是 0 而不是 111（初始化阶段才会赋值）。（初始化为0，之后才是进行赋值）</strong></p>\n<p><strong>敞常量就是原始状态</strong></p>\n<p><strong>特殊情况：比如给 value 变量加上了 final 关键字<code>public static final int value=111</code> ，那么准备阶段 value 的值就被赋值为 111。</strong></p>\n<h3 id=\"1-3-5解析\"><a href=\"#1-3-5解析\" class=\"headerlink\" title=\"1.3.5解析\"></a>1.3.5解析</h3><p>进行减符号引用，转化为内存地址</p>\n<p>解析阶段是虚拟机将常量池内的符号引用替换为直接引用的过程。解析动作<strong>主要针对类或接口、字段、类方法、接口方法、方法类型、方法句柄和调用限定符</strong> 7 类符号引用进行。</p>\n<p>符号引用就是一组符号来描述目标，可以是任何字面量。<strong>直接引用</strong>就是直接指向目标的指针、相对偏移量或一个间接定位到目标的句柄。在程序实际运行时，只有符号引用是不够的，举个例子：在程序执行方法时，系统需要明确知道这个方法所在的位置。Java 虚拟机为每个类都准备了一张方法表来存放类中所有的方法。当需要调用一个类的方法的时候，只要知道这个方法在方法表中的偏移量就可以直接调用该方法了。通过解析操作符号引用就可以直接转变为目标方法在类中方法表的位置，从而使得方法可以被调用。</p>\n<p>综上，解析阶段是虚拟机将常量池内的符号引用替换为直接引用的过程，也就是得到类或者字段、方法在内存中的指针或者偏移量。</p>\n<p>**符号引用（如类的全限定名）解析为直接引用（类在实际内存中的地址） **</p>\n<hr>\n<h3 id=\"1-3-6类初始化\"><a href=\"#1-3-6类初始化\" class=\"headerlink\" title=\"1.3.6类初始化\"></a>1.3.6类初始化</h3><p>就是执行clinit方法</p>\n<p>在这个阶段把之前的static变量进行赋值，这个时候才会UI变成113，不是一开始就是113</p>\n<p>有静态方法就是由clint</p>\n<h3 id=\"1-3-7常用的类加载器\"><a href=\"#1-3-7常用的类加载器\" class=\"headerlink\" title=\"1.3.7常用的类加载器\"></a>1.3.7常用的类加载器</h3><p>一个最开始的bootstrap，一个ext，一个app，最低那个曾就是开始的bootstrap</p>\n<p>JVM 中内置了三个重要的 ClassLoader，除了 BootstrapClassLoader 其他类加载器均由 Java 实现且全部继承自<code>java.lang.ClassLoader</code>：</p>\n<ol>\n<li><strong>BootstrapClassLoader(启动类加载器)</strong> ：最顶层的加载类，由 C++实现，负责加载 <code>%JAVA_HOME%/lib</code>目录下的 jar 包和类或者被 <code>-Xbootclasspath</code>参数指定的路径中的所有类。</li>\n<li><strong>ExtensionClassLoader(扩展类加载器)</strong> ：主要负责加载 <code>%JRE_HOME%/lib/ext</code> 目录下的 jar 包和类，或被 <code>java.ext.dirs</code> 系统变量所指定的路径下的 jar 包。</li>\n<li><strong>AppClassLoader(应用程序类加载器)</strong> ：面向我们用户的加载器，负责加载当前应用 classpath 下的所有 jar 包和类。</li>\n</ol>\n<p>自定义只需要实现loadclass，找到这个全限定的地址的二进制</p>\n<h3 id=\"1-3-8双亲委派\"><a href=\"#1-3-8双亲委派\" class=\"headerlink\" title=\"1.3.8双亲委派\"></a>1.3.8双亲委派</h3><p>就是递归寻找，首先智商往下到达最顶层bootstrap，之后才是ext，最后才是app，看他的父类能不能处理，不能就自己进行加载</p>\n<p>除了 <code>BootstrapClassLoader</code> 其他类加载器均由 Java 实现且全部继承自<code>java.lang.ClassLoader</code>。如果我们要自定义自己的类加载器，很明显需要继承 <code>ClassLoader</code>。</p>\n<hr>\n","tags":[{"name":"面试","slug":"面试","permalink":"http://yoursite.com/tags/%E9%9D%A2%E8%AF%95/"},{"name":"jvm","slug":"jvm","permalink":"http://yoursite.com/tags/jvm/"}]},{"title":"resnet基础模型","date":"2023-02-17T09:09:49.000Z","path":"2023/02/17/resnet基础模型/","content":"<h1 id=\"1-数据集搭建\"><a href=\"#1-数据集搭建\" class=\"headerlink\" title=\"1.数据集搭建\"></a>1.数据集搭建</h1><p>使用经典的csv读取数据，然后再进行构建自己的dataset的时候，通过csv ，直接获得图片地址，使用pil来读取图像，使用int强转label（label本来是是string，通过构建字典dict来得到的）</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">__getitem__</span>(<span class=\"params\">self, idx</span>):</span><br><span class=\"line\">    img, label = self.images[idx], self.labels[idx]</span><br><span class=\"line\">    <span class=\"comment\"># 返回图像,下面的std是来自imagenet</span></span><br><span class=\"line\">    tf = transforms.Compose([</span><br><span class=\"line\">        <span class=\"keyword\">lambda</span> x: Image.<span class=\"built_in\">open</span>(x).convert(<span class=\"string\">&#x27;RGB&#x27;</span>),  <span class=\"comment\"># string path= &gt; image data</span></span><br><span class=\"line\">        transforms.Resize((<span class=\"built_in\">int</span>(self.resize * <span class=\"number\">1.25</span>), <span class=\"built_in\">int</span>(self.resize * <span class=\"number\">1.25</span>))),</span><br><span class=\"line\">        transforms.RandomRotation(<span class=\"number\">15</span>),</span><br><span class=\"line\">        transforms.CenterCrop(self.resize),</span><br><span class=\"line\">        transforms.ToTensor(),</span><br><span class=\"line\">        transforms.Normalize(mean=[<span class=\"number\">0.485</span>, <span class=\"number\">0.456</span>, <span class=\"number\">0.406</span>],</span><br><span class=\"line\">                             std=[<span class=\"number\">0.229</span>, <span class=\"number\">0.224</span>, <span class=\"number\">0.225</span>])</span><br><span class=\"line\">    ])</span><br><span class=\"line\"></span><br><span class=\"line\">    img = tf(img)</span><br><span class=\"line\">    label = torch.tensor(label)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> img, label</span><br></pre></td></tr></table></figure>\n\n\n\n<p>直接读取所有的文件，构建csv</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">make_csv</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    构建csv，返回当前路径的图片的属性</span></span><br><span class=\"line\"><span class=\"string\">    :return:</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    file_name = <span class=\"string\">&#x27;./label.csv&#x27;</span></span><br><span class=\"line\">    type_dir = glob.glob(os.path.join(self.root, <span class=\"string\">&#x27;*&#x27;</span>))</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(file_name, <span class=\"string\">&#x27;w&#x27;</span>) <span class=\"keyword\">as</span> csvfile:</span><br><span class=\"line\">        writer = csv.writer(csvfile)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> <span class=\"built_in\">type</span> <span class=\"keyword\">in</span> type_dir:</span><br><span class=\"line\">            person_dir = glob.glob(os.path.join(<span class=\"built_in\">type</span>, <span class=\"string\">&#x27;*&#x27;</span>))</span><br><span class=\"line\">            <span class=\"keyword\">for</span> person <span class=\"keyword\">in</span> person_dir:</span><br><span class=\"line\">                emotion_dir = glob.glob(os.path.join(person, <span class=\"string\">&#x27;*&#x27;</span>))</span><br><span class=\"line\">                <span class=\"keyword\">for</span> emotion <span class=\"keyword\">in</span> emotion_dir:</span><br><span class=\"line\">                    label = emotion.split(<span class=\"string\">&#x27;/&#x27;</span>)[-<span class=\"number\">1</span>]</span><br><span class=\"line\">                    img_dir = glob.glob(os.path.join(emotion, <span class=\"string\">&#x27;*.jpeg&#x27;</span>))</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> img <span class=\"keyword\">in</span> img_dir:</span><br><span class=\"line\">                        writer.writerow([img, label])</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot;writting one person&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;process ok&quot;</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>、</p>\n<p>之后就是进行分割数据集，train，val，test&#x3D;6:2：2</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, path, resize, mode</span>):</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(NIREmotionDatasets, self).__init__()</span><br><span class=\"line\">    <span class=\"comment\"># 进行自定义标签</span></span><br><span class=\"line\">    self.class_dir = &#123;<span class=\"string\">&quot;Anger&quot;</span>: <span class=\"number\">0</span>, <span class=\"string\">&quot;Disgust&quot;</span>: <span class=\"number\">1</span>, <span class=\"string\">&quot;Fear&quot;</span>: <span class=\"number\">2</span>, <span class=\"string\">&quot;Happiness&quot;</span>: <span class=\"number\">3</span>, <span class=\"string\">&quot;Sadness&quot;</span>: <span class=\"number\">4</span>, <span class=\"string\">&quot;Surprise&quot;</span>: <span class=\"number\">5</span>&#125;</span><br><span class=\"line\">    self.root = path</span><br><span class=\"line\">    self.resize = resize</span><br><span class=\"line\">    self.images, self.labels = self.load_csv(<span class=\"string\">&#x27;./label.csv&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> mode == <span class=\"string\">&quot;train&quot;</span>:</span><br><span class=\"line\">        self.images = self.images[:<span class=\"built_in\">int</span>(<span class=\"number\">0.6</span> * <span class=\"built_in\">len</span>(self.images))]</span><br><span class=\"line\">        self.labels = self.labels[:<span class=\"built_in\">int</span>(<span class=\"number\">0.6</span> * <span class=\"built_in\">len</span>(self.labels))]</span><br><span class=\"line\">    <span class=\"keyword\">elif</span> mode == <span class=\"string\">&#x27;val&#x27;</span>:  <span class=\"comment\"># 20% = 60%-&gt;80%</span></span><br><span class=\"line\">        self.images = self.images[<span class=\"built_in\">int</span>(<span class=\"number\">0.6</span> * <span class=\"built_in\">len</span>(self.images)):<span class=\"built_in\">int</span>(<span class=\"number\">0.8</span> * <span class=\"built_in\">len</span>(self.images))]</span><br><span class=\"line\">        self.labels = self.labels[<span class=\"built_in\">int</span>(<span class=\"number\">0.6</span> * <span class=\"built_in\">len</span>(self.labels)):<span class=\"built_in\">int</span>(<span class=\"number\">0.8</span> * <span class=\"built_in\">len</span>(self.labels))]</span><br><span class=\"line\">    <span class=\"keyword\">elif</span> mode == <span class=\"string\">&#x27;test&#x27;</span>:  <span class=\"comment\"># 20% = 80%-&gt;9999%</span></span><br><span class=\"line\">        self.images = self.images[<span class=\"built_in\">int</span>(<span class=\"number\">0.8</span> * <span class=\"built_in\">len</span>(self.images)):<span class=\"built_in\">int</span>(<span class=\"number\">0.99999</span> * <span class=\"built_in\">len</span>(self.images))]</span><br><span class=\"line\">        self.labels = self.labels[<span class=\"built_in\">int</span>(<span class=\"number\">0.8</span> * <span class=\"built_in\">len</span>(self.labels)):<span class=\"built_in\">int</span>(<span class=\"number\">0.99999</span> * <span class=\"built_in\">len</span>(self.labels))]</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"2-train模板\"><a href=\"#2-train模板\" class=\"headerlink\" title=\"2.train模板\"></a>2.train模板</h1><p>因为resnet在timm库里直接由，我们直接进行调用</p>\n<p>构建代码步骤</p>\n<ol>\n<li>构建argparse，直接复制粘贴</li>\n<li>构建dataloader，传入我们的datasets，然后进行shuttle，设置batch</li>\n<li>进行设置crition，adam还有model，模型直接进行调用，然后传入之前的pth，使用load</li>\n<li>设置model的最后一层为class层数 ，进行修改后放入device</li>\n<li>之后就是for语句了，在epoch里面</li>\n<li>首先是进行验证，验证，是计算正确率（这个就是，accurate的计算方法</li>\n<li>之后就是train，train需要设置为train模式，然后这个是计算loss的</li>\n<li>上面的常规就是zerograd，然后计算pred，pred与y计算loss，之后，loss进行反串，优化器进行更新</li>\n<li>一轮后更新学习率lr</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">best_acc = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(args.input_size)</span><br><span class=\"line\">    datasets_train = build_datasets(<span class=\"string\">&#x27;train&#x27;</span>, args)</span><br><span class=\"line\">    datasets_val = build_datasets(<span class=\"string\">&#x27;test&#x27;</span>, args)</span><br><span class=\"line\">    emotion_idx = datasets_train.class_dir</span><br><span class=\"line\">    train_loader = torch.utils.data.DataLoader(datasets_train, batch_size=args.batch_size, shuffle=<span class=\"literal\">True</span>,</span><br><span class=\"line\">                                               num_workers=args.num_workers)</span><br><span class=\"line\">    val_loader = torch.utils.data.DataLoader(datasets_val, batch_size=args.batch_size, shuffle=<span class=\"literal\">True</span>,</span><br><span class=\"line\">                                             num_workers=args.num_workers)</span><br><span class=\"line\">    model_resnet = resnet18(pretrained=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    checkpoint = torch.load(<span class=\"string\">&#x27;/home/tonnn/.nas/weijia/work/fer/baseline/resnet_base/resnet18_msceleb .pth&#x27;</span>)</span><br><span class=\"line\">    model_resnet.load_state_dict(checkpoint[<span class=\"string\">&#x27;state_dict&#x27;</span>], strict=<span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    model = nn.Sequential(*<span class=\"built_in\">list</span>(model_resnet.children())[:-<span class=\"number\">1</span>],</span><br><span class=\"line\">                          Flatten(),</span><br><span class=\"line\">                          nn.Linear(<span class=\"number\">512</span>, <span class=\"number\">6</span>)</span><br><span class=\"line\">                          ).to(device)</span><br><span class=\"line\">    val_num = <span class=\"built_in\">len</span>(val_loader)</span><br><span class=\"line\">    train_num = <span class=\"built_in\">len</span>(train_loader)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;using &#123;&#125; images for training, &#123;&#125; images for validation.&quot;</span>.<span class=\"built_in\">format</span>(train_num, val_num))</span><br><span class=\"line\"></span><br><span class=\"line\">    params = <span class=\"built_in\">list</span>(model.parameters())</span><br><span class=\"line\">    optimizer = torch.optim.SGD(params, lr=args.lr, weight_decay=<span class=\"number\">1e-4</span>, momentum=<span class=\"number\">0.9</span>)</span><br><span class=\"line\">    scheduler = torch.optim.lr_scheduler.StepLR(optimizer, step_size=<span class=\"number\">10</span>, gamma=<span class=\"number\">0.1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    criteon = nn.CrossEntropyLoss()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 训练start</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> epoch <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(args.epochs):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Epoch <span class=\"subst\">&#123;epoch&#125;</span>&#x27;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;length of dataloader_train is <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(train_loader)&#125;</span>&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        acc = <span class=\"number\">0.0</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> epoch % <span class=\"number\">1</span> == <span class=\"number\">0</span>:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Evaluating...&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">            model.<span class=\"built_in\">eval</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">with</span> torch.no_grad():</span><br><span class=\"line\">                <span class=\"keyword\">for</span> x, y <span class=\"keyword\">in</span> val_loader:</span><br><span class=\"line\">                    x, y = x.to(device), y.to(device)</span><br><span class=\"line\">                    logits = model(x)</span><br><span class=\"line\">                    pred = logits.argmax(dim=<span class=\"number\">1</span>)</span><br><span class=\"line\">                    <span class=\"comment\"># 找出最大值作为答案</span></span><br><span class=\"line\">                    acc += torch.eq(pred, y.to(device)).<span class=\"built_in\">sum</span>().item()</span><br><span class=\"line\"></span><br><span class=\"line\">            val_acc = acc / <span class=\"built_in\">len</span>(val_loader)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;[epoch %d]  val_accuracy: %.3f&#x27;</span> %</span><br><span class=\"line\">                  (epoch + <span class=\"number\">1</span>,  val_acc))</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> val_acc &gt; best_acc:</span><br><span class=\"line\">                best_acc = val_acc</span><br><span class=\"line\">                torch.save(model.state_dict(), <span class=\"string\">&#x27;accuracy_loss_change_train_50.mdl&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        model.train()</span><br><span class=\"line\">        <span class=\"keyword\">for</span> step,(x,y) <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(train_loader):</span><br><span class=\"line\">            x, y = x.to(device), y.to(device)</span><br><span class=\"line\">            logits = model(x)</span><br><span class=\"line\">            loss = criteon(logits,y)</span><br><span class=\"line\"></span><br><span class=\"line\">            optimizer.zero_grad()</span><br><span class=\"line\">            loss.backward()</span><br><span class=\"line\">            optimizer.step()</span><br><span class=\"line\"></span><br><span class=\"line\">        scheduler.step()</span><br><span class=\"line\">        <span class=\"comment\"># 更新 lr</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h1 id=\"3-进行预测test还有读取pth继续进行训练\"><a href=\"#3-进行预测test还有读取pth继续进行训练\" class=\"headerlink\" title=\"3.进行预测test还有读取pth继续进行训练\"></a>3.进行预测test还有读取pth继续进行训练</h1><p>预测函数predict，我们新建一个文件，然后还是要把预测的图片路径传入进来，然后就是进行加载模型，载入权重，之后使用nograd来进行计算，最后还需要id到属性的字典来进行映射</p>\n<ol>\n<li>使用dataset读取图片传入到dataloader</li>\n<li>设置enviroment来进行多卡推理</li>\n<li>设置模型，进行加载权重，使用模型的load’函数进行加载</li>\n<li>最后就是with nograd’，进行推理，推理的时候，数据也要传到cuda上面</li>\n<li>然后找到最大的索引，之后通过反向查询，得到他的名称</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">os.environ[<span class=\"string\">&#x27;CUDA_VISIBLE_DEVICES&#x27;</span>] = <span class=\"string\">&#x27;0,1&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">   device = torch.device(<span class=\"string\">&quot;cuda:0&quot;</span> <span class=\"keyword\">if</span> torch.cuda.is_available() <span class=\"keyword\">else</span> <span class=\"string\">&quot;cpu&quot;</span>)</span><br><span class=\"line\">   test_datasets = build_datasets(<span class=\"string\">&quot;test&quot;</span>, get_args_parser().parse_args())</span><br><span class=\"line\"></span><br><span class=\"line\">   test_loader = torch.utils.data.DataLoader(</span><br><span class=\"line\">       test_datasets, batch_size=args.batch_size, shuffle=<span class=\"literal\">False</span>,</span><br><span class=\"line\">       num_workers=args.num_workers)</span><br><span class=\"line\"></span><br><span class=\"line\">   class_idx = test_datasets.class_dir</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\"># 加载模型</span></span><br><span class=\"line\">   pth_path = <span class=\"string\">&#x27;accuracy_loss_change_train_50.mdl&#x27;</span></span><br><span class=\"line\">   model = resnet18()</span><br><span class=\"line\">   model = nn.Sequential(*<span class=\"built_in\">list</span>(model.children())[:-<span class=\"number\">1</span>],</span><br><span class=\"line\">                         Flatten(),</span><br><span class=\"line\">                         nn.Linear(<span class=\"number\">512</span>, <span class=\"number\">6</span>)</span><br><span class=\"line\">                         ).to(device)</span><br><span class=\"line\">   model.load_state_dict(torch.load(pth_path))</span><br><span class=\"line\">   <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;loaded from ckpt!&#x27;</span>)</span><br><span class=\"line\">   model = nn.DataParallel(model)</span><br><span class=\"line\">   model = model.cuda()</span><br><span class=\"line\">   model.<span class=\"built_in\">eval</span>()</span><br><span class=\"line\">   acc = <span class=\"number\">0</span></span><br><span class=\"line\">   ans = []</span><br><span class=\"line\">   <span class=\"keyword\">with</span> torch.no_grad():</span><br><span class=\"line\">       <span class=\"keyword\">for</span> x, y <span class=\"keyword\">in</span> test_loader:</span><br><span class=\"line\">           x, y = x.cuda(), y.cuda()</span><br><span class=\"line\">           logits = model(x)</span><br><span class=\"line\">           pred = logits.argmax(dim=<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">           <span class=\"keyword\">for</span> x1 <span class=\"keyword\">in</span> pred:</span><br><span class=\"line\">               ans.append(find(class_idx, <span class=\"built_in\">int</span>(x1)))</span><br><span class=\"line\">           <span class=\"comment\"># 找出最大值作为答案</span></span><br><span class=\"line\">           acc += torch.eq(pred, y.to(device)).<span class=\"built_in\">sum</span>().<span class=\"built_in\">float</span>().item()</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>继续训练和之前的predict一样，看args的startt是不是0，不是0，就进行加载权重</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if args.start_epoch !=0:</span><br><span class=\"line\">      model.load_state_dict = torch.load(&#x27;accuracy_loss_change_train_1003.mdl&#x27;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"4-pytorch多卡运行，读取还有保存权重\"><a href=\"#4-pytorch多卡运行，读取还有保存权重\" class=\"headerlink\" title=\"4.pytorch多卡运行，读取还有保存权重\"></a>4.pytorch多卡运行，读取还有保存权重</h1><p>多卡运行，上面已经有操作了</p>\n<ol>\n<li>首先设置os的黄精为0,1</li>\n<li>然后加载到dataparallel上面</li>\n<li>之后模型移动到cuda</li>\n<li>然后在训练和预测的时候数据移动到cuda</li>\n</ol>\n<p>和上面没有什么差别，支部够要移动一下，普通是移动到device</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">criteon = nn.CrossEntropyLoss()</span><br><span class=\"line\">   <span class=\"comment\"># if args.start_epoch !=0:</span></span><br><span class=\"line\">   <span class=\"comment\">#     model.load_state_dict = torch.load(&#x27;accuracy_loss_change_train_1003.mdl&#x27;)</span></span><br><span class=\"line\">   <span class=\"comment\">#     # model.load_state_dict(torch.load(&#x27;accuracy_loss_change_train_3.mdl&#x27;))</span></span><br><span class=\"line\"></span><br><span class=\"line\">   model = nn.DataParallel(model)</span><br><span class=\"line\">   model = model.cuda()</span><br><span class=\"line\">   <span class=\"comment\"># 训练start</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> epoch <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,args.epochs):</span><br><span class=\"line\">       <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Epoch <span class=\"subst\">&#123;epoch&#125;</span>&#x27;</span>)</span><br><span class=\"line\">       <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;length of dataloader_train is <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(train_loader.dataset)&#125;</span>&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">       acc = <span class=\"number\">0.0</span></span><br><span class=\"line\">       <span class=\"keyword\">if</span> epoch % <span class=\"number\">1</span> == <span class=\"number\">0</span>:</span><br><span class=\"line\">           <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Evaluating...&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">           model.<span class=\"built_in\">eval</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">           <span class=\"keyword\">with</span> torch.no_grad():</span><br><span class=\"line\">               <span class=\"keyword\">for</span> x, y <span class=\"keyword\">in</span> val_loader:</span><br><span class=\"line\">                   x, y = x.cuda(), y.cuda()</span><br><span class=\"line\">                   logits = model(x)</span><br><span class=\"line\">                   pred = logits.argmax(dim=<span class=\"number\">1</span>)</span><br><span class=\"line\">                   <span class=\"comment\"># 找出最大值作为答案</span></span><br><span class=\"line\">                   acc += torch.eq(pred, y.cuda()).<span class=\"built_in\">sum</span>().item()</span><br><span class=\"line\"></span><br><span class=\"line\">           val_acc = acc / <span class=\"built_in\">len</span>(val_loader.dataset)</span><br><span class=\"line\">           <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;[epoch %d]  val_accuracy: %.3f&#x27;</span> %</span><br><span class=\"line\">                 (epoch + <span class=\"number\">1</span>,  val_acc))</span><br><span class=\"line\"></span><br><span class=\"line\">           <span class=\"keyword\">if</span> val_acc &gt; best_acc:</span><br><span class=\"line\">               best_acc = val_acc</span><br><span class=\"line\">               file_name = <span class=\"string\">&#x27;/home/tonnn/.nas/weijia/work/fer/baseline/resnet_base/checkpoint/accuracy_loss_change_train_&#x27;</span>+<span class=\"built_in\">str</span>(epoch)+<span class=\"string\">&#x27;.pth&#x27;</span></span><br><span class=\"line\">               torch.save(model.state_dict(), file_name)</span><br><span class=\"line\"></span><br><span class=\"line\">       model.train()</span><br><span class=\"line\">       <span class=\"keyword\">for</span> step,(x,y) <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(train_loader):</span><br><span class=\"line\">           x, y = x.cuda(), y.cuda()</span><br><span class=\"line\">           logits = model(x)</span><br><span class=\"line\">           loss = criteon(logits,y)</span><br><span class=\"line\"></span><br><span class=\"line\">           optimizer.zero_grad()</span><br><span class=\"line\">           loss.backward()</span><br><span class=\"line\">           optimizer.step()</span><br><span class=\"line\">           <span class=\"built_in\">print</span>(<span class=\"string\">r&quot;train epoch[&#123;&#125;/&#123;&#125;] loss:&#123;:.3f&#125;&quot;</span>.<span class=\"built_in\">format</span>(epoch + <span class=\"number\">1</span>,</span><br><span class=\"line\">                                                                    args.epochs,</span><br><span class=\"line\">                                                                    loss.item()))</span><br><span class=\"line\"></span><br><span class=\"line\">       scheduler.step()</span><br><span class=\"line\">       <span class=\"comment\"># 更新 lr</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h1 id=\"附录：mtcnn进行裁剪\"><a href=\"#附录：mtcnn进行裁剪\" class=\"headerlink\" title=\"附录：mtcnn进行裁剪\"></a>附录：mtcnn进行裁剪</h1>","tags":[{"name":"深度学习","slug":"深度学习","permalink":"http://yoursite.com/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"}]},{"title":"alist网盘聚合","date":"2023-02-04T10:59:27.000Z","path":"2023/02/04/alist网盘聚合/","content":"<h1 id=\"alist简介\"><a href=\"#alist简介\" class=\"headerlink\" title=\"alist简介\"></a>alist简介</h1><p><strong>AList</strong> 是一个支持在本地加载 18 款常见网盘文件列表的工具，它可以让用户直接在浏览器中预览文件、上传文件、下载文件、播放视频、浏览照片，也可以直接在播放器中打开视频文件，还可以配合 aria2 实现文件下载功能。跨平台简单易用。@<a href=\"https://www.appinn.com/alist-file-list-program/\">Appinn</a></p>\n<p><img src=\"https://www.appinn.com/wp-content/uploads/2022/09/Appinn-2022-09-16T150310.322.jpg\" alt=\"AList - 聚合阿里云盘、百度网盘、PikPak、WebDav 等 18 款网盘：文件预览、上传/下载，直接播放视频\"></p>\n<p>感谢 @<strong>imsoff</strong> 推荐。</p>\n<h2 id=\"AList-–-文件列表程序\"><a href=\"#AList-–-文件列表程序\" class=\"headerlink\" title=\"AList – 文件列表程序\"></a>AList – 文件列表程序</h2><p>AList 自己的定位是一个支持多存储的文件列表程序，使用 Gin 和 Solidjs。它可以将以下网盘聚合在一起：</p>\n<ul>\n<li>本地存储</li>\n<li>阿里云盘</li>\n<li>OneDrive &#x2F; Sharepoint（国际版, 世纪互联,de,us）</li>\n<li>天翼云盘 (个人云, 家庭云)</li>\n<li>GoogleDrive</li>\n<li>123云盘</li>\n<li>FTP &#x2F; SFTP</li>\n<li>PikPak</li>\n<li>S3</li>\n<li>又拍云对象存储</li>\n<li>WebDav(支持无API的OneDrive&#x2F;SharePoint)</li>\n<li>Teambition（中国，国际）</li>\n<li>分秒帧</li>\n<li>和彩云 (个人云,家庭云)</li>\n<li>Yandex.Disk</li>\n<li>百度网盘</li>\n<li>夸克网盘</li>\n<li>迅雷网盘</li>\n</ul>\n<p>然后只需要在浏览器中打开，即可预览文件、上传文件、下载文件、直接播放视频、音频。</p>\n<h2 id=\"在线播放视频效果\"><a href=\"#在线播放视频效果\" class=\"headerlink\" title=\"在线播放视频效果\"></a>在线播放视频效果</h2><p><img src=\"https://www.appinn.com/wp-content/uploads/2022/09/Screen-Appinn2022-09-16-15.59.14.jpg\" alt=\"AList - 聚合阿里云盘、百度网盘、PikPak、WebDav 等 18 款网盘：文件预览、上传/下载，直接播放视频 1\"></p>\n<p>并且提供了几个播放器按钮，直接点击就能跳转。</p>\n<p>不过青小蛙在测试的时候没搞定云字幕，似乎需要下载字幕之后才能加载。</p>\n<h2 id=\"安装-amp-配置\"><a href=\"#安装-amp-配置\" class=\"headerlink\" title=\"安装 &amp; 配置\"></a>安装 &amp; 配置</h2><p>AList 的安装比较简单，对于 Windows 用户，直接下载 .exe 文件之后，使用命令提示符运行，就行了。对于其他平台用户，也差不多，另外也支持 docker 部署，即开机用非常简单。</p>\n<p>也算是0配置，只需要输入命令 alist.exe admin 获取管理员密码，打开浏览器 127.0.0.1:5244 就行了。</p>\n<h2 id=\"添加存储\"><a href=\"#添加存储\" class=\"headerlink\" title=\"添加存储\"></a>添加存储</h2><p>在管理界面，可以添加很多的网盘：</p>\n<p><img src=\"https://www.appinn.com/wp-content/uploads/2022/09/Screen-Appinn2022-09-16-16.30.03.jpg\" alt=\"AList - 聚合阿里云盘、百度网盘、PikPak、WebDav 等 18 款网盘：文件预览、上传/下载，直接播放视频 2\"></p>\n<p>这里就需要<a href=\"https://alist.nn.ci/zh/guide/drivers/common.html\">阅读文档</a>了，但也很简单，最重要的是获取 Token，也提供了自动化获取按钮。不放心的同学可以根据文档说明手动获取。</p>\n<p><img src=\"https://www.appinn.com/wp-content/uploads/2022/09/Screen-Appinn2022-09-16-16.31.09.jpg\" alt=\"AList - 聚合阿里云盘、百度网盘、PikPak、WebDav 等 18 款网盘：文件预览、上传/下载，直接播放视频 3\"></p>\n<h2 id=\"公网访问\"><a href=\"#公网访问\" class=\"headerlink\" title=\"公网访问\"></a>公网访问</h2><p>虽然青小蛙主要用来自己在家用，但的确看到了不少人拿来在公网使用。AList 可以设置公告、用户权限、</p>\n<p><img src=\"https://www.appinn.com/wp-content/uploads/2022/09/Screen-Appinn2022-09-16-16.39.19.jpg\" alt=\"AList - 聚合阿里云盘、百度网盘、PikPak、WebDav 等 18 款网盘：文件预览、上传/下载，直接播放视频 4\"></p>\n<p>嗯，比如<a href=\"https://kutt.appinn.net/ftlxSu\">这种</a>。</p>\n<h2 id=\"WebDAV\"><a href=\"#WebDAV\" class=\"headerlink\" title=\"WebDAV\"></a>WebDAV</h2><p>除了直接将 WebDAV 资源添加进 AList，还支持反向使用，即使用 WebDAV 客户端连接 Alist，然后浏览绑定的内容，这样就极大的扩展了客户端，包括 iPhone、Android 都可以轻松访问你的网盘资源了：</p>\n<p><img src=\"https://www.appinn.com/wp-content/uploads/2022/09/Screen-Appinn2022-09-16-16.47.23.jpg\" alt=\"AList - 聚合阿里云盘、百度网盘、PikPak、WebDav 等 18 款网盘：文件预览、上传/下载，直接播放视频 5\"></p>\n<p><img src=\"https://www.appinn.com/wp-content/uploads/2022/09/Screen-Appinn2022-09-16-16.47.28.jpg\" alt=\"AList - 聚合阿里云盘、百度网盘、PikPak、WebDav 等 18 款网盘：文件预览、上传/下载，直接播放视频 6\"></p>\n<p>怎么说呢，反正省了台 <a href=\"https://www.appinn.com/tag/nas/\">NAS</a> 的感觉。</p>\n<h1 id=\"2-为什么搭建\"><a href=\"#2-为什么搭建\" class=\"headerlink\" title=\"2.为什么搭建\"></a>2.为什么搭建</h1><p>笔者手里有多个网盘，百度云（网课视频），阿里云（电视视频），pikpak（下torrent），还有谷歌云（自用，备份手机的）。</p>\n<p>主要是笔者中午使用pikpak在线客户端很卡，播放视频非常卡顿，不流畅，所以笔者花了一点时间来进行搭建。搭建完成之后的效果就是可以只要输入一个网站，就可以访问多个网盘，而且播放效果，比官网好多 了。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16755087318811675508731713.png\"></p>\n<p>搭建效果如图</p>\n<h1 id=\"3-搭建教程\"><a href=\"#3-搭建教程\" class=\"headerlink\" title=\"3.搭建教程\"></a>3.搭建教程</h1><p>主要参考下面官网文档，本来想使用docker的，但是垃圾服务器，内存根本跑不了docker，所以直接使用的一件脚本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL &quot;https://alist.nn.ci/v3.sh&quot; | bash -s install</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://alist.nn.ci/zh/guide/install/script.html\">https://alist.nn.ci/zh/guide/install/script.html</a> 官网教程</p>\n<p>搭建完成之后，会出现账号密码，这个自己记住。</p>\n<p>之后就是使用如何进行安装网盘。最简单的是pikpak，这个只要输入账号密码就行。具体安装步骤在官网上面。</p>\n<p>百度网盘安装教程：</p>\n<ol>\n<li><a href=\"https://openapi.baidu.com/oauth/2.0/authorize?response_type=code&amp;client_id=iYCeC9g08h5vuP9UqvPHKKSVrKFXGa1v&amp;redirect_uri=https://tool.nn.ci/baidu/callback&amp;scope=basic,netdisk&amp;qrcode=1\">https://openapi.baidu.com/oauth/2.0/authorize?response_type=code&amp;client_id=iYCeC9g08h5vuP9UqvPHKKSVrKFXGa1v&amp;redirect_uri=https://tool.nn.ci/baidu/callback&amp;scope=basic,netdisk&amp;qrcode=1</a></li>\n<li>使用上面网站获取令牌还有secret还有id</li>\n<li>下面看图，不然没有办法正常播放视频</li>\n<li>下载选择非官方就行</li>\n</ol>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16755090388811675509038218.png\"></p>\n<p>谷歌网盘：</p>\n<p>这是最复杂的，需要自己申请api接口，然后再把这个接口开放给自己一个人使用，得到接口之后才能进行生成id还有token，具体参考下面这个YouTube博主视频</p>\n<p><a href=\"https://youtu.be/Hktdyg7L0Bg\">https://youtu.be/Hktdyg7L0Bg</a></p>\n<ol>\n<li>创建项目</li>\n<li>然后启用api还有服务，主要使用云盘服务，找到云盘</li>\n<li>之后就是创建姘居，创建OA客户端id，填写外部，然后只要输入自己的电子邮件</li>\n<li>之后就是添加用户，吧自己添加进去</li>\n<li>之后再次回到品聚，创建oa的id，选择应用是桌面客户端之后秘钥还有id就出来了</li>\n<li>之后输入到那个网站，点击code，弹出网页，一直继续</li>\n<li>就会有token出现</li>\n<li>之后就按照放入到alist的后台</li>\n</ol>\n<h1 id=\"4-反向代理\"><a href=\"#4-反向代理\" class=\"headerlink\" title=\"4.反向代理\"></a>4.反向代理</h1><p>下午使用github学生包，白嫖了一个域名，然后，为了懒得记住ip，直接用域名来使用。</p>\n<p>问题是alist使用的5244端口，但是直接输入域名+端口非常不好看，所以使用反向代理，这里使用的是nginx，</p>\n<p>直接下载nginx安装，笔者之前忘了开80端口，一直打不开，以为是自己配置问题。换了apache也是一样的。于是再换回nginx，才发现80没有打开，大坑。打开之后，一直是配置502，一直以为是自己的配置有问题（实际上没有，只是linux内核问题），谷歌发现要设置一个内核关闭，代码如下</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setsebool -P httpd_can_network_connect 1   </span><br></pre></td></tr></table></figure>\n\n<p>之后就可以正常访问了，主要的是配置，参考官网，直接在http模块里面添加一个新的server模块，就可以，配置文档etc、nginx、nginxconf里面，修改如下</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location / &#123;</span><br><span class=\"line\">  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">  proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class=\"line\">  proxy_set_header Host $http_host;</span><br><span class=\"line\">  proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">  proxy_set_header Range $http_range;</span><br><span class=\"line\">\tproxy_set_header If-Range $http_if_range;</span><br><span class=\"line\">  proxy_redirect off;</span><br><span class=\"line\">  proxy_pass http:<span class=\"comment\">//127.0.0.1:5244;</span></span><br><span class=\"line\">  <span class=\"meta\"># the max size of file to upload</span></span><br><span class=\"line\">  client_max_body_size <span class=\"number\">20000</span>m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"网盘","slug":"网盘","permalink":"http://yoursite.com/tags/%E7%BD%91%E7%9B%98/"}]},{"title":"一文详解欧易wise和depay","date":"2023-02-04T09:56:13.000Z","path":"2023/02/04/一文详解欧易wise和depay/","content":"<h1 id=\"1-简要介绍\"><a href=\"#1-简要介绍\" class=\"headerlink\" title=\"1.简要介绍\"></a>1.简要介绍</h1><p>之所以写这个的原因是，笔者正在白嫖土耳其的低价优惠。因为埃尔多安经济学，导致人民币兑土耳其不断升高，而且定价在土区也是低价区。所以如何充分利用土区白嫖优惠，就是个问题。</p>\n<p>门前主流的国外网站netflix，Spotify，apple，google，Disney等价格都远远低于国区。但是购买方式只能使用国外的信用卡组织visa或者MasterCard。笔者作为学生党，当然是办不了的。但是oldubil这个软件，提供一个虚拟土耳其mastercard，可以对上述网站进行购买。所以我们的问题就变成如何给oldubil入金了。</p>\n<p>目前有两种方式，笔者尝试的第一种损耗很大，而且还需要进行kyc身份验证，需要使用你的护照信息。第二种是直接通过欧易交易所，交易usdt给土耳其人（因为中国大陆区无法直接交易土耳其，所以还需要注册一个台湾区来进行交易）。</p>\n<p>下面先介绍第一种思路：</p>\n<ol>\n<li>支付宝购买usdt在欧易里面（微信，银行卡也可以）</li>\n<li>在depay里面进行充币操作</li>\n<li>利用depay的虚拟卡给wise汇款</li>\n<li>利用wise进行转换，把美元兑换成土耳其</li>\n<li>最后利用wise发送到oldubil支持的iban银行</li>\n</ol>\n<p>以上每一步都有损耗，交易费，手续费，还有转账费用，笔者一共付出23.8在欧易，到wise里面就只有20了。损耗率有16个点。而且还需要kyc身份认证在wise，总体比较繁琐</p>\n<p>第二种就是直接欧易买卖币，兑换成土耳其</p>\n<ol>\n<li>大陆欧易账号买币</li>\n<li>发送到台湾欧易账号（站内转账）</li>\n<li>最后用台湾的账号卖出为土耳其，填入iban相关的</li>\n</ol>\n<p>下面先介绍一下第一种方法</p>\n<h2 id=\"1-1-欧易操作\"><a href=\"#1-1-欧易操作\" class=\"headerlink\" title=\"1.1 欧易操作\"></a>1.1 欧易操作</h2><blockquote>\n<p><strong>欧易</strong>（英语：OKX；原名<strong>OKEx</strong>）是一间<a href=\"https://zh.wikipedia.org/wiki/%E7%B8%BD%E9%83%A8\">总部</a>位于<a href=\"https://zh.wikipedia.org/wiki/%E5%A1%9E%E8%88%8C%E5%B0%94\">塞舌尔</a>的<a href=\"https://zh.wikipedia.org/wiki/%E5%8A%A0%E5%AF%86%E8%B4%A7%E5%B8%81%E4%BA%A4%E6%98%93%E6%89%80\">加密货币交易所</a>[<a href=\"https://zh.wikipedia.org/zh-cn/%E6%AC%A7%E6%98%93#cite_note-2\">2]</a>，由徐明星于2017年创办[<a href=\"https://zh.wikipedia.org/zh-cn/%E6%AC%A7%E6%98%93#cite_note-Birnbaum_2022-3\">3]</a>。该机构的主营业务是为<a href=\"https://zh.wikipedia.org/wiki/%E7%94%A8%E6%88%B7\">用户</a>提供多种加密资产交易服务。2021年2月2日，该交易所正式启用中文名“欧易”[<a href=\"https://zh.wikipedia.org/zh-cn/%E6%AC%A7%E6%98%93#cite_note-4\">4]</a>。2022年1月，OKEx更名为OKX[<a href=\"https://zh.wikipedia.org/zh-cn/%E6%AC%A7%E6%98%93#cite_note-5\">5]</a>。</p>\n</blockquote>\n<p>简单来说就是一个交易所，进行买卖比特币的地方，我们如果要进行买币就要首先认证身份，l1认证就行，使用身份证可以通过。</p>\n<p><strong>第二步就是进行c2c买币</strong>，顾名思义，就是顾客对顾客买币，量大他的折扣才打。目前汇率是1:6.78，但是个人卖家，你卖的少可能会出现1:7的价格。这也是一部分损耗。选择接受的方式进行筛选，微信，支付宝</p>\n<h2 id=\"1-2depay操作\"><a href=\"#1-2depay操作\" class=\"headerlink\" title=\"1.2depay操作\"></a>1.2depay操作</h2><p><a href=\"https://zhuanlan.zhihu.com/p/596899194\">https://zhuanlan.zhihu.com/p/596899194</a></p>\n<blockquote>\n<blockquote>\n<p><em>一、Depay的使用场景有那些？</em></p>\n</blockquote>\n<p>1、Depay Master Visa卡支持绑定支付宝、微信支付、美团外卖、拼多多、Paypal、天猫国际版等等。</p>\n<p>2、支持Stripe商户、google play商店、youtube premium、paypal商户、美区苹果商店、和支持非3DS卡的电商网站</p>\n<p>3、支持国内苹果官网直接绑卡购买iphone和mac，可能会打电话问询，直接说即可。</p>\n<p>4、暂不支持苹果支付APPLE PAY和谷歌PAY</p>\n<p>5、所有等级的卡（Lite、标准、高级、白金、黑金）都满足以上场景</p>\n</blockquote>\n<p>简而言之就是提供了一个虚拟mastercard，但是入金的方式只能通过比特币来入金，所以我们需要第一步的欧易来操作。（注意，手续费比较多）</p>\n<ol>\n<li>首先把欧易里面的usdt发送给depay</li>\n<li>我们需要在depay里面找到usdt，还有他的合约链，复制合约链还有id来到欧易</li>\n<li><strong>在欧易里面选择提币，然后选择连上转账，输入地址还有链，这个时候因为是外链会有0.8的手续费</strong></li>\n<li>之后等过5分钟到达depay</li>\n<li>我们在等待时间，先开一张虚拟卡，使用身份证可以验证，然后就是最便宜的没有开卡费用，但是月费是1刀，还有交易费</li>\n<li>开卡完成，我们回到usdt，还需要进行转换为usd才能放入depay一般是97折进行转换</li>\n<li>转换放入需要扣除0.3的手续，到此23.8就只有21.76左右了</li>\n</ol>\n<h2 id=\"1-3wise操作\"><a href=\"#1-3wise操作\" class=\"headerlink\" title=\"1.3wise操作\"></a>1.3wise操作</h2><blockquote>\n<h2 id=\"什麼是-Wise？\"><a href=\"#什麼是-Wise？\" class=\"headerlink\" title=\"什麼是 Wise？\"></a><strong>什麼是 Wise？</strong></h2><p>Wise（舊稱Transferwise），是一家提供國際匯款轉賬服務的 P2P 國際匯款平台。Wise 也是世界上成長速度最快的線上匯款、電子貨幣服務之一。</p>\n<p>Wise 因匯率和定價透明，加上直接將資金匯到海外，省去高昂的銀行手續費，吸引超過1,000萬的用戶。目前 Wise 可支持40多個國家的貨幣轉賬，非常適合在海外工作，或是擁有海外收入的用戶。</p>\n</blockquote>\n<p>简单来说wise就是跨境汇款工具，因为普通银行汇款会有巨额的手续费没所以才有了wise，就是减少手续费 的。</p>\n<p>但是wise这个软件是需要进行进行身份验证，前面两个使用身份证就行，这个必须使用护照（还好现在办护照容易，笔者是上个月办的，听到可以恢复办理护照，就赶快办了一个）。说回正题，现在你还需要入金20刀还有护照才能激活wise，才可以开通跨境转账成为土耳其货币，具体步骤如下。</p>\n<ol>\n<li>使用depay进行付款20美金，注意，<strong>又有手续费，0.8必须扣得</strong></li>\n<li>之后就是身份验证，需要护照还有自拍</li>\n<li>最后一步就是转账，具体流程如下图</li>\n<li>转账之前还需要把美元兑换成土耳其，也有损耗</li>\n<li>发送固定是24土耳其，合计1美金左右的手续费</li>\n</ol>\n<p>简单来说就是去oldubil里面 选择iban转账，然后去oldubil找到银行，复制iban和名称回到wise，最后一步就是附言要写上自己的虚拟卡（这个是oldubil提供的土耳其虚拟卡），如下图所示</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16755067588821675506758131.png\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16755067768841675506776221.png\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16755067878851675506787752.png\"></p>\n<h2 id=\"1-4oldubil操作\"><a href=\"#1-4oldubil操作\" class=\"headerlink\" title=\"1.4oldubil操作\"></a>1.4oldubil操作</h2><p>这个是土耳其的虚拟卡软件，但是注册的话，国内手机号没有办法使用。我是用的是土乌克兰lifecell的esim，使用国内的万事达借记卡，可以购买手机号。优点不需要实名认证，价格是5块钱一个月。使用的是美版se2，进行使用esim的</p>\n<p>esim连接：<a href=\"https://www.lifecell.ua/en/sim-and-number/eSIM/\">https://www.lifecell.ua/en/sim-and-number/eSIM/</a></p>\n<blockquote>\n<p>万事达借记卡：使用的是中国银行的莫奈，有3ds，可以在某些网站进行验证，有网申连接，主要参考这个网站</p>\n<p><a href=\"https://poplite.xyz/post/2018/03/05/boc-debit-card-guide-for-online-payment.html\">https://poplite.xyz/post/2018/03/05/boc-debit-card-guide-for-online-payment.html</a>   还有dotofcards这个群组。唯一缺点就是需要自己手动结汇购汇，这个是会占用自己的5w外汇额度的。美国运通的借记卡就不需要，但是没有3ds，有些网站买不了东西。</p>\n</blockquote>\n<p>最后就是转账到oldubil里面，然后使用这个提供的银行卡去买spotify，netflix</p>\n<h1 id=\"2-方法总结\"><a href=\"#2-方法总结\" class=\"headerlink\" title=\"2.方法总结\"></a>2.方法总结</h1><p>上述方法，一共损耗0.8（欧易费用）+0.3（depay汇入费用）+（0.86wise汇入费用）+（1.2wise会出费用），这还没有计算，usdt打折，还有还有usdt转入usd的损耗，还有美元转土耳其的损耗。目前就损耗了3美元，流程繁琐，而且损耗严重。</p>\n<p>第二种方法就是直接买usdt，通过欧易发送到台湾账户，这个站内转账没有损害，而且我们只需要在卖比特币给土耳其人就行，时间很快。主要有下面的教程</p>\n<p><a href=\"https://yummy.best/how-to-top-up-oldubil/\">https://yummy.best/how-to-top-up-oldubil/</a>  参考下面的教程</p>\n<blockquote>\n<h2 id=\"入金步骤（来自-沐攸-投稿）\"><a href=\"#入金步骤（来自-沐攸-投稿）\" class=\"headerlink\" title=\"入金步骤（来自 沐攸 投稿）\"></a>入金步骤（来自 <a href=\"https://t.me/Mylovetbole\">沐攸</a> 投稿）</h2><p><strong>第一步</strong>：注册两个欧易账户，一个欧易账号身份认证选择  <code>**大陆+大陆身份证验证**</code> ，另一欧易账户身份认证选择 <code>**台湾+大陆身份证认证**</code> 。</p>\n<blockquote>\n<p>说明：选择台湾账户的账户只需要简单认证  <code>**L1**</code> 即可，不要验证到  <code>**L2**</code> 否则默认成为大陆欧易无法绕过 CNY 进行交易；另一个账户随便。</p>\n</blockquote>\n<p><strong>第二步</strong>：用 <code>**大陆**</code> 的欧易账户购买 USDT 入金欧易（支持微信+支付宝），然后将购买到的 USDT 发送到 <code>**台湾**</code> 欧易账户（<strong>选择站内转账，否则需要支付 0.8 usdt 手续费</strong>）</p>\n<p><strong>第三步</strong>：使用 <code>**台湾**</code> 欧易账户 C2C 交易 → 选择货币为 TRY → 交易方式为银行转账 → 选择 oldubil 支持的银行并填入信息，然后按照如下格式填入发送到聊天框‌‌</p>\n<p><strong>IBAN:‌‌</strong></p>\n<p><strong>Name:</strong></p>\n<p><strong>‌‌Card Number:</strong></p>\n</blockquote>\n<p>第三种就是直接淘宝进行购买，主要使用的是礼品卡，淘宝也有卖的，而且。还有一些专门卖礼品卡的网站。</p>\n<p><a href=\"https://hezu.wiki/zh/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7%E5%8C%BA/%E5%9C%9F%E8%80%B3%E5%85%B6%E7%A4%BC%E5%93%81%E5%8D%A1%E8%B4%AD%E4%B9%B0\">https://hezu.wiki/zh/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7%E5%8C%BA/%E5%9C%9F%E8%80%B3%E5%85%B6%E7%A4%BC%E5%93%81%E5%8D%A1%E8%B4%AD%E4%B9%B0</a></p>\n<p><a href=\"https://www.oyunfor.com/tv/netflix-hediye-kodu-karti\">https://www.oyunfor.com/tv/netflix-hediye-kodu-karti</a>  主要使用这个，这个基本都有买的。</p>\n<p>总而言之，使用第一种方法是费力不讨好的，但是折腾了很久，也学到了btc一些知识。充值还是推荐后面两种。</p>\n","tags":[{"name":"usdt","slug":"usdt","permalink":"http://yoursite.com/tags/usdt/"},{"name":"btc","slug":"btc","permalink":"http://yoursite.com/tags/btc/"},{"name":"外汇","slug":"外汇","permalink":"http://yoursite.com/tags/%E5%A4%96%E6%B1%87/"},{"name":"入金","slug":"入金","permalink":"http://yoursite.com/tags/%E5%85%A5%E9%87%91/"},{"name":"土耳其","slug":"土耳其","permalink":"http://yoursite.com/tags/%E5%9C%9F%E8%80%B3%E5%85%B6/"},{"name":"mastercard","slug":"mastercard","permalink":"http://yoursite.com/tags/mastercard/"}]},{"title":"搜索专题","date":"2023-02-03T08:54:33.000Z","path":"2023/02/03/搜索专题/","content":"<h1 id=\"1-BFS\"><a href=\"#1-BFS\" class=\"headerlink\" title=\"1.BFS\"></a>1.BFS</h1><p>bfs主要包括一下应用，flood fill（洪水灌溉）把所有的值进行填充man，最小步数模型，就是最先到达的形态，使用的最小方法。然后就是多源bfs，这个思路就是吧所有的起点全部放入到queue里面。之后就是双向bfs，这个是节约搜索时间（使用两个queue来进行）</p>\n<h2 id=\"397-整数替换\"><a href=\"#397-整数替换\" class=\"headerlink\" title=\"397. 整数替换\"></a><a href=\"https://leetcode.cn/problems/integer-replacement/\">397. 整数替换</a></h2><p>返回最小的次数，可以用递归，或者最小步数</p>\n<p>思路也是没有发现了这个值，就放入st和queue</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">integerReplacement</span><span class=\"params\">(<span class=\"type\">int</span> n)</span> </span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//        if (n==1)return 0;</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//        if(n%2)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">//            return min(integerReplacement(n-1), integerReplacement(n+1))+1;</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//        &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//        return 1+ integerReplacement(n/2);</span></span><br><span class=\"line\">        queue&lt;<span class=\"type\">long</span>&gt; q;</span><br><span class=\"line\">        q.<span class=\"built_in\">push</span>(n);</span><br><span class=\"line\">        <span class=\"type\">int</span> step=<span class=\"number\">0</span>;</span><br><span class=\"line\">        set&lt;<span class=\"type\">long</span>&gt; st;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (q.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> n=q.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">auto</span> n1=q.<span class=\"built_in\">front</span>();</span><br><span class=\"line\">                q.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(n1==<span class=\"number\">1</span>)<span class=\"keyword\">return</span> step;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(n1%<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(st.<span class=\"built_in\">count</span>(n1<span class=\"number\">-1</span>)==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                        st.<span class=\"built_in\">insert</span>(n1<span class=\"number\">-1</span>);</span><br><span class=\"line\">                        q.<span class=\"built_in\">push</span>(n1<span class=\"number\">-1</span>);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (st.<span class=\"built_in\">count</span>(n1+<span class=\"number\">1</span>)==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                        q.<span class=\"built_in\">push</span>(n1+<span class=\"number\">1</span>);</span><br><span class=\"line\">                        st.<span class=\"built_in\">insert</span>(n1+<span class=\"number\">1</span>);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(st.<span class=\"built_in\">count</span>(n1/<span class=\"number\">2</span>)==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                        q.<span class=\"built_in\">push</span>(n1/<span class=\"number\">2</span>);</span><br><span class=\"line\">                        st.<span class=\"built_in\">insert</span>(n1/<span class=\"number\">2</span>);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            step++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"403-青蛙过河\"><a href=\"#403-青蛙过河\" class=\"headerlink\" title=\"403. 青蛙过河\"></a><a href=\"https://leetcode.cn/problems/frog-jump/\">403. 青蛙过河</a></h2><p>f[i][j】表示表示到达i这个点，下一步是j步数。</p>\n<p>计算方法就是当前i可能是由j，j-1，j+1构成的，f【rec[num[i]-j]][j]可以由他来构成，所以我们要查看当前值有没有。最后一个我们只要看f【n-1】【0.。。n-1】有没有一个成功的</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"comment\">//直接使用dp，f【i】【j】是bool，表示到达i，下一步是j，是不是可能的</span></span><br><span class=\"line\"><span class=\"comment\">//    地推方程f[?][j-1],f[?][j],f[?][j+1]来构成</span></span><br><span class=\"line\"><span class=\"comment\">//一共到达n，有f[n][1],f[n][2],f[n][n]中方法，一个是true，就返回</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">canCross</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt;&amp; stones)</span> </span>&#123;</span><br><span class=\"line\">        unordered_map&lt;<span class=\"type\">int</span>,<span class=\"type\">int</span>&gt; rec;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> n=stones.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; stones.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            rec[stones[i]]=i;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> end=stones[stones.<span class=\"built_in\">size</span>()<span class=\"number\">-1</span>];</span><br><span class=\"line\">        vector&lt;vector&lt;<span class=\"type\">bool</span>&gt;&gt; <span class=\"built_in\">f</span>(n,<span class=\"built_in\">vector</span>&lt;<span class=\"type\">bool</span>&gt;(n, <span class=\"literal\">false</span>));</span><br><span class=\"line\">        f[<span class=\"number\">0</span>][<span class=\"number\">1</span>]=<span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"comment\">//开门表示，0开始一步跳是可以的</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">1</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">1</span>; j &lt; n; ++j) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(i==<span class=\"number\">0</span>&amp;&amp;j==<span class=\"number\">1</span>)<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                <span class=\"type\">int</span> x=stones[i];</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(rec.<span class=\"built_in\">count</span>(x-j))&#123;</span><br><span class=\"line\">                    f[i][j]=f[i][j]||f[rec[x-j]][j];</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(rec.<span class=\"built_in\">count</span>(x-j<span class=\"number\">-1</span>)&amp;&amp;j+<span class=\"number\">1</span>&lt;n)&#123;</span><br><span class=\"line\">                    f[i][j]=f[i][j]||f[rec[x-j<span class=\"number\">-1</span>]][j+<span class=\"number\">1</span>];</span><br><span class=\"line\">                &#125;<span class=\"keyword\">if</span>(rec.<span class=\"built_in\">count</span>(x-j+<span class=\"number\">1</span>)&amp;&amp;j<span class=\"number\">-1</span>&gt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                    f[i][j]=f[i][j]||f[rec[x-j+<span class=\"number\">1</span>]][j<span class=\"number\">-1</span>];</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">1</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(f[n<span class=\"number\">-1</span>][i])<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">canCross</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt;&amp; stones)</span> </span>&#123;</span><br><span class=\"line\">         <span class=\"type\">int</span> len = stones.<span class=\"built_in\">size</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//dp[i][j] 表示 第 i 个石头是否可以跳 j 步</span></span><br><span class=\"line\">        <span class=\"comment\">// boolean[][] dp = new boolean[len][len + 1];</span></span><br><span class=\"line\">                vector&lt;vector&lt;<span class=\"type\">bool</span>&gt;&gt; <span class=\"built_in\">dp</span>(len,<span class=\"built_in\">vector</span>&lt;<span class=\"type\">bool</span>&gt;(len+<span class=\"number\">1</span>, <span class=\"literal\">false</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//初始条件：第 0 个石头可以跳 1 步</span></span><br><span class=\"line\">        dp[<span class=\"number\">0</span>][<span class=\"number\">1</span>] = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">1</span>; i &lt; len; i++)&#123;</span><br><span class=\"line\">            <span class=\"type\">bool</span> flag = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            <span class=\"comment\">//因为 石头 i 最大只能跳 i + 1 步，因此 前面的石头 j 到达 石头 i 的距离必须 &lt;= i</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j = i - <span class=\"number\">1</span>; j &gt;= <span class=\"number\">0</span>; j--)&#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> diff = stones[i] - stones[j];</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(diff &gt; i)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">//对于 石头 j ，它需要跳 diff 步</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(dp[j][diff])&#123;</span><br><span class=\"line\">                    dp[i][diff - <span class=\"number\">1</span>] = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    dp[i][diff] = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    dp[i][diff + <span class=\"number\">1</span>] = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    flag = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//当到达了终点 而 flag ，表示无法从前面的任意石头跳到终点，返回 false</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(i == len - <span class=\"number\">1</span> &amp;&amp; !flag)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"429-N-叉树的层序遍历\"><a href=\"#429-N-叉树的层序遍历\" class=\"headerlink\" title=\"429. N 叉树的层序遍历\"></a><a href=\"https://leetcode.cn/problems/n-ary-tree-level-order-traversal/\">429. N 叉树的层序遍历</a></h2><p>模板题目</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">levelOrder</span>(Node* root) &#123;</span><br><span class=\"line\">        vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; ans;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!root)<span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">        queue&lt;Node*&gt; q;</span><br><span class=\"line\">        q.<span class=\"built_in\">push</span>(root);</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(q.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> n=q.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">            vector&lt;<span class=\"type\">int</span>&gt; path;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">auto</span> cur=q.<span class=\"built_in\">front</span>();</span><br><span class=\"line\">                q.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">                path.<span class=\"built_in\">push_back</span>(cur-&gt;val);</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; cur-&gt;children.<span class=\"built_in\">size</span>(); ++j) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(cur-&gt;children[j])&#123;</span><br><span class=\"line\">                        q.<span class=\"built_in\">push</span>(cur-&gt;children[j]);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"513-找树左下角的值\"><a href=\"#513-找树左下角的值\" class=\"headerlink\" title=\"513. 找树左下角的值\"></a><a href=\"https://leetcode.cn/problems/find-bottom-left-tree-value/\">513. 找树左下角的值</a></h2><p>dfs，直接加入depth，然后第一次出现的就进行设置，从做开始到右边</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"type\">int</span> max=<span class=\"number\">0</span>,ans=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">findBottomLeftValue</span><span class=\"params\">(TreeNode* root)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(root,<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(TreeNode* root,<span class=\"type\">int</span> depth)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!root)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(depth&gt;max)&#123;</span><br><span class=\"line\">            max=depth;</span><br><span class=\"line\">            ans=root-&gt;val;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(root-&gt;left,depth+<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(root-&gt;right,depth+<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>或者直接每一层的用vector存着，然后放出第一个</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title\">findBottomLeftValue</span><span class=\"params\">(TreeNode root)</span> </span>&#123;</span><br><span class=\"line\">        Deque&lt;TreeNode&gt; d = <span class=\"keyword\">new</span> ArrayDeque&lt;&gt;();</span><br><span class=\"line\">        d.<span class=\"built_in\">addLast</span>(root);</span><br><span class=\"line\">        <span class=\"type\">int</span> ans = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (!d.<span class=\"built_in\">isEmpty</span>()) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> sz = d.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">            ans = d.<span class=\"built_in\">peek</span>().val;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (sz-- &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                TreeNode poll = d.<span class=\"built_in\">pollFirst</span>();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (poll.left != null) d.<span class=\"built_in\">addLast</span>(poll.left);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (poll.right != null) d.<span class=\"built_in\">addLast</span>(poll.right);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"515-在每个树行中找最大值\"><a href=\"#515-在每个树行中找最大值\" class=\"headerlink\" title=\"515. 在每个树行中找最大值\"></a><a href=\"https://leetcode.cn/problems/find-largest-value-in-each-tree-row/\">515. 在每个树行中找最大值</a></h2><p>标准的层序，然后当前的进行比较，放进去，或者是使用dfs来对每一个进行大小比较</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    unordered_map&lt;<span class=\"type\">int</span>,<span class=\"type\">int</span>&gt; rec;</span><br><span class=\"line\">    <span class=\"type\">int</span> max1;</span><br><span class=\"line\">    <span class=\"function\">vector&lt;<span class=\"type\">int</span>&gt; <span class=\"title\">largestValues</span><span class=\"params\">(TreeNode* root)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!root)<span class=\"keyword\">return</span> &#123;&#125;;</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(root,<span class=\"number\">0</span>);</span><br><span class=\"line\">        rec[<span class=\"number\">0</span>]=root-&gt;val;</span><br><span class=\"line\">        vector&lt;<span class=\"type\">int</span>&gt;ans;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt;=max1; ++i) &#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(rec[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(TreeNode* root,<span class=\"type\">int</span> depth)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!root)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(depth&gt;max1)&#123;</span><br><span class=\"line\">            max1=depth;</span><br><span class=\"line\">            rec[depth]=root-&gt;val;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            rec[depth]=<span class=\"built_in\">max</span>(rec[depth],root-&gt;val);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(root-&gt;left,depth+<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(root-&gt;right,depth+<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"559-N-叉树的最大深度\"><a href=\"#559-N-叉树的最大深度\" class=\"headerlink\" title=\"559. N 叉树的最大深度\"></a><a href=\"https://leetcode.cn/problems/maximum-depth-of-n-ary-tree/\">559. N 叉树的最大深度</a></h2><p>简单模板</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    unordered_map&lt;<span class=\"type\">int</span>,<span class=\"type\">int</span>&gt; rec;</span><br><span class=\"line\">    <span class=\"type\">int</span> maxdepth=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">maxDepth</span><span class=\"params\">(Node* root)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!root)<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> ans=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"comment\">//        rec[0]=1;</span></span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(root,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt;=maxdepth ; ++i) &#123;</span><br><span class=\"line\">            ans=<span class=\"built_in\">max</span>(rec[i],ans);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> maxdepth+<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(Node* root,<span class=\"type\">int</span> depth)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!root)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(depth&gt; maxdepth)&#123;</span><br><span class=\"line\">            maxdepth=depth;</span><br><span class=\"line\">            rec[maxdepth]=<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            rec[depth]++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; root-&gt;children.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(root-&gt;children[i],depth+<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"623-在二叉树中增加一行\"><a href=\"#623-在二叉树中增加一行\" class=\"headerlink\" title=\"623. 在二叉树中增加一行\"></a><a href=\"https://leetcode.cn/problems/add-one-row-to-tree/\">623. 在二叉树中增加一行</a></h2><p>最开始就是在0层直接加，其它层就是找到深度-1的时候加入</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\">TreeNode* <span class=\"title\">addOneRow</span><span class=\"params\">(TreeNode* root, <span class=\"type\">int</span> val, <span class=\"type\">int</span> depth)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(depth == <span class=\"number\">1</span>)<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">TreeNode</span>(val,root, <span class=\"literal\">nullptr</span>);</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(root,val,depth,<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> root;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(TreeNode* root, <span class=\"type\">int</span> val, <span class=\"type\">int</span> depth,<span class=\"type\">int</span> height)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(height == depth - <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            root-&gt;left = <span class=\"keyword\">new</span> <span class=\"built_in\">TreeNode</span>(val,root-&gt;left, <span class=\"literal\">nullptr</span>);</span><br><span class=\"line\">            root-&gt;right = <span class=\"keyword\">new</span> <span class=\"built_in\">TreeNode</span>(val,<span class=\"literal\">nullptr</span>,root-&gt;right);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(root-&gt;left)</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(root-&gt;left,val,depth,height+<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (root-&gt;right)</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(root-&gt;right,val,depth,height+<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"669-修剪二叉搜索树\"><a href=\"#669-修剪二叉搜索树\" class=\"headerlink\" title=\"669. 修剪二叉搜索树\"></a><a href=\"https://leetcode.cn/problems/trim-a-binary-search-tree/\">669. 修剪二叉搜索树</a></h2><p>好题目，主要是想多了，如果当前值小，就返回右边的值（因为是bst，右边一定大），如果大，就返回左边的，如果符合返回root</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\">TreeNode* <span class=\"title\">trimBST</span><span class=\"params\">(TreeNode* root, <span class=\"type\">int</span> low, <span class=\"type\">int</span> high)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!root)<span class=\"keyword\">return</span> <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(root-&gt;val&lt;low)&#123;</span><br><span class=\"line\">            <span class=\"comment\">//当前的国小,返回右边的</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">trimBST</span>(root-&gt;right,low,high);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(root-&gt;val&gt;high)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">trimBST</span>(root-&gt;left,low,high);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        root-&gt;left=<span class=\"built_in\">trimBST</span>(root-&gt;left,low,high);</span><br><span class=\"line\">        root-&gt;right=<span class=\"built_in\">trimBST</span>(root-&gt;right,low,high);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> root;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"127-单词接龙\"><a href=\"#127-单词接龙\" class=\"headerlink\" title=\"127. 单词接龙\"></a><a href=\"https://leetcode.cn/problems/word-ladder/\">127. 单词接龙</a></h2><p>这个是求最短的变换方式，就是最小步数模型。我们通过检索每一个位置，然后进行a-z的变形，而且在指点里面就进行加入</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unordered_set&lt;string&gt; S;</span><br><span class=\"line\">      unordered_map&lt;string, int&gt; dist;</span><br><span class=\"line\">      queue&lt;string&gt; q;</span><br><span class=\"line\">      dist[beginWord] = 1;</span><br><span class=\"line\">      q.push(beginWord);</span><br><span class=\"line\">      for (auto word: wordList) S.insert(word);</span><br><span class=\"line\"></span><br><span class=\"line\">      while (q.size()) &#123;</span><br><span class=\"line\">          auto t = q.front();</span><br><span class=\"line\">          q.pop();</span><br><span class=\"line\">          string r = t;</span><br><span class=\"line\">          for (int i = 0; i &lt; t.size(); i ++ ) &#123;</span><br><span class=\"line\">              t = r;</span><br><span class=\"line\">              for (char j = &#x27;a&#x27;; j &lt;= &#x27;z&#x27;; j ++ )</span><br><span class=\"line\">                  if (r[i] != j) &#123;</span><br><span class=\"line\">                      t[i] = j;</span><br><span class=\"line\">                      if (S.count(t) &amp;&amp; dist.count(t) == 0) &#123;</span><br><span class=\"line\">                          dist[t] = dist[r] + 1;</span><br><span class=\"line\">                          if (t == endWord) return dist[t];</span><br><span class=\"line\">                          q.push(t);</span><br><span class=\"line\">                      &#125;</span><br><span class=\"line\">                  &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      return 0;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"417-太平洋大西洋水流问题\"><a href=\"#417-太平洋大西洋水流问题\" class=\"headerlink\" title=\"417. 太平洋大西洋水流问题\"></a><a href=\"https://leetcode.cn/problems/pacific-atlantic-water-flow/\">417. 太平洋大西洋水流问题</a></h2><p>都可以流的，那我们只需要2次遍历，一次太平洋，一次大西洋，然后都可以的，两次遍历，取公共</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">static</span> <span class=\"type\">const</span> <span class=\"type\">int</span> dirs[<span class=\"number\">4</span>][<span class=\"number\">2</span>] = &#123;&#123;<span class=\"number\">-1</span>, <span class=\"number\">0</span>&#125;, &#123;<span class=\"number\">1</span>, <span class=\"number\">0</span>&#125;, &#123;<span class=\"number\">0</span>, <span class=\"number\">-1</span>&#125;, &#123;<span class=\"number\">0</span>, <span class=\"number\">1</span>&#125;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; heights;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">bfs</span><span class=\"params\">(<span class=\"type\">int</span> row, <span class=\"type\">int</span> col, vector&lt;vector&lt;<span class=\"type\">bool</span>&gt;&gt; &amp; ocean)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ocean[row][col]) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> m = heights.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">        <span class=\"type\">int</span> n = heights[<span class=\"number\">0</span>].<span class=\"built_in\">size</span>();</span><br><span class=\"line\">        ocean[row][col] = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        queue&lt;pair&lt;<span class=\"type\">int</span>, <span class=\"type\">int</span>&gt;&gt; qu;</span><br><span class=\"line\">        qu.<span class=\"built_in\">emplace</span>(row, col);</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (!qu.<span class=\"built_in\">empty</span>()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">auto</span> [row, col] = qu.<span class=\"built_in\">front</span>();</span><br><span class=\"line\">            qu.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">4</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> newRow = row + dirs[i][<span class=\"number\">0</span>], newCol = col + dirs[i][<span class=\"number\">1</span>];</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (newRow &gt;= <span class=\"number\">0</span> &amp;&amp; newRow &lt; m &amp;&amp; newCol &gt;= <span class=\"number\">0</span> &amp;&amp; newCol &lt; n &amp;&amp; heights[newRow][newCol] &gt;= heights[row][col] &amp;&amp; !ocean[newRow][newCol]) &#123;</span><br><span class=\"line\">                    ocean[newRow][newCol] = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    qu.<span class=\"built_in\">emplace</span>(newRow, newCol);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">pacificAtlantic</span>(vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt;&amp; heights) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>-&gt;heights = heights;</span><br><span class=\"line\">        <span class=\"type\">int</span> m = heights.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">        <span class=\"type\">int</span> n = heights[<span class=\"number\">0</span>].<span class=\"built_in\">size</span>();</span><br><span class=\"line\">        vector&lt;vector&lt;<span class=\"type\">bool</span>&gt;&gt; <span class=\"built_in\">pacific</span>(m, <span class=\"built_in\">vector</span>&lt;<span class=\"type\">bool</span>&gt;(n, <span class=\"literal\">false</span>));</span><br><span class=\"line\">        vector&lt;vector&lt;<span class=\"type\">bool</span>&gt;&gt; <span class=\"built_in\">atlantic</span>(m, <span class=\"built_in\">vector</span>&lt;<span class=\"type\">bool</span>&gt;(n, <span class=\"literal\">false</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; m; i++) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">bfs</span>(i, <span class=\"number\">0</span>, pacific);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">1</span>; j &lt; n; j++) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">bfs</span>(<span class=\"number\">0</span>, j, pacific);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; m; i++) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">bfs</span>(i, n - <span class=\"number\">1</span>, atlantic);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; n - <span class=\"number\">1</span>; j++) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">bfs</span>(m - <span class=\"number\">1</span>, j, atlantic);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; result;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; m; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; n; j++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (pacific[i][j] &amp;&amp; atlantic[i][j]) &#123;</span><br><span class=\"line\">                    vector&lt;<span class=\"type\">int</span>&gt; cell;</span><br><span class=\"line\">                    cell.<span class=\"built_in\">emplace_back</span>(i);</span><br><span class=\"line\">                    cell.<span class=\"built_in\">emplace_back</span>(j);</span><br><span class=\"line\">                    result.<span class=\"built_in\">emplace_back</span>(cell);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"433-最小基因变化\"><a href=\"#433-最小基因变化\" class=\"headerlink\" title=\"433. 最小基因变化\"></a><a href=\"https://leetcode.cn/problems/minimum-genetic-mutation/\">433. 最小基因变化</a></h2><p>简单的最小步数模型，和前两题一样</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">minMutation</span><span class=\"params\">(string startGene, string endGene, vector&lt;string&gt;&amp; bank)</span> </span>&#123;</span><br><span class=\"line\">        queue&lt;string&gt; q;</span><br><span class=\"line\">        q.<span class=\"built_in\">push</span>(startGene);</span><br><span class=\"line\">        <span class=\"type\">int</span> step=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> t=<span class=\"number\">0</span>;</span><br><span class=\"line\">        set&lt;string&gt; st;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; bank.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (bank[i]==endGene)&#123;</span><br><span class=\"line\">                t=<span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            st.<span class=\"built_in\">insert</span>(bank[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        set&lt;string &gt; rec;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(t==<span class=\"number\">0</span>)<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">        rec.<span class=\"built_in\">insert</span>(startGene);</span><br><span class=\"line\">        <span class=\"type\">char</span> dic[<span class=\"number\">4</span>]=&#123;<span class=\"string\">&#x27;A&#x27;</span>,<span class=\"string\">&#x27;T&#x27;</span>,<span class=\"string\">&#x27;C&#x27;</span>,<span class=\"string\">&#x27;G&#x27;</span>&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (q.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> n=q.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">auto</span>  cur=q.<span class=\"built_in\">front</span>();</span><br><span class=\"line\"><span class=\"comment\">//                cout&lt;&lt;cur&lt;&lt;endl;</span></span><br><span class=\"line\">                q.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(cur==endGene)<span class=\"keyword\">return</span> step;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; cur.<span class=\"built_in\">size</span>(); ++j) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> k = <span class=\"number\">0</span>; k &lt; <span class=\"number\">4</span>; ++k) &#123;</span><br><span class=\"line\">                        string b=cur;</span><br><span class=\"line\"></span><br><span class=\"line\">                        b[j]=dic[k];</span><br><span class=\"line\"><span class=\"comment\">//                        cout&lt;&lt;cur&lt;&lt;endl;</span></span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"keyword\">if</span>(st.<span class=\"built_in\">count</span>(b))&#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span>(!rec.<span class=\"built_in\">count</span>(b))&#123;</span><br><span class=\"line\">                                q.<span class=\"built_in\">push</span>(b);</span><br><span class=\"line\">                                rec.<span class=\"built_in\">insert</span>(b);</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            step++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"752-打开转盘锁\"><a href=\"#752-打开转盘锁\" class=\"headerlink\" title=\"752. 打开转盘锁\"></a><a href=\"https://leetcode.cn/problems/open-the-lock/\">752. 打开转盘锁</a></h2><p>最小步数模型，就是这样的模板，修改，如果为9，就变0或者8</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">openLock</span><span class=\"params\">(vector&lt;string&gt;&amp; deadends, string target)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//状态转移,使用最小步数模型,使用bfs</span></span><br><span class=\"line\">        queue&lt;string&gt; q;</span><br><span class=\"line\">        q.<span class=\"built_in\">push</span>(<span class=\"string\">&quot;0000&quot;</span>);</span><br><span class=\"line\">        unordered_map&lt;string,<span class=\"type\">int</span>&gt; rec;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; deadends.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            rec[deadends[i]]=<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (rec.<span class=\"built_in\">find</span>(<span class=\"string\">&quot;0000&quot;</span>)!=rec.<span class=\"built_in\">end</span>())<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        rec[<span class=\"string\">&quot;0000&quot;</span>]=<span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> ans=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(q.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> n=q.<span class=\"built_in\">size</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">auto</span> cur=q.<span class=\"built_in\">front</span>();</span><br><span class=\"line\">                q.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\"><span class=\"comment\">//                cout&lt;&lt;cur&lt;&lt;&quot; &quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (cur==target)<span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; <span class=\"number\">4</span>; ++j) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">auto</span> a= <span class=\"built_in\">up</span>(cur,j);</span><br><span class=\"line\">                    <span class=\"keyword\">auto</span> b= <span class=\"built_in\">down</span>(cur,j);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(rec.<span class=\"built_in\">find</span>(a)==rec.<span class=\"built_in\">end</span>())&#123;</span><br><span class=\"line\">                        q.<span class=\"built_in\">push</span>(a);</span><br><span class=\"line\">                        rec[a]=<span class=\"number\">1</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(rec.<span class=\"built_in\">find</span>(b)==rec.<span class=\"built_in\">end</span>())&#123;</span><br><span class=\"line\">                        q.<span class=\"built_in\">push</span>(b);</span><br><span class=\"line\">                        rec[b]=<span class=\"number\">1</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//每一次++</span></span><br><span class=\"line\">            ans++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\">string <span class=\"title\">up</span><span class=\"params\">(string s,<span class=\"type\">int</span> i)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(s[i]==<span class=\"string\">&#x27;9&#x27;</span>)&#123;</span><br><span class=\"line\">            s[i]=<span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            s[i]=s[i]+<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> s;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\">string <span class=\"title\">down</span><span class=\"params\">(string s,<span class=\"type\">int</span> i)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(s[i]==<span class=\"string\">&#x27;0&#x27;</span>)&#123;</span><br><span class=\"line\">            s[i]=<span class=\"string\">&#x27;9&#x27;</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            s[i]=s[i]<span class=\"number\">-1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> s;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"2-DFS\"><a href=\"#2-DFS\" class=\"headerlink\" title=\"2.DFS\"></a>2.DFS</h1><p>dfs一般就是爆搜，进行排列组合，组合数，一般就是直接sort，排列数，就是使用st数组，然后continue条件就是排列是0，组合是u</p>\n<h2 id=\"17-电话号码的字母组合\"><a href=\"#17-电话号码的字母组合\" class=\"headerlink\" title=\"17. 电话号码的字母组合\"></a><a href=\"https://leetcode.cn/problems/letter-combinations-of-a-phone-number/\">17. 电话号码的字母组合</a></h2><p>这个是组合数，u&#x3D;，直接push进去。正常的回溯教程</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;string&gt; ans;</span><br><span class=\"line\">    string strs[<span class=\"number\">10</span>] = &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;abc&quot;</span>, <span class=\"string\">&quot;def&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;ghi&quot;</span>, <span class=\"string\">&quot;jkl&quot;</span>, <span class=\"string\">&quot;mno&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;pqrs&quot;</span>, <span class=\"string\">&quot;tuv&quot;</span>, <span class=\"string\">&quot;wxyz&quot;</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    string path;</span><br><span class=\"line\">    <span class=\"function\">vector&lt;string&gt; <span class=\"title\">letterCombinations</span><span class=\"params\">(string digits)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (digits.<span class=\"built_in\">empty</span>())<span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(digits,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(string digits,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u==digits.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u&gt;digits.<span class=\"built_in\">size</span>())<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> n=digits[u]-<span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; strs[n].<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            path.<span class=\"built_in\">push_back</span>(strs[n][i]);</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(digits,u+<span class=\"number\">1</span>);</span><br><span class=\"line\">            path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"22-括号生成\"><a href=\"#22-括号生成\" class=\"headerlink\" title=\"22. 括号生成\"></a><a href=\"https://leetcode.cn/problems/generate-parentheses/\">22. 括号生成</a></h2><p>这个条件就是左括号大于右括号，左右括号的值相等</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;string&gt; ans;</span><br><span class=\"line\">    string path;</span><br><span class=\"line\">    unordered_map&lt;<span class=\"type\">char</span>,<span class=\"type\">int</span>&gt; rec;</span><br><span class=\"line\">    <span class=\"function\">vector&lt;string&gt; <span class=\"title\">generateParenthesis</span><span class=\"params\">(<span class=\"type\">int</span> n)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(n,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"type\">int</span> n,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u==<span class=\"number\">2</span>*n)&#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"comment\">//        cout&lt;&lt;path&lt;&lt;&quot; &quot;;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(rec.<span class=\"built_in\">find</span>(<span class=\"string\">&#x27;(&#x27;</span>)==rec.<span class=\"built_in\">end</span>()||rec[<span class=\"string\">&#x27;(&#x27;</span>]&lt;n)&#123;</span><br><span class=\"line\">            path+=<span class=\"string\">&#x27;(&#x27;</span>;</span><br><span class=\"line\">            rec[<span class=\"string\">&#x27;(&#x27;</span>]++;</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(n,u+<span class=\"number\">1</span>);</span><br><span class=\"line\">            path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">            rec[<span class=\"string\">&#x27;(&#x27;</span>]--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (rec.<span class=\"built_in\">find</span>(<span class=\"string\">&#x27;)&#x27;</span>)==rec.<span class=\"built_in\">end</span>()||rec[<span class=\"string\">&#x27;)&#x27;</span>]&lt;rec[<span class=\"string\">&#x27;(&#x27;</span>])&#123;</span><br><span class=\"line\">            path+=<span class=\"string\">&#x27;)&#x27;</span>;</span><br><span class=\"line\">            rec[<span class=\"string\">&#x27;)&#x27;</span>]++;</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(n,u+<span class=\"number\">1</span>);</span><br><span class=\"line\">            path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">            rec[<span class=\"string\">&#x27;)&#x27;</span>]--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"37-解数独\"><a href=\"#37-解数独\" class=\"headerlink\" title=\"37. 解数独\"></a><a href=\"https://leetcode.cn/problems/sudoku-solver/\">37. 解数独</a></h2><p>数独解法就是回溯，然后还是使用多个数组来进行，初始化每一个有的点</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"type\">bool</span> row[<span class=\"number\">9</span>][<span class=\"number\">9</span>],col[<span class=\"number\">9</span>][<span class=\"number\">9</span>],block[<span class=\"number\">3</span>][<span class=\"number\">3</span>][<span class=\"number\">9</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">solveSudoku</span><span class=\"params\">(vector&lt;vector&lt;<span class=\"type\">char</span>&gt;&gt;&amp; board)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">memset</span>(row,<span class=\"literal\">false</span>,<span class=\"keyword\">sizeof</span> row);</span><br><span class=\"line\">        <span class=\"built_in\">memset</span>(col,<span class=\"literal\">false</span>,<span class=\"keyword\">sizeof</span> col);</span><br><span class=\"line\">        <span class=\"built_in\">memset</span>(block,<span class=\"literal\">false</span>,<span class=\"keyword\">sizeof</span> block);</span><br><span class=\"line\">        <span class=\"comment\">//初始化所有的点</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">9</span>;i++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>;j&lt;<span class=\"number\">9</span>;j++)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(board[i][j]!=<span class=\"string\">&#x27;.&#x27;</span>)&#123;</span><br><span class=\"line\">                    <span class=\"type\">int</span> t=board[i][j]-<span class=\"string\">&#x27;1&#x27;</span>;</span><br><span class=\"line\">                    row[i][t]=<span class=\"literal\">true</span>;</span><br><span class=\"line\">                    col[j][t]=<span class=\"literal\">true</span>;</span><br><span class=\"line\">                    block[i/<span class=\"number\">3</span>][j/<span class=\"number\">3</span>][t]=<span class=\"literal\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(board,<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">dfs</span><span class=\"params\">(vector&lt;vector&lt;<span class=\"type\">char</span>&gt;&gt;&amp; board,<span class=\"type\">int</span> x,<span class=\"type\">int</span> y)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (y==<span class=\"number\">9</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">//进入下一轮</span></span><br><span class=\"line\">            x++;</span><br><span class=\"line\">            y=<span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x==<span class=\"number\">9</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//判断当前点是不是.可以填入</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (board[x][y]!=<span class=\"string\">&#x27;.&#x27;</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">dfs</span>(board,x,y+<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt;<span class=\"number\">9</span>; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (row[x][i]||col[y][i]||block[x/<span class=\"number\">3</span>][y/<span class=\"number\">3</span>][i])<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                row[x][i]=col[y][i]=block[x/<span class=\"number\">3</span>][y/<span class=\"number\">3</span>][i]=<span class=\"literal\">true</span>;</span><br><span class=\"line\">                board[x][y]=<span class=\"string\">&#x27;0&#x27;</span>+i+<span class=\"number\">1</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"built_in\">dfs</span>(board,x,y+<span class=\"number\">1</span>))<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">                board[x][y]=<span class=\"string\">&#x27;.&#x27;</span>;</span><br><span class=\"line\">                row[x][i]=col[y][i]=block[x/<span class=\"number\">3</span>][y/<span class=\"number\">3</span>][i]=<span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                </span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"39-组合总和\"><a href=\"#39-组合总和\" class=\"headerlink\" title=\"39. 组合总和\"></a><a href=\"https://leetcode.cn/problems/combination-sum/\">39. 组合总和</a></h2><p>因为是组合，所以所以使用sort，还有continue，从u开始</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; ans;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; path;</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">combinationSum</span>(vector&lt;<span class=\"type\">int</span>&gt;&amp; candidates, <span class=\"type\">int</span> target) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">sort</span>(candidates.<span class=\"built_in\">begin</span>(),candidates.<span class=\"built_in\">end</span>());</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(candidates,target,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt; &amp;nums,<span class=\"type\">int</span> u,<span class=\"type\">int</span> index)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (u==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index==nums.<span class=\"built_in\">size</span>())<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u&lt;<span class=\"number\">0</span>)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = index; i &lt; nums.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            path.<span class=\"built_in\">push_back</span>(nums[i]);</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(nums,u-nums[i],i);</span><br><span class=\"line\">            path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"40-组合总和-II\"><a href=\"#40-组合总和-II\" class=\"headerlink\" title=\"40. 组合总和 II\"></a><a href=\"https://leetcode.cn/problems/combination-sum-ii/\">40. 组合总和 II</a></h2><p>这个就是药continue</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; path;</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; ans;</span><br><span class=\"line\"></span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">combinationSum2</span>(vector&lt;<span class=\"type\">int</span>&gt;&amp; candidates, <span class=\"type\">int</span> target) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">sort</span>(candidates.<span class=\"built_in\">begin</span>(),candidates.<span class=\"built_in\">end</span>());</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(candidates,target,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt; &amp;nums,<span class=\"type\">int</span> target,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(target==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u&gt;=nums.<span class=\"built_in\">size</span>())<span class=\"keyword\">return</span>;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//        cout&lt;&lt;target&lt;&lt;&quot;  &quot;;</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = u; i &lt; nums.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(nums[i]&gt;target)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i&gt;u&amp;&amp;nums[i]==nums[i<span class=\"number\">-1</span>])<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            path.<span class=\"built_in\">push_back</span>(nums[i]);</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(nums,target-nums[i],i+<span class=\"number\">1</span>);</span><br><span class=\"line\">            path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\"><span class=\"comment\">//            rec[nums[i]]=1;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"93-复原-IP-地址\"><a href=\"#93-复原-IP-地址\" class=\"headerlink\" title=\"93. 复原 IP 地址\"></a><a href=\"https://leetcode.cn/problems/restore-ip-addresses/\">93. 复原 IP 地址</a></h2><p>他这个前导0，需要用进行替换，用u+1代替s。szie</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"type\">int</span> start;</span><br><span class=\"line\">    <span class=\"type\">int</span> end;</span><br><span class=\"line\">    vector&lt;string&gt; ans;</span><br><span class=\"line\">    string path;</span><br><span class=\"line\">    <span class=\"function\">vector&lt;string&gt; <span class=\"title\">restoreIpAddresses</span><span class=\"params\">(string s)</span> </span>&#123;</span><br><span class=\"line\">        start=<span class=\"number\">0</span>,end=<span class=\"number\">255</span>;</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(s,<span class=\"number\">4</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(string s,<span class=\"type\">int</span> times,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//不出现011</span></span><br><span class=\"line\">        <span class=\"comment\">//只有3个小数点可以进行加入</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!times&amp;&amp;u==s.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (times&lt;<span class=\"number\">0</span>)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u&gt;=s.<span class=\"built_in\">size</span>())<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> n=u+<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(s[u]!=<span class=\"string\">&#x27;0&#x27;</span>)n=s.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">        <span class=\"comment\">// if(s[u]==&#x27;0&#x27;)&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//     path+=&quot;0.&quot;;</span></span><br><span class=\"line\">        <span class=\"comment\">//     dfs(s,times-1,u+1);</span></span><br><span class=\"line\">        <span class=\"comment\">//     return ;</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;else&#123;</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = u; i &lt; n; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (i-u+<span class=\"number\">1</span>&gt;<span class=\"number\">3</span>)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">                <span class=\"keyword\">auto</span> x=s.<span class=\"built_in\">substr</span>(u,i-u+<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">auto</span> t= <span class=\"built_in\">stoi</span>(x);</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(t&lt;=<span class=\"number\">255</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">auto</span> back=path;</span><br><span class=\"line\">                    path+=x+<span class=\"string\">&quot;.&quot;</span>;</span><br><span class=\"line\">                    <span class=\"built_in\">dfs</span>(s,times<span class=\"number\">-1</span>,i+<span class=\"number\">1</span>);</span><br><span class=\"line\">                    path=back;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        <span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"95-不同的二叉搜索树-II\"><a href=\"#95-不同的二叉搜索树-II\" class=\"headerlink\" title=\"95. 不同的二叉搜索树 II\"></a><a href=\"https://leetcode.cn/problems/unique-binary-search-trees-ii/\">95. 不同的二叉搜索树 II</a></h2><p>找出不同的bst，我们设置根节点为0到n-1，没次遍历，然后左右两边设置为左右树，同事也对每一个左右节点来作为root的左右</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\">vector&lt;TreeNode*&gt; <span class=\"title\">generateTrees</span><span class=\"params\">(<span class=\"type\">int</span> n)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 进行建树，从1-n开始，可以改成1-l-1，l，和l+1到n</span></span><br><span class=\"line\">        vector&lt;TreeNode*&gt; ans=<span class=\"built_in\">dfs</span>(<span class=\"number\">1</span>,n);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\">vector&lt;TreeNode*&gt; <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"type\">int</span> l,<span class=\"type\">int</span> r)</span></span>&#123;</span><br><span class=\"line\">        vector&lt;TreeNode*&gt; res;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(l&gt;r)&#123;</span><br><span class=\"line\">             res.<span class=\"built_in\">push_back</span>(<span class=\"literal\">NULL</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=l;i&lt;=r;i++)&#123;</span><br><span class=\"line\">        vector&lt;TreeNode*&gt; left=<span class=\"built_in\">dfs</span>(l,i<span class=\"number\">-1</span>);</span><br><span class=\"line\">        vector&lt;TreeNode*&gt; right=<span class=\"built_in\">dfs</span>(i+<span class=\"number\">1</span>,r);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 接着就是左右节点的选择</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">auto</span> &amp;L:left)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">auto</span> &amp;R:right)&#123;</span><br><span class=\"line\">                TreeNode *root = <span class=\"keyword\">new</span> <span class=\"built_in\">TreeNode</span>(i);</span><br><span class=\"line\">                    root-&gt;left = L;</span><br><span class=\"line\">                    root-&gt;right = R;</span><br><span class=\"line\">                    res.<span class=\"built_in\">push_back</span>(root);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"310-最小高度树\"><a href=\"#310-最小高度树\" class=\"headerlink\" title=\"310. 最小高度树\"></a><a href=\"https://leetcode.cn/problems/minimum-height-trees/\">310. 最小高度树</a></h2><p>建图也tle，使用树形dp，下次在写</p>\n<h2 id=\"386-字典序排数\"><a href=\"#386-字典序排数\" class=\"headerlink\" title=\"386. 字典序排数\"></a><a href=\"https://leetcode.cn/problems/lexicographical-numbers/\">386. 字典序排数</a></h2><p>这个的思路还是首先dfs，如果大于了，就返回，然后直接push</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; ans;</span><br><span class=\"line\">    <span class=\"function\">vector&lt;<span class=\"type\">int</span>&gt; <span class=\"title\">lexicalOrder</span><span class=\"params\">(<span class=\"type\">int</span> n)</span> </span>&#123;</span><br><span class=\"line\">        string path;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(<span class=\"built_in\">to_string</span>(n),<span class=\"number\">0</span>,path);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(string s ,<span class=\"type\">int</span> u,string path)</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u&gt;s.<span class=\"built_in\">size</span>())<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u&gt;<span class=\"number\">0</span>&amp;&amp;<span class=\"built_in\">stoi</span>(s)&lt; <span class=\"built_in\">stoi</span>(path))&#123;</span><br><span class=\"line\"><span class=\"comment\">//            ans.push_back(stoi(path));</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(u)&#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(<span class=\"built_in\">stoi</span>(path));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> start=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u==<span class=\"number\">0</span>)start=<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = start; i &lt;=<span class=\"number\">9</span>; ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">auto</span> b=path;</span><br><span class=\"line\">            path+= <span class=\"built_in\">to_string</span>(i);</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(s,u+<span class=\"number\">1</span>,path);</span><br><span class=\"line\">            path=b;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>首先对u来进行判断，u&#x3D;0，只能从1开始，其他都是</p>\n<h2 id=\"437-路径总和-III\"><a href=\"#437-路径总和-III\" class=\"headerlink\" title=\"437. 路径总和 III\"></a><a href=\"https://leetcode.cn/problems/path-sum-iii/\">437. 路径总和 III</a></h2><p>双重dfs，这个题目，首先第一次是遍历，第二次就是进行对以他为root，来查找路径</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\"><span class=\"comment\">//两个dfs，第一个遍历点，第二几个计算</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">int</span> ans;</span><br><span class=\"line\"><span class=\"type\">int</span> x;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">pathSum</span><span class=\"params\">(TreeNode* root, <span class=\"type\">int</span> targetSum)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!root)<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        x=targetSum;</span><br><span class=\"line\">        <span class=\"built_in\">dfs1</span>(root);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs1</span><span class=\"params\">(TreeNode* root)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!root)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"built_in\">dfs2</span>(root,x-root-&gt;val);</span><br><span class=\"line\"><span class=\"comment\">//        cout&lt;&lt;&quot;-----------&quot;&lt;&lt;endl;</span></span><br><span class=\"line\">        <span class=\"built_in\">dfs1</span>(root-&gt;left);</span><br><span class=\"line\">        <span class=\"built_in\">dfs1</span>(root-&gt;right);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs2</span><span class=\"params\">(TreeNode* root, <span class=\"type\">long</span> targetSum)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(targetSum==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            ans++;</span><br><span class=\"line\"><span class=\"comment\">//            return;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!root-&gt;left&amp;&amp;!root-&gt;right)<span class=\"keyword\">return</span>;</span><br><span class=\"line\"><span class=\"comment\">//       cout&lt;&lt;targetSum&lt;&lt;&quot; &quot;;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(root-&gt;left)<span class=\"built_in\">dfs2</span>(root-&gt;left,targetSum-root-&gt;left-&gt;val);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(root-&gt;right)<span class=\"built_in\">dfs2</span>(root-&gt;right,targetSum-root-&gt;right-&gt;val);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"473-火柴拼正方形\"><a href=\"#473-火柴拼正方形\" class=\"headerlink\" title=\"473. 火柴拼正方形\"></a><a href=\"https://leetcode.cn/problems/matchsticks-to-square/\">473. 火柴拼正方形</a></h2><p>这个就是和之前的分组都是一样的，可以看成k&#x3D;4，求解4个相等的</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;<span class=\"type\">bool</span>&gt; st;</span><br><span class=\"line\">    <span class=\"type\">int</span> x;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">makesquare</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt;&amp; matchsticks)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> sum= <span class=\"built_in\">accumulate</span>(matchsticks.<span class=\"built_in\">begin</span>(),matchsticks.<span class=\"built_in\">end</span>(),<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(sum%<span class=\"number\">4</span>)<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> k=sum/<span class=\"number\">4</span>;</span><br><span class=\"line\">        <span class=\"built_in\">sort</span>(matchsticks.<span class=\"built_in\">begin</span>(),matchsticks.<span class=\"built_in\">end</span>());</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(matchsticks.<span class=\"built_in\">back</span>()&gt;k)<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        st=<span class=\"built_in\">vector</span>&lt;<span class=\"type\">bool</span>&gt;(matchsticks.<span class=\"built_in\">size</span>(),<span class=\"literal\">false</span>);</span><br><span class=\"line\">        x=k;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">dfs</span>(matchsticks,x,<span class=\"number\">0</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">bool</span>  <span class=\"title\">dfs</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt; &amp;nums,<span class=\"type\">int</span> target,<span class=\"type\">int</span> index,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u==<span class=\"number\">4</span>)<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"comment\">//        cout&lt;&lt;u;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(target==<span class=\"number\">0</span>)<span class=\"keyword\">return</span> <span class=\"built_in\">dfs</span>(nums,x,<span class=\"number\">0</span>,u+<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"comment\">//        if(target&lt;0)return false;</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = index; i &lt; nums.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!st[i]&amp;&amp;target-nums[i]&gt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                st[i]=<span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"comment\">//                path.push_back(nums[i]);</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(<span class=\"built_in\">dfs</span>(nums,target-nums[i],i+<span class=\"number\">1</span>,u))&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                st[i]=<span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"comment\">//                path.pop_back();</span></span><br><span class=\"line\">                <span class=\"comment\">//排好序了的,如果当前都没办法减少到0,后面就不可能</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (target==x)<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>然后还是使用index开始，最后的一个剪纸条件就是，无论如何这个target都不在改变，那就是失败了。我们可以把target看成某一成的值，但是他在这一层不变，说明以后的层也不变</p>\n<h2 id=\"494-目标和\"><a href=\"#494-目标和\" class=\"headerlink\" title=\"494. 目标和\"></a><a href=\"https://leetcode.cn/problems/target-sum/\">494. 目标和</a></h2><p>dfs两次操作就是+，-</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"type\">int</span> ans;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">findTargetSumWays</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt;&amp; nums, <span class=\"type\">int</span> target)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(nums,<span class=\"number\">0</span>,target);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt;&amp; nums,<span class=\"type\">int</span> u,<span class=\"type\">int</span> target)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u==nums.<span class=\"built_in\">size</span>()&amp;&amp;target==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            ans++;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u&gt;=nums.<span class=\"built_in\">size</span>())<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(nums,u+<span class=\"number\">1</span>,target-nums[u]);</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(nums,u+<span class=\"number\">1</span>,target+nums[u]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"BFS","slug":"BFS","permalink":"http://yoursite.com/tags/BFS/"},{"name":"DFS","slug":"DFS","permalink":"http://yoursite.com/tags/DFS/"}]},{"title":"贪心","date":"2023-02-03T08:33:54.000Z","path":"2023/02/03/贪心/","content":"","tags":[]},{"title":"滑动窗口","date":"2023-01-27T03:54:55.000Z","path":"2023/01/27/滑动窗口/","content":"<h1 id=\"1-滑动窗口\"><a href=\"#1-滑动窗口\" class=\"headerlink\" title=\"1.滑动窗口\"></a>1.滑动窗口</h1><p>固定的模板talus就是,设置l,r,首先r++,当满足超过窗口大小的时候,使用while循环,来进行l++,之道跳出这个while循环,最后,还是r&lt;size</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> left = <span class=\"number\">0</span>, right = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">while</span> (right &lt; s.<span class=\"built_in\">size</span>()) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 增大窗口</span></span><br><span class=\"line\">    window.<span class=\"built_in\">add</span>(s[right]);</span><br><span class=\"line\">    right++;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">while</span> (window needs shrink) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 缩小窗口</span></span><br><span class=\"line\">        window.<span class=\"built_in\">remove</span>(s[left]);</span><br><span class=\"line\">        left++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"76最小覆盖字串\"><a href=\"#76最小覆盖字串\" class=\"headerlink\" title=\"76最小覆盖字串\"></a>76最小覆盖字串</h2><p>这个的窗口大小就是t字符串不同的数量,当相等的时候,就进行比较最大值,然后进行移除</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\">string <span class=\"title\">minWindow</span><span class=\"params\">(string s, string t)</span> </span>&#123;</span><br><span class=\"line\">        unordered_map&lt;<span class=\"type\">char</span>,<span class=\"type\">int</span>&gt; rec;</span><br><span class=\"line\">        unordered_map&lt;<span class=\"type\">char</span>,<span class=\"type\">int</span>&gt; cnt;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">auto</span> c:t)&#123;</span><br><span class=\"line\">            rec[c]++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> total=rec.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">        <span class=\"type\">int</span> i=<span class=\"number\">0</span>,j=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> u=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"comment\">//u是总数,当前的,窗口条件,dp</span></span><br><span class=\"line\">        string ans=s;</span><br><span class=\"line\">        <span class=\"type\">bool</span> flag=<span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> start=<span class=\"number\">0</span>,len=INT_MAX;</span><br><span class=\"line\">       <span class=\"keyword\">while</span>(i&lt;s.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (rec.<span class=\"built_in\">find</span>(s[i])!=rec.<span class=\"built_in\">end</span>())&#123;</span><br><span class=\"line\">               cnt[s[i]]++;</span><br><span class=\"line\">               <span class=\"keyword\">if</span>(cnt[s[i]]==rec[s[i]])&#123;</span><br><span class=\"line\">                   u++;</span><br><span class=\"line\">                   <span class=\"comment\">//统计有多少个了</span></span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           <span class=\"comment\">//下面是提纯操作,进行更新什么的</span></span><br><span class=\"line\"></span><br><span class=\"line\">           <span class=\"keyword\">while</span>(u==total)&#123;</span><br><span class=\"line\">               flag=<span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(i-j+<span class=\"number\">1</span>&lt;len)&#123;</span><br><span class=\"line\">                    start=j;</span><br><span class=\"line\">                    len=i-j+<span class=\"number\">1</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span>(rec.<span class=\"built_in\">find</span>(s[j])!=rec.<span class=\"built_in\">end</span>())&#123;</span><br><span class=\"line\">                   cnt[s[j]]--;</span><br><span class=\"line\">                   <span class=\"keyword\">if</span>(cnt[s[j]]&lt;rec[s[j]])&#123;</span><br><span class=\"line\">                       u--;</span><br><span class=\"line\">                   &#125;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               j++;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           i++;</span><br><span class=\"line\"></span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"keyword\">if</span>(!flag)<span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> s.<span class=\"built_in\">substr</span>(start,len);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"567-字符串的排列\"><a href=\"#567-字符串的排列\" class=\"headerlink\" title=\"567. 字符串的排列\"></a><a href=\"https://leetcode.cn/problems/permutation-in-string/\">567. 字符串的排列</a></h2><p>这个和上一题差不多,也是</p>\n<p>这个思路,然后就是如果长度一样,那么就是直接返回true</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">checkInclusion</span><span class=\"params\">(string s1, string s2)</span> </span>&#123;</span><br><span class=\"line\">        unordered_map&lt;<span class=\"type\">char</span>,<span class=\"type\">int</span>&gt; rec,window;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">auto</span> c:s1)rec[c]++;</span><br><span class=\"line\">        <span class=\"type\">int</span> l=<span class=\"number\">0</span>,r=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> u=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(l&lt;s2.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            <span class=\"type\">char</span> c=s2[l];</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(rec.<span class=\"built_in\">count</span>(c))&#123;</span><br><span class=\"line\">                window[c]++;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (window[c]==rec[c])u++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            l++;</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(u==rec.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(l-r==s1.<span class=\"built_in\">size</span>())<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">                <span class=\"keyword\">auto</span> t=s2[r];</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(rec.<span class=\"built_in\">count</span>(t))&#123;</span><br><span class=\"line\">                    window[t]--;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(window[t]&lt;rec[t])&#123;</span><br><span class=\"line\">                        u--;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                r++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-无重复字符的最长子串\"><a href=\"#3-无重复字符的最长子串\" class=\"headerlink\" title=\"3. 无重复字符的最长子串\"></a><a href=\"https://leetcode.cn/problems/longest-substring-without-repeating-characters/\">3. 无重复字符的最长子串</a></h2><p>求出最大的最长字串,那么这个窗口就是每一个字母出现的次数就是1,超过1,就开始进行滑动窗口</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">lengthOfLongestSubstring</span><span class=\"params\">(string s)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> l=<span class=\"number\">0</span>,r=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> ans=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> u=<span class=\"number\">0</span>;</span><br><span class=\"line\">        unordered_map&lt;<span class=\"type\">char</span>,<span class=\"type\">int</span>&gt; rec;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(r&lt;s.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            <span class=\"keyword\">auto</span> c=s[r];</span><br><span class=\"line\">            rec[c]++;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//abb</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span>(rec[s[r]]&gt;<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">auto</span> t=s[l];</span><br><span class=\"line\">                rec[t]--;</span><br><span class=\"line\">                l++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            r++;</span><br><span class=\"line\">            ans=<span class=\"built_in\">max</span>(ans,r-l);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"1004-最大连续1的个数-III\"><a href=\"#1004-最大连续1的个数-III\" class=\"headerlink\" title=\"1004. 最大连续1的个数 III\"></a><a href=\"https://leetcode.cn/problems/max-consecutive-ones-iii/\">1004. 最大连续1的个数 III</a></h2><p>这个就是滑动窗口是0出现的次数，然后如果超过k，就进行更新</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">longestOnes</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt;&amp; nums, <span class=\"type\">int</span> k)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//窗口值就是k，放的是0</span></span><br><span class=\"line\"><span class=\"comment\">//        unordered_map&lt;int,int&gt; rec;</span></span><br><span class=\"line\">        <span class=\"type\">int</span> cnt=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> l=<span class=\"number\">0</span>,r=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> ans=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(r&lt;nums.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            <span class=\"keyword\">auto</span> c=nums[r];</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(c==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                cnt++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            r++;</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(cnt&gt;k)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(nums[l]==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                    cnt--;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                l++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//此时就是cnt==k</span></span><br><span class=\"line\">            ans=<span class=\"built_in\">max</span>(ans,r-l);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"1438-绝对差不超过限制的最长连续子数组\"><a href=\"#1438-绝对差不超过限制的最长连续子数组\" class=\"headerlink\" title=\"1438. 绝对差不超过限制的最长连续子数组\"></a><a href=\"https://leetcode.cn/problems/longest-continuous-subarray-with-absolute-diff-less-than-or-equal-to-limit/\">1438. 绝对差不超过限制的最长连续子数组</a></h2><p>这个的滑动窗口就是最大值减去最小值是小于k，所以一旦超过就进行更新，使用set可以来得到最大值还有最小值，然后进行计算</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">longestSubarray</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt;&amp; nums, <span class=\"type\">int</span> limit)</span> </span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//        int l=0,r=0;</span></span><br><span class=\"line\"><span class=\"comment\">//        int ans=0;</span></span><br><span class=\"line\"><span class=\"comment\">//        multiset&lt;int&gt; s;</span></span><br><span class=\"line\"><span class=\"comment\">//        while(r&lt;nums.size())&#123;</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//            s.insert(nums[r]);</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//            while(*s.rbegin()-*s.rend()&gt;limit)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">//                s.erase(s.find(nums[l]));</span></span><br><span class=\"line\"><span class=\"comment\">//                l++;</span></span><br><span class=\"line\"><span class=\"comment\">//            &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//            r++;</span></span><br><span class=\"line\"><span class=\"comment\">//            ans= max(ans,r-l);</span></span><br><span class=\"line\"><span class=\"comment\">//        &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//        return ans;</span></span><br><span class=\"line\">        multiset&lt;<span class=\"type\">int</span>&gt; st;</span><br><span class=\"line\">        <span class=\"type\">int</span> left = <span class=\"number\">0</span>, right = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> res = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (right &lt; nums.<span class=\"built_in\">size</span>()) &#123;</span><br><span class=\"line\">            st.<span class=\"built_in\">insert</span>(nums[right]);</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (*st.<span class=\"built_in\">rbegin</span>() - *st.<span class=\"built_in\">begin</span>() &gt; limit) &#123;</span><br><span class=\"line\">                st.<span class=\"built_in\">erase</span>(st.<span class=\"built_in\">find</span>(nums[left]));</span><br><span class=\"line\">                left ++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            res = <span class=\"built_in\">max</span>(res, right - left + <span class=\"number\">1</span>);</span><br><span class=\"line\">            right ++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">is_ok</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt; &amp;nums,<span class=\"type\">int</span> l,<span class=\"type\">int</span> r)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(l==r)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> t=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = l; i &lt; r; ++i) &#123;</span><br><span class=\"line\">            t=<span class=\"built_in\">max</span>(<span class=\"built_in\">abs</span>(nums[r]-nums[i]),t);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">max</span>(t, <span class=\"built_in\">is_ok</span>(nums,l,r<span class=\"number\">-1</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"1658-将-x-减到-0-的最小操作数\"><a href=\"#1658-将-x-减到-0-的最小操作数\" class=\"headerlink\" title=\"1658. 将 x 减到 0 的最小操作数\"></a><a href=\"https://leetcode.cn/problems/minimum-operations-to-reduce-x-to-zero/\">1658. 将 x 减到 0 的最小操作数</a></h2><p>这个的思路就是计算最左+最右&#x3D;5，那我们可以计算中间的&#x3D;整体的-5，然后我们可以使用前缀和，来进行计算，如果等于了，就来计算。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"comment\">//这题思路就是统计中间数值是acc（nums）-x的最大距离</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">minOperations</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt;&amp; nums, <span class=\"type\">int</span> x)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> sum= <span class=\"built_in\">accumulate</span>(nums.<span class=\"built_in\">begin</span>(),nums.<span class=\"built_in\">end</span>(),<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"type\">int</span> target=sum-x;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(target&lt;<span class=\"number\">0</span>)<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> l=<span class=\"number\">0</span>,r=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> u=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> res=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">bool</span> flag= <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(r&lt;nums.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            u+=nums[r];</span><br><span class=\"line\">            r++;</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(u&gt;target)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                u-=nums[l];</span><br><span class=\"line\">                l++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (u==target)&#123;</span><br><span class=\"line\">                flag= <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(r-l&gt;res)&#123;</span><br><span class=\"line\">                    res=r-l;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!flag)<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> nums.<span class=\"built_in\">size</span>()-res;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"comment\">//    int dfs(vector&lt;int&gt; &amp;nums,int l,int r,int &amp;x)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//        if(x&lt;0||l&gt;r)return -1;</span></span><br><span class=\"line\"><span class=\"comment\">//        if(x==0)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">//            return 0;</span></span><br><span class=\"line\"><span class=\"comment\">//        &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//        int t=x;</span></span><br><span class=\"line\"><span class=\"comment\">//        x-=nums[r];</span></span><br><span class=\"line\"><span class=\"comment\">//        auto l1= dfs(nums,l,r-1,x)+1;</span></span><br><span class=\"line\"><span class=\"comment\">//        t-=nums[l];</span></span><br><span class=\"line\"><span class=\"comment\">//        x=t;</span></span><br><span class=\"line\"><span class=\"comment\">//        auto r1= dfs(nums,l+1,r,x)+1;</span></span><br><span class=\"line\"><span class=\"comment\">//        if (l1==-1&amp;&amp;r1==-1)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">//            return -1;</span></span><br><span class=\"line\"><span class=\"comment\">//        &#125;else if (l1==-1)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">//            return r1;</span></span><br><span class=\"line\"><span class=\"comment\">//        &#125; else if(r1==-1)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">//            return l1;</span></span><br><span class=\"line\"><span class=\"comment\">//        &#125;else&#123;</span></span><br><span class=\"line\"><span class=\"comment\">//            return min(l1,r1);</span></span><br><span class=\"line\"><span class=\"comment\">//        &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//    &#125;</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"209-长度最小的子数组\"><a href=\"#209-长度最小的子数组\" class=\"headerlink\" title=\"209. 长度最小的子数组\"></a><a href=\"https://leetcode.cn/problems/minimum-size-subarray-sum/\">209. 长度最小的子数组</a></h2><p>这个也还是普通的滑动窗口，大小也是这个k来作为窗口</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">minSubArrayLen</span><span class=\"params\">(<span class=\"type\">int</span> target, vector&lt;<span class=\"type\">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> l=<span class=\"number\">0</span>,r=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> u=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">bool</span> flag=<span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> ans=INT_MAX;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (r&lt;nums.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            u+=nums[r++];</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(u&gt;=target)&#123;</span><br><span class=\"line\">                flag=<span class=\"literal\">true</span>;</span><br><span class=\"line\">                ans=<span class=\"built_in\">min</span>(ans,r-l);</span><br><span class=\"line\">                u-=nums[l++];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!flag)<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"219-存在重复元素-II\"><a href=\"#219-存在重复元素-II\" class=\"headerlink\" title=\"219. 存在重复元素 II\"></a><a href=\"https://leetcode.cn/problems/contains-duplicate-ii/\">219. 存在重复元素 II</a></h2><p>检查是不是有重复的，使用双指针，来进行计算</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">containsNearbyDuplicate</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt;&amp; nums, <span class=\"type\">int</span> k)</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"type\">int</span> l=<span class=\"number\">0</span>,r=<span class=\"number\">0</span>;</span><br><span class=\"line\">       unordered_map&lt;<span class=\"type\">int</span>,<span class=\"type\">int</span>&gt; rec;</span><br><span class=\"line\">       <span class=\"keyword\">while</span>(r&lt;nums.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">           rec[nums[r]]++;</span><br><span class=\"line\">           <span class=\"keyword\">while</span>(rec[nums[r]]==<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\"><span class=\"comment\">//               cout&lt;&lt;&quot;ok&quot;;</span></span><br><span class=\"line\">               <span class=\"keyword\">if</span>(nums[l]==nums[r]&amp;&amp;r-l&lt;=k)&#123;</span><br><span class=\"line\">                   cout&lt;&lt;r&lt;&lt;<span class=\"string\">&quot; &quot;</span>&lt;&lt;l&lt;&lt;endl;</span><br><span class=\"line\">                   <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               rec[nums[l]]--;</span><br><span class=\"line\">               l++;</span><br><span class=\"line\"></span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           r++;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"220-存在重复元素-III\"><a href=\"#220-存在重复元素-III\" class=\"headerlink\" title=\"220. 存在重复元素 III\"></a><a href=\"https://leetcode.cn/problems/contains-duplicate-iii/\">220. 存在重复元素 III</a></h2><p>这是上面一个题目的扩张，有两个值来进行计算，使用set来进行计算。首先找到比当前值num【i】-t大的值，如果没有就跳过，有而且还满足就是true</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Solution &#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">    bool containsNearbyAlmostDuplicate(vector&lt;int&gt;&amp; nums, int indexDiff, int valueDiff) &#123;</span><br><span class=\"line\">        int l=0,r=0;</span><br><span class=\"line\">        set&lt;long&gt;st;</span><br><span class=\"line\"></span><br><span class=\"line\">        for (int i = 0; i &lt; nums.size(); i++) &#123;</span><br><span class=\"line\">            auto lb = st.lower_bound((long)nums[i] - valueDiff);</span><br><span class=\"line\">            if (lb != st.end() &amp;&amp; *lb &lt;= (long)nums[i] + valueDiff) return 1;</span><br><span class=\"line\">            st.insert(nums[i]);</span><br><span class=\"line\">            if (i &gt;= indexDiff) st.erase(nums[i - indexDiff]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"395-至少有-K-个重复字符的最长子串\"><a href=\"#395-至少有-K-个重复字符的最长子串\" class=\"headerlink\" title=\"395. 至少有 K 个重复字符的最长子串\"></a><a href=\"https://leetcode.cn/problems/longest-substring-with-at-least-k-repeating-characters/\">395. 至少有 K 个重复字符的最长子串</a></h2><p>选出至少有k个，这个提普通的窗口没有办法处理，使用枚举的方法，我们手动设置窗口，1-26为出现不同的异构字母，然后满足的窗口来进行滑动。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">typedef pair&lt;char,int&gt; PII;</span><br><span class=\"line\"></span><br><span class=\"line\">class Solution &#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">// 思路枚举出现不同的次数，作为窗口，，1-26，就是串口的大小，然后进行计算</span><br><span class=\"line\">//int longestSubstring(string s, int k) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    int k;</span><br><span class=\"line\">    unordered_map&lt;char,int&gt;cnt;//字符的个数</span><br><span class=\"line\">    void add(char c ,int&amp; x ,int&amp; y)&#123;</span><br><span class=\"line\">        if(!cnt[c])x++;//如果当前字符以前没有,不同字符种数++</span><br><span class=\"line\">        cnt[c]++;</span><br><span class=\"line\">        if(cnt[c] == k)y++;//如果加上c之后,刚好满足条件(即字符c的个数不少于k),则满足条件的字符种数++</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    void del(char c, int&amp; x , int&amp; y)&#123;</span><br><span class=\"line\">        if(cnt[c] == k)y--;//如果当前c字符刚好满足条件,则去掉一个后,不再满足条件,则满足条件的字符种数--</span><br><span class=\"line\">        cnt[c]--;</span><br><span class=\"line\">        if(!cnt[c])x--;//如果刚好字符c删没了,则不同字符种数--</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    int longestSubstring(string s, int _k) &#123;</span><br><span class=\"line\">        k=_k;</span><br><span class=\"line\">        int res = 0;</span><br><span class=\"line\">        int n = s.size();</span><br><span class=\"line\">        if(n &lt; k)return 0;</span><br><span class=\"line\">        //允许字符的种数</span><br><span class=\"line\">        for(int c = 1 ; c &lt;= 26 ; c++)&#123;//只允许一个字符,只允许两个字符,...</span><br><span class=\"line\">            cnt.clear();</span><br><span class=\"line\">            //i是遍历在前面的指针,j是遍历在后面的指针,x是当前窗口内不同字符的种数,y是当前窗口内满足条件的字符的种数</span><br><span class=\"line\">            for(int i = 0 ,j = 0 , x = 0 , y = 0; i &lt; n ; i ++)&#123;//遍历字符串s</span><br><span class=\"line\">                add(s[i],x,y);//每次先选先把字符加进来,并更新x和y</span><br><span class=\"line\">                while(x&gt;c)del(s[j++],x,y);//当窗口内遍历到的字符种数超过了当前允许的字符的种数,就删除窗口的末端</span><br><span class=\"line\">                if(x == y)res = max(res ,i-j+1);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return res;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"424-替换后的最长重复字符\"><a href=\"#424-替换后的最长重复字符\" class=\"headerlink\" title=\"424.替换后的最长重复字符\"></a>424.<a href=\"https://leetcode.cn/problems/longest-repeating-character-replacement/\">替换后的最长重复字符</a></h2><p>这个的思路就是r-l-1-max（字符串)&lt;&#x3D;k,所以我们的思路就是进行查找最大值字母</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">characterReplacement</span><span class=\"params\">(string s, <span class=\"type\">int</span> k)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> left = <span class=\"number\">0</span>, right = <span class=\"number\">0</span>; <span class=\"comment\">// 两个指针</span></span><br><span class=\"line\">        <span class=\"type\">int</span> res = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> Max = <span class=\"number\">-1</span>; <span class=\"comment\">// 当前区间出现最多的字符数</span></span><br><span class=\"line\">        <span class=\"function\">vector&lt;<span class=\"type\">int</span> &gt; <span class=\"title\">nums</span><span class=\"params\">(<span class=\"number\">26</span>)</span></span>;  <span class=\"comment\">// 用来统计字符出现的个数</span></span><br><span class=\"line\">        <span class=\"type\">int</span> n = s.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(right &lt; n)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 每次去更新字符出现的最大数</span></span><br><span class=\"line\">            <span class=\"type\">char</span> c = s[right];</span><br><span class=\"line\">            nums[c - <span class=\"string\">&#x27;A&#x27;</span>] ++ ;</span><br><span class=\"line\">            Max = <span class=\"built_in\">max</span>(Max, nums[c - <span class=\"string\">&#x27;A&#x27;</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 判断区间是否满足条件 注意这里当left++的时候，要提前更新Max，在left++</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span>(right - left + <span class=\"number\">1</span> - Max &gt; k)&#123;</span><br><span class=\"line\">                nums[s[left] - <span class=\"string\">&#x27;A&#x27;</span>] --;</span><br><span class=\"line\">                Max = <span class=\"built_in\">max</span>(Max, nums[s[left] - <span class=\"string\">&#x27;A&#x27;</span>]);</span><br><span class=\"line\">                left ++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// 此时的 [left, right]的区间一定是满足条件的，更新答案即可。</span></span><br><span class=\"line\">            res = <span class=\"built_in\">max</span>(res, right - left + <span class=\"number\">1</span>);</span><br><span class=\"line\">            right ++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"713-乘积小于-K-的子数组\"><a href=\"#713-乘积小于-K-的子数组\" class=\"headerlink\" title=\"713. 乘积小于 K 的子数组\"></a><a href=\"https://leetcode.cn/problems/subarray-product-less-than-k/\">713. 乘积小于 K 的子数组</a></h2><p>这个题目的思路还是比较简单，主要的是如何进行求和。当l到r满足小于的，l+1，l+2的一定也满足，那么ans+&#x3D;r-l+1</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">numSubarrayProductLessThanK</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt;&amp; nums, <span class=\"type\">int</span> k)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> l=<span class=\"number\">0</span>,r=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> u=<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> ans=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (k&lt;=<span class=\"number\">1</span>)<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (r&lt;nums.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            u*=nums[r];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">while</span>(u&gt;=k)&#123;</span><br><span class=\"line\">                u/=nums[l];</span><br><span class=\"line\">                l++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            ans+=r-l+<span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"comment\">//因为l到r满足小于k，l+1到r也是，l+2到r也是</span></span><br><span class=\"line\"><span class=\"comment\">//            那么就是计算l到r的距离</span></span><br><span class=\"line\">            r++;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"滑动窗口","slug":"滑动窗口","permalink":"http://yoursite.com/tags/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3/"}]},{"title":"回溯总结","date":"2023-01-26T03:03:40.000Z","path":"2023/01/26/回溯总结/","content":"<h1 id=\"1-回溯总结\"><a href=\"#1-回溯总结\" class=\"headerlink\" title=\"1.回溯总结\"></a>1.回溯总结</h1><p>主要参考下面的题目，<a href=\"https://www.programmercarl.com/\">代码随想</a>，还有<a href=\"https://labuladong.github.io/algo/di-san-zha-24031/\">labuladong</a>，这个类型的主要思路就是，找</p>\n<p>到结束条件，然后就是进行选择，放入之后，就再次进行放出</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = []</span><br><span class=\"line\">def backtrack(路径, 选择列表):</span><br><span class=\"line\">    if 满足结束条件:</span><br><span class=\"line\">        result.add(路径)</span><br><span class=\"line\">        return</span><br><span class=\"line\">    </span><br><span class=\"line\">    for 选择 in 选择列表:</span><br><span class=\"line\">        做选择</span><br><span class=\"line\">        backtrack(路径, 选择列表)</span><br><span class=\"line\">        撤销选择</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>包含下面几个题目</p>\n<h2 id=\"46全排列\"><a href=\"#46全排列\" class=\"headerlink\" title=\"46全排列\"></a>46全排列</h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; ans;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; res;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">bool</span>&gt; st;</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">permute</span>(vector&lt;<span class=\"type\">int</span>&gt;&amp; nums) &#123;</span><br><span class=\"line\">        st=<span class=\"built_in\">vector</span>&lt;<span class=\"type\">bool</span>&gt; (nums.<span class=\"built_in\">size</span>());</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(nums,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt; &amp;nums,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u==nums.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(res);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; nums.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!st[i])&#123;</span><br><span class=\"line\">                st[i]=<span class=\"literal\">true</span>;</span><br><span class=\"line\">                res.<span class=\"built_in\">push_back</span>(nums[i]);</span><br><span class=\"line\">                <span class=\"built_in\">dfs</span>(nums,u+<span class=\"number\">1</span>);</span><br><span class=\"line\">                res.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">                st[i]=<span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>首先还是使用ans进行保存，使用st进行验证，u代表成功的个数，当为n，就是可以进行添加，从0开始进行访问所有的值</p>\n<h2 id=\"51-N皇后\"><a href=\"#51-N皇后\" class=\"headerlink\" title=\"51.N皇后\"></a>51.N皇后</h2><p>这个题目就是进行求解，他的check条件就是列上没有，，斜线上没有，斜线就是当前的点（x-1，y-1），（x-1，y+1），检查这些值有没有，没有就放，</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;vector&lt;string&gt;&gt; ans;</span><br><span class=\"line\">    vector&lt;string&gt; res;</span><br><span class=\"line\">    vector&lt;vector&lt;string&gt;&gt; <span class=\"built_in\">solveNQueens</span>(<span class=\"type\">int</span> n) &#123;</span><br><span class=\"line\">        res=<span class=\"built_in\">vector</span>&lt;string&gt;(n,<span class=\"built_in\">string</span>(n,<span class=\"string\">&#x27;.&#x27;</span>));</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(n,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"type\">int</span> n,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(n==u)&#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(res);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> ;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"built_in\">isok</span>(u,i))&#123;</span><br><span class=\"line\">                res[u][i]=<span class=\"string\">&#x27;Q&#x27;</span>;</span><br><span class=\"line\">                <span class=\"built_in\">dfs</span>(n,u+<span class=\"number\">1</span>);</span><br><span class=\"line\">                res[u][i]=<span class=\"string\">&#x27;.&#x27;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">isok</span><span class=\"params\">(<span class=\"type\">int</span> u,<span class=\"type\">int</span> i)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//统计每一个竖起来的</span></span><br><span class=\"line\">        <span class=\"comment\">//统计左上还有右下</span></span><br><span class=\"line\">        <span class=\"type\">int</span> n=res.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt;=u; ++j) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(res[j][i]==<span class=\"string\">&#x27;Q&#x27;</span>)<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//45°检查</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = u<span class=\"number\">-1</span>,k=i<span class=\"number\">-1</span>; j&gt;=<span class=\"number\">0</span>&amp;&amp;k&gt;=<span class=\"number\">0</span> ; j--,k--) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(res[j][k]==<span class=\"string\">&#x27;Q&#x27;</span>)<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = u<span class=\"number\">-1</span>,k=i+<span class=\"number\">1</span>; j&gt;=<span class=\"number\">0</span>&amp;&amp;k&lt;n ; j--,k++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(res[j][k]==<span class=\"string\">&#x27;Q&#x27;</span>)<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"112路径总和\"><a href=\"#112路径总和\" class=\"headerlink\" title=\"112路径总和\"></a>112路径总和</h2><p>从根节点开始寻找，两种dfs方式，一种就是在for循环里面进行回溯，还有一种在最开始进行回溯。</p>\n<p>这个就是在里面进行回溯，因为是直接开始减的，所以，不需要把target还原</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">hasPathSum</span><span class=\"params\">(TreeNode* root, <span class=\"type\">int</span> targetSum)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!root)<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">dfs</span>(root,targetSum-root-&gt;val);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">dfs</span><span class=\"params\">(TreeNode* root,<span class=\"type\">int</span> target)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (target==<span class=\"number\">0</span>&amp;&amp;!root-&gt;left&amp;&amp;!root-&gt;right)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"comment\">//        if (target&lt;0)return false;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(root-&gt;left)&#123;</span><br><span class=\"line\">            <span class=\"type\">bool</span> left= <span class=\"built_in\">dfs</span>(root-&gt;left,target-root-&gt;left-&gt;val);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (left)<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(root-&gt;right)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"built_in\">dfs</span>(root-&gt;right,target-root-&gt;right-&gt;val))&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"140-单词拆分\"><a href=\"#140-单词拆分\" class=\"headerlink\" title=\"140.单词拆分\"></a>140.单词拆分</h2><p>这个题目还是回溯，本质就是对i从u开始，进行截取，然后，看是不是在指点里面</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    unordered_map&lt;string,<span class=\"type\">int</span>&gt; rec;</span><br><span class=\"line\">    vector&lt;string&gt; ans;</span><br><span class=\"line\">    string path;</span><br><span class=\"line\">    <span class=\"function\">vector&lt;string&gt; <span class=\"title\">wordBreak</span><span class=\"params\">(string s, vector&lt;string&gt;&amp; wordDict)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">auto</span> word:wordDict)&#123;</span><br><span class=\"line\">            rec[word]++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(s,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(string s,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u==s.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">            <span class=\"comment\">//排除末尾</span></span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">            path+=<span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u&gt;s.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = u; i &lt;s.<span class=\"built_in\">size</span>() ; ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">auto</span> t=s.<span class=\"built_in\">substr</span>(u,i-u+<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(rec.<span class=\"built_in\">find</span>(t)!=rec.<span class=\"built_in\">end</span>())&#123;</span><br><span class=\"line\">                <span class=\"keyword\">auto</span> x=path;</span><br><span class=\"line\">                path+=t+<span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">                <span class=\"built_in\">dfs</span>(s,i+<span class=\"number\">1</span>);</span><br><span class=\"line\">                path=x;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"17-电话组合\"><a href=\"#17-电话组合\" class=\"headerlink\" title=\"17.电话组合\"></a>17.电话组合</h2><p>还不是组合一样，放入字符串里面</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;string&gt; ans;</span><br><span class=\"line\">    string strs[<span class=\"number\">10</span>] = &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;abc&quot;</span>, <span class=\"string\">&quot;def&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;ghi&quot;</span>, <span class=\"string\">&quot;jkl&quot;</span>, <span class=\"string\">&quot;mno&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;pqrs&quot;</span>, <span class=\"string\">&quot;tuv&quot;</span>, <span class=\"string\">&quot;wxyz&quot;</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    string path;</span><br><span class=\"line\">    <span class=\"function\">vector&lt;string&gt; <span class=\"title\">letterCombinations</span><span class=\"params\">(string digits)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (digits.<span class=\"built_in\">empty</span>())<span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(digits,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(string digits,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u==digits.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u&gt;digits.<span class=\"built_in\">size</span>())<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> n=digits[u]-<span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; strs[n].<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            path.<span class=\"built_in\">push_back</span>(strs[n][i]);</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(digits,u+<span class=\"number\">1</span>);</span><br><span class=\"line\">            path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"22-括号生成\"><a href=\"#22-括号生成\" class=\"headerlink\" title=\"22.括号生成\"></a>22.括号生成</h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;string&gt; ans;</span><br><span class=\"line\">    string path;</span><br><span class=\"line\">    unordered_map&lt;<span class=\"type\">char</span>,<span class=\"type\">int</span>&gt; rec;</span><br><span class=\"line\">    <span class=\"function\">vector&lt;string&gt; <span class=\"title\">generateParenthesis</span><span class=\"params\">(<span class=\"type\">int</span> n)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(n,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"type\">int</span> n,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u==<span class=\"number\">2</span>*n)&#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"comment\">//        cout&lt;&lt;path&lt;&lt;&quot; &quot;;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(rec.<span class=\"built_in\">find</span>(<span class=\"string\">&#x27;(&#x27;</span>)==rec.<span class=\"built_in\">end</span>()||rec[<span class=\"string\">&#x27;(&#x27;</span>]&lt;n)&#123;</span><br><span class=\"line\">            path+=<span class=\"string\">&#x27;(&#x27;</span>;</span><br><span class=\"line\">            rec[<span class=\"string\">&#x27;(&#x27;</span>]++;</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(n,u+<span class=\"number\">1</span>);</span><br><span class=\"line\">            path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">            rec[<span class=\"string\">&#x27;(&#x27;</span>]--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (rec.<span class=\"built_in\">find</span>(<span class=\"string\">&#x27;)&#x27;</span>)==rec.<span class=\"built_in\">end</span>()||rec[<span class=\"string\">&#x27;)&#x27;</span>]&lt;rec[<span class=\"string\">&#x27;(&#x27;</span>])&#123;</span><br><span class=\"line\">            path+=<span class=\"string\">&#x27;)&#x27;</span>;</span><br><span class=\"line\">            rec[<span class=\"string\">&#x27;)&#x27;</span>]++;</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(n,u+<span class=\"number\">1</span>);</span><br><span class=\"line\">            path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">            rec[<span class=\"string\">&#x27;)&#x27;</span>]--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>两个剪纸，一个是长度都是n，括号，还有一个就是右括号小于左的</p>\n<h2 id=\"39-组合总和\"><a href=\"#39-组合总和\" class=\"headerlink\" title=\"39.组合总和\"></a>39.组合总和</h2><p>这个就是组合数，使用i到u进行遍历，然后还有一个就是，直接从i开始，不是i+1</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; ans;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; path;</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">combinationSum</span>(vector&lt;<span class=\"type\">int</span>&gt;&amp; candidates, <span class=\"type\">int</span> target) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">sort</span>(candidates.<span class=\"built_in\">begin</span>(),candidates.<span class=\"built_in\">end</span>());</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(candidates,target,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt; &amp;nums,<span class=\"type\">int</span> u,<span class=\"type\">int</span> index)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (u==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index==nums.<span class=\"built_in\">size</span>())<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u&lt;<span class=\"number\">0</span>)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = index; i &lt; nums.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            path.<span class=\"built_in\">push_back</span>(nums[i]);</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(nums,u-nums[i],i);</span><br><span class=\"line\">            path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>这个就是从i即系开始，可以重复使用</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Solution &#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">    vector&lt;vector&lt;int&gt;&gt; ans;</span><br><span class=\"line\">    vector&lt;int&gt; path;</span><br><span class=\"line\">    </span><br><span class=\"line\">    vector&lt;vector&lt;int&gt;&gt; combinationSum(vector&lt;int&gt;&amp; c, int target) &#123;</span><br><span class=\"line\">            dfs(c,0,target);</span><br><span class=\"line\">            return ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    void dfs(vector&lt;int&gt;&amp; c,int u,int target )&#123;</span><br><span class=\"line\">        // u代表当前循环到哪一个了数字呢</span><br><span class=\"line\">        // 考虑边界</span><br><span class=\"line\">        if(target==0)&#123;</span><br><span class=\"line\">            ans.push_back(path);</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        if(u==c.size())&#123;</span><br><span class=\"line\">            return;</span><br><span class=\"line\">            // 直接返回</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        // 接下来就是放入放出</span><br><span class=\"line\">        for(int i=0;i*c[u]&lt;=target;i++)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            dfs(c,u+1,target-i*c[u]);</span><br><span class=\"line\">            path.push_back(c[u]);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            // 这是选择加入一个后，再对后面的进行加入</span><br><span class=\"line\">            // target-i*c[u]是加入当前的次数，u+1是下一个值</span><br><span class=\"line\">             // 回复现场</span><br><span class=\"line\">             </span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        for(int i=0;i*c[u]&lt;=target;i++)&#123;</span><br><span class=\"line\">            path.pop_back();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p><strong>这个代码很不错，因为是先dfs然后再push，为什么了，因为先dfs，代表选0个当前的，之后放入一个，就是选了一个dfs，而且是在dfs之后选择下一个值，而且，target因为是没有变，所以直接减去i*cu</strong></p>\n<h2 id=\"698-划分k个相等的子集\"><a href=\"#698-划分k个相等的子集\" class=\"headerlink\" title=\"698.划分k个相等的子集\"></a>698.划分k个相等的子集</h2><p>首先的先决条件就是sum数组的和可以整除k，而且最后一个数，一定小于平均数。之后就是进行回溯，代码思路，使用dfs(nums,avg,k,u)</p>\n<p>含义就是当avg为0的时候，可以进行k-1（表示又有一组满足了，然后u从开始进行寻找，avg再次恢复到初始值）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Solution &#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">    vector&lt;vector&lt;int&gt;&gt; ans;</span><br><span class=\"line\">    vector&lt;int&gt;path;</span><br><span class=\"line\">    vector&lt;bool&gt; st;</span><br><span class=\"line\">    int t;</span><br><span class=\"line\">    int avg;</span><br><span class=\"line\">    bool canPartitionKSubsets(vector&lt;int&gt;&amp; nums, int k) &#123;</span><br><span class=\"line\">         auto sum=accumulate(nums.begin(),nums.end(),0);</span><br><span class=\"line\">        if(sum%k!=0)return false;</span><br><span class=\"line\">        st=vector&lt;bool&gt;(nums.size(),false);</span><br><span class=\"line\">        int target=sum/k;</span><br><span class=\"line\">        if (nums.back()&gt;target)return false;</span><br><span class=\"line\">//</span><br><span class=\"line\">        t=k;</span><br><span class=\"line\">        avg=target;</span><br><span class=\"line\">        sort(nums.begin(),nums.end());</span><br><span class=\"line\">        return dfs(nums,target,0,0);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    bool  dfs(vector&lt;int&gt; &amp;nums,int target,int index,int u)&#123;</span><br><span class=\"line\">        if(u==t)return true;</span><br><span class=\"line\">//        cout&lt;&lt;u;</span><br><span class=\"line\">        if(target==0)return dfs(nums,avg,0,u+1);</span><br><span class=\"line\">//        if(target&lt;0)return false;</span><br><span class=\"line\">        for (int i = index; i &lt; nums.size(); ++i) &#123;</span><br><span class=\"line\">            if(!st[i]&amp;&amp;target-nums[i]&gt;=0)&#123;</span><br><span class=\"line\">                st[i]=true;</span><br><span class=\"line\">//                path.push_back(nums[i]);</span><br><span class=\"line\">                if(dfs(nums,target-nums[i],i+1,u))&#123;</span><br><span class=\"line\">                    return true;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                st[i]=false;</span><br><span class=\"line\">//                path.pop_back();</span><br><span class=\"line\">                    //排好序了的,如果当前都没办法减少到0,后面就不可能</span><br><span class=\"line\">                if (target==avg)return false;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>if (target&#x3D;&#x3D;avg)return false;重要剪纸，当表示值不变还是avg，就表示后面更不可能进行减少值，因为后面的都比当前值大，target会一直不变，所以不能选择，直接失败</strong></p>\n<h2 id=\"77-组合数\"><a href=\"#77-组合数\" class=\"headerlink\" title=\"77.组合数\"></a>77.组合数</h2><p>组合数，就是进行选择，首先进行排序，i到u开始，</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; ans;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; rec;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">bool</span>&gt;st;</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">combine</span>(<span class=\"type\">int</span> n, <span class=\"type\">int</span> k) &#123;</span><br><span class=\"line\">        st=<span class=\"built_in\">vector</span>&lt;<span class=\"type\">bool</span>&gt; (n+<span class=\"number\">1</span>,<span class=\"literal\">false</span>);</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(n,k,<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"type\">int</span> n,<span class=\"type\">int</span> k,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!k)&#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(rec);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = u; i &lt; n+<span class=\"number\">1</span>; ++i) &#123;</span><br><span class=\"line\">            rec.<span class=\"built_in\">push_back</span>(i);</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(n,k<span class=\"number\">-1</span>,i+<span class=\"number\">1</span>);</span><br><span class=\"line\">            rec.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"78-幂集\"><a href=\"#78-幂集\" class=\"headerlink\" title=\"78,幂集\"></a>78,幂集</h2><p>就是返回所有的选择,直接在上面的进行手动设置k</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; ans;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; rec;</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">subsets</span>(vector&lt;<span class=\"type\">int</span>&gt;&amp; nums) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">sort</span>(nums.<span class=\"built_in\">begin</span>(),nums.<span class=\"built_in\">end</span>());</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt;=nums.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(nums,i,<span class=\"number\">0</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt; &amp;nums,<span class=\"type\">int</span> k,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!k)&#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(rec);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = u; i &lt; nums.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            rec.<span class=\"built_in\">push_back</span>(nums[i]);</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(nums,k<span class=\"number\">-1</span>,i+<span class=\"number\">1</span>);</span><br><span class=\"line\">            rec.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"40-组合综合\"><a href=\"#40-组合综合\" class=\"headerlink\" title=\"40.组合综合\"></a>40.组合综合</h2><p>进行筛选,而且不能含有重复的,首先进行选择就是i到u,去重就是要使用那个continue,与前面相同</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; path;</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; ans;</span><br><span class=\"line\"></span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">combinationSum2</span>(vector&lt;<span class=\"type\">int</span>&gt;&amp; candidates, <span class=\"type\">int</span> target) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">sort</span>(candidates.<span class=\"built_in\">begin</span>(),candidates.<span class=\"built_in\">end</span>());</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(candidates,target,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt; &amp;nums,<span class=\"type\">int</span> target,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(target==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u&gt;=nums.<span class=\"built_in\">size</span>())<span class=\"keyword\">return</span>;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//        cout&lt;&lt;target&lt;&lt;&quot;  &quot;;</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = u; i &lt; nums.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(nums[i]&gt;target)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i&gt;u&amp;&amp;nums[i]==nums[i<span class=\"number\">-1</span>])<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            path.<span class=\"built_in\">push_back</span>(nums[i]);</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(nums,target-nums[i],i+<span class=\"number\">1</span>);</span><br><span class=\"line\">            path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\"><span class=\"comment\">//            rec[nums[i]]=1;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>if (i&gt;u&amp;&amp;nums[i]&#x3D;&#x3D;nums[i-1])continue;去重代码,不需要使用st,来表示,因为后面都是没有访问的</p>\n<h2 id=\"216-组合综合\"><a href=\"#216-组合综合\" class=\"headerlink\" title=\"216.组合综合\"></a>216.组合综合</h2><p>还是之前一样</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">vector&lt;<span class=\"type\">int</span>&gt; path;</span><br><span class=\"line\">vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; ans;</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">combinationSum3</span>(<span class=\"type\">int</span> k, <span class=\"type\">int</span> n) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(<span class=\"number\">1</span>,k,n);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"type\">int</span> start,<span class=\"type\">int</span> k,<span class=\"type\">int</span> n)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!k)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!n)ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(k)&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 说明还有字数需要</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=start;i&lt;=<span class=\"number\">9</span>;i++)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(n&gt;=i)&#123;</span><br><span class=\"line\">                    path.<span class=\"built_in\">push_back</span>(i);</span><br><span class=\"line\">                    <span class=\"built_in\">dfs</span>(i+<span class=\"number\">1</span>,k<span class=\"number\">-1</span>,n-i);</span><br><span class=\"line\">                    path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"131-分割回文串\"><a href=\"#131-分割回文串\" class=\"headerlink\" title=\"131.分割回文串\"></a>131.分割回文串</h2><p>还是之前一样,check条件就是是不是会问,如果是true,直接返回</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;vector&lt;string&gt;&gt; ans;</span><br><span class=\"line\">    vector&lt;string&gt; path;</span><br><span class=\"line\">    vector&lt;vector&lt;string&gt;&gt; <span class=\"built_in\">partition</span>(string s) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(s,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(string s,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u==s.<span class=\"built_in\">size</span>()) &#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = u; i &lt; s.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">auto</span> x=s.<span class=\"built_in\">substr</span>(u,i-u+<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"built_in\">is_ok</span>(x))&#123;</span><br><span class=\"line\">                path.<span class=\"built_in\">push_back</span>(x);</span><br><span class=\"line\">                <span class=\"built_in\">dfs</span>(s,i+<span class=\"number\">1</span>);</span><br><span class=\"line\">                path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">is_ok</span><span class=\"params\">(string s)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">auto</span> x=s;</span><br><span class=\"line\">        <span class=\"built_in\">reverse</span>(s.<span class=\"built_in\">begin</span>(),s.<span class=\"built_in\">end</span>());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x==s;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"93复原ip地址\"><a href=\"#93复原ip地址\" class=\"headerlink\" title=\"93复原ip地址\"></a>93复原ip地址</h2><p>这个首先是对于0,直接继续,而且,一共只有4个小数点,最后一个在加入的时候去除,之后就是普通的回溯</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"type\">int</span> start;</span><br><span class=\"line\">    <span class=\"type\">int</span> end;</span><br><span class=\"line\">    vector&lt;string&gt; ans;</span><br><span class=\"line\">    string path;</span><br><span class=\"line\">    <span class=\"function\">vector&lt;string&gt; <span class=\"title\">restoreIpAddresses</span><span class=\"params\">(string s)</span> </span>&#123;</span><br><span class=\"line\">        start=<span class=\"number\">0</span>,end=<span class=\"number\">255</span>;</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(s,<span class=\"number\">4</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(string s,<span class=\"type\">int</span> times,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//不出现011</span></span><br><span class=\"line\">        <span class=\"comment\">//只有3个小数点可以进行加入</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!times&amp;&amp;u==s.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (times&lt;<span class=\"number\">0</span>)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u&gt;=s.<span class=\"built_in\">size</span>())<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(s[u]==<span class=\"string\">&#x27;0&#x27;</span>)&#123;</span><br><span class=\"line\">            path+=<span class=\"string\">&quot;0.&quot;</span>;</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(s,times<span class=\"number\">-1</span>,u+<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> ;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = u; i &lt; s.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (i-u+<span class=\"number\">1</span>&gt;<span class=\"number\">3</span>)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">                <span class=\"keyword\">auto</span> x=s.<span class=\"built_in\">substr</span>(u,i-u+<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">auto</span> t= <span class=\"built_in\">stoi</span>(x);</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(t&lt;=<span class=\"number\">255</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">auto</span> back=path;</span><br><span class=\"line\">                    path+=x+<span class=\"string\">&quot;.&quot;</span>;</span><br><span class=\"line\">                    <span class=\"built_in\">dfs</span>(s,times<span class=\"number\">-1</span>,i+<span class=\"number\">1</span>);</span><br><span class=\"line\">                    path=back;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>对于签到0的优化方法就是把循环的下一位变成u+1,不是s.size</strong></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> n=u+<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(s[u]!=<span class=\"string\">&#x27;0&#x27;</span>)n=s.<span class=\"built_in\">size</span>();</span><br><span class=\"line\">       </span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = u; i &lt; n; ++i) &#123;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"90子集\"><a href=\"#90子集\" class=\"headerlink\" title=\"90子集\"></a>90子集</h2><p>这个就是进行去重,直接看是不是相等,然后continue</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; ans;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; path;</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">subsetsWithDup</span>(vector&lt;<span class=\"type\">int</span>&gt;&amp; nums) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">sort</span>(nums.<span class=\"built_in\">begin</span>(),nums.<span class=\"built_in\">end</span>());</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt;=nums.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(nums,i,<span class=\"number\">0</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>  ans;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt; &amp;nums,<span class=\"type\">int</span> n,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(n==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u&gt;=nums.<span class=\"built_in\">size</span>())<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(n&lt;<span class=\"number\">0</span>)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i =u; i &lt; nums.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(i&gt;u&amp;&amp;nums[i]==nums[i<span class=\"number\">-1</span>])<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            path.<span class=\"built_in\">push_back</span>(nums[i]);</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(nums,n<span class=\"number\">-1</span>,i+<span class=\"number\">1</span>);</span><br><span class=\"line\">            path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>因为都是排序了的,后面一定没有访问,所以不用st</p>\n<h2 id=\"47全排列\"><a href=\"#47全排列\" class=\"headerlink\" title=\"47全排列\"></a>47全排列</h2><p>进行去重,这个就是需要st数组,因为从是排列,而且需要进行去重,所以是从0开始的,需要st</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\"><span class=\"comment\">// 这题的意思就是要融合，消去2个112</span></span><br><span class=\"line\"><span class=\"comment\">// 去重使用三个数之和的方法，是不是前面一个相同，相同就跳过了</span></span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; ans;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; path;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">bool</span>&gt; st;</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">permuteUnique</span>(vector&lt;<span class=\"type\">int</span>&gt;&amp; nums) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">sort</span>(nums.<span class=\"built_in\">begin</span>(),nums.<span class=\"built_in\">end</span>());</span><br><span class=\"line\">        path= <span class=\"built_in\">vector</span>&lt;<span class=\"type\">int</span>&gt;(nums.<span class=\"built_in\">size</span>());</span><br><span class=\"line\">        st= <span class=\"built_in\">vector</span>&lt;<span class=\"type\">bool</span>&gt;(nums.<span class=\"built_in\">size</span>());</span><br><span class=\"line\">        <span class=\"built_in\">dfs</span>(nums,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt;&amp; nums,<span class=\"type\">int</span> u )</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u==nums.<span class=\"built_in\">size</span>())&#123;</span><br><span class=\"line\">            ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;nums.<span class=\"built_in\">size</span>();i++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!st[i])&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(i&amp;&amp;nums[i<span class=\"number\">-1</span>]==nums[i]&amp;&amp;!st[i<span class=\"number\">-1</span>])<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            <span class=\"comment\">// 前面一个还没有使用，那就用前面那个1</span></span><br><span class=\"line\">                st[i] = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                path[u] = nums[i];</span><br><span class=\"line\">                <span class=\"built_in\">dfs</span>(nums, u + <span class=\"number\">1</span>);</span><br><span class=\"line\">                st[i] = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"491递增子序列\"><a href=\"#491递增子序列\" class=\"headerlink\" title=\"491递增子序列\"></a>491递增子序列</h2><p>因为没有排序,不能排序,所以只能使用set来进行作为</p>\n<p>本人思路,就是对所有n的n从2到size进行遍历,然后加进去,使用set去除</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; ans;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; path;</span><br><span class=\"line\">    set&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; s;</span><br><span class=\"line\">    vector&lt;vector&lt;<span class=\"type\">int</span>&gt;&gt; <span class=\"built_in\">findSubsequences</span>(vector&lt;<span class=\"type\">int</span>&gt;&amp; nums) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">2</span>; i &lt;=nums.<span class=\"built_in\">size</span>(); ++i) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">dfs</span>(nums,i,<span class=\"number\">0</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(vector&lt;<span class=\"type\">int</span>&gt;&amp; nums,<span class=\"type\">int</span> n,<span class=\"type\">int</span> u)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(n==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(s.<span class=\"built_in\">find</span>(path)==s.<span class=\"built_in\">end</span>())&#123;</span><br><span class=\"line\">                ans.<span class=\"built_in\">push_back</span>(path);</span><br><span class=\"line\">                s.<span class=\"built_in\">insert</span>(path);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(u==nums.<span class=\"built_in\">size</span>())<span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = u; i &lt;nums.<span class=\"built_in\">size</span>() ; ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(path.<span class=\"built_in\">empty</span>()||nums[i]&gt;=path.<span class=\"built_in\">back</span>())&#123;</span><br><span class=\"line\">                path.<span class=\"built_in\">push_back</span>(nums[i]);</span><br><span class=\"line\">                <span class=\"built_in\">dfs</span>(nums,n<span class=\"number\">-1</span>,i+<span class=\"number\">1</span>);</span><br><span class=\"line\">                path.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"2-小结\"><a href=\"#2-小结\" class=\"headerlink\" title=\"2.小结\"></a>2.小结</h1><p>上面的几个经典题目,一个去重,前面相等直接跳过</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if(i&gt;u&amp;&amp;num[i]==num[i-1])continue</span><br></pre></td></tr></table></figure>\n\n\n\n<p>第二个就是前导0的问题,一般是只能用做单独的0,那么距离就是u+1</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int n=s.size();</span><br><span class=\"line\">if(s[i]==&#x27;0&#x27;)n=u+1:</span><br><span class=\"line\">for(int i=u;i&lt;n;i++)</span><br></pre></td></tr></table></figure>\n\n<p>第三个就是排列组合,排列的话就是从0开始,设置st数组.</p>\n<p>组合的就是从u开始,去重和上面是一样的</p>\n","tags":[{"name":"算法","slug":"算法","permalink":"http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"},{"name":"回溯","slug":"回溯","permalink":"http://yoursite.com/tags/%E5%9B%9E%E6%BA%AF/"}]},{"title":"设计模式","date":"2023-01-17T08:45:25.000Z","path":"2023/01/17/设计模式/","content":"<h1 id><a href=\"#\" class=\"headerlink\" title></a></h1><h1 id=\"1-设计模式\"><a href=\"#1-设计模式\" class=\"headerlink\" title=\"1.设计模式\"></a>1.设计模式</h1><p>设计模式主要包括一下三种创建者模式,结构模式还有行为模式</p>\n<h1 id=\"2创建者模式\"><a href=\"#2创建者模式\" class=\"headerlink\" title=\"2创建者模式\"></a>2创建者模式</h1><p>主要包括以下工厂模式,单例模式,原型模式还有抽象工厂模式,最后是建造者模式</p>\n<h2 id=\"2-1工厂模式\"><a href=\"#2-1工厂模式\" class=\"headerlink\" title=\"2.1工厂模式\"></a>2.1工厂模式</h2><p>简单点说:两个接口,一个食物类接口,一个工厂类接口,工厂接口来进行创建食物,使用工厂进行创建对象</p>\n<p><img src=\"https://design-patterns.readthedocs.io/zh_CN/latest/_images/loger.jpg\"></p>\n<h2 id=\"2-2抽象工厂模式\"><a href=\"#2-2抽象工厂模式\" class=\"headerlink\" title=\"2.2抽象工厂模式\"></a>2.2抽象工厂模式</h2><p>例子就是一个店子可以做咖啡还有甜品,所以继承工厂类,做两个视频,一个咖啡,一个蛋糕</p>\n<p><img src=\"https://design-patterns.readthedocs.io/zh_CN/latest/_images/AbatractFactory.jpg\"></p>\n<p>可以看出,每一个工厂类都有做产品a还有做产品b的方法</p>\n<h2 id=\"2-3单例模式\"><a href=\"#2-3单例模式\" class=\"headerlink\" title=\"2.3单例模式\"></a>2.3单例模式</h2><p>顾名思义就是无论如何,指挥产生一个对象instance,最简单的方法就是私有构造函数,然后使用静态变量生成instance,这届得到</p>\n<p><img src=\"https://design-patterns.readthedocs.io/zh_CN/latest/_images/Singleton.jpg\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;Singleton.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\">Singleton * Singleton::instance = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">Singleton::<span class=\"built_in\">Singleton</span>()&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Singleton::~<span class=\"built_in\">Singleton</span>()&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">delete</span> instance;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">Singleton* <span class=\"title\">Singleton::getInstance</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (instance == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tinstance = <span class=\"keyword\">new</span> <span class=\"built_in\">Singleton</span>();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">return</span>  instance;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">Singleton::singletonOperation</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\tcout &lt;&lt; <span class=\"string\">&quot;singletonOperation&quot;</span> &lt;&lt; endl;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-4建造者模式\"><a href=\"#2-4建造者模式\" class=\"headerlink\" title=\"2.4建造者模式\"></a>2.4建造者模式</h2><p>这个例子就是工厂工人做每一步,然后最后进行组装</p>\n<p>todo:还没写完</p>\n<p><img src=\"https://design-patterns.readthedocs.io/zh_CN/latest/_images/Builder.jpg\"></p>\n<h1 id=\"3-行为模式\"><a href=\"#3-行为模式\" class=\"headerlink\" title=\"3.行为模式\"></a>3.行为模式</h1><h2 id=\"3-1适配器模式\"><a href=\"#3-1适配器模式\" class=\"headerlink\" title=\"3.1适配器模式\"></a>3.1适配器模式</h2><p>例子:就是电源适配器(欧洲电源需要转接口才能使用),适配器就是转换头</p>\n<p>所以我们需要实现欧洲的接口,但是继承国内的充电头,一个impl一个extend</p>\n<p>然后在impl里面调用extend函数</p>\n<p><img src=\"https://design-patterns.readthedocs.io/zh_CN/latest/_images/Adapter_classModel.jpg\"></p>\n<h2 id=\"3-2桥接模式\"><a href=\"#3-2桥接模式\" class=\"headerlink\" title=\"3.2桥接模式\"></a>3.2桥接模式</h2><p>主要是减少使用继承类,例如四边形,子类是长方形还有正方形,但是子类还有红色和蓝色的长方形</p>\n<p>我们使用颜色类聚类到四边形里面,这样就可以减少子类,所以我们,我们在color里面实现,蓝色还有绿色,</p>\n<p><img src=\"https://design-patterns.readthedocs.io/zh_CN/latest/_images/Bridge.jpg\"></p>\n<h2 id=\"3-3桥接模式\"><a href=\"#3-3桥接模式\" class=\"headerlink\" title=\"3.3桥接模式\"></a>3.3桥接模式</h2><p>就是代购火车票,方法都一样的,售票处售票,代购店也要售票,代购店售票的方法就是使用售票处的方法</p>\n<p><img src=\"https://design-patterns.readthedocs.io/zh_CN/latest/_images/Proxy.jpg\"></p>\n<p>都要实现接口,同时调用真实接口</p>\n<h2 id=\"3-4享元模式\"><a href=\"#3-4享元模式\" class=\"headerlink\" title=\"3.4享元模式\"></a>3.4享元模式</h2><p>贡献模式,每次调用都是相同的的值,但是修改一些属性而已</p>\n<p>主要使用map,来得到相同的元素,map[i]</p>\n<p><img src=\"https://design-patterns.readthedocs.io/zh_CN/latest/_images/Flyweight.jpg\"></p>\n<h2 id=\"3-5外观模式\"><a href=\"#3-5外观模式\" class=\"headerlink\" title=\"3.5外观模式\"></a>3.5外观模式</h2><p>基金经理帮我们来买股票,这样我们就不需自己进行选择股票</p>\n<p><img src=\"https://design-patterns.readthedocs.io/zh_CN/latest/_images/Facade.jpg\"></p>\n<h2 id=\"3-6装饰模式\"><a href=\"#3-6装饰模式\" class=\"headerlink\" title=\"3.6装饰模式\"></a>3.6装饰模式</h2><p>就是炒饭+鸡蛋+肉+其他的,因此,炒房还有配料都要继承食物类别</p>\n<p>同时配料类还要聚合食物类,这样就可以进行添加配料</p>\n<p><img src=\"https://design-patterns.readthedocs.io/zh_CN/latest/_images/Decorator.jpg\"></p>\n<p>decorate是配料类,聚合食物类,设置get set方法,最后的总价价格&#x3D;this.getprice+this.getfood.getcost</p>\n<h1 id=\"4-行为型模式\"><a href=\"#4-行为型模式\" class=\"headerlink\" title=\"4.行为型模式\"></a>4.行为型模式</h1><h2 id=\"4-1策略模式\"><a href=\"#4-1策略模式\" class=\"headerlink\" title=\"4.1策略模式\"></a>4.1策略模式</h2><p>最简单的模式,直接使用接口实现多个策略就可以,聚合策略就可以</p>\n<p><img src=\"https://design-patterns.readthedocs.io/zh_CN/latest/_images/Strategy.jpg\"></p>\n<h2 id=\"4-2命令模式\"><a href=\"#4-2命令模式\" class=\"headerlink\" title=\"4.2命令模式\"></a>4.2命令模式</h2><p><img src=\"https://design-patterns.readthedocs.io/zh_CN/latest/_images/Command.jpg\"></p>\n<p>简单来说就是命令来控制厨师,让厨师做事,让服务员收拾订单</p>\n<h2 id=\"4-3中介模式\"><a href=\"#4-3中介模式\" class=\"headerlink\" title=\"4.3中介模式\"></a>4.3中介模式</h2><p>中介这个人看碟子下菜,看对面是什么类型,然后调用不同的交互方法</p>\n<p>使用get set方法来把中介者里面.</p>\n<p>同时colleagues也要把中介放进去</p>\n<p><img src=\"https://design-patterns.readthedocs.io/zh_CN/latest/_images/Mediator.jpg\"></p>\n<h2 id=\"4-4观察者模式\"><a href=\"#4-4观察者模式\" class=\"headerlink\" title=\"4.4观察者模式\"></a>4.4观察者模式</h2><p>例子就是订阅公众号,公众号添加用户,公众号推送更新,调用用户更新.使用list添加</p>\n<p>subject是公众号,observe是微信用户,公众号的时候添加用户,使用for</p>\n<p><img src=\"https://design-patterns.readthedocs.io/zh_CN/latest/_images/Obeserver.jpg\"></p>\n<h2 id=\"4-5状态模式\"><a href=\"#4-5状态模式\" class=\"headerlink\" title=\"4.5状态模式\"></a>4.5状态模式</h2><p>state是多个状态有电梯运行,电梯停止,电梯开门等多个状态,减少判断switch逻辑</p>\n<p><img src=\"https://design-patterns.readthedocs.io/zh_CN/latest/_images/State.jpg\"></p>\n","tags":[{"name":"设计模式","slug":"设计模式","permalink":"http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"摄影技巧","date":"2023-01-05T06:51:23.000Z","path":"2023/01/05/摄影技巧/","content":"<h1 id=\"摄影技巧\"><a href=\"#摄影技巧\" class=\"headerlink\" title=\"摄影技巧\"></a>摄影技巧</h1><h2 id=\"1-拍摄\"><a href=\"#1-拍摄\" class=\"headerlink\" title=\"1.拍摄\"></a>1.拍摄</h2><h3 id=\"1-1基础知识\"><a href=\"#1-1基础知识\" class=\"headerlink\" title=\"1.1基础知识\"></a>1.1基础知识</h3><p>硬件部分：</p>\n<ol>\n<li>光圈（f1.4，f2.2）数值越小就越好</li>\n<li>快门（曝光时间，如果要拍摄晚上车水马龙，需要延长快门时间</li>\n<li>ISO（可以提高曝光率，但是变大会有噪点）</li>\n</ol>\n<p>手机没有办法像单反那样，可以得到不同的焦距，所以只能用多个摄像头来进行获得不同的焦段，5倍，10倍，60倍。剩下的2倍使用算法进裁剪得到，所以还是一般使用固定的焦距。</p>\n<h3 id=\"1-2光的知识\"><a href=\"#1-2光的知识\" class=\"headerlink\" title=\"1.2光的知识\"></a>1.2光的知识</h3><p>光强：</p>\n<ol>\n<li>亮度（明亮成都）</li>\n<li>距离（越远越低）</li>\n<li>光面积（越大越强）</li>\n<li>反光率</li>\n</ol>\n<p>色温：</p>\n<p>光质：</p>\n<ol>\n<li>硬广</li>\n<li>软光（通过放入纸巾，可以把赢的变软（漫反射）</li>\n</ol>\n<p>光比：明暗对比</p>\n<p>光影：影子</p>\n<h3 id=\"1-3色彩\"><a href=\"#1-3色彩\" class=\"headerlink\" title=\"1.3色彩\"></a>1.3色彩</h3><p>色相：（颜色名称，红黄蓝）</p>\n<p>明度：颜色的亮度</p>\n<p>饱和度：洗衣服，掉色，颜色越来越淡</p>\n<p>色相环（一般都是互补色，家教为180）黄色还有蓝色</p>\n<p>冷暖对比（上冷下暖）</p>\n<p>黄图还有蓝天</p>\n<h3 id=\"1-4构图\"><a href=\"#1-4构图\" class=\"headerlink\" title=\"1.4构图\"></a>1.4构图</h3><p>点构图：</p>\n<ol>\n<li>中心点</li>\n<li>九宫格法（放到四个焦点）</li>\n<li>引导线（忘一个点走）</li>\n</ol>\n<p>线构图：</p>\n<ol>\n<li>对称（镜面）</li>\n<li>二分线（九宫格）</li>\n<li>三分线</li>\n<li>引导线</li>\n<li>对角线</li>\n</ol>\n<p>面构图：</p>\n<ol>\n<li>框架（被框柱）</li>\n<li>三角</li>\n<li>重复出现</li>\n<li>留白</li>\n</ol>\n<h3 id=\"1-5专业模式\"><a href=\"#1-5专业模式\" class=\"headerlink\" title=\"1.5专业模式\"></a>1.5专业模式</h3><p>主要就是让自己手动设置快门，光圈还有感光度</p>\n<p>光圈：（光圈越大，进光越大，一般就是使用人像），越小越好f1.4</p>\n<p>快门：（打开门的时间，时间越短，就是记录的越来越快），时间越长，进光越多</p>\n<p>感光度：（iso越大越亮，但是会出现噪点</p>\n<p>景深：就是手动进行对焦</p>\n<p>晚间拍摄车水马龙：调大光圈，然后延长曝光时间，iso一般不用设置，因为出现过度</p>\n<p>shuttle（快门） af，mf来进行对焦</p>\n<p>白平衡：进行设置色温的冷暖（越低越暖）</p>\n<p>打开raw可以进行设置</p>\n<h3 id=\"1-6夜景\"><a href=\"#1-6夜景\" class=\"headerlink\" title=\"1.6夜景\"></a>1.6夜景</h3><p>iso低，延长曝光时间</p>\n<p>苹果的就是，实况，长曝光</p>\n<h3 id=\"1-7人像\"><a href=\"#1-7人像\" class=\"headerlink\" title=\"1.7人像\"></a>1.7人像</h3><p>人像一般需要进行虚化，虚化一般需要大光圈。虚化背景</p>\n<p><strong>背景就远离人物，可以拍摄更久，更好的虚化</strong></p>\n<p><strong>拍摄技巧（后退2-3步，然后2-3倍）</strong>（因为，这样可以虚化背景）</p>\n<p>如何拍摄长腿：</p>\n<ol>\n<li>弯腰，然后仰角拍摄</li>\n<li><strong>或者是脚在最下面，然后偷留下1&#x2F;3的空间</strong></li>\n<li><strong>或者对角线拍摄</strong></li>\n</ol>\n<p>或者是自己进行附魔头发</p>\n<h3 id=\"1-8街拍\"><a href=\"#1-8街拍\" class=\"headerlink\" title=\"1.8街拍\"></a>1.8街拍</h3><p>一般使用引导线，然后夜间一般就是长曝光</p>\n<h3 id=\"1-9风光\"><a href=\"#1-9风光\" class=\"headerlink\" title=\"1.9风光\"></a>1.9风光</h3><h3 id=\"1-10\"><a href=\"#1-10\" class=\"headerlink\" title=\"1.10\"></a>1.10</h3><p>微距</p>\n<p>长时间在3-4cm会自动进行触发</p>\n<p>然后喷壶，使用连拍，可以拍摄出动物</p>\n<h3 id=\"1-11食物\"><a href=\"#1-11食物\" class=\"headerlink\" title=\"1.11食物\"></a>1.11食物</h3><p>拍摄角度</p>\n<ol>\n<li>俯拍</li>\n<li>平拍摄（背景</li>\n<li>45°进行拍摄</li>\n</ol>\n<p>构图：</p>\n<ol>\n<li>三角构图（三个食物）</li>\n<li>斜对角线</li>\n<li>中心点</li>\n<li>重复食物</li>\n</ol>\n<p>光纤：放入一张白纸，增加柔软度</p>\n<p>放大片面</p>\n<h3 id=\"1-12星空\"><a href=\"#1-12星空\" class=\"headerlink\" title=\"1.12星空\"></a>1.12星空</h3><p>设置长曝光，iso进行调整</p>\n<p>最后一个就是对焦（设置为无限远，因为要对焦的是星星）</p>\n<p>有限使用主摄，白平衡（设置偏暖）</p>\n<h2 id=\"2-后期设置\"><a href=\"#2-后期设置\" class=\"headerlink\" title=\"2.后期设置\"></a>2.后期设置</h2><h3 id=\"2-1基础知识\"><a href=\"#2-1基础知识\" class=\"headerlink\" title=\"2.1基础知识\"></a>2.1基础知识</h3><p>曝光：调整明亮度</p>\n<p>对比度：就是明与暗的对比</p>\n<p>锐化：图片表面边缘</p>\n<p>饱和度：颜色更鲜艳</p>\n<p>白平衡：调节色温</p>\n<p>褪色：添加颗粒（一般使用胶片的时候）</p>\n<p>肤色：调整人的肤色</p>\n<p>镜头模糊：虚化</p>\n<p>清晰：凸显细节</p>\n<p>使用的软件</p>\n<ol>\n<li>vsco</li>\n<li>snap</li>\n<li>lr泼辣修图</li>\n</ol>\n<h3 id=\"2-2影调\"><a href=\"#2-2影调\" class=\"headerlink\" title=\"2.2影调\"></a>2.2影调</h3><p>图像分为影调还有色影</p>\n<p>影调就是明暗轮廓，主要是从0-255的灰度值，来计算每个地方的数量</p>\n<p>分为以下几个：</p>\n<ol>\n<li>曝光（纯黑）</li>\n<li>对比（有点黑的数量）</li>\n<li>细节（剩下的就是细节）</li>\n<li>阴影（有点白的）</li>\n<li>白色（全是白色的）</li>\n</ol>\n<p>这个可以用曲线来看出</p>\n<p>清晰度：边缘对比</p>\n<h3 id=\"2-3色调\"><a href=\"#2-3色调\" class=\"headerlink\" title=\"2.3色调\"></a>2.3色调</h3><p>色温，调整这个一般都是的相邻色</p>\n<p>主要还是使用曲线来进行设置，剩下的就是hsl来进行设置</p>\n<p>直方图：反应图片（黑色，阴影，细节，高光，白色），这个就是数值</p>\n<p>从左到右是0-255,255是白光</p>\n<p>下面是色彩的直方图</p>\n<p>只有三原色，红绿蓝</p>\n<p>左边是红色的数量少，右边是红色多</p>\n<p>对比度（明暗的对比）</p>\n<p>如何做好，就是模仿别人的直方图</p>\n<h3 id=\"2-4hsl\"><a href=\"#2-4hsl\" class=\"headerlink\" title=\"2.4hsl\"></a>2.4hsl</h3><p>色彩调整</p>\n<p>单一的颜色调整（七原色）</p>\n<p>色相：颜色</p>\n<p>饱和度：鲜艳程度</p>\n<p>明亮度：明暗</p>\n<p>色相：只能是他的相邻色，30平分</p>\n<p>拉动只会到他的相邻色</p>\n<p>调色思路：一般去除杂色，饱和度为0，<strong>然后留下互补色</strong></p>\n<p>一般思路：</p>\n<ol>\n<li><strong>家曝光</strong>，这个在局部调整（增加光进入）</li>\n<li>加对比</li>\n<li>降低高光</li>\n</ol>\n<h3 id=\"2-6曲线\"><a href=\"#2-6曲线\" class=\"headerlink\" title=\"2.6曲线\"></a>2.6曲线</h3><p>一般是两个曲线，明亮曲线（一般用于s行）</p>\n<p>左上是亮度，游侠是暗度</p>\n<p>一般使用锚点，固定每一个的格子</p>\n<p>胶片的思路：一般就是加暗，调低亮度，然后加入颗粒感</p>\n<p>小清新：提高亮度，一般只有2中颜色，调低对比度</p>\n<p><strong>颜色曲线：</strong></p>\n<ol>\n<li>往下就是互补色（红色互补就是蓝+绿）</li>\n<li>往上就是增加强度</li>\n<li>一般使用（2个颜色叠加，来增加第三个颜色）</li>\n</ol>\n<h3 id=\"2-7颜色分级\"><a href=\"#2-7颜色分级\" class=\"headerlink\" title=\"2.7颜色分级\"></a>2.7颜色分级</h3><p>就是使用圆形轮廓，然后设置，可以进行局部设置</p>\n<h3 id=\"2-10后期实战\"><a href=\"#2-10后期实战\" class=\"headerlink\" title=\"2.10后期实战\"></a>2.10后期实战</h3><p>基础问题分析：</p>\n<ol>\n<li>没有层次感（加强对比度，加强清晰感）</li>\n<li>色彩不突出（重新上色，局部提亮，增加曝光）</li>\n</ol>\n<p><strong>青橙思路</strong>：</p>\n<ol>\n<li>适用于风光，建筑，晴天</li>\n<li>主要是互补色</li>\n<li>高光，阴影，细节</li>\n<li>lsh’设置青橙</li>\n</ol>\n<p><strong>暗黑：</strong></p>\n<ol>\n<li>适用于阴雨天</li>\n<li>降低高光，加对比度，增加黑色</li>\n<li>lsh去除杂色，明确颜色</li>\n</ol>\n<p><strong>蓝调：</strong></p>\n<ol>\n<li>增加曝光，降低高光，提高阴影</li>\n<li>色温设定颜色</li>\n</ol>\n<p><strong>小清新：</strong></p>\n<ol>\n<li>天气好</li>\n<li>降低对比度</li>\n<li>一般都是男女为主，加明亮度</li>\n</ol>\n<p>*<em>cyberpunk</em>***：</p>\n<ol>\n<li>一般适用于夜晚</li>\n<li>降低高光，提高阴影，加对比度</li>\n<li>hsl往品红，杨宏走</li>\n</ol>\n","tags":[{"name":"摄影","slug":"摄影","permalink":"http://yoursite.com/tags/%E6%91%84%E5%BD%B1/"}]},{"title":"excel","date":"2022-11-27T11:59:36.000Z","path":"2022/11/27/excel/","content":"<h1 id=\"excel小结\"><a href=\"#excel小结\" class=\"headerlink\" title=\"excel小结\"></a>excel小结</h1><p>通过4个模块来学习excel如何使用，学生成绩表，学习如何对表格进行设置列宽，输入的格式</p>\n<h2 id=\"4-1学生课程表\"><a href=\"#4-1学生课程表\" class=\"headerlink\" title=\"4.1学生课程表\"></a>4.1学生课程表</h2><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16695505408951669550540036.png\"></p>\n<p>这个首先就是需要进行第一行的合并单元格，然后进行插入单元格来近似填充文字。之后就是文字输入（这个是要自动换行，使用alt+enter，还有就是，输入3-4，需要设置单元格格式为文本，这样才不会出现问题。</p>\n<p>一下是重点</p>\n<ol>\n<li>在单元格输入多个文字，使用文本框</li>\n<li>输入数字，不会变成日期，需要把格式设置为文本</li>\n<li>分成多行，需要使用alt+enter</li>\n</ol>\n<p>总结：</p>\n<p>第一个案例还是比较简单的，不需要多次学习</p>\n<h2 id=\"2-学生成绩表\"><a href=\"#2-学生成绩表\" class=\"headerlink\" title=\"2.学生成绩表\"></a>2.学生成绩表</h2><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16695508618951669550861471.png\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16695508758951669550875367.png\"></p>\n<p>这个没有效果图</p>\n<p>使用官方教程来精简一下：</p>\n<ol>\n<li>第一个计算年龄（这个就需要使用函数，year（today（））-mid（c4,7,4），偶去今年然后减去省份中第7位开始长度为4的值 2022-2001&#x3D;21</li>\n<li>第二个就是使用分裂，来得到班级，我们通过学号发现，前5位就是班级号。所以我们复制学号，然后到班级版一列，使用分裂，固定宽度为5.就可以进行分列</li>\n<li>有效性，就是检查成绩是不是在0-100，使用有效性，需要先进行设置数据范围，之后全出有效性数据，修改数据值</li>\n<li>计算成绩，这个直接使用公式计算，然后下拉</li>\n<li>计算最高，这个直接使用max，count</li>\n<li>这个在数据的条件格式，突出显示前20%就可以</li>\n<li>选择性粘贴，直接右击，保存至，下一个就是直接乘</li>\n<li>自定义排序</li>\n<li>使用ctrl拖动就可以复制</li>\n<li>合规岗使用筛选，之后使用自定义排序就可</li>\n</ol>\n<p>总结：</p>\n<p>这个也不是很难，还是比较简单的。主要包括函数的使用，对程序员还是比较友好的</p>\n<h2 id=\"3-班费分析图\"><a href=\"#3-班费分析图\" class=\"headerlink\" title=\"3.班费分析图\"></a>3.班费分析图</h2><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16695513598951669551359372.png\"></p>\n<p>这个主要是用来进行作图的，精简步骤如下</p>\n<ol>\n<li>选择包含列名的所有数据，之后选择插入柱状图</li>\n<li>这样每一个系列就是列名</li>\n<li>x和y轴就是从0开始的轴</li>\n<li>水平垂直网格，就是每一行所代表的的</li>\n<li>以上所有的操作都可以右击得到</li>\n</ol>\n<p>总结：</p>\n<p>这个总体也不是很难，主要包括的动作，只需要右击属性，更换不同元素就可以进行设置</p>\n<h2 id=\"4-图书信息表\"><a href=\"#4-图书信息表\" class=\"headerlink\" title=\"4.图书信息表\"></a>4.图书信息表</h2><p>信息量最大的一个，学习了多级分类，还有分类筛选</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16695517318951669551731087.png\"></p>\n<p>主要包括以上多个功能，我精简的说下如何实现</p>\n<p><strong>高级筛选</strong>，这个需要我们自己首先建立一个筛选表，填上所需要的列名，查找元素，不确定（姓王，可以使用王<em>来代替），这个</em>s正则表达式的任意匹配，上面都是匹配条件，使用高级筛选，选择值为数据区域，条件区域，还有最后的结果区域</p>\n<blockquote>\n<p>单击“高级筛选”工作表，在表内，按要求输入条件数据，单击“开始”选项卡中“筛选”命令的下拉菜单中的“高级筛选”，在弹出的对话框中设置，列表区域设置“图书信息表!$A$2:$J$66”，条件区域设置“高级筛选!$B$2:$F$5”，复制到设置“高级筛选!$B$13”，即可。</p>\n</blockquote>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16695519988991669551998303.png\"></p>\n<p><strong>分类汇总</strong>：就是进行分类出，这是那个书库，然后还有这些书库里的树又是那几个出版社出版的。</p>\n<ol>\n<li>单击“分类汇总”工作表，在表内选定A2:J66单元格区域,点击“数<strong>据”选项卡中的“排序”命令，设置主要关键字为“所在书库编号”，次要关键字为“出版社”</strong>（数据里的排序，主要关键是书库，次要是出版社）</li>\n<li>第一次汇总，书库，选择分类汇总，字段为书库，汇总为计数，汇总的值是所在书库编号</li>\n<li>下一个就是分类依据是出版社，然后火种为求和，UI中值是价格（选择对价格进行求和）</li>\n</ol>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16695525368941669552536684.png\"></p>\n<p>数据透视表：这个要求是求出每一个书库每一个出版社，每一种类别的值：</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16695527979031669552797175.png\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16695529268961669552926263.png\"></p>\n<p>可以看出，最上面一行是总计，3,6,6,2都是下面的和。</p>\n<p>然后行可以看到是出版社，还有图书类别构成（为什么，因为有4*8行），列就是书库名</p>\n<p>所以我们把书库编号放到列，图书类型，还有出版社方导航，计数值就是图书名称求和</p>\n<p><strong>数据透视图</strong>L:xianshi每一个出版社的人数。</p>\n<p>这个上一个4.3就做过，我们只需要把著作者放到值区域，然后图例就是出版社</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16695534069141669553406891.png\"></p>\n<p><strong>合并计算</strong>：计算每个出版社的书的价格</p>\n<blockquote>\n<p>单击“合并计算”工作表，选定A1单元格，点击“数据”选项卡的“合并计算”命令，在弹出对话框中“函数”选“求和”、引用位置选择“图书信息表!$E$2:$F$66”，点击“添加”按钮，勾选“首行”、“最左列”，点击“确定”按钮，即可</p>\n</blockquote>\n<p><strong>选择e2到f66是因为，e2是出版社，f2是价格，直接选择这两个，首行代表，首行也要进行计算，最左列，代表是对最左列进行合并汇总</strong></p>\n<p><strong>模拟计算</strong>：学校新增3000的图书，如果还有一个出版社，要出多少钱，之前的大75折扣</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16695537958951669553795387.png\"></p>\n<p>这个是所有的（b2到b6进行打75这扣扣，目前计算是查，所以需要b6来进行补充，所以使用模拟计算来得到b6的值</p>\n<blockquote>\n<p>这个就相当于求b6，使用函数来得到（x+b6）*0.75&#x3D;3000x已知得的，所以模拟计算就是用来求b65</p>\n</blockquote>\n<p>总结：这个案例还是有很多可圈可点的，学的内容还是很多，我做第二次还是不太熟悉，得多次进行练习。</p>\n","tags":[{"name":"office","slug":"office","permalink":"http://yoursite.com/tags/office/"},{"name":"excel","slug":"excel","permalink":"http://yoursite.com/tags/excel/"}]},{"title":"数字逻辑","date":"2022-11-26T07:45:52.000Z","path":"2022/11/26/数字逻辑/","content":"<h1 id=\"数电小结\"><a href=\"#数电小结\" class=\"headerlink\" title=\"数电小结\"></a>数电小结</h1><h2 id=\"1-逻辑代数\"><a href=\"#1-逻辑代数\" class=\"headerlink\" title=\"1.逻辑代数\"></a>1.逻辑代数</h2><p>第一章主要是讲逻辑代数，主要是离散数学的知识，这些知识在考验期间学过，就直接跳过。包括逻辑化简，最小项还有最大项。砌筑一个新的知识点就是卡洛图。下面简单介绍一下卡诺图。</p>\n<p>卡诺图：用小方格来表示最小项，一个小方格代表一个最小项，然后将这些最小项按照相邻性排列起来<strong>（00 01 11 10）</strong>。</p>\n<p>注意，是使用01还有11，不是01,10这样排列，这样是为了，能够2个都是1可以消除第一位，只留下一，还有10和00也是可以在一起进行消除的。</p>\n<p>无关项：就是值未知的项，值为x，可0可1，一般是为了凑成最大的圈，就把x设置为1</p>\n<p>卡诺图化简规则</p>\n<ol>\n<li>尽量化最大的圈（只能是2的倍数）</li>\n<li>化尽量少的圈</li>\n<li>然后进行看无关项，如果无关项可以进行辅助化简也加进来</li>\n</ol>\n<h2 id=\"2-组合逻辑\"><a href=\"#2-组合逻辑\" class=\"headerlink\" title=\"2.组合逻辑\"></a>2.组合逻辑</h2><p>基础知识：与或非异或，基本的门电路</p>\n<p>电路分析，一般使用一下方法</p>\n<ol>\n<li>直接按照输入输出进行化简</li>\n<li>或者是对表达式，进行逻辑组合进行化简</li>\n<li>或者是真值表，进行最小项来直接得到结果</li>\n</ol>\n<h3 id=\"2-1组合逻辑电路\"><a href=\"#2-1组合逻辑电路\" class=\"headerlink\" title=\"2.1组合逻辑电路\"></a>2.1组合逻辑电路</h3><p>编码器：就是把独热编码进行转化为相应的二进制代码把（0010）转化为二进制就是10（因为是2位使用，二进制就是10）</p>\n<p>优先编码器：允许同时输入两个以上信号，并按优先级输出。例如：10-4线(如74LS147)、 8-3线(如74LS148)。<strong>就是输入多个有效信号，并且按照有限输出</strong></p>\n<p>译码器：3-8译码器，刚才把2进行编码输出为10，那么译码器就是把10，输出为0010</p>\n<p><img src=\"https://repo.holgerbest.top/img/fyMXeGraTizmxlK.png\"></p>\n<p>其中下面456是使能端，当45为低电平，6为高电平的时候才有效（因此，地址的开头可以设置在使能端，通过使能端的逻辑组合，来达到搜寻特定地址例如a8h到afh，后三位接到123，前面5位接到456，使用逻辑电路进行组合</p>\n<p><strong>74LS138应用1 实现逻辑函数</strong>：将逻辑函数转换成最小项表达式，再转换成与非—与非形式。用一片74138加与非门就可实现三变量逻辑函数。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16729040080261672904007282.png\"></p>\n<p>例题：首先画出真值表，得到卡诺图，发现是y2y3y4y5，我们可以在最后面使用与非得到，前面就是选择2345的最小项</p>\n<p>数据选择器：（4选一，需要2位来进行选择，因为2的2次方就是4，这两位数就是地址选择）</p>\n<p><img src=\"https://repo.holgerbest.top/img/R18Y9mlbF5rQ7Oo.png\"></p>\n<p>香浓化简法：把最终的逻辑函数，分成w还有-w，然后最下面进行设置数据选择器。</p>\n<p>例题：2个8选一，构成16选一。</p>\n<p>2片就是16选2，同时还需要设置，使能端，需要进行设置取反</p>\n<p><img src=\"https://repo.holgerbest.top/img/CP69jouBO1SFlzb.png\"></p>\n<h2 id=\"3-时序电路\"><a href=\"#3-时序电路\" class=\"headerlink\" title=\"3.时序电路\"></a>3.时序电路</h2><p>rd的意识就是设置为0</p>\n<p><strong>rs触发器</strong>：特点就是r&#x3D;1，最后q的输出就是为0（r是resert的意思），当s&#x3D;1，最后q就是1（s是set的意思），特征方程如下，rs</p>\n<p><img src=\"https://repo.holgerbest.top/img/SQ3ACdbkvPrsVBz.png\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16729055030251672905502326.png\"></p>\n<p>这个要换成或非门，只需要我们把r还有s设置真值表，，然后就可以得到逻辑函数，我们知道q非还有q是相反的，所以我们的约束条件是rs&#x3D;0，但是当我们输入00的时候，这个条件就不成立，所以就是约束条件。</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16729057560251672905755304.png\"></p>\n<p>接下来就是d触发器（这个就是寄存器的原型，因为输入什么，输出什么）</p>\n<p><img src=\"https://repo.holgerbest.top/img/ynDgfWOMzUcA1B5.png\"></p>\n<p>下面就是t触发器</p>\n<p><img src=\"https://repo.holgerbest.top/img/EJTLOymIpvPd3hC.png\"></p>\n<p>最后一个就是jk触发器，</p>\n<p><img src=\"https://repo.holgerbest.top/img/nyEHmc3PxdBgk5T.png\"></p>\n<p>他有上述的几个触发器的多个特点，j为1，设置0，k为设置为1，全0就是保持不变，全1就是进行取反</p>\n<p>进行多个变形jk变d</p>\n<p><img src=\"https://repo.holgerbest.top/img/VRsyxivXWPcTz8A.png\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16729062970281672906296730.png\"></p>\n","tags":[{"name":"数字逻辑","slug":"数字逻辑","permalink":"http://yoursite.com/tags/%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91/"},{"name":"ic","slug":"ic","permalink":"http://yoursite.com/tags/ic/"}]},{"title":"职场networking","date":"2022-11-26T07:08:19.000Z","path":"2022/11/26/职场networking/","content":"<h1 id=\"职场networking\"><a href=\"#职场networking\" class=\"headerlink\" title=\"职场networking\"></a>职场networking</h1><p>以下内容来源于小林说职场,关注小林的youtube即可</p>\n<h2 id=\"1-为什么需要\"><a href=\"#1-为什么需要\" class=\"headerlink\" title=\"1.为什么需要\"></a>1.为什么需要</h2><ol>\n<li>帮你快速了解整个流程(大一,找到学长学姐,直接知道大学三年,怎么走)</li>\n<li>然后根据这些经验与其他人相互交流,这样别的人也会觉得你是有点东西的</li>\n</ol>\n<h2 id=\"2-如何开始\"><a href=\"#2-如何开始\" class=\"headerlink\" title=\"2.如何开始\"></a>2.如何开始</h2><p>分为线上还有平级社交,想射由于是boss,有点难度.</p>\n<p>但是平级社交容易开始:</p>\n<blockquote>\n<p>平级社交本质就是价值交换</p>\n</blockquote>\n<p>只有我的价值有用才可以开始社交,普通人之间相互开始的.</p>\n<p>如何开始:</p>\n<ol>\n<li>可以帮助他们查资料(做实验的时候)</li>\n<li>举办活动的时候做志愿者</li>\n<li>逢年过节(写上祝福)</li>\n</ol>\n<p>最简单的方式.</p>\n<p><strong>如何溶蚀他人—-把自己要说的话写好,然后再转发给那个帮你的人(可以节约他的时间)</strong></p>\n<h2 id=\"3-认识人模板\"><a href=\"#3-认识人模板\" class=\"headerlink\" title=\"3.认识人模板\"></a>3.认识人模板</h2><p>还是经典的三段论</p>\n<ol>\n<li>自我介绍</li>\n<li>说明来意</li>\n<li>提出需求</li>\n</ol>\n<p>1.自我介绍:</p>\n<blockquote>\n<p>xxx你好,我叫xxx,来自xxx.我从我那个水知道你,知道你是我们学校的做个这有很高方向的人</p>\n</blockquote>\n<p>2.说明来意:</p>\n<blockquote>\n<p>我目前做的研究与你这个有关联,再研究调养期间,发现你的论文对我很有帮助,然后正在逐步学习你的代码</p>\n</blockquote>\n<p>3.提出需求:</p>\n<blockquote>\n<p>然后发现,您的代码,有些逻辑,不太理解.能1请耽误您15分钟的时间,能简介 一下吗.解决之后(说出好处)</p>\n</blockquote>\n<h2 id=\"4-附录-社交场合如何networking\"><a href=\"#4-附录-社交场合如何networking\" class=\"headerlink\" title=\"4.附录(社交场合如何networking)\"></a>4.附录(社交场合如何networking)</h2><h3 id=\"4-1开始\"><a href=\"#4-1开始\" class=\"headerlink\" title=\"4.1开始\"></a>4.1开始</h3><ol>\n<li>自我介绍(hi,你好,我叫xxx,nicetomeetu)</li>\n<li>跨别人(你这个衣服真不错,直接这么做的呀)</li>\n<li>套近乎(看着比较眼熟,你是哪里的)</li>\n<li>插入别人的对话</li>\n<li>mind i joining</li>\n<li>你们再讨论什么呢,这么有意思</li>\n</ol>\n<h3 id=\"4-2chat-topic\"><a href=\"#4-2chat-topic\" class=\"headerlink\" title=\"4.2chat topic\"></a>4.2chat topic</h3><ol>\n<li>你从哪里来的呀(开车呀,好远,哪里吃的不错)</li>\n<li>你从哪里听到这个活动的呀</li>\n<li>你也是这个活动的会员呀</li>\n<li>环境感觉如何</li>\n<li>经典的吃(茶歇)</li>\n<li>我吃的这个不错,你也可以事实上哦</li>\n<li>单独落单了,你也是第一次参加这个吗</li>\n</ol>\n<h3 id=\"4-3结束\"><a href=\"#4-3结束\" class=\"headerlink\" title=\"4.3结束\"></a>4.3结束</h3><ol>\n<li>我去个厕所</li>\n<li>我吃的没有了,弄点吃的</li>\n<li>太晚了,我该回去了</li>\n<li>我同学来了,我和他打个招呼</li>\n</ol>\n","tags":[{"name":"社交","slug":"社交","permalink":"http://yoursite.com/tags/%E7%A4%BE%E4%BA%A4/"},{"name":"人机","slug":"人机","permalink":"http://yoursite.com/tags/%E4%BA%BA%E6%9C%BA/"}]},{"title":"人际社会学","date":"2022-11-25T07:17:18.000Z","path":"2022/11/25/人际社会学/","content":"<h1 id=\"人机解剖\"><a href=\"#人机解剖\" class=\"headerlink\" title=\"人机解剖\"></a>人机解剖</h1><h2 id=\"1-什么叫魅力\"><a href=\"#1-什么叫魅力\" class=\"headerlink\" title=\"1.什么叫魅力\"></a>1.什么叫魅力</h2><blockquote>\n<p>刚开始不认识对方还是和和气气的,认识之后就对对方可以调戏.这是因为我们知道了对方的框架.</p>\n</blockquote>\n<p>框架:</p>\n<ol>\n<li>对方能接受的底线(一开始不知道对方的底线)</li>\n<li>包括对方喜欢什么,还有不接受什么</li>\n</ol>\n<p>人与人认识,就是认识对方的框架</p>\n<hr>\n<p>能量:</p>\n<blockquote>\n<p>为什么会在开始,就知道这个人能不能决胜.(因为已经做好准备了,兵马未动,粮草先行)</p>\n</blockquote>\n<p>决定你能不能取胜都是事前的准备(例如1km,取决于之前的锻炼,而不i是今天自己的爆发)</p>\n<p>做好准备就是决定能量的多少就是你的实力</p>\n<hr>\n<p>实力:</p>\n<ol>\n<li>社会是幕强的</li>\n<li>绝对实力再任何技巧面前都是没用的(只要篮球够好,总有一堆人喜欢你的)</li>\n<li>赢家通吃(长得帅一堆女生)</li>\n</ol>\n<hr>\n<p>提升实力:</p>\n<p>能量&#x3D;&#x3D;&gt;包括实力</p>\n<p>实力&#x3D;价值+稀缺性</p>\n<p>实力可以包括:</p>\n<ol>\n<li>兴趣(使用电脑)</li>\n<li>优势(数学&amp;英语)</li>\n</ol>\n<p>价值:取决于你所在位置的用途(滑雪对boss没什么用,只能当运动员)</p>\n<p>稀缺性:阳光,空气还有水都有价值(但没有稀缺性,信息是有稀缺性的)</p>\n<hr>\n<p>稀缺性构建:</p>\n<ol>\n<li>信息过剩(查询到有用信息,查询会计师信息)</li>\n<li>知识(知道信息,学习知识,使用某本书)</li>\n<li>能力(需要联系的,能够和别人谈笑风生,都需要联系自己的交往能力的)</li>\n<li>认识,能出其他人的角度思考</li>\n<li>资源(资源永远是稀缺的,没人带你无法入门)</li>\n</ol>\n<hr>\n<blockquote>\n<p>重点部分</p>\n</blockquote>\n<p><strong>构成实力:</strong></p>\n<ol>\n<li><strong>干就完事了(不要多想)</strong></li>\n<li>保持真实</li>\n<li>再自己的主场(自己的主场,别人大佬也会请教你的,或者是自己的学晓)</li>\n</ol>\n<h2 id=\"2-人机关系痛苦\"><a href=\"#2-人机关系痛苦\" class=\"headerlink\" title=\"2.人机关系痛苦\"></a>2.人机关系痛苦</h2><h3 id=\"本质\"><a href=\"#本质\" class=\"headerlink\" title=\"本质\"></a>本质</h3><blockquote>\n<p>自己的需求得不到</p>\n</blockquote>\n<p>没有曼珠自己的需求</p>\n<p>需求,不可能一直满足,所以会有痛苦.相反</p>\n<p>当当时得到满足了,那个需求,那么一瞬间就是快乐</p>\n<blockquote>\n<ol>\n<li>辩证的知道,没有痛苦就没有快乐</li>\n<li>痛苦是常态</li>\n</ol>\n</blockquote>\n<h3 id=\"他人攻击谩骂\"><a href=\"#他人攻击谩骂\" class=\"headerlink\" title=\"他人攻击谩骂\"></a>他人攻击谩骂</h3><blockquote>\n<p>别人不喜欢,无所谓了</p>\n</blockquote>\n<blockquote>\n<p>体温，为什么会被别人不喜欢</p>\n<p>因为，他攻击力，是因为你当前这个角色没做好</p>\n</blockquote>\n<p>人是一切关系社会的综合，</p>\n<p><strong>人也是角色的综合</strong></p>\n<ol>\n<li>自己是学生</li>\n<li>自己也是老师</li>\n<li>自己也是儿子</li>\n<li>自己也是男朋友</li>\n<li>自己也是同学</li>\n<li>自己也是公司员工</li>\n</ol>\n<p><strong>高情商就是处理号自己的角色</strong></p>\n<p>家长对孩子也是要辩证的</p>\n<ol>\n<li>孩子顶撞自己</li>\n<li>孩子考试好了(阳)</li>\n</ol>\n<p>他只是攻击这个角色,并不是攻击我</p>\n<hr>\n<blockquote>\n<p><strong>关于忍不忍</strong></p>\n</blockquote>\n<p><strong>主要是看是不是自己的核心利益</strong></p>\n<p>辞职:这个时候辞职了,有没有下一家</p>\n<h3 id=\"为什么会霸凌\"><a href=\"#为什么会霸凌\" class=\"headerlink\" title=\"为什么会霸凌\"></a>为什么会霸凌</h3><blockquote>\n<p>一步步试探底线,发现你都可以接受(所以刚开始就要说不)</p>\n</blockquote>\n<p>为什么会干欺凌(因为没有代价)</p>\n<p>如何解决:</p>\n<ol>\n<li>使劲闹大</li>\n<li>增加犯错成本</li>\n</ol>\n<h2 id=\"3-恋爱\"><a href=\"#3-恋爱\" class=\"headerlink\" title=\"3.恋爱\"></a>3.恋爱</h2><p>分为下面多个阶段</p>\n<h3 id=\"陌生人到男女朋友-暧昧期\"><a href=\"#陌生人到男女朋友-暧昧期\" class=\"headerlink\" title=\"陌生人到男女朋友(暧昧期)\"></a>陌生人到男女朋友(暧昧期)</h3><p>为什么会有的人自来熟(一见如故),因为他默认把你当作他多年的朋友.</p>\n<p><strong>距离:你觉得近 就近,你觉得渊就远</strong></p>\n<p>什么时候调:把对方当作你的情人</p>\n<p>男女朋友(状态):</p>\n<ol>\n<li>直接开始吃饭</li>\n<li>直接开始约会</li>\n<li>直接做男女朋友的事</li>\n</ol>\n<h3 id=\"吸引\"><a href=\"#吸引\" class=\"headerlink\" title=\"吸引\"></a>吸引</h3><p>被你吸引事因为:</p>\n<ol>\n<li>被你这个人的世界所吸引(朋友圈,显示high value)</li>\n<li>再这个领域事top(篮球)</li>\n<li>会才艺(做饭)</li>\n<li>处于焦点(经常出现,刷脸熟,容易被人记住)</li>\n</ol>\n<blockquote>\n<p>人在专注的时候,别人会被你的世界吸引过来</p>\n</blockquote>\n<h3 id=\"激情\"><a href=\"#激情\" class=\"headerlink\" title=\"激情\"></a>激情</h3><p>好奇心(想了解你这个人的一切)</p>\n<p>如何保持激情,就是保持好奇心,就是增加神秘感(你有你的世界,如果被知道了,就再增加)</p>\n<h3 id=\"平淡\"><a href=\"#平淡\" class=\"headerlink\" title=\"平淡\"></a>平淡</h3><p>淡下去了,就去增加自己的神秘感</p>\n<p>美好的声音≠好妻子</p>\n<blockquote>\n<p>结婚,找舒服的,想出舒服(情绪稳定,不要找个祖宗)(闹啊,你不爱我呀,打电话啊)</p>\n</blockquote>\n","tags":[{"name":"社会学","slug":"社会学","permalink":"http://yoursite.com/tags/%E7%A4%BE%E4%BC%9A%E5%AD%A6/"},{"name":"多萝西","slug":"多萝西","permalink":"http://yoursite.com/tags/%E5%A4%9A%E8%90%9D%E8%A5%BF/"}]},{"title":"pa1.1小结","date":"2022-11-19T12:41:21.000Z","path":"2022/11/19/pa1-1小结/","content":"<h1 id=\"pa1-1\"><a href=\"#pa1-1\" class=\"headerlink\" title=\"pa1.1\"></a>pa1.1</h1><p>本章主要是要求大家进行使用构建完成简易表达式，主要包括单步执行，打印寄存器，还有扫描内存</p>\n<blockquote>\n<p>为什么使用static，因为使用static可以解决两个c文件有相同函数名的问题，不会造成编译问题</p>\n</blockquote>\n<h2 id=\"单步执行\"><a href=\"#单步执行\" class=\"headerlink\" title=\"单步执行\"></a>单步执行</h2><p>但不执行，我们可以看到远吗使用的cmdc这个函数</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">cmd_c</span><span class=\"params\">(<span class=\"type\">char</span> *args)</span> &#123;</span><br><span class=\"line\"><span class=\"comment\">//    -1是65535最大的2的64-1</span></span><br><span class=\"line\">  cpu_exec(<span class=\"number\">-1</span>);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>使用cpu_exec代表就是直接执行，使用-1，因为这是uint，无符号，-1的无符号就是最大值</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">cpu_exec</span><span class=\"params\">(<span class=\"type\">uint64_t</span> n)</span> &#123;</span><br><span class=\"line\">  g_print_step = (n &lt; MAX_INST_TO_PRINT);</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (nemu_state.state) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> NEMU_END: <span class=\"keyword\">case</span> NEMU_ABORT:</span><br><span class=\"line\">      <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Program execution has ended. To restart the program, exit NEMU and run again.\\n&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: nemu_state.state = NEMU_RUNNING;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>所以我们只需要对当前的函数，进行查找出需要执行的步数，然后调用cpu——exec来进行执行代码</p>\n<p>使用strtok来进行抽取参数就可以</p>\n<p>然后转换函数可以直接使用atoi</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">cmd_si</span><span class=\"params\">(<span class=\"type\">char</span> *args)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/* extract the first argument */</span></span><br><span class=\"line\">    <span class=\"comment\">/*get steps,default is 1*/</span></span><br><span class=\"line\">    <span class=\"type\">char</span> *arg = strtok(<span class=\"literal\">NULL</span>, <span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">int</span> i=<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(arg==<span class=\"literal\">NULL</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">/* no argument given */</span></span><br><span class=\"line\">        i=<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        i=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>;j&lt; <span class=\"built_in\">strlen</span>(arg);j++)&#123;</span><br><span class=\"line\">            i=i*<span class=\"number\">10</span>+arg[j]-<span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"comment\">//    printf(&quot;%s&quot;,arg);</span></span><br><span class=\"line\">    cpu_exec(i);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"打印寄存器\"><a href=\"#打印寄存器\" class=\"headerlink\" title=\"打印寄存器\"></a>打印寄存器</h2><blockquote>\n<p>打印寄存器就更简单了. 不过既然寄存器的结构是ISA相关的, 我们希望能为简易调试器屏蔽ISA的差异. 框架代码已经为大家准备了如下的API:</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// nemu/src/isa/$ISA/reg.c</span><br><span class=\"line\">void isa_reg_display(void);</span><br></pre></td></tr></table></figure>\n\n<p>执行<code>info r</code>之后, 就调用<code>isa_reg_display()</code>, 在里面直接通过<code>printf()</code>输出所有寄存器的值即可. 如果你从来没有使用过<code>printf()</code>, 请RTFM或者STFW. 如果你不知道要输出什么, 你可以参考GDB中的输出.</p>\n</blockquote>\n<p>这个因为我们使用的riscv，所以需要去riscv里面进行修改isa——display这个函数。</p>\n<p>直接调用isa，主要思路就是在reg里面进行遍历每一个寄存器，然后reg里面有gpr这个可以直接获取值。</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">isa_reg_display</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">32</span>; ++i) &#123;</span><br><span class=\"line\"><span class=\"comment\">//        printf(&quot;%s %s&quot;,regs[i],isa_reg_str2val(regs[i],false));</span></span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%-3s :0x%08lx |  \\n&quot;</span>, regs[i], cpu.gpr[i]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"扫描内存\"><a href=\"#扫描内存\" class=\"headerlink\" title=\"扫描内存\"></a>扫描内存</h2><p>这个意思就是求出地址附近的10个值。如何求出值，观看rtfsc，可以发现调用vaddr，传入地址，还有字节数就行。默认riscv一个地址有4B，所以我们就传入就行</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">cmd_x</span><span class=\"params\">(<span class=\"type\">char</span> *args)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/* get N info,with the start of exp*/</span></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * vaddr_read(addr,len),这个len是长度的意思，单位是byte，一条指令默认4B，所以取的4</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"type\">char</span> *arg= strtok(<span class=\"literal\">NULL</span>, <span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">int</span> N=atoi(arg);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">paddr_t</span> exprs=<span class=\"number\">0x80000000</span>;</span><br><span class=\"line\"><span class=\"comment\">//    printf(&quot;0x%08x&quot;,exprs);</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//    printf(&quot;Address    Dword block ... Byte sequence\\n&quot;);</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;N;i++)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;0x%8x  0x%08lx\\n&quot;</span>,exprs + i*<span class=\"number\">4</span>,vaddr_read(exprs + i * <span class=\"number\">4</span>,<span class=\"number\">4</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后地址的话，每次都是更新4，。直接+4就可以</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>总的来说还是比较简单的，但是由于是第一次接触到这种作业，还是查了不少资料。重点还是要看jyy的2020ics的习题课</p>\n","tags":[{"name":"pa","slug":"pa","permalink":"http://yoursite.com/tags/pa/"}]},{"title":"leetcode150","date":"2022-11-19T12:33:58.000Z","path":"2022/11/19/leetcode150/","content":"<h1 id=\"leetcode-150\"><a href=\"#leetcode-150\" class=\"headerlink\" title=\"leetcode 150\"></a>leetcode 150</h1><blockquote>\n<p>Evaluate the value of an arithmetic expression in <a href=\"http://en.wikipedia.org/wiki/Reverse_Polish_notation\">Reverse Polish Notation</a>.</p>\n<p>Valid operators are <code>+</code>, <code>-</code>, <code>*</code>, and <code>/</code>. Each operand may be an integer or another expression.</p>\n<p><strong>Note</strong> that division between two integers should truncate toward zero.</p>\n<p>It is guaranteed that the given RPN expression is always valid. That means the expression would always evaluate to a result, and there will not be any division by zero operation.</p>\n</blockquote>\n<h2 id=\"题意\"><a href=\"#题意\" class=\"headerlink\" title=\"题意\"></a>题意</h2><p>本题是给你了逆波兰表达式，让你自己求，这个结果。</p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><p>我们可以发现，这个就是后缀表达式，使用后缀遍历，然后我们也可以发现，这个树的叶子节点就是数字。</p>\n<p>整体思路就是遍历这个字符串，然后发现是数字就push到stack里面，然后发现是符号就pop出来两个数字，对他进行操作。</p>\n<p>最后返回栈顶元素</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    </span><br><span class=\"line\">    stack&lt;<span class=\"type\">long</span> <span class=\"type\">long</span>&gt; s;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">evalRPN</span><span class=\"params\">(vector&lt;string&gt;&amp; tokens)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 简单的后缀表达式求和</span></span><br><span class=\"line\">        set&lt;string&gt; rec;</span><br><span class=\"line\">        rec.<span class=\"built_in\">insert</span>(<span class=\"string\">&quot;+&quot;</span>);</span><br><span class=\"line\">        rec.<span class=\"built_in\">insert</span>(<span class=\"string\">&quot;-&quot;</span>);</span><br><span class=\"line\">        rec.<span class=\"built_in\">insert</span>(<span class=\"string\">&quot;*&quot;</span>);</span><br><span class=\"line\">        rec.<span class=\"built_in\">insert</span>(<span class=\"string\">&quot;/&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">auto</span> i:tokens)&#123;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span>(rec.<span class=\"built_in\">find</span>(i)!=rec.<span class=\"built_in\">end</span>())&#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> a=s.<span class=\"built_in\">top</span>();</span><br><span class=\"line\">                s.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">                <span class=\"type\">int</span> b=s.<span class=\"built_in\">top</span>();</span><br><span class=\"line\">                s.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">                <span class=\"comment\">// cout&lt;&lt;a&lt;&lt;&quot; &quot;&lt;&lt;b&lt;&lt;endl;</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(i==<span class=\"string\">&quot;+&quot;</span>)&#123;</span><br><span class=\"line\">                    s.<span class=\"built_in\">push</span>(a+b);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(i==<span class=\"string\">&quot;-&quot;</span>)&#123;</span><br><span class=\"line\">                    s.<span class=\"built_in\">push</span>(b-a);</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(i==<span class=\"string\">&quot;*&quot;</span>)&#123;</span><br><span class=\"line\">                    s.<span class=\"built_in\">push</span>((<span class=\"type\">long</span> <span class=\"type\">long</span>)a*(<span class=\"type\">long</span> <span class=\"type\">long</span> )b);</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                    s.<span class=\"built_in\">push</span>(b/a);</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                s.<span class=\"built_in\">push</span>(<span class=\"built_in\">atoi</span>(i.<span class=\"built_in\">c_str</span>()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> s.<span class=\"built_in\">top</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"leetcode","slug":"leetcode","permalink":"http://yoursite.com/tags/leetcode/"},{"name":"后序遍历","slug":"后序遍历","permalink":"http://yoursite.com/tags/%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86/"}]},{"title":"leetcode148","date":"2022-11-19T12:13:00.000Z","path":"2022/11/19/leetcode148/","content":"<h1 id=\"leetcode-148\"><a href=\"#leetcode-148\" class=\"headerlink\" title=\"leetcode 148\"></a>leetcode 148</h1><blockquote>\n<p>Given the <code>head</code> of a linked list, return <em>the list after sorting it in <strong>ascending order</strong></em>.</p>\n</blockquote>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16688601431171668860143064.png\"></p>\n<blockquote>\n<p><strong>Follow up:</strong> Can you sort the linked list in <code>O(n logn)</code> time and <code>O(1)</code> memory (i.e. constant space)?</p>\n</blockquote>\n<h2 id=\"题意\"><a href=\"#题意\" class=\"headerlink\" title=\"题意\"></a>题意</h2><p>把链表进行排序输出，但是只能使用o1的空间，nlogn的时间。</p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><p>使用nlogn的方法来进行排序只有快排还有归并，但是都是用来递归，那空间就是on。所以只能使用迭代的方法来进行排序。</p>\n<p>地带也是给予归并的，就是我们手动从下到上，手动进行排序。排序完成一层厚，再次进行下一层来排序。</p>\n<p>现在我们进行引进dummy还有cur，dummy使用尾插法，来构建新的完整的链表（这是新一层的）</p>\n<p>每一层开始的时候p&#x3D;q&#x3D;head，</p>\n<p>然后q多走i补来达到下一组的开始</p>\n<p>然后引进p还有q，pq是两组的开头，对pq进行循环遍历，次数小于1,2,4，（这是分组的方式）。同事还有一个 o，o是2i的位置（表示新的一组开始进行排序，连接），这个都是用cur来进行尾插法。之后再把head&#x3D;o，开始进行下一组</p>\n<p>完成一层厚，我们让head&#x3D;dummy-》next。</p>\n<h2 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h2><blockquote>\n<p><code>[4,3,1,7,8,9,2,11,5,6]</code>.这个进行排序</p>\n</blockquote>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">step=<span class=\"number\">1</span>: (<span class=\"number\">3</span>-&gt;<span class=\"number\">4</span>)-&gt;(<span class=\"number\">1</span>-&gt;<span class=\"number\">7</span>)-&gt;(<span class=\"number\">8</span>-&gt;<span class=\"number\">9</span>)-&gt;(<span class=\"number\">2</span>-&gt;<span class=\"number\">11</span>)-&gt;(<span class=\"number\">5</span>-&gt;<span class=\"number\">6</span>)</span><br><span class=\"line\">step=<span class=\"number\">2</span>: (<span class=\"number\">1</span>-&gt;<span class=\"number\">3</span>-&gt;<span class=\"number\">4</span>-&gt;<span class=\"number\">7</span>)-&gt;(<span class=\"number\">2</span>-&gt;<span class=\"number\">8</span>-&gt;<span class=\"number\">9</span>-&gt;<span class=\"number\">11</span>)-&gt;(<span class=\"number\">5</span>-&gt;<span class=\"number\">6</span>)</span><br><span class=\"line\">step=<span class=\"number\">4</span>: (<span class=\"number\">1</span>-&gt;<span class=\"number\">2</span>-&gt;<span class=\"number\">3</span>-&gt;<span class=\"number\">4</span>-&gt;<span class=\"number\">7</span>-&gt;<span class=\"number\">8</span>-&gt;<span class=\"number\">9</span>-&gt;<span class=\"number\">11</span>)-&gt;(<span class=\"number\">5</span>-&gt;<span class=\"number\">6</span>)</span><br><span class=\"line\">step=<span class=\"number\">8</span>: (<span class=\"number\">1</span>-&gt;<span class=\"number\">2</span>-&gt;<span class=\"number\">3</span>-&gt;<span class=\"number\">4</span>-&gt;<span class=\"number\">5</span>-&gt;<span class=\"number\">6</span>-&gt;<span class=\"number\">7</span>-&gt;<span class=\"number\">8</span>-&gt;<span class=\"number\">9</span>-&gt;<span class=\"number\">11</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<p>我们可以看第一轮i&#x3D;1，dummy-&gt;next表示step1这个完整的链表（3417.。），cur都是尾插法，然后p&#x3D;4，q&#x3D;3，o&#x3D;1，34</p>\n<p>结束后就是head&#x3D;o，p&#x3D;head&#x3D;1，q&#x3D;7，然后接着进行更新</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Definition for singly-linked list.</span></span><br><span class=\"line\"><span class=\"comment\"> * struct ListNode &#123;</span></span><br><span class=\"line\"><span class=\"comment\"> *     int val;</span></span><br><span class=\"line\"><span class=\"comment\"> *     ListNode *next;</span></span><br><span class=\"line\"><span class=\"comment\"> *     ListNode() : val(0), next(nullptr) &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> *     ListNode(int x) : val(x), next(nullptr) &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> *     ListNode(int x, ListNode *next) : val(x), next(next) &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> * &#125;;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">   <span class=\"comment\">/*1.首先求出长度n</span></span><br><span class=\"line\"><span class=\"comment\">   2.第一个for i是求出层数</span></span><br><span class=\"line\"><span class=\"comment\">   3.第二个for是求出分了几组，想领2gei是一组</span></span><br><span class=\"line\"><span class=\"comment\">   4.然后对q走到下一个开头，p是当前的开头</span></span><br><span class=\"line\"><span class=\"comment\">   5.对o走到2i的位置，使他们可以接着循环</span></span><br><span class=\"line\"><span class=\"comment\">   6.之后就是常规的归并方法使用while</span></span><br><span class=\"line\"><span class=\"comment\">   7.一层遍历结束完成后，让cur-&gt;next=null,同事更新head为dummy-》nexzt表示新的开头</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\">ListNode* <span class=\"title\">sortList</span><span class=\"params\">(ListNode* head)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 使用地带进行排序</span></span><br><span class=\"line\">        <span class=\"type\">int</span> n=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">auto</span> cur=head;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(cur)&#123;</span><br><span class=\"line\">            n++;</span><br><span class=\"line\">            cur=cur-&gt;next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;n;i*=<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">             <span class=\"keyword\">auto</span> dummy=<span class=\"keyword\">new</span> <span class=\"built_in\">ListNode</span>(<span class=\"number\">-1</span>);</span><br><span class=\"line\">            <span class=\"comment\">//  dummy指示的是一层的开始</span></span><br><span class=\"line\">            cur=dummy;</span><br><span class=\"line\">            <span class=\"comment\">//第一层循环是层数，从第一个开始,1,2,4</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">1</span>;j&lt;=n;j+=<span class=\"number\">2</span>*i)&#123;</span><br><span class=\"line\">                <span class=\"comment\">//第二个循环是组好，然后进行比较</span></span><br><span class=\"line\">                <span class=\"comment\">//  在组好开始进行排序 这是一次组里的比较</span></span><br><span class=\"line\">               </span><br><span class=\"line\">                <span class=\"comment\">// auto cur=dummy;使用cur来进行插入</span></span><br><span class=\"line\">                <span class=\"keyword\">auto</span> p=head;<span class=\"comment\">//第一组开始</span></span><br><span class=\"line\">                 <span class=\"keyword\">auto</span> q=p;<span class=\"comment\">//第二组开始</span></span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">//找到下一个组开始的0号</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"type\">int</span> k=<span class=\"number\">0</span>;k&lt;i&amp;&amp;q;k++)&#123;</span><br><span class=\"line\">                    q=q-&gt;next;</span><br><span class=\"line\">                    <span class=\"comment\">//下一组的开始</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">auto</span> o=q;<span class=\"comment\">//下一组的开始标签，使用2i开始</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"type\">int</span> k=<span class=\"number\">0</span>;k&lt;i&amp;&amp;o;k++)&#123;</span><br><span class=\"line\">                    o=o-&gt;next;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"type\">int</span> l=<span class=\"number\">0</span>;</span><br><span class=\"line\">                <span class=\"type\">int</span> r=<span class=\"number\">0</span>;</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// 两个开始,第一组开始都是1开始比较</span></span><br><span class=\"line\">                <span class=\"keyword\">while</span>(p&amp;&amp;q&amp;&amp;l&lt;i&amp;&amp;r&lt;i)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(p-&gt;val&lt;q-&gt;val)&#123;</span><br><span class=\"line\">                        l++;</span><br><span class=\"line\">                     cur-&gt;next=p;</span><br><span class=\"line\">                     cur=cur-&gt;next;</span><br><span class=\"line\">                     p=p-&gt;next;</span><br><span class=\"line\">                    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                        r++;</span><br><span class=\"line\">                        cur-&gt;next=q;</span><br><span class=\"line\">                        cur=cur-&gt;next;</span><br><span class=\"line\">                        q=q-&gt;next;</span><br><span class=\"line\">                        <span class=\"comment\">//尾插法</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">while</span>(p&amp;&amp;l&lt;i)&#123;</span><br><span class=\"line\">                    l++;</span><br><span class=\"line\">                     cur-&gt;next=p;</span><br><span class=\"line\">                     cur=cur-&gt;next; </span><br><span class=\"line\">                     p=p-&gt;next;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">while</span>(q&amp;&amp;r&lt;i)&#123;</span><br><span class=\"line\">                   r++;</span><br><span class=\"line\">                        cur-&gt;next=q;</span><br><span class=\"line\">                        cur=cur-&gt;next;</span><br><span class=\"line\">                        q=q-&gt;next;</span><br><span class=\"line\">                        <span class=\"comment\">//尾插法 </span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                head=o;<span class=\"comment\">//下一次开始</span></span><br><span class=\"line\">                <span class=\"comment\">// cout&lt;&lt;head-&gt;val&lt;&lt;&quot; &quot;;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// 整个结束了，插入到开始</span></span><br><span class=\"line\">            cur-&gt;next=<span class=\"literal\">NULL</span>;</span><br><span class=\"line\">            <span class=\"comment\">//尾插法，是因为要保持开始的顺序不变</span></span><br><span class=\"line\">            head=dummy-&gt;next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> head;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"leetcode","slug":"leetcode","permalink":"http://yoursite.com/tags/leetcode/"},{"name":"linked list","slug":"linked-list","permalink":"http://yoursite.com/tags/linked-list/"}]},{"title":"pa配置vscode","date":"2022-11-18T12:59:12.000Z","path":"2022/11/18/pa配置vscode/","content":"<h1 id=\"pa配置vscode\"><a href=\"#pa配置vscode\" class=\"headerlink\" title=\"pa配置vscode\"></a>pa配置vscode</h1><h2 id=\"1-为什么会写这一个\"><a href=\"#1-为什么会写这一个\" class=\"headerlink\" title=\"1.为什么会写这一个\"></a>1.为什么会写这一个</h2><p>目前正在写nju pa。pa是用makefile进行构建的，然后使用了多个自定义宏，导致，无法进行，直接的和之前一样，按一下run就可以运行。所以得进行手动配置。</p>\n<p>还有就是，没有使用ide进行编码，导致一堆{}对齐的问题，然后找bug比较难受</p>\n<h2 id=\"2-配置方法\"><a href=\"#2-配置方法\" class=\"headerlink\" title=\"2.配置方法\"></a>2.配置方法</h2><p>根据jyy<a href=\"https://www.bilibili.com/video/BV1qa4y1j7xk?p=4&vd_source=d043013c6aa637931d747eae4c52b842\">的课程</a>在1小时16分钟左右的时候，只需要进行vscode配置一会儿就可以正常使用。把defines里面进行添加宏就可以，这个宏如何查找，在第三届讲makefile的时候介绍过。我们使用make -nB(可以进行强制编译所有的)然后我们使用vim</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16687772080711668777207848.png\"></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make -nB \\</span><br><span class=\"line\"> | grep -ve &#x27;^\\(\\#\\|echo\\|mkdir\\)&#x27; \\</span><br><span class=\"line\"> | vim -</span><br></pre></td></tr></table></figure>\n\n<p>然后进行搜索 -D ，这个参数就是在编译里面加入自定义宏，然后我们把这些宏进行拷贝过来，使用管道连接，去除echo 还有mkidr，传递给vim，vim用搜索按钮查找就可以</p>\n<h2 id=\"3-vscode配置教程\"><a href=\"#3-vscode配置教程\" class=\"headerlink\" title=\"3.vscode配置教程\"></a>3.vscode配置教程</h2><p>参考教程：<a href=\"https://zhuanlan.zhihu.com/p/87864677\">https://zhuanlan.zhihu.com/p/87864677</a></p>\n<ol>\n<li>安装c++插件</li>\n<li>安装远程开发（我是用的虚拟机，进行ssh开发）</li>\n<li>之后就是通过ssh连接虚拟机，然后插件安装后，进行设置</li>\n<li>进行配置c_cpp_properties.json，在defines进行添加宏（无人其他改动）</li>\n<li><strong>接下来就是配置gdb</strong></li>\n</ol>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;configurations&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Linux&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;includePath&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">                <span class=\"string\">&quot;$&#123;workspaceFolder&#125;/**&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;defines&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">                <span class=\"string\">&quot;__GUESR_ISA__=riscv64&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"string\">&quot;_GNU_SOURCE&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"string\">&quot;__STDC_CONSTANT_MACROS&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"string\">&quot;__STDC_FORMAT_MACROS&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"string\">&quot;__STDC_LIMIT_MACROS&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;compilerPath&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;/usr/bin/clang&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;cStandard&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;c17&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;cppStandard&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;c++14&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;intelliSenseMode&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;linux-clang-x64&quot;</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>gdb配置有坑：</p>\n<p>参考下面 ： <a href=\"https://www.youtube.com/watch?v=9VpiGwp8Vos&amp;ab_channel=SavvyNik\">https://www.youtube.com/watch?v=9VpiGwp8Vos&amp;ab_channel=SavvyNik</a></p>\n<p>我们要进行配置gdb，就得要在编译过程加入- g ，这个可以在makefile发现是在build.mk里面的，我们加入-g选项。然后还得设置launch.json</p>\n<p>参考如下：<a href=\"https://blog.csdn.net/zztiger123/article/details/105544640\">https://blog.csdn.net/zztiger123/article/details/105544640</a></p>\n<p>修改program为build下面那个输出的，然后cwd，修改为nemu的目录</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"comment\">// 使用 IntelliSense 了解相关属性。 </span></span><br><span class=\"line\">    <span class=\"comment\">// 悬停以查看现有属性的描述。</span></span><br><span class=\"line\">    <span class=\"comment\">// 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;0.2.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;configurations&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;(gdb) Launch&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;cppdbg&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;request&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;launch&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;program&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;$&#123;workspaceRoot&#125;/nemu/build/riscv64-nemu-interpreter&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;args&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"string\">&quot;-b&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;stopAtConnect&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;cwd&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;$&#123;workspaceRoot&#125;/nemu&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;environment&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;externalConsole&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;MIMode&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;gdb&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;setupCommands&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;description&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;为 gdb 启用整齐打印&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;text&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;-enable-pretty-printing&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;ignoreFailures&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;description&quot;</span><span class=\"punctuation\">:</span>  <span class=\"string\">&quot;将反汇编风格设置为 Intel&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;text&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;-gdb-set disassembly-flavor intel&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;ignoreFailures&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">        <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;miDebuggerPath&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;/usr/bin/gdb&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>这个结束之后，有个坑，jyy在is_mode_batch这个函数设置为true，我用gdb就追踪不了，我输入p命令的结果，把那个函数值设置为false就可以走正常流程，进行追踪。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tasks&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;label&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;make&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;shell&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;command&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;make -j8&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;problemMatcher&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;group&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;build&quot;</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;cppbuild&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;label&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;C/C++: gcc 生成活动文件&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;command&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;/usr/bin/gcc&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;args&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">                <span class=\"string\">&quot;-fdiagnostics-color=always&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"string\">&quot;-g&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"string\">&quot;$&#123;file&#125;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"string\">&quot;-o&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"string\">&quot;$&#123;fileDirname&#125;/$&#123;fileBasenameNoExtension&#125;&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;options&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;cwd&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;$&#123;fileDirname&#125;&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;problemMatcher&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">                <span class=\"string\">&quot;$gcc&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;group&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;kind&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;build&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;isDefault&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;detail&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;调试器生成的任务。&quot;</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2.0.0&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"4-clion应该也一样\"><a href=\"#4-clion应该也一样\" class=\"headerlink\" title=\"4.clion应该也一样\"></a>4.clion应该也一样</h2><p>明天有空在进行配置clion，修改自定义make目标，然后进行添加，可以参考下面的连接</p>\n<p><a href=\"https://www.jetbrains.com/help/clion/custom-build-targets.html#custom-rundebug\">https://www.jetbrains.com/help/clion/custom-build-targets.html#custom-rundebug</a></p>\n<h2 id=\"5-总结\"><a href=\"#5-总结\" class=\"headerlink\" title=\"5.总结\"></a>5.总结</h2><p>pa确实难，对于我这个非科班跨考的。不过感觉也学到挺多知识的，好的大学，课程真的可以和没过高校的课程差不多，现在才做完1.2，还得接着写。</p>\n","tags":[{"name":"pa","slug":"pa","permalink":"http://yoursite.com/tags/pa/"},{"name":"nemu","slug":"nemu","permalink":"http://yoursite.com/tags/nemu/"},{"name":"vscode","slug":"vscode","permalink":"http://yoursite.com/tags/vscode/"}]},{"title":"学习技巧","date":"2022-11-18T09:48:27.000Z","path":"2022/11/18/学习技巧/","content":"<h1 id=\"1-学习技巧\"><a href=\"#1-学习技巧\" class=\"headerlink\" title=\"1.学习技巧\"></a>1.学习技巧</h1><p>来源于youtube 的crashcourse 里面分为10节进行讲述，如何学习。一个半小时左右可以看完，还是很不错的。具体连接如下</p>\n<p><a href=\"https://youtu.be/IhuwS5ZLwKY\">https://youtu.be/IhuwS5ZLwKY</a></p>\n<p>看完了这个视频，解决了我研一所与到的多个问题，是使用笔记本还是手写做笔记。做笔记的方法有哪些怎么进行读书</p>\n<h2 id=\"1-1学会做笔记\"><a href=\"#1-1学会做笔记\" class=\"headerlink\" title=\"1.1学会做笔记\"></a>1.1学会做笔记</h2><p>分为下面几个重点</p>\n<p>1.<strong>工具</strong></p>\n<ol>\n<li>电脑</li>\n<li>传统的笔记本</li>\n</ol>\n<blockquote>\n<p><strong>研究表明，使用电脑的打字速度会更快，但是，打字只会让自己变成一个记忆机器，没有自己的思考。人的大佬不能并行处理时间（打字还有进行思考），所以得需要使用纸币来进行记录，这样不会进行打断思路</strong></p>\n</blockquote>\n<p>2.<strong>记录内容</strong></p>\n<ol>\n<li>idea</li>\n<li>专业术语</li>\n<li>例子</li>\n</ol>\n<p>3.<strong>笔记记录方式</strong></p>\n<ol>\n<li>思维导图，xmind</li>\n<li>cmu笔记，使用左边hint，右边笔记，下面是总结</li>\n<li>总结（目录法），就是word</li>\n</ol>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16687713222201668771322176.png\" alt=\"word大纲\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16687713750721668771374689.png\"></p>\n<h2 id=\"1-2读书\"><a href=\"#1-2读书\" class=\"headerlink\" title=\"1.2读书\"></a>1.2读书</h2><p>只能处理4-7bit的信息</p>\n<p>看论文的方法</p>\n<p>如何学习可课本教科书</p>\n<ol>\n<li>简介</li>\n<li>标题</li>\n<li>课后习题</li>\n</ol>\n<p><strong>如何快速的阅读</strong></p>\n<ol>\n<li>设置时间ddl</li>\n<li>使用highlight</li>\n<li>使用跳读,(跳过 and,or)</li>\n<li>消除默读现象</li>\n</ol>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16687716960771668771695525.png\"></p>\n<p>广泛的阅读还有其他多看书</p>\n<ol>\n<li>观点花点</li>\n<li>论证的用破折号</li>\n</ol>\n<h2 id=\"1-3回忆与记忆\"><a href=\"#1-3回忆与记忆\" class=\"headerlink\" title=\"1.3回忆与记忆\"></a>1.3回忆与记忆</h2><p>recall&amp;memory</p>\n<p>工作记忆只能处理4-7位的信息</p>\n<p>长期记忆需要进行连接</p>\n<p>记忆喜欢记得是图像,有形的(使用注记法),就是被关键词,使用联想法</p>\n<p>然后就是记忆衰退的方法,多次检索,就会容易回忆(就是多次开始记录)</p>\n<p>盒子记录：就是anki，会的就进入下一个盒子，不会的就重新回到第一个盒子</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16687725300721668772529814.png\"></p>\n<p>，每天学习，没三天学习</p>\n<h2 id=\"1-4如何做组织管理\"><a href=\"#1-4如何做组织管理\" class=\"headerlink\" title=\"1.4如何做组织管理\"></a>1.4如何做组织管理</h2><p>这一节，解决了我之前想的，到底如何进行处理数据。使用日历+todo+笔记系统（calendar+todo+typora）</p>\n<p>学习必须要在学习环境，在图书馆，或者咖啡店</p>\n<p><strong>及时捕获自己的想法</strong></p>\n<ol>\n<li>任务</li>\n<li>事件</li>\n<li>还有知识</li>\n<li>想法（论文的idea）</li>\n</ol>\n<p><strong>输出自己的想法</strong></p>\n<ol>\n<li>写作</li>\n<li>代码</li>\n</ol>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16687728890711668772888770.png\"></p>\n<p><strong>记录自己的戒指信息还有任务详情</strong></p>\n<p>谷歌日历来进行记录</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16687730720801668773071545.png\"></p>\n<p>云端笔记如何记录：</p>\n<blockquote>\n<p>使用电脑结构，跟目录，时间，课程</p>\n</blockquote>\n<p>quick catch：</p>\n<ol>\n<li>当时有的信息，就储存下来</li>\n<li>使用todo，记录今天发生的事件</li>\n</ol>\n<p>每周计划还有每日计划</p>\n<ol>\n<li>每个星期天来做（分成几个小块）</li>\n<li><strong>杂事（全部在一起处理）</strong></li>\n<li>还要复盘，每周（什么做了。什么没做）</li>\n</ol>\n<p>为什么无法坚持，因为熵增定律</p>\n<h2 id=\"1-5如何专注\"><a href=\"#1-5如何专注\" class=\"headerlink\" title=\"1.5如何专注\"></a>1.5如何专注</h2><blockquote>\n<p>这个解决了，我为什么感觉什么都没有学到专注不了自己喜欢的东西</p>\n</blockquote>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16687735320721668773531358.png\"></p>\n<p>基于任务的（做数学题），自顶向下的，但是会匹配</p>\n<p>如何加强自己</p>\n<ol>\n<li>环境</li>\n<li>兴趣爱好</li>\n<li>还有大脑的状态</li>\n</ol>\n<p><strong>加强自己专注</strong></p>\n<ol>\n<li>去图书馆（健身房就会自己想去健身）</li>\n<li>停止多线程，经常切换，会让自己的大脑没有思路</li>\n<li>关闭手机（断网，有时候多就是少，关闭手机还有电脑）（请勿打扰）</li>\n<li>把我任务进行结块（摘要，结论，研究方法，实验）</li>\n<li>使用forset或者番茄土豆（不要切换任务）</li>\n<li>还要学会放松</li>\n</ol>\n<h2 id=\"1-6拖延症\"><a href=\"#1-6拖延症\" class=\"headerlink\" title=\"1.6拖延症\"></a>1.6拖延症</h2><blockquote>\n<p>又是一个好的course，给解决拖延症提供了思路</p>\n</blockquote>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16687744690781668774468167.png\"></p>\n<p>预期可以考到那个学校（求其上这得中）</p>\n<p>价值越高（就是工作给的钱，就不会不拖延）</p>\n<p>冲动做其他的事，拖延的时间越长，就容易拖延（</p>\n<p><strong>减少冲动</strong></p>\n<ol>\n<li>分解任务</li>\n</ol>\n<p><strong>寻求帮助</strong></p>\n<ol>\n<li><p>成立学习小组</p>\n</li>\n<li><p>提高奖励（看完论文和朋友看电影</p>\n</li>\n<li><p>提高体验（打游戏，很久时间）</p>\n</li>\n<li><p>去图书馆</p>\n</li>\n<li><p>使用block进行阻挡网络</p>\n</li>\n<li><p>使用番茄土豆</p>\n</li>\n</ol>\n<p><strong>进行娱乐</strong></p>\n<h2 id=\"1-10体育学习\"><a href=\"#1-10体育学习\" class=\"headerlink\" title=\"1.10体育学习\"></a>1.10体育学习</h2><p>健身版提供助学习，还是要运动。 </p>\n<p>用进废退</p>\n<p>定期训练</p>\n","tags":[{"name":"crash course","slug":"crash-course","permalink":"http://yoursite.com/tags/crash-course/"},{"name":"学习方法","slug":"学习方法","permalink":"http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/"}]},{"title":"虚拟机网络","date":"2022-11-18T09:32:01.000Z","path":"2022/11/18/虚拟机网络/","content":"<h1 id=\"vmware桥接没有网络\"><a href=\"#vmware桥接没有网络\" class=\"headerlink\" title=\"vmware桥接没有网络\"></a>vmware桥接没有网络</h1><p>好久没有登录虚拟机，虚拟机的桥接出现问题。我以为是这个虚拟机iso的问题。于是我对manjaro这个linux进行折腾了半天。从下午折腾到晚上。</p>\n<p>主要包括，自己手动进行网络配置，然后重新建立网卡，还使用其他网络工具。最后我对网络进行啥用nat可以联网，但是使用nat联网，我的jetbrains gateway的配置识别不了，换了nat的ip也进不去。于是我准备使用新的iso，同时在manjaro里面下载github，把我写的代码进行上传。manjaro仓库有github第三方，可以直接下载。然后我是用deepin进行安装，安装完成后，我也是使用桥接的方式来进行连接，结果发现网络还是连接不了。那我就意识到是vmware的问题，于是我去stfw，网上进行搜索，发现这个问题是因为vmwarre进行桥接的时候识别不了，本机现在联网的网卡，需要自己手动设置。我 手动设置之后，结果两个linux都连上网了，又是折腾了一下午。</p>\n<p>主要还是对manjaro这个系统不熟悉，我看到他的问题，显示已经连上网络，但是不能上网，我就以为是可能香谷歌那种，只是上不了谷歌才显示的，于是就以为是linux的问题。但是deepin安装完成后，直接就是显示网络平已经断开，所以，我才觉得是虚拟机的问题。</p>\n<hr>\n<p>总结</p>\n<ol>\n<li>主要是对manjaro这个linux发行版不熟悉</li>\n<li>然后就是vmaware这个软件的bug</li>\n</ol>\n<p>具体解决方法</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16687647390781668764738161.png\"></p>\n","tags":[{"name":"运维","slug":"运维","permalink":"http://yoursite.com/tags/%E8%BF%90%E7%BB%B4/"},{"name":"网络","slug":"网络","permalink":"http://yoursite.com/tags/%E7%BD%91%E7%BB%9C/"}]},{"title":"多源bfs","date":"2022-11-12T13:26:33.000Z","path":"2022/11/12/多源bfs/","content":"<h1 id=\"多源bfs-amp-最小树\"><a href=\"#多源bfs-amp-最小树\" class=\"headerlink\" title=\"多源bfs&amp;最小树\"></a>多源bfs&amp;最小树</h1><h2 id=\"0-证明\"><a href=\"#0-证明\" class=\"headerlink\" title=\"0.证明\"></a>0.证明</h2><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16682604660491668260465791.png\"></p>\n<p>归纳法,开始为0,不用证明</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16682605600491668260559129.png\"></p>\n<p>去除对头的第一个元素x,可以加入3个x+1的元素,最多有两端</p>\n<p>两个特性,一般是队列,前面是x,后面是x+1</p>\n<p>默认开始的元素是最小值,喝dij的使用优先队列的最小值一样.</p>\n<p>入队就是最小值的</p>\n<h2 id=\"1-bfs\"><a href=\"#1-bfs\" class=\"headerlink\" title=\"1.bfs\"></a>1.bfs</h2><h3 id=\"1-1矩阵距离\"><a href=\"#1-1矩阵距离\" class=\"headerlink\" title=\"1.1矩阵距离\"></a>1.1矩阵距离</h3><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16682596642021668259663290.png\"></p>\n<blockquote>\n<p>大致意识就是求每个位置到1的最短距离</p>\n</blockquote>\n<p>这个就是求最短路,求每个点到一堆起点的距离,建立一个虚拟起点,让1 作为起点开始寻找,然后使用虚拟起点,连接所有的 1</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16682598242021668259823715.png\"></p>\n<p>思路:先把所有是1的位置加入到queue里面,距离是0</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16682603282041668260328053.png\"></p>\n<p>重点是找到放入所有的值,还有一个就是进行更新,tt&#x3D;-1</p>\n<hr>\n<p>总体思路如下</p>\n<ol>\n<li>使用1作为开始的点,把所有的1进行插入到队列</li>\n<li>之后就是常规bfs,进行pop</li>\n<li>然后第二阶段就是搜索周围的元素,找到符合的元素,二姐没有被使用(没有被使用就是距离为-1),使用的直接continue</li>\n<li>然后进行更新,更新之后在把他插入到队列里面,</li>\n</ol>\n<h2 id=\"2-魔棒\"><a href=\"#2-魔棒\" class=\"headerlink\" title=\"2.魔棒\"></a>2.魔棒</h2><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16682614080511668261407501.png\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16682616770571668261677035.png\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16682616960541668261695181.png\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16682617290551668261728112.png\"></p>\n","tags":[]},{"title":"pa1","date":"2022-11-11T03:40:00.000Z","path":"2022/11/11/pa1/","content":"<h2 id=\"1-1\"><a href=\"#1-1\" class=\"headerlink\" title=\"1.1\"></a>1.1</h2><h3 id=\"单步执行\"><a href=\"#单步执行\" class=\"headerlink\" title=\"单步执行\"></a>单步执行</h3><blockquote>\n<p>单步执行的功能十分简单, 而且框架代码中已经给出了模拟CPU执行方式的函数, 你只要使用相应的参数去调用它就可以了. 如果你仍然不知道要怎么做, RTFSC</p>\n</blockquote>\n<p>我们从源代码可以看到这个，通过查看c（继续执行发现）他条用了一个exec函数，我们的目的，就是通过求职，得到那个数字是多少，然后调用exec这个函数，如何得到数字，使用strtok进行得到，之后得到的是char，转换需要使用atoi来进行使用</p>\n<p>代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"打印寄存器\"><a href=\"#打印寄存器\" class=\"headerlink\" title=\"打印寄存器\"></a>打印寄存器</h3><blockquote>\n<p>打印寄存器就更简单了. 不过既然寄存器的结构是ISA相关的, 我们希望能为简易调试器屏蔽ISA的差异. 框架代码已经为大家准备了如下的API:</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// nemu/src/isa/$ISA/reg.c</span><br><span class=\"line\">void isa_reg_display(void);</span><br></pre></td></tr></table></figure>\n\n<p>执行<code>info r</code>之后, 就调用<code>isa_reg_display()</code>, 在里面直接通过<code>printf()</code>输出所有寄存器的值即可. 如果你从来没有使用过<code>printf()</code>, 请RTFM或者STFW. 如果你不知道要输出什么, 你可以参考GDB中的输出</p>\n</blockquote>\n<p>通过这个可以知道，我们需要使用打印寄存器，只需要调用isa——display，因为我们选择的是riscv，所以我们需要在，make menuconfig里面选择isa，同事也要去对应的架构下面完善这个打印函数，这个打印函数还要输出数字，这个数值，是使用gdr这个api得到的，这个在头文件里有定义</p>\n<p>代码如下</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"扫描内存\"><a href=\"#扫描内存\" class=\"headerlink\" title=\"扫描内存\"></a>扫描内存</h3><blockquote>\n<p>扫描内存的实现也不难, 对命令进行解析之后, 先求出表达式的值. 但你还没有实现表达式求值的功能, 现在可以先实现一个简单的版本: 规定表达式<code>EXPR</code>中只能是一个十六进制数, 例如</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x 10 0x80000000</span><br></pre></td></tr></table></figure>\n\n<p>这样的简化可以让你暂时不必纠缠于表达式求值的细节. 解析出待扫描内存的起始地址之后, 就可以使用循环将指定长度的内存数据通过十六进制打印出来. 如果你不知道要怎么输出, 同样的, 你可以参考GDB中的输出. 问题是, 我们要如何访问客户计算机的内存数据呢? (答案早就说了喂)</p>\n<p>实现了扫描内存的功能之后, 你可以打印<code>0x80000000</code>或者<code>0x100000</code>附近的内存, 你应该会看到程序的代码, 和内置客户程序的内容进行对比, 检查你的实现是否正确.</p>\n</blockquote>\n<p>刚开始没有看懂题目意思，主要是使用，后面这个地址，来得到后10位地址的指，一个地址有4B，因此800下一个就是804，夹具体调用的函数是vaddr——read（addr，len），这个len是字节长度，写4就是4B，暂时是固定所有制来进行执行的</p>\n<p>代码如下</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"pa，一生一芯","slug":"pa，一生一芯","permalink":"http://yoursite.com/tags/pa%EF%BC%8C%E4%B8%80%E7%94%9F%E4%B8%80%E8%8A%AF/"}]},{"title":"word技巧","date":"2022-11-11T02:18:29.000Z","path":"2022/11/11/word技巧/","content":"<h1 id=\"word操作技巧\"><a href=\"#word操作技巧\" class=\"headerlink\" title=\"word操作技巧\"></a>word操作技巧</h1><h2 id=\"3-1项目\"><a href=\"#3-1项目\" class=\"headerlink\" title=\"3.1项目\"></a>3.1项目</h2><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16681334072201668133406077.png\"></p>\n<ol>\n<li>带圈字符在拼音那里</li>\n<li>然后段落可以设置行间距</li>\n<li>选择之后可以设置字体，字体又是可以分为大小，还有样式</li>\n<li>项目符号就是指那个三角形，编号是123，直接右击都是可以使用</li>\n<li>最后的是使用对齐方式，使用居中对齐</li>\n<li>还有一件事，可以使用格式刷，对已经设置好样式的文本进行复制粘贴。不需要自己手动设置格式</li>\n</ol>\n<h2 id=\"3-2项目\"><a href=\"#3-2项目\" class=\"headerlink\" title=\"3.2项目\"></a>3.2项目</h2><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16681337809981668133780647.png\"></p>\n<p>这个主要是学习表格的使用</p>\n<ol>\n<li>前面的格式样式设置就不提了</li>\n<li>然后是插入表格</li>\n<li>插入之后</li>\n<li>选择之后表单有对齐的功能，使用对齐</li>\n<li>还有合并单元格</li>\n<li>.进行设置行高还有列宽</li>\n<li>之后就是wps的功能，使用公式进行求和还有求级，product（left），还有sum</li>\n<li>之后设置格式，设置的格式有，人民币大写，还有一些其他</li>\n<li>设置表格变宽，使用全选进行设置，设置表格样式，选择线性颜色，还有粗细度</li>\n</ol>\n<h2 id=\"3-3项目\"><a href=\"#3-3项目\" class=\"headerlink\" title=\"3.3项目\"></a>3.3项目</h2><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16681348640571668134864015.png\"></p>\n<p>目前，难度比较大的一个。</p>\n<p>学习这个就是药了解到文本框的作用。使用普通的文本没有办法</p>\n<ol>\n<li>文本框进行插入，插入之后可以对他进行字体设置吗，还有字体效果，同事去除文本边框</li>\n<li>接下来就是进行图片插入，插入之后药把文字进行浮动与上方，不然不好移动图片</li>\n<li>之后就是手指下沉</li>\n<li>还有设置文字的行间距这些，就可以skip</li>\n<li>最后一个就是进行插入分栏，插入分栏，需要选择药进行芬兰的段落，还要进行选择分割线。注意不要选择到回车键</li>\n<li>然后就是艺术字进行设置，艺术字插入之后就是对齐，还有一些其他效果。</li>\n</ol>\n<h2 id=\"3-4项目\"><a href=\"#3-4项目\" class=\"headerlink\" title=\"3.4项目\"></a>3.4项目</h2><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16681357919941668135791288.png\"></p>\n<p>本次项目还是实际作用比较大，这个对于文档排版还是很有帮助的</p>\n<ol>\n<li>首先就是设置标题，在进行设置标题之前，我们可以对标题格式进行自定义设置</li>\n<li>然后就是对正文样式，还有标题2的样式进行设置</li>\n<li>之后就是对每一本部分进行选择设置</li>\n<li><strong>重点使用分节符，在第一页的最开头</strong>（这样可以分成，正文还有目录2节）‘</li>\n<li>之后就是进行目录的插入，也要进行设置，在应用你进行插入目录</li>\n<li>最后就是也没页脚之间的设置，使用页眉，可以定义最上面</li>\n<li>使用页脚可以定义页码，在不同节的页码，我们就不连接上一节了。然后重新设置页码</li>\n<li>最后就是插入封面，这个也是有点的</li>\n</ol>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>这些项目的操作，重点还是文本框的使用，行间距还有字体。对于我们使用的是最后一个项目，如何进行word排版，发出文章。还有那个字体和插入图片的意思。</p>\n","tags":[{"name":"word","slug":"word","permalink":"http://yoursite.com/tags/word/"}]},{"title":"框架代码","date":"2022-11-08T02:30:13.000Z","path":"2022/11/08/框架代码/","content":"","tags":[]},{"title":"github的action","date":"2022-10-26T09:58:55.000Z","path":"2022/10/26/github的action/","content":"<h1 id=\"action-操作\"><a href=\"#action-操作\" class=\"headerlink\" title=\"action 操作\"></a>action 操作</h1><h2 id=\"1-workflow是什么\"><a href=\"#1-workflow是什么\" class=\"headerlink\" title=\"1.workflow是什么\"></a>1.workflow是什么</h2><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16667785330551666778532504.png\"></p>\n<p>假设你开发的java软件又bug,用户提交问题到issue,代码人员进行修复,修复完成,之后进行pull request,然后就进行合并,合并之后旧的进行测试才能发布,这就是一个流程</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16667787870631666778786133.png\"></p>\n<h2 id=\"2-名称解释\"><a href=\"#2-名称解释\" class=\"headerlink\" title=\"2.名称解释\"></a>2.名称解释</h2><p><strong>event</strong></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16667789010571666778900736.png\"></p>\n<p>就是我触发的条件(pull request)</p>\n<p>workflow就是一系列自动化流程</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16667789610561666778960997.png\"></p>\n<p>常用的cicd</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16667791370571666779136700.png\"></p>\n<h2 id=\"3-为什么使用action\"><a href=\"#3-为什么使用action\" class=\"headerlink\" title=\"3.为什么使用action\"></a>3.为什么使用action</h2><p>因为你 不想配置环境变量   </p>\n<h2 id=\"3-demo\"><a href=\"#3-demo\" class=\"headerlink\" title=\"3.demo\"></a>3.demo</h2><h3 id=\"3-1yaml教程\"><a href=\"#3-1yaml教程\" class=\"headerlink\" title=\"3.1yaml教程\"></a>3.1yaml教程</h3><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16667809480571666780947313.png\"></p>\n<p>使用tab就是一个对象,使用kv来记录纸</p>\n<p>使用过 list记录多个,那就需要-</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16667810550641666781054310.png\"></p>\n<h3 id=\"3-2demo简介\"><a href=\"#3-2demo简介\" class=\"headerlink\" title=\"3.2demo简介\"></a>3.2demo简介</h3><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16667812140551666781213509.png\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16667812860561666781285494.png\"></p>\n<ol>\n<li>name是可选</li>\n<li>on就是event,单位需要出发的事件</li>\n</ol>\n<p>jobs,就是执行的事件</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16667813680551666781367823.png\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16667815090571666781508152.png\"></p>\n<p>到这一步就是进行代码检查,使用github编译好的checkout</p>\n<p>每一个-,代表一个list,就代表一次操作</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16667816150561666781614964.png\"></p>\n<blockquote>\n<p>uses,时使用别人的action,run是自己执行linux命令</p>\n</blockquote>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16667816900551666781689860.png\"></p>\n<h2 id=\"4-cicd在哪里执行\"><a href=\"#4-cicd在哪里执行\" class=\"headerlink\" title=\"4.cicd在哪里执行\"></a>4.cicd在哪里执行</h2><p>在github的服务器上 </p>\n<p>jobs是并行的,如果publish需要build,那就要使用关键字,need</p>\n<h2 id=\"5-总结\"><a href=\"#5-总结\" class=\"headerlink\" title=\"5.总结\"></a>5.总结</h2><p>首先 on 是触发条件(push,pull)</p>\n<p>接下来就是正常的jobs</p>\n<p>首先第一步就是checkout,第二部就是设置值环境时候用java,然后就是读取使用run,之后就clone文件,并且进入,之后就是build,一般使用gradle,并且权限777</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16667840363551666784036329.png\"></p>\n","tags":[{"name":"action","slug":"action","permalink":"http://yoursite.com/tags/action/"}]},{"title":"元编程","date":"2022-10-25T11:23:57.000Z","path":"2022/10/25/元编程/","content":"<h1 id=\"元编程\"><a href=\"#元编程\" class=\"headerlink\" title=\"元编程\"></a>元编程</h1><h2 id=\"1-概念解释\"><a href=\"#1-概念解释\" class=\"headerlink\" title=\"1.概念解释\"></a>1.概念解释</h2><p>就相当云java构建spring项目,进行build.使用规则来定义如何使用这些文件来的到,jar包</p>\n<p>cmake 比make跟smart,cmake查找本地的哭,make只会自己寻找文件</p>\n<p>使用make来进行build固件,make寻找makefile来进行make </p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666973194161666697319373.png\"></p>\n<p>上面是需按照那两个文件,然后接下来才是进行编译代码</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666974668991666697465989.png\"></p>\n<h2 id=\"2-ci持续集成\"><a href=\"#2-ci持续集成\" class=\"headerlink\" title=\"2.ci持续集成\"></a>2.ci持续集成</h2><p>自动进行构建,每一个event出发一个action,自动调用</p>\n<p>例如本文的网站,当我写好一个markdwon文件,然后使用push操作,github就会进行ci,并且生成网页</p>\n<h2 id=\"3-测速\"><a href=\"#3-测速\" class=\"headerlink\" title=\"3.测速\"></a>3.测速</h2><p>单元测试,值测试某一个功能</p>\n<p>集成测试,测试代码交互之间是不是又问题</p>\n","tags":[]},{"title":"git控制","date":"2022-10-25T02:26:53.000Z","path":"2022/10/25/git控制/","content":"<h1 id=\"git操作\"><a href=\"#git操作\" class=\"headerlink\" title=\"git操作\"></a>git操作</h1><h2 id=\"1-模型\"><a href=\"#1-模型\" class=\"headerlink\" title=\"1.模型\"></a>1.模型</h2><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666653059061666665304945.png\"></p>\n<p>模型树。对于文件夹，叫做tree，对于文件叫做blob，根目录是root</p>\n<p>git工作流</p>\n<p>使用分支branch，还有merge合并</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666656019051666665601612.png\"></p>\n<p>元数据：作者，message</p>\n<p><strong>数据模型</strong></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666657919001666665791145.png\"></p>\n<p>定义的文件为数组，tree是hash隐射，然后commit是要提交的stack</p>\n<p>一个obejcect是一个版本，维护，使用hash进行映射</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666659669051666665966713.png\"></p>\n<h2 id=\"2git-demo\"><a href=\"#2git-demo\" class=\"headerlink\" title=\"2git demo\"></a>2git demo</h2><p>暂存区</p>\n<blockquote>\n<p>为什么add和commit分开</p>\n</blockquote>\n<p>因为add可能已经完成了一个新的feature，还有一些没有完成，只提交完成的就可以进行发布</p>\n<p>也可能不想上传日志文件</p>\n<p>git checkout 进行版本切换回退 </p>\n<p>git diff进行代码比较</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666813658981666681365480.png\"></p>\n<p>可以比较不同时期某个文件的的区别</p>\n<h2 id=\"3-分支\"><a href=\"#3-分支\" class=\"headerlink\" title=\"3.分支\"></a>3.分支</h2><p>git branch cat，新建一个cat分支</p>\n<p> <img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666817818981666681781631.png\"></p>\n<p>可以之间checkout -b创新建新分支，然后进去</p>\n<p>回到什么功能都没有的master分支，进行合并cat和dog分支</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666821539001666682152951.png\"></p>\n<p>首先git merge cat</p>\n<p>然后出现合并不兼容的情况（conflic）</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666822748981666682274329.png\"></p>\n<p>因为那个if判断不对</p>\n<p>最终结果</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666824468971666682446494.png\"></p>\n","tags":[]},{"title":"acw数论","date":"2022-10-24T13:31:35.000Z","path":"2022/10/24/acw数论/","content":"<h1 id=\"4-数学知识\"><a href=\"#4-数学知识\" class=\"headerlink\" title=\"4.数学知识\"></a>4.数学知识</h1><h2 id=\"4-1质数\"><a href=\"#4-1质数\" class=\"headerlink\" title=\"4.1质数\"></a>4.1质数</h2><h3 id=\"4-1-1基本算法\"><a href=\"#4-1-1基本算法\" class=\"headerlink\" title=\"4.1.1基本算法\"></a>4.1.1基本算法</h3><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">is_prime</span><span class=\"params\">(<span class=\"type\">int</span> n)</span></span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(i&lt;<span class=\"number\">2</span>)<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">2</span>;i&lt;=n/;i++)&#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(n%i==<span class=\"number\">0</span>)<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"4-1-2分解质因数\"><a href=\"#4-1-2分解质因数\" class=\"headerlink\" title=\"4.1.2分解质因数\"></a>4.1.2分解质因数</h3><p>从小到大尝试每一个因素</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void divide(int n)&#123;</span><br><span class=\"line\">\tfor(int i=2;i&lt;=n;i++)&#123;</span><br><span class=\"line\">\t\tif(n%i==0)&#123;</span><br><span class=\"line\">\t\tint s=0;</span><br><span class=\"line\">\t\t#求出i的次数</span><br><span class=\"line\">\t\twhile(n%i==0)&#123;</span><br><span class=\"line\">\t\tn/=s;</span><br><span class=\"line\">\t\ti++;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>优化版本</p>\n<p>n中至多质保函一个最多大于根号n的因子</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void divide(int n)&#123;</span><br><span class=\"line\">\tfor(int i=2;i&lt;=n/i;i++)&#123;</span><br><span class=\"line\">\t\tif(n%i==0)&#123;</span><br><span class=\"line\">\t\tint s=0;</span><br><span class=\"line\">\t\t#求出i的次数</span><br><span class=\"line\">\t\twhile(n%i==0)&#123;</span><br><span class=\"line\">\t\tn/=i;</span><br><span class=\"line\">\t\ts++;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t#这个循环是求出质数i的次数</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tif(n&gt;1)print(n)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"4-1-3筛质数\"><a href=\"#4-1-3筛质数\" class=\"headerlink\" title=\"4.1.3筛质数\"></a>4.1.3筛质数</h3><p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666190608981666619060512.png\"></p>\n<p>筛选倍数，直到n，是质数的倍数的直接pass</p>\n<p>核心思想，反思倍数的，坑定不是质数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void get_prime(int n)&#123;</span><br><span class=\"line\">\tfor(int i=2;i&lt;=n;i++)&#123;</span><br><span class=\"line\">\t\tif(!st[i])&#123;</span><br><span class=\"line\">\t\tprime[cnt++]=i;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tfor(int j=i+i;j&lt;=n;j+=i)&#123;</span><br><span class=\"line\">\t\tst[i]=true;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<hr>\n<p>下面这个是线性筛法</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666205978511666620597830.png\"></p>\n<p>为什么是正确的，n只会倍最小质因子甩掉。从小到大枚举质数，每次筛掉i和质数</p>\n<p><strong>当break发生意味着prime【j】是i的最小质因子，因此primes【j】</strong></p>\n<p>第一次出现摸他为0 ，一定是质因子</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666209365431666620936520.png\"></p>\n<p>如果摸不是0，pj也一定是pj*i的最小质因子</p>\n","tags":[{"name":"算法基础","slug":"算法基础","permalink":"http://yoursite.com/tags/%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/"},{"name":"数论","slug":"数论","permalink":"http://yoursite.com/tags/%E6%95%B0%E8%AE%BA/"}]},{"title":"bilibili视频下载","date":"2022-10-24T13:02:31.000Z","path":"2022/10/24/bilibili视频下载/","content":"<h1 id=\"1-哔哩哔哩下载\"><a href=\"#1-哔哩哔哩下载\" class=\"headerlink\" title=\"1.哔哩哔哩下载\"></a>1.哔哩哔哩下载</h1><p>发现一个好用的工具,直接输入连接,就可以批量下载哔哩哔哩视频</p>\n<p>推荐大家star</p>\n<p><a href=\"https://github.com/leiurayer/downkyi\">leiurayer&#x2F;downkyi: 哔哩下载姬downkyi，B站视频下载工具，支持批量下载，支持8K、HDR、杜比视界，提供工具箱（音视频提取、去水印等）。 (github.com)</a></p>\n","tags":[{"name":"使用工具","slug":"使用工具","permalink":"http://yoursite.com/tags/%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7/"},{"name":"bilibili","slug":"bilibili","permalink":"http://yoursite.com/tags/bilibili/"}]},{"title":"command教程","date":"2022-10-24T09:39:20.000Z","path":"2022/10/24/command教程/","content":"<h1 id=\"命令行教程\"><a href=\"#命令行教程\" class=\"headerlink\" title=\"命令行教程\"></a>命令行教程</h1><p>工作流，终端复用，dotfile配置，还有远程服务器</p>\n<h2 id=\"2-工作流\"><a href=\"#2-工作流\" class=\"headerlink\" title=\"2.工作流\"></a>2.工作流</h2><p>ctrl+c是打断程序</p>\n<p>ctrl+z是暂停</p>\n<p>ctrl+\\是结束程序 </p>\n<p><strong>使用&amp;表示程序后台执行</strong></p>\n<p>使用jobs可以查看当前执行的进程状态，</p>\n<p>使用bg %1，回复倍暂停的jobs</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666049269001666604925973.png\"></p>\n<p>产生式挂起进程使用nohup</p>\n<h2 id=\"2-tmux\"><a href=\"#2-tmux\" class=\"headerlink\" title=\"2.tmux\"></a>2.tmux</h2><p>一般使用screen，不过也学习一下</p>\n<p>三大核心，session，windows，panel</p>\n<ul>\n<li><p>会话</p>\n<p>- 每个会话都是一个独立的工作区，其中包含一个或多个窗口</p>\n<ul>\n<li><code>tmux</code> 开始一个新的会话</li>\n<li><code>tmux new -s NAME</code> 以指定名称开始一个新的会话</li>\n<li><code>tmux ls</code> 列出当前所有会话</li>\n<li>在 <code>tmux</code> 中输入 <code>&lt;C-b&gt; d</code> ，将当前会话分离</li>\n<li><code>tmux a</code> 重新连接最后一个会话。您也可以通过 <code>-t</code> 来指定具体的会话</li>\n</ul>\n</li>\n</ul>\n<p>windows&#x3D;&#x3D;tab（浏览器的窗口）</p>\n<ul>\n<li><p>会话</p>\n<p>- 每个会话都是一个独立的工作区，其中包含一个或多个窗口</p>\n<ul>\n<li><code>tmux</code> 开始一个新的会话</li>\n<li><code>tmux new -s NAME</code> 以指定名称开始一个新的会话</li>\n<li><code>tmux ls</code> 列出当前所有会话</li>\n<li>在 <code>tmux</code> 中输入 <code>&lt;C-b&gt; d</code> ，将当前会话分离</li>\n<li><code>tmux a</code> 重新连接最后一个会话。您也可以通过 <code>-t</code> 来指定具体的会话</li>\n</ul>\n</li>\n</ul>\n<p>ctrl+a （n，是下一个，p是之前一个tmux窗口</p>\n<h2 id=\"3-重命名\"><a href=\"#3-重命名\" class=\"headerlink\" title=\"3.重命名\"></a>3.重命名</h2><p>alias把长命令进行缩短</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666058858981666605885498.png\"></p>\n<p>alias gc&#x3D;“git clone”</p>\n<p>如何写入重命名，关闭终端，重命名就结束了</p>\n<p><strong>直接写入到dotfiles</strong></p>\n<h2 id=\"4-符号链接\"><a href=\"#4-符号链接\" class=\"headerlink\" title=\"4.符号链接\"></a>4.符号链接</h2><p>就是和快捷方式一样</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16666064699001666606468924.png\"></p>\n<h2 id=\"5-ssh\"><a href=\"#5-ssh\" class=\"headerlink\" title=\"5.ssh\"></a>5.ssh</h2><p>这个已经熟练了</p>\n<p>、</p>\n<p>还有设置别名，在ssh里面进行配置，就不用一个刚刚输入IP了</p>\n<h2 id=\"6-homework\"><a href=\"#6-homework\" class=\"headerlink\" title=\"6.homework\"></a>6.homework</h2><h3 id=\"6-1任务控制\"><a href=\"#6-1任务控制\" class=\"headerlink\" title=\"6.1任务控制\"></a>6.1任务控制</h3><blockquote>\n<ol>\n<li>我们可以使用类似 <code>ps aux | grep</code> 这样的命令来获取任务的 pid ，然后您可以基于pid 来结束这些进程。但我们其实有更好的方法来做这件事。在终端中执行 <code>sleep 10000</code> 这个任务。然后用 <code>Ctrl-Z</code> 将其切换到后台并使用 <code>bg</code>来继续允许它。现在，使用 <a href=\"https://www.man7.org/linux/man-pages/man1/pgrep.1.html\"><code>pgrep</code></a> 来查找 pid 并使用 <a href=\"https://www.man7.org/linux/man-pages/man1/pgrep.1.html\"><code>pkill</code></a> 结束进程而不需要手动输入pid。(提示：: 使用 <code>-af</code> 标记)。</li>\n</ol>\n</blockquote>\n<p>这一题使用的pger&#x3D;&#x3D;ps aux|grep python</p>\n<p>pgrep python</p>\n<p>使用prep sleep可以得到</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sleep 10000</span><br><span class=\"line\">Ctrl-Z</span><br><span class=\"line\">bg</span><br><span class=\"line\"></span><br><span class=\"line\">pgrep sleep </span><br><span class=\"line\"></span><br><span class=\"line\">pkill  -af sleep</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<blockquote>\n<ol>\n<li><p>如果您希望某个进程结束后再开始另外一个进程， 应该如何实现呢？在这个练习中，我们使用 <code>sleep 60 &amp;</code> 作为先执行的程序。一种方法是使用 <a href=\"http://man7.org/linux/man-pages/man1/wait.1p.html\"><code>wait</code></a> 命令。尝试启动这个休眠命令，然后待其结束后再执行 <code>ls</code> 命令。</p>\n<p>但是，如果我们在不同的 bash 会话中进行操作，则上述方法就不起作用了。因为 <code>wait</code> 只能对子进程起作用。之前我们没有提过的一个特性是，<code>kill</code> 命令成功退出时其状态码为 0 ，其他状态则是非0。<code>kill -0</code> 则不会发送信号，但是会在进程不存在时返回一个不为0的状态码。请编写一个 bash 函数 <code>pidwait</code> ，它接受一个 pid 作为输入参数，然后一直等待直到该进程结束。您需要使用 <code>sleep</code> 来避免浪费 CPU 性能。</p>\n</li>\n</ol>\n</blockquote>\n","tags":[]},{"title":"vim教程","date":"2022-10-22T07:08:51.000Z","path":"2022/10/22/vim教程/","content":"<h1 id=\"vim基础\"><a href=\"#vim基础\" class=\"headerlink\" title=\"vim基础\"></a>vim基础</h1><h2 id=\"1-模式区分\"><a href=\"#1-模式区分\" class=\"headerlink\" title=\"1.模式区分\"></a>1.模式区分</h2><p>分为normal还有iinsert</p>\n<p>norm是倒过来,insert是输入</p>\n<p>:这个是是command命令模式</p>\n<h2 id=\"2-缓冲区和窗口\"><a href=\"#2-缓冲区和窗口\" class=\"headerlink\" title=\"2.缓冲区和窗口\"></a>2.缓冲区和窗口</h2><p>vim也开开启多个tab</p>\n<p>使用:sp可以进行分区</p>\n<p>使用:tabnew创建一个行窗口,一个窗口多个buffer</p>\n<p>使用:qa进行全部关闭窗口</p>\n<h2 id=\"3-文本编辑\"><a href=\"#3-文本编辑\" class=\"headerlink\" title=\"3.文本编辑\"></a>3.文本编辑</h2><p>使用w是向后,b是向前,e是单词结尾,使用s开头,$是结尾</p>\n<p>浏览模式,使用u(向上),使用D(向下)</p>\n<p>查找模式使用f,后面加要查找的单词</p>\n<blockquote>\n<p>以上都是normal模式</p>\n</blockquote>\n<hr>\n<p>下面是insert模式</p>\n<p>使用d进行删除,使用u进行undo,删除到结尾就是de(delete end)</p>\n<p>dd删除一行,cc是删除后给一个空白的给你(d和c差不多)</p>\n<p>u是undo, ctrl+r是重做</p>\n<p>y是粘贴,p是赋值</p>\n<h2 id=\"4-visual模式\"><a href=\"#4-visual模式\" class=\"headerlink\" title=\"4.visual模式\"></a>4.visual模式</h2><p>这个就是进行多选使用的,按住v进入</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16664246597541666424658817.png\"></p>\n<p>然后使用y进行赋值,p紧张粘贴</p>\n<h2 id=\"5-计数模式\"><a href=\"#5-计数模式\" class=\"headerlink\" title=\"5.计数模式\"></a>5.计数模式</h2><p>就是使用4j,线下跳转4行,就是前面加上数字</p>\n<h2 id=\"6-修饰词\"><a href=\"#6-修饰词\" class=\"headerlink\" title=\"6.修饰词\"></a>6.修饰词</h2><p>i是inside ,a是all</p>\n<p>使用da(,会删除所有的值,在(,包括() </p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16664250417491666425041531.png\"></p>\n<p>使用&#x2F;进行查找,n进行查找下一个符合的</p>\n","tags":[]},{"title":"shell教程","date":"2022-10-19T02:44:36.000Z","path":"2022/10/19/shell教程/","content":"<h1 id=\"0-shell脚本\"><a href=\"#0-shell脚本\" class=\"headerlink\" title=\"0.shell脚本\"></a>0.shell脚本</h1><h2 id=\"0-1shell赋值\"><a href=\"#0-1shell赋值\" class=\"headerlink\" title=\"0.1shell赋值\"></a>0.1shell赋值</h2><p>一般使用双一号,这样可以进行输出</p>\n<p>使用方法和python的f差不多,直接使用$</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">foo=bar</span><br><span class=\"line\">echo &quot;$foo&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">打印 bar</span></span><br><span class=\"line\">echo &#x27;$foo&#x27;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">打印 <span class=\"variable\">$foo</span></span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/.com//code\\site\\weijia99.github.io\\source_posts\\shell教程\\image-20221019203249378.png\" alt=\"image-20221019203249378\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16661831919761666183191589.png\"></p>\n<h2 id=\"0-2shell进行函数变换\"><a href=\"#0-2shell进行函数变换\" class=\"headerlink\" title=\"0.2shell进行函数变换\"></a>0.2shell进行函数变换</h2><p>如何使用sh脚本,直接加载到source,使用source保存,然后直接运行函数</p>\n<p>&amp;1-9是保存的函数变量,</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16661833769821666183376434.png\"></p>\n<blockquote>\n<p>经常会遇到权限不够的问题,写入,或者读取,那么只要使用sudo!!,就可以执行上面一个权限不够的命令</p>\n</blockquote>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16661835669731666183566863.png\"></p>\n<p>grep是查找函数 ,$?代表是不是有错误,正确就是0(没有错误,0个错误)</p>\n<p>这里的||的意思是第一个不对,就执行第二个</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16661838109721666183810355.png\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16661839759721666183975015.png\"></p>\n<p>目前看来这里的||还有&amp;&amp; 都是相反的,一个是只有,一个是或者</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16661840729731666184072240.png\"></p>\n<p><strong>使用()代表的是全局变量,局部自定义的变量不需要括号,linux命令</strong></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16661843409731666184340326.png\"></p>\n<p>例题讲解</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16661844299741666184429787.png\"></p>\n<p>0代表函数的名称, &amp;#代表参数的数量(#是number的意思) $$代表当前运行的pid </p>\n<ul>\n<li><code>$@</code> - 所有参数 读取参数</li>\n</ul>\n<p>-ne是不相等就代表错误</p>\n<p>for循环所有的参数,然后进行grep查找,有就进行写入,没有就有错误,然后进行追加</p>\n<ul>\n<li><blockquote>\n<p>花括号<code>&#123;&#125;</code> - 当你有一系列的指令，其中包含一段公共子串时，可以用花括号来自动展开这些命令。这在批量移动或转换文件时非常方便。</p>\n</blockquote>\n</li>\n</ul>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16661858169731666185816168.png\"></p>\n<p>直接进行扩展,可以建立多个文件,或者是少些几个命令</p>\n<p>同时花括号还宽裕使用{a..b},遵循笛卡尔乘积,使用{a…h}表示a到h</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16661859079801666185907753.png\"></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">convert image.&#123;png,jpg&#125;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">会展开为</span></span><br><span class=\"line\">convert image.png image.jpg</span><br><span class=\"line\"></span><br><span class=\"line\">cp /path/to/project/&#123;foo,bar,baz&#125;.sh /newpath</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">会展开为</span></span><br><span class=\"line\">cp /path/to/project/foo.sh /path/to/project/bar.sh /path/to/project/baz.sh /newpath</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">也可以结合通配使用</span></span><br><span class=\"line\">mv *&#123;.py,.sh&#125; folder</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">会移动所有 *.py 和 *.sh 文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">mkdir foo bar</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">下面命令会创建foo/a, foo/b, ... foo/h, bar/a, bar/b, ... bar/h这些文件</span></span><br><span class=\"line\">touch &#123;foo,bar&#125;/&#123;a..h&#125;</span><br><span class=\"line\">touch foo/x bar/y</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">比较文件夹 foo 和 bar 中包含文件的不同</span></span><br><span class=\"line\">diff &lt;(ls foo) &lt;(ls bar)</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">输出</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">&lt; x</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">---</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">&gt; y</span></span><br></pre></td></tr></table></figure>\n\n<p>shell最开始是指定运行的文件位置</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16661863736751666186372698.png\"></p>\n<h1 id=\"1-shell工具\"><a href=\"#1-shell工具\" class=\"headerlink\" title=\"1.shell工具\"></a>1.shell工具</h1><h2 id=\"1-1查询使用帮助\"><a href=\"#1-1查询使用帮助\" class=\"headerlink\" title=\"1.1查询使用帮助\"></a>1.1查询使用帮助</h2><ol>\n<li>使用-h</li>\n<li>或者直接man rm（man是Manuel</li>\n</ol>\n<h2 id=\"1-2查找文件\"><a href=\"#1-2查找文件\" class=\"headerlink\" title=\"1.2查找文件\"></a>1.2查找文件</h2><p>顾名思义就是使用使用find</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find . -name src -type d </span><br><span class=\"line\">#这是查找名称为src的文件夹，type可以分为d，f，f是文件</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find . -path */test/*.py -type f</span><br><span class=\"line\">#这是查找路径</span><br></pre></td></tr></table></figure>\n\n\n\n<p>还有其他的参数 -exec就是执行命令，找到后删除</p>\n<p>fd还可以使用</p>\n<p>ctrl+r 也是可以进行查找使用的快捷键</p>\n<h1 id=\"2-课后练习\"><a href=\"#2-课后练习\" class=\"headerlink\" title=\"2.课后练习\"></a>2.课后练习</h1><h2 id=\"2-1ls命令\"><a href=\"#2-1ls命令\" class=\"headerlink\" title=\"2.1ls命令\"></a>2.1ls命令</h2><blockquote>\n<ol>\n<li><p>阅读 <a href=\"https://man7.org/linux/man-pages/man1/ls.1.html\"><code>man ls</code></a> ，然后使用<code>ls</code> 命令进行如下操作：</p>\n<ul>\n<li>所有文件（包括隐藏文件）</li>\n<li>文件打印以人类可以理解的格式输出 (例如，使用454M 而不是 454279954)</li>\n<li>文件以最近访问顺序排序</li>\n<li>以彩色文本显示输出结果</li>\n</ul>\n<p>典型输出如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-rw-r--r--   1 user group 1.1M Jan 14 09:53 baz</span><br><span class=\"line\">drwxr-xr-x   5 user group  160 Jan 14 09:53 .</span><br><span class=\"line\">-rw-r--r--   1 user group  514 Jan 14 06:42 bar</span><br><span class=\"line\">-rw-r--r--   1 user group 106M Jan 13 12:12 foo</span><br><span class=\"line\">drwx------+ 47 user group 1.5K Jan 12 18:08 ..</span><br></pre></td></tr></table></figure></li>\n</ol>\n</blockquote>\n<p>1.直接使用ls -a</p>\n<p>2.搜索打印就是-h</p>\n<p><img src=\"https://files.catbox.moe/kuxnto.png\"></p>\n<p>3.直接搜索time</p>\n<p><img src=\"https://files.catbox.moe/a0vaqn.png\"></p>\n<p>4.直接搜索color</p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/weijia99/blog_image@main/16662495226761666249521717.png\"></p>\n<h2 id=\"2-2shell函数\"><a href=\"#2-2shell函数\" class=\"headerlink\" title=\"2.2shell函数\"></a>2.2shell函数</h2><blockquote>\n<ol>\n<li>编写两个bash函数 <code>marco</code> 和 <code>polo</code> 执行下面的操作。 每当你执行 <code>marco</code> 时，当前的工作目录应当以某种形式保存，当执行 <code>polo</code> 时，无论现在处在什么目录下，都应当 <code>cd</code> 回到当时执行 <code>marco</code> 的目录。 为了方便debug，你可以把代码写在单独的文件 <code>marco.sh</code> 中，并通过 <code>source marco.sh</code>命令，（重新）加载函数。</li>\n</ol>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i</span><br><span class=\"line\"><span class=\"meta prompt_\"> #</span><span class=\"language-bash\">这里忘了加开始解释的地址</span></span><br><span class=\"line\"> marco()&#123;</span><br><span class=\"line\">     echo &quot;$(pwd)&quot; &gt; $HOME/marco_history.log</span><br><span class=\"line\">     echo &quot;save pwd $(pwd)&quot;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> polo()&#123;</span><br><span class=\"line\">     cd &quot;$(cat &quot;$HOME/marco_history.log&quot;)&quot;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"2-3错误检验\"><a href=\"#2-3错误检验\" class=\"headerlink\" title=\"2.3错误检验\"></a>2.3错误检验</h2><blockquote>\n<p>假设您有一个命令，它很少出错。因此为了在出错时能够对其进行调试，需要花费大量的时间重现错误并捕获输出。 编写一段bash脚本，运行如下的脚本直到它出错，将它的标准输出和标准错误流记录到文件，并在最后输出所有内容。 加分项：报告脚本在失败前共运行了多少次。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/usr/bin/env bash</span></span><br><span class=\"line\"></span><br><span class=\"line\">n=$(( RANDOM % 100 ))</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ n -eq 42 ]]; then</span><br><span class=\"line\">    echo &quot;Something went wrong&quot;</span><br><span class=\"line\">    &gt;&amp;2 echo &quot;The error was using magic numbers&quot;</span><br><span class=\"line\">    exit 1</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;Everything went according to plan&quot;</span><br></pre></td></tr></table></figure>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">count=1</span><br><span class=\"line\"></span><br><span class=\"line\"> while true</span><br><span class=\"line\"> do</span><br><span class=\"line\">     ./buggy.sh 2&gt; out.log</span><br><span class=\"line\">     if [[ $? -ne 0 ]]; then</span><br><span class=\"line\">         echo &quot;failed after $count times&quot;</span><br><span class=\"line\">         cat out.log</span><br><span class=\"line\">         break</span><br><span class=\"line\">     fi</span><br><span class=\"line\">     ((count++))</span><br><span class=\"line\"></span><br><span class=\"line\"> done</span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"linux","slug":"linux","permalink":"http://yoursite.com/tags/linux/"},{"name":"shell","slug":"shell","permalink":"http://yoursite.com/tags/shell/"},{"name":"计算机教程缺失的一课","slug":"计算机教程缺失的一课","permalink":"http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%95%99%E7%A8%8B%E7%BC%BA%E5%A4%B1%E7%9A%84%E4%B8%80%E8%AF%BE/"}]},{"title":"dfg代码解读","date":"2022-10-18T14:05:12.000Z","path":"2022/10/18/dfg代码解读/","content":"","tags":[]},{"title":"换电脑更新hexo","date":"2022-10-18T10:02:26.000Z","path":"2022/10/18/换电脑更新hexo/","content":"<h2 id=\"换电脑更新hexo\"><a href=\"#换电脑更新hexo\" class=\"headerlink\" title=\"换电脑更新hexo\"></a>换电脑更新hexo</h2><blockquote>\n<p>因为更换电脑之后，原始数据在之前的电脑，所以博客一直没有更新。最近为了，监督自己复盘，花费两天重新折腾 了一下博客。本来想着把博客迁移到hugo，结果hugo，更新的教程还没有hexo教程多。而且我这个github.io的域名已经使用了。如果更新hugo。就得把这个仓库的数据清空。（主要是折腾两天了，githubpage使用action自动更新还比较繁琐）。所以才换回hexo。下面我来复盘一下这两天的折腾过程。</p>\n</blockquote>\n<h2 id=\"1-更换hugo\"><a href=\"#1-更换hugo\" class=\"headerlink\" title=\"1.更换hugo\"></a>1.更换hugo</h2><p>主要参考的是这个up的教程。</p>\n<p><a href=\"https://www.pseudoyu.com/zh/2022/05/29/deploy_your_blog_using_hugo_and_github_action/\">Hugo + GitHub Action，搭建你的博客自动发布系统 · Pseudoyu</a></p>\n<h3 id=\"1-1hugo本地搭建\"><a href=\"#1-1hugo本地搭建\" class=\"headerlink\" title=\"1.1hugo本地搭建\"></a>1.1hugo本地搭建</h3><p>本地搭建参照这个up没有任何问题，主要是要把下载的主题里面的example文件复制下来，然后更新<strong>config。toml</strong>文件，注意这里的坑点（需要解析自己baseurl为自己github的地址）不然搭建之后直接跳转到example的网站，让我以为是自己搭建问题，折腾了几个小时。然后就没有什么坑点了</p>\n<h3 id=\"1-2域名购买\"><a href=\"#1-2域名购买\" class=\"headerlink\" title=\"1.2域名购买\"></a>1.2域名购买</h3><p>为了贯彻讲白嫖进行到底的思想，我本来想着是使用freenom进行搭建一个 域名。但是一直购买失败。然后我又突然想起来，我之前认证了github学生包了的，所以直接去github学生包找到了一个提供免费域名的公司。顶级域名是.tech.一年的白嫖时间。博主使用的cloudflare，这个也不错，之前有过部署服务器的经验。所以我吧购买的域名，直接把dns改到cloudflare里的域名了。（可能等了一个小时才有结果）</p>\n<p>域名设置到cloudflare后，需要进行cname设置（cname的意思就是重新跳转，例如输入世界一流大学.com直接跳转到sdu.edu.cn）</p>\n<p>上述过程还好，没有花费多少时间。主要下面的设置自定义域名</p>\n<h3 id=\"1-3设置自定义域名\"><a href=\"#1-3设置自定义域名\" class=\"headerlink\" title=\"1.3设置自定义域名\"></a>1.3设置自定义域名</h3><p>因为我的原始github.io的域名已经设置成为hexo的网站了，不能再次使用。所以我就参考了别人的方法，不能够有多个github.io的网站，但是可以在其他仓库里面开启一个仓库，然后使用github .io&#x2F;projectname 来进行构成一个新的网站。所以哦去setting里面打开了一个新的page，然后此时还有一个坑点（<strong>仓库默认的是main分支，我之后按照这个up的都是master分支，所以会出现几次配置失败的情况）</strong>我删除重建了几个仓库才解决这个问题。</p>\n<p>在setting进行悬着page，然后悬着page，在page里选择master分支，使用githubbot进行更新网页。</p>\n<p>下面是设置自定义域名的坑，因为设置自定义域名，会<strong>新建一个cname文件</strong>，造成本地与远程版本内容不一样，所以我之前使用push操作都是push失败，后来强制push，造成cname丢失，无法通过自定义域名访问到网页。这个卡了一晚上。</p>\n<h3 id=\"1-4自定义action的坑点\"><a href=\"#1-4自定义action的坑点\" class=\"headerlink\" title=\"1.4自定义action的坑点\"></a>1.4自定义action的坑点</h3><p>因为使用自定义action的话，是需要设置github workflows的，我直接新建一个仓库，进行设置了workflows，结果</p>\n<p>就是push的时候本地雨远程还是有 差异。而且他这个是需要把本地hugo的文件夹全部上传。（原文没些清楚，我以为只需要一个workflows工作流），结果也是看了一上午，触发任务失败。然后痛定思痛还是换成hexo了c</p>\n<h3 id=\"1-5总结错误\"><a href=\"#1-5总结错误\" class=\"headerlink\" title=\"1.5总结错误\"></a>1.5总结错误</h3><p>目前犯了下列几个错误</p>\n<ol>\n<li>git操作不熟悉（remote branch，checkout，push -f）不知道怎么查看分支，如何删除，还有切换分支，分支管理</li>\n<li>自定义域名，这个大坑</li>\n<li>主要是设置config.toml文件没有进行设置，一直跳转到example网页，心态崩了几次</li>\n<li>之后就是主题设置问题，theme</li>\n<li>还有就是两个仓库，一个仓库上传public内容，一个进行上传所有的文件</li>\n<li>觉得没有时间然后换回来hexo了</li>\n</ol>\n<h2 id=\"2-hexo进行重装\"><a href=\"#2-hexo进行重装\" class=\"headerlink\" title=\"2.hexo进行重装\"></a>2.hexo进行重装</h2><p><a href=\"https://wungjyan.github.io/2018/08/17/move-hexo/\">hexo博客迁移到另一台电脑 | wj’blog (wungjyan.github.io)</a></p>\n<p>复制下面的文件，就相当于在hexo分支里面的文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_config.yml</span><br><span class=\"line\">package.json</span><br><span class=\"line\">scaffolds/</span><br><span class=\"line\">source/</span><br><span class=\"line\">themes/</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// mac环境</span><br><span class=\"line\">sudo npm install -g hexo</span><br><span class=\"line\">npm install</span><br><span class=\"line\">npm install hexo-deployer-git --save</span><br><span class=\"line\">npm install hexo-generator-feed --save</span><br><span class=\"line\">npm install hexo-generator-sitemap --save</span><br><span class=\"line\">hexo g</span><br><span class=\"line\">hexo s</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>说起来也是比较简单，就是直接git下来所有的文件，但是也有小坑</p>\n<p>git版本问题，因为，我是最新的npm，但是hexo的版本还是3.6的，结果就造成版本不同。按照上述的直接进行重装，就会造成安装版本不兼容，直接造成无法推送到服务端。但是本地没有问题。</p>\n<p>所以接下来就是进行更新npm的不兼容的hexo版本</p>\n<p>主要参考的是下面的</p>\n<p><a href=\"https://novnan.github.io/Hexo/update_hexo/\">Hexo版本升级指南 | novnan’s notes</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//以下指令均在Hexo目录下操作，先定位到Hexo目录</span><br><span class=\"line\">//查看当前版本，判断是否需要升级</span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">hexo version</span></span><br><span class=\"line\"></span><br><span class=\"line\">//全局升级hexo-cli</span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">npm i hexo-cli -g</span></span><br><span class=\"line\"></span><br><span class=\"line\">//再次查看版本，看hexo-cli是否升级成功</span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">hexo version</span></span><br><span class=\"line\"></span><br><span class=\"line\">//安装npm-check，若已安装可以跳过</span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">npm install -g npm-check</span></span><br><span class=\"line\"></span><br><span class=\"line\">//检查系统插件是否需要升级</span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">npm-check</span></span><br><span class=\"line\"></span><br><span class=\"line\">//安装npm-upgrade，若已安装可以跳过</span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">npm install -g npm-upgrade</span></span><br><span class=\"line\"></span><br><span class=\"line\">//更新package.json</span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">npm-upgrade</span></span><br><span class=\"line\"></span><br><span class=\"line\">//更新全局插件</span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">npm update -g</span></span><br><span class=\"line\"></span><br><span class=\"line\">//更新系统插件</span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">npm update --save</span></span><br><span class=\"line\"></span><br><span class=\"line\">//再次查看版本，判断是否升级成功</span><br><span class=\"line\"><span class=\"meta prompt_\">&gt; </span><span class=\"language-bash\">hexo version</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>需要我们自己安装npm-check工具，然后就是网络原因，不提了（直接使用clash打开cmd）</p>\n<p>然后更新也有可能会有问题，于是就进行重启了。</p>\n<p>之后hexo就成功的到hexo</p>\n<h2 id=\"3-更换hexo主题\"><a href=\"#3-更换hexo主题\" class=\"headerlink\" title=\"3.更换hexo主题\"></a>3.更换hexo主题</h2><p>由于之前一直是使用yiliya主题，这次换的是butterfly主题，然后新的主题也有坑的，需要在原始的config里面进行更换主题轻微butterfly。同事还得继续复制自带的config文件，到跟目录，进行重命名，修改文件的信息，才可以更换主题细节。具体还有其他细节还在摸索，是参考下面这个的。有时间再继续折腾一下。</p>\n<p><a href=\"https://akilar.top/posts/f99b208/\">Butterfly主题美化日记 | Akilarの糖果屋</a></p>\n<h2 id=\"4-复盘\"><a href=\"#4-复盘\" class=\"headerlink\" title=\"4.复盘\"></a>4.复盘</h2><p>失败原因，还有一段时间尝试使用gitee，结果gitee使用网页，需要认证身份证。弄了半天，我就跑路了，耽误时间。</p>\n<ol>\n<li>不想丢失以前写的hexo数据</li>\n<li>然后使用自定义域名不熟悉</li>\n<li>不熟悉使用git操作</li>\n<li>好久没使用相关前段工具</li>\n<li>折腾太少了，应该及时止损</li>\n<li>b站有非常详细的教程</li>\n</ol>\n","tags":[{"name":"hexo","slug":"hexo","permalink":"http://yoursite.com/tags/hexo/"},{"name":"git","slug":"git","permalink":"http://yoursite.com/tags/git/"},{"name":"npm","slug":"npm","permalink":"http://yoursite.com/tags/npm/"}]},{"title":"test","date":"2022-10-18T09:00:50.000Z","path":"2022/10/18/test/","content":"","tags":[]},{"title":"Hello World","date":"2022-10-18T08:54:26.073Z","path":"2022/10/18/hello-world/","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\">Deployment</a></p>\n","tags":[]},{"title":"5.3.11删除以x为根的子树","date":"2020-07-09T07:30:12.000Z","path":"2020/07/09/5-3-11删除以x为根的子树/","content":"<h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>删除以x为根节点的所有子树，注意可能有多个为x值</p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><ol>\n<li>先递归删除所有节点</li>\n<li>可能有多个值是x，所以用层序找出他们的父节点，然后删除x，同时设置父节点的子节点为空</li>\n</ol>\n<h2 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * 删除每个以x为值的子树（可能有多个，父节点智能用层序找到）</span></span><br><span class=\"line\"><span class=\"comment\"> * 1.递归删除节点</span></span><br><span class=\"line\"><span class=\"comment\"> * 2.层序找到后调用1</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">del</span><span class=\"params\">(TreeNode* root)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (root== <span class=\"literal\">nullptr</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">del</span>(root-&gt;left);</span><br><span class=\"line\">    <span class=\"built_in\">del</span>(root-&gt;right);</span><br><span class=\"line\">    <span class=\"built_in\">free</span>(root);</span><br><span class=\"line\">    <span class=\"comment\">//释放节点</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">searchDel</span><span class=\"params\">(TreeNode *root,<span class=\"type\">int</span> x)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(root== <span class=\"literal\">nullptr</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (root-&gt;val==x)&#123;</span><br><span class=\"line\"><span class=\"comment\">//        根节点就是，全删</span></span><br><span class=\"line\">        <span class=\"built_in\">del</span>(root);</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"comment\">//    层序遍历找父亲</span></span><br><span class=\"line\">    queue&lt;TreeNode*&gt; queue1;</span><br><span class=\"line\">    queue1.<span class=\"built_in\">push</span>(root);</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!queue1.<span class=\"built_in\">empty</span>())&#123;</span><br><span class=\"line\">        TreeNode* cur=queue1.<span class=\"built_in\">front</span>();</span><br><span class=\"line\"><span class=\"comment\">//        如果是就删除</span></span><br><span class=\"line\">        queue1.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cur-&gt;left)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cur-&gt;left-&gt;val==x)&#123;</span><br><span class=\"line\">                <span class=\"built_in\">del</span>(cur-&gt;left);</span><br><span class=\"line\">                cur-&gt;left= <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//                加入</span></span><br><span class=\"line\">                queue1.<span class=\"built_in\">push</span>(cur-&gt;left);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cur-&gt;right)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cur-&gt;right-&gt;val==x)&#123;</span><br><span class=\"line\">                <span class=\"built_in\">del</span>(cur-&gt;right);</span><br><span class=\"line\">                cur-&gt;right= <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//                加入</span></span><br><span class=\"line\">                queue1.<span class=\"built_in\">push</span>(cur-&gt;right);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","tags":[{"name":"树","slug":"树","permalink":"http://yoursite.com/tags/%E6%A0%91/"}]},{"title":"王道5.3.7完全二叉树的判定","date":"2020-07-09T01:29:25.000Z","path":"2020/07/09/王道5-3-7完全二叉树的判定/","content":"<h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>给定一个二叉树，确定它是否是一个完全二叉树。</p>\n<p>百度百科中对完全二叉树的定义如下：</p>\n<p>若设二叉树的深度为 h，除第 h 层外，其它各层 (1～h-1) 的结点数都达到最大个数，第 h 层所有的结点都连续集中在最左边，这就是完全二叉树。（注：第 h 层可能包含 1~ 2h 个节点。）</p>\n<p>示例 1：</p>\n<p>输入：[1,2,3,4,5,6] 输出：true 解释：最后一层前的每一层都是满的（即，结点值为 {1} 和 {2,3} 的两层），且最后一层中的所有结点（{4,5,6}）都尽可能地向左。</p>\n<p>来源：力扣（LeetCode） 链接：<a href=\"https://leetcode-cn.com/problems/check-completeness-of-a-binary-tree\">https://leetcode-cn.com/problems/check-completeness-of-a-binary-tree</a> 著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><p>根据层序遍历，设置flag标志是否出现过null，如果出现null，设置flag为1.如果存在当前节点，判断当前flag如果是1，就直接返回false，不是就把他的左右节点加入（无论他的左右节点是否存在），接着层序。</p>\n<h2 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Definition for a binary tree node.</span></span><br><span class=\"line\"><span class=\"comment\"> * struct TreeNode &#123;</span></span><br><span class=\"line\"><span class=\"comment\"> *     int val;</span></span><br><span class=\"line\"><span class=\"comment\"> *     TreeNode *left;</span></span><br><span class=\"line\"><span class=\"comment\"> *     TreeNode *right;</span></span><br><span class=\"line\"><span class=\"comment\"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> * &#125;;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">isCompleteTree</span><span class=\"params\">(TreeNode* root)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (root== <span class=\"literal\">nullptr</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    queue&lt;TreeNode*&gt; queue1;</span><br><span class=\"line\">    queue1.<span class=\"built_in\">push</span>(root);</span><br><span class=\"line\">    <span class=\"type\">int</span> flag=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"comment\">//    是否出现null</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!queue1.<span class=\"built_in\">empty</span>())&#123;</span><br><span class=\"line\">        TreeNode* cur=queue1.<span class=\"built_in\">front</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cur) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (flag==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                </span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            queue1.<span class=\"built_in\">push</span>(cur-&gt;left);</span><br><span class=\"line\">            queue1.<span class=\"built_in\">push</span>(cur-&gt;right);</span><br><span class=\"line\">            queue1.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            queue1.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">            flag=<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>","tags":[{"name":"树","slug":"树","permalink":"http://yoursite.com/tags/%E6%A0%91/"}]},{"title":"王道5.3.5","date":"2020-07-08T04:33:26.000Z","path":"2020/07/08/王道5-3-5/","content":"<h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>给定一个二叉树，找出其最大深度。</p>\n<p>二叉树的深度为根节点到最远叶子节点的最长路径上的节点数。</p>\n<p>说明: 叶子节点是指没有子节点的节点。</p>\n<p>示例： 给定二叉树 [3,9,20,null,null,15,7]，</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3</span><br></pre></td></tr></table></figure>\n\n<p>&#x2F; \\ 9 20 &#x2F; \\ 15 7 返回它的最大深度 3 。</p>\n<p>来源：力扣（LeetCode） 链接：<a href=\"https://leetcode-cn.com/problems/maximum-depth-of-binary-tree\">https://leetcode-cn.com/problems/maximum-depth-of-binary-tree</a> 著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><ol>\n<li>通过层序遍历来获取</li>\n<li>queue记录当前层的所有元素，用for遍历这一层的元素加入他的左右节点，for结束就是一层结束</li>\n</ol>\n<h2 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Definition for a binary tree node.</span></span><br><span class=\"line\"><span class=\"comment\"> * struct TreeNode &#123;</span></span><br><span class=\"line\"><span class=\"comment\"> *     int val;</span></span><br><span class=\"line\"><span class=\"comment\"> *     TreeNode *left;</span></span><br><span class=\"line\"><span class=\"comment\"> *     TreeNode *right;</span></span><br><span class=\"line\"><span class=\"comment\"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> * &#125;;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">maxDepth</span><span class=\"params\">(TreeNode* root)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(root == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> num = <span class=\"number\">0</span>;</span><br><span class=\"line\">    queue&lt;TreeNode*&gt; queue1;</span><br><span class=\"line\">    queue1.<span class=\"built_in\">push</span>(root);</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!queue1.<span class=\"built_in\">empty</span>())&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> n=queue1.<span class=\"built_in\">size</span>();</span><br><span class=\"line\"><span class=\"comment\">//        对这一层所有的元素进行加子节点</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">            TreeNode *cur=queue1.<span class=\"built_in\">front</span>();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cur-&gt;left)&#123;</span><br><span class=\"line\">                queue1.<span class=\"built_in\">push</span>(cur-&gt;left);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cur-&gt;right)&#123;</span><br><span class=\"line\">                queue1.<span class=\"built_in\">push</span>(cur-&gt;right);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            queue1.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">            </span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"comment\">//        for结束后这一层就结束了</span></span><br><span class=\"line\">        num++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> num;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>","tags":[{"name":"树","slug":"树","permalink":"http://yoursite.com/tags/%E6%A0%91/"}]},{"title":"王道5.3_2_3非递归后续遍历","date":"2020-07-08T03:39:50.000Z","path":"2020/07/08/王道5-3-2-3非递归后续遍历/","content":"<h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>给定一个二叉树，返回它的 后序 遍历。</p>\n<p>示例:</p>\n<p>输入: [1,null,2,3] 1 \\ 2 &#x2F; 3</p>\n<p>输出: [3,2,1] 进阶: 递归算法很简单，你可以通过迭代算法完成吗？</p>\n<p>来源：力扣（LeetCode） 链接：<a href=\"https://leetcode-cn.com/problems/binary-tree-postorder-traversal\">https://leetcode-cn.com/problems/binary-tree-postorder-traversal</a> 著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p>\n<h2 id=\"2-思路\"><a href=\"#2-思路\" class=\"headerlink\" title=\"2.思路\"></a>2.思路</h2><p>构建模板</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span>( 栈非空 || p 非空)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span>( p 非空)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>填写步骤</p>\n<ol>\n<li>p非空一直左压</li>\n<li>然后，如果是空的，获取栈的顶端，如果右节点也是空的或者访问了的就是p.right&#x3D;pre，那么就直接访问当前的，并把p给pop出来，同时设置pre&#x3D;p，标志访问，*<strong>同时设置p&#x3D;null（否则下一次p会进入if判断，然后一直压）*</strong></li>\n<li>如果不是空的，并且没有访问，那么把p&#x3D;p.right，他就会进入之前的if，一直左压</li>\n</ol>\n<h2 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Definition for a binary tree node.</span></span><br><span class=\"line\"><span class=\"comment\"> * struct TreeNode &#123;</span></span><br><span class=\"line\"><span class=\"comment\"> *     int val;</span></span><br><span class=\"line\"><span class=\"comment\"> *     TreeNode *left;</span></span><br><span class=\"line\"><span class=\"comment\"> *     TreeNode *right;</span></span><br><span class=\"line\"><span class=\"comment\"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> * &#125;;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">   <span class=\"function\">vector&lt;<span class=\"type\">int</span>&gt; <span class=\"title\">postorderTraversal</span><span class=\"params\">(TreeNode* root)</span> </span>&#123;</span><br><span class=\"line\">    stack&lt;TreeNode*&gt; stack1;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; vector;</span><br><span class=\"line\"><span class=\"comment\">//    两个一个判断，一个向前走</span></span><br><span class=\"line\">    TreeNode *p=root;</span><br><span class=\"line\">    TreeNode *pre= <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (p||!stack1.<span class=\"built_in\">empty</span>())&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (p)&#123;</span><br><span class=\"line\"><span class=\"comment\">//            如果p存在就一直左压</span></span><br><span class=\"line\">            stack1.<span class=\"built_in\">push</span>(p);</span><br><span class=\"line\">            p=p-&gt;left;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//            不存在先取top</span></span><br><span class=\"line\">            p=stack1.<span class=\"built_in\">top</span>();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!p-&gt;right||p-&gt;right==pre)&#123;</span><br><span class=\"line\"><span class=\"comment\">//                不存在，或者是之前访问的了</span></span><br><span class=\"line\">                vector.<span class=\"built_in\">push_back</span>(p-&gt;val);</span><br><span class=\"line\"><span class=\"comment\">//                并设置这个也是访问的</span></span><br><span class=\"line\">                pre=p;</span><br><span class=\"line\"><span class=\"comment\">//                弹出当前的</span></span><br><span class=\"line\">                stack1.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">                p= <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//                设置为右边的，然后他访问右边的所有左树</span></span><br><span class=\"line\">                p=p-&gt;right;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> vector;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>","tags":[{"name":"树","slug":"树","permalink":"http://yoursite.com/tags/%E6%A0%91/"}]},{"title":"kmp数组求法","date":"2020-07-05T08:15:01.000Z","path":"2020/07/05/kmp数组求法/","content":"<h2 id=\"1-next求法\"><a href=\"#1-next求法\" class=\"headerlink\" title=\"1.next求法\"></a>1.next求法</h2><p>例如s&#x3D;‘abcac’，首先从第一位a开始，设置a为0（如果是-1，后面的都不需要+1），第二个是b，b的前面子串是a，没有匹配的设置成0+1，接下来是c，前面子串是ab，同理设置为0+1，下一个a也是0+1，最后是c，前面子串是abca，他的前缀子串a和后缀a相等，设置成1+1，所以next&#x3D;{0,1,1,1,2}</p>\n<h2 id=\"2-nextval求法\"><a href=\"#2-nextval求法\" class=\"headerlink\" title=\"2.nextval求法\"></a>2.nextval求法</h2><p>例如，s&#x3D;‘aaaab’，next&#x3D;{0，1,2,3,4,}，第一个是a，i&#x3D;0，设置naxtval&#x3D;0，i++.第二个是a与第一位相同，设置nextval【2】&#x3D;nextval【1】&#x3D;0，i++，第三个是a与第i个相同就是nextval【3】&#x3D;nextval【2】，第四个与第3个也相同，也是nv【4】&#x3D;nv【3】，第5位是b与第4位是a不同，i不加，nextval【5】&#x3D;next【5】&#x3D;4，所以nextval&#x3D;{0,0,0,0,4}</p>\n","tags":[{"name":"数据结构","slug":"数据结构","permalink":"http://yoursite.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"王道2_2_24","date":"2020-07-01T13:44:57.000Z","path":"2020/07/01/王道2-2-24/","content":"<h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a><a href=\"https://leetcode-cn.com/problems/linked-list-cycle-ii/\">题目大意</a></h2><p>给定一个链表，返回链表开始入环的第一个节点。 如果链表无环，则返回 null。</p>\n<p>为了表示给定链表中的环，我们使用整数 pos 来表示链表尾连接到链表中的位置（索引从 0 开始）。 如果 pos 是 -1，则在该链表中没有环。</p>\n<p>说明：不允许修改给定的链表。</p>\n<p>。</p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><ol>\n<li>快慢两个指针，fast走两步，slow走一步，如果相遇就是有环</li>\n<li>假设head与入幻点相差a，入环与slow差b，fast比slow多走a+b（2倍关系），若slow再走a会到入幻点（因为入幻与slow差b），而且head走a也是入幻点，所以如果a&#x3D;slow，那么就是入幻点</li>\n</ol>\n<h2 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//快慢指针，若相遇择优换</span></span><br><span class=\"line\">        ListNode *fast=head,*slow=head;</span><br><span class=\"line\">        <span class=\"type\">int</span> flag=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(slow&amp;&amp;fast-&gt;next)&#123;</span><br><span class=\"line\">            <span class=\"comment\">//fast走两次，所以需要检查fast的下一个</span></span><br><span class=\"line\">            slow=slow-&gt;next;</span><br><span class=\"line\">            fast=fast-&gt;next-&gt;next;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(fast==slow)&#123;</span><br><span class=\"line\">                flag=<span class=\"number\">1</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(flag)&#123;</span><br><span class=\"line\">            ListNode *p=head;</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(p!=slow)&#123;</span><br><span class=\"line\">                p=p-&gt;next;</span><br><span class=\"line\">                slow=slow-&gt;next;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> p;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>","tags":[{"name":"链表","slug":"链表","permalink":"http://yoursite.com/tags/%E9%93%BE%E8%A1%A8/"},{"name":"王道数据结构","slug":"王道数据结构","permalink":"http://yoursite.com/tags/%E7%8E%8B%E9%81%93%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"王道2_2_25","date":"2020-07-01T08:23:13.000Z","path":"2020/07/01/王道2-2-25/","content":"<h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><blockquote>\n<p>给定一个单链表 L：L0→L1→…→Ln-1→Ln ， 将其重新排列后变为： L0→Ln→L1→Ln-1→L2→Ln-2→…</p>\n</blockquote>\n<blockquote>\n<p>你不能只是单纯的改变节点内部的值，而是需要实际的进行节点交换。</p>\n</blockquote>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><ol>\n<li>先找到中间节点，q用两次next，p用一次next，等q为空，那么p就是中间节点</li>\n<li>对p后面的节点进行头插法，形成逆序，如123456，变成123465，*<strong>注意是465*</strong></li>\n<li>然后进行断链，形成1234和65两条链</li>\n<li>最后进行和链162534</li>\n</ol>\n<h2 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">reorderList</span><span class=\"params\">(ListNode* head)</span> </span>&#123;</span><br><span class=\"line\">        ListNode* p=head,*q=head,*r,*s=head;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!head)            <span class=\"comment\">//head为空，则直接退出</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> ;         </span><br><span class=\"line\">        <span class=\"keyword\">while</span>(q-&gt;next)&#123;      <span class=\"comment\">//寻找中间结点</span></span><br><span class=\"line\">            q=q-&gt;next;       <span class=\"comment\">//p走一步</span></span><br><span class=\"line\">            p=p-&gt;next;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(q-&gt;next)</span><br><span class=\"line\">              q=q-&gt;next;     <span class=\"comment\">//q走两步</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        q=p-&gt;next;           <span class=\"comment\">//p所指结点为中间结点，q为后半段链表的首结点</span></span><br><span class=\"line\">        p-&gt;next=<span class=\"literal\">nullptr</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(q)&#123;            <span class=\"comment\">//将链表后半段逆置</span></span><br><span class=\"line\">            r=q-&gt;next;</span><br><span class=\"line\">            q-&gt;next=p-&gt;next;</span><br><span class=\"line\">            p-&gt;next=q;</span><br><span class=\"line\">            q=r;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        q=p-&gt;next;            <span class=\"comment\">//q指向后半段的第一个数据结点</span></span><br><span class=\"line\">        p-&gt;next=<span class=\"literal\">nullptr</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(q)&#123;             <span class=\"comment\">//将链表后半段的结点插入到指定位置</span></span><br><span class=\"line\">            r=q-&gt;next;        <span class=\"comment\">//r指向后半段的下一个结点</span></span><br><span class=\"line\">            q-&gt;next=s-&gt;next;  <span class=\"comment\">//将q所指结点插入到s所指结点（head结点）之后</span></span><br><span class=\"line\">            s-&gt;next=q;        </span><br><span class=\"line\">            s=q-&gt;next;        <span class=\"comment\">//s指向前半段的下一个插入点</span></span><br><span class=\"line\">            q=r;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>","tags":[{"name":"链表","slug":"链表","permalink":"http://yoursite.com/tags/%E9%93%BE%E8%A1%A8/"},{"name":"王道数据结构","slug":"王道数据结构","permalink":"http://yoursite.com/tags/%E7%8E%8B%E9%81%93%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"王道2_2_21","date":"2020-07-01T08:23:08.000Z","path":"2020/07/01/王道2-2-21/","content":"<h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>实现一种算法，找出单向链表中倒数第 k 个节点。返回该节点的值。</p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><p>双指针，第一个p先走k部，然后q从head开始，pq同时走，直到p为空，q就是索要的节点</p>\n<p>设p与结尾查x次，总长k+x次，p走了x次，也就是倒数k</p>\n<h2 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">kthToLast</span><span class=\"params\">(ListNode* head, <span class=\"type\">int</span> k)</span> </span>&#123;</span><br><span class=\"line\">    ListNode* c=head;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(k)&#123;</span><br><span class=\"line\">            head=head.next;</span><br><span class=\"line\">            k--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(head)&#123;</span><br><span class=\"line\">            c=c.next;</span><br><span class=\"line\">            head=head.next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> c.val;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>","tags":[{"name":"链表","slug":"链表","permalink":"http://yoursite.com/tags/%E9%93%BE%E8%A1%A8/"},{"name":"王道数据结构","slug":"王道数据结构","permalink":"http://yoursite.com/tags/%E7%8E%8B%E9%81%93%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"王道2_2_6","date":"2020-07-01T08:22:49.000Z","path":"2020/07/01/王道2-2-6/","content":"<h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>给定一个头结点链表，按照从小到大排序</p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><p>根据插入排序的思路和逆置链表的思路，首先先把头结点和他的next摘出p，让p为读取元链表的节点，pre为摘出来新链表的头结点，然后pre遍历，小于p.val的就继续，不然就是正常的插入。</p>\n<h2 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">ListNode</span> &#123;</span><br><span class=\"line\">      <span class=\"type\">int</span> val;</span><br><span class=\"line\">      ListNode *next;</span><br><span class=\"line\">      <span class=\"built_in\">ListNode</span>(<span class=\"type\">int</span> x) : <span class=\"built_in\">val</span>(x), <span class=\"built_in\">next</span>(<span class=\"literal\">NULL</span>) &#123;&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">//本题思路插入排序，头插法类似，吧l取出，做个新链表</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">deleteNode</span><span class=\"params\">(ListNode* node)</span> </span>&#123;</span><br><span class=\"line\">       ListNode *p=node.next,*q=p.next;</span><br><span class=\"line\">       <span class=\"comment\">//pre是断链后端头插法节点</span></span><br><span class=\"line\"></span><br><span class=\"line\">       ListNode *pre;</span><br><span class=\"line\">       <span class=\"comment\">//进行断链</span></span><br><span class=\"line\">       p.next=<span class=\"literal\">NULL</span>;</span><br><span class=\"line\">       <span class=\"comment\">//进行替换</span></span><br><span class=\"line\">       p=r;</span><br><span class=\"line\">       <span class=\"keyword\">while</span>(p!=<span class=\"literal\">NULL</span>)&#123;</span><br><span class=\"line\">        r=p.next;</span><br><span class=\"line\">        pre=node;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(pre.next!=null&amp;&amp;pre.next.val&lt;p.val)&#123;</span><br><span class=\"line\">            pre=pre.next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        p.next=pre.next;</span><br><span class=\"line\">        pre.next=p;</span><br><span class=\"line\">        p=r;</span><br><span class=\"line\">        <span class=\"comment\">//进行下一轮</span></span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","tags":[{"name":"链表","slug":"链表","permalink":"http://yoursite.com/tags/%E9%93%BE%E8%A1%A8/"},{"name":"王道数据结构","slug":"王道数据结构","permalink":"http://yoursite.com/tags/%E7%8E%8B%E9%81%93%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"a1010","date":"2020-06-25T13:18:56.000Z","path":"2020/06/25/a1010/","content":"","tags":[]},{"title":"a1009","date":"2020-06-25T13:18:51.000Z","path":"2020/06/25/a1009/","content":"<h1 id=\"a1009\"><a href=\"#a1009\" class=\"headerlink\" title=\"a1009\"></a><a href=\"https://pintia.cn/problem-sets/994805342720868352/problems/994805509540921344\">a1009</a></h1><h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>多项式乘法。</p>\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><p>与前面的多项式加法基本类似。不过要构建两个双精度数组。第一个保存第一列的数字系数和指数。然后再还有一个哈希表。这个是保存第一列由哪几个数字是要进行指数相加的。第二列就首先是遍历这个哈希表。然后进行赋值。如果bi不是零，那么次数就加一。经过加法后，如果bi的值为0，那么次数就减一。，然后再次利用sort函数进行倒序输出就可以了。</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;map&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cmath&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;set&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stack&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;queue&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//cin用多了超市</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> maxn=<span class=\"number\">10010</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"type\">double</span>  a[maxn],b[maxn];</span><br><span class=\"line\">    <span class=\"built_in\">fill</span>(a,a+maxn,<span class=\"number\">0.0</span>);</span><br><span class=\"line\">    <span class=\"built_in\">fill</span>(b,b+maxn,<span class=\"number\">0.0</span>);</span><br><span class=\"line\">    <span class=\"type\">int</span> temp[maxn];</span><br><span class=\"line\">    <span class=\"type\">int</span> count=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"comment\">//    统计一共有多少个</span></span><br><span class=\"line\">    <span class=\"type\">int</span> a_index=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> hash[maxn];</span><br><span class=\"line\">    <span class=\"type\">int</span> total=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">2</span>; ++i) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> n,zhishu;</span><br><span class=\"line\">        <span class=\"type\">double</span> xishu;</span><br><span class=\"line\">        cin&gt;&gt;n;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; n; ++j) &#123;</span><br><span class=\"line\">            cin&gt;&gt;zhishu&gt;&gt;xishu;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                a[zhishu]=xishu;</span><br><span class=\"line\">                temp[a_index++]=zhishu;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> k = <span class=\"number\">0</span>; k &lt; a_index; ++k) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"type\">int</span> weizhi=zhishu+temp[k];</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (b[weizhi]==<span class=\"number\">0.0</span>)&#123;</span><br><span class=\"line\">                        hash[count]=weizhi;</span><br><span class=\"line\">                        count++;</span><br><span class=\"line\"><span class=\"comment\">//                        系数增加</span></span><br><span class=\"line\">                        total++;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    b[weizhi]+=xishu*a[temp[k]];</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (b[weizhi]==<span class=\"number\">0.0</span>)&#123;</span><br><span class=\"line\">                        total--;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    cout&lt;&lt;total;</span><br><span class=\"line\">    <span class=\"built_in\">sort</span>(hash,hash+count);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> l = count<span class=\"number\">-1</span>; l &gt;=<span class=\"number\">0</span> ; --l) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (b[hash[l]]!=<span class=\"number\">0.0</span>)</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot; %d %0.1lf&quot;</span>,hash[l],b[hash[l]]);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","tags":[{"name":"pat","slug":"pat","permalink":"http://yoursite.com/tags/pat/"},{"name":"水题","slug":"水题","permalink":"http://yoursite.com/tags/%E6%B0%B4%E9%A2%98/"}]},{"title":"a1008","date":"2020-06-25T13:18:47.000Z","path":"2020/06/25/a1008/","content":"<h1 id=\"a1008\"><a href=\"#a1008\" class=\"headerlink\" title=\"a1008\"></a><a href=\"https://pintia.cn/problem-sets/994805342720868352/problems/994805511923286016\">a1008</a></h1><h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>求错电梯所需要花费的所有时间。</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;map&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cmath&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;set&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stack&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;queue&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//cin用多了超市</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> maxn=<span class=\"number\">100100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> n;</span><br><span class=\"line\">    cin&gt;&gt;n ;</span><br><span class=\"line\">    <span class=\"type\">int</span> cost[n];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;cost[i]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">int</span> total=cost[<span class=\"number\">0</span>]*<span class=\"number\">6</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">1</span>; j &lt; n; ++j) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cost[j]&lt;cost[j<span class=\"number\">-1</span>])&#123;</span><br><span class=\"line\">            total+=(cost[j<span class=\"number\">-1</span>]-cost[j])*<span class=\"number\">4</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            total+=(cost[j]-cost[j<span class=\"number\">-1</span>])*<span class=\"number\">6</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    total+=n*<span class=\"number\">5</span>;</span><br><span class=\"line\">    cout&lt;&lt;total;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","tags":[{"name":"pat","slug":"pat","permalink":"http://yoursite.com/tags/pat/"},{"name":"水题","slug":"水题","permalink":"http://yoursite.com/tags/%E6%B0%B4%E9%A2%98/"}]},{"title":"a1007","date":"2020-06-25T13:18:43.000Z","path":"2020/06/25/a1007/","content":"<h1 id=\"a1007\"><a href=\"#a1007\" class=\"headerlink\" title=\"a1007\"></a><a href=\"https://pintia.cn/problem-sets/994805342720868352/problems/994805514284679168\">a1007</a></h1><h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>给出序列片段最大的和。</p>\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><p>使用动态规划,</p>\n<h3 id=\"第一步构建d-p-初始值\"><a href=\"#第一步构建d-p-初始值\" class=\"headerlink\" title=\"第一步构建d[p]初始值\"></a>第一步构建d[p]初始值</h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">d[<span class=\"number\">0</span>]=cost[<span class=\"number\">0</span>];</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"第二步检查是不是所有的都是负数\"><a href=\"#第二步检查是不是所有的都是负数\" class=\"headerlink\" title=\"第二步检查是不是所有的都是负数\"></a>第二步检查是不是所有的都是负数</h3><p>如果是,那么直接返回0</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> flag=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; n; ++j) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cost[j]&gt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            flag= <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (flag==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;0 %d %d&quot;</span>,cost[<span class=\"number\">0</span>],cost[n<span class=\"number\">-1</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"写出转移态方程\"><a href=\"#写出转移态方程\" class=\"headerlink\" title=\"写出转移态方程\"></a>写出转移态方程</h3><p>如果d[j-1]+a[j]&gt;a[j],d[j]&#x3D;d[j-1]+a[j],否则d[j]&#x3D;a[j]</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"type\">int</span> k = <span class=\"number\">1</span>; k &lt; n; ++k) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (d[k<span class=\"number\">-1</span>]+cost[k]&gt;cost[k])&#123;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\">            d[k]=d[k<span class=\"number\">-1</span>]+cost[k];</span><br><span class=\"line\">            s[k]=s[k<span class=\"number\">-1</span>];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            d[k]=cost[k];</span><br><span class=\"line\"><span class=\"comment\">//            更新起点</span></span><br><span class=\"line\">            s[k]=k;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"总体代码\"><a href=\"#总体代码\" class=\"headerlink\" title=\"总体代码\"></a>总体代码</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;map&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cmath&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;set&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stack&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;queue&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//cin用多了超市</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> maxn=<span class=\"number\">100100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> n;</span><br><span class=\"line\">    cin&gt;&gt;n;</span><br><span class=\"line\">    <span class=\"type\">int</span> cost[n];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;cost[i]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//    首先检查睡吧睡吧全是负数</span></span><br><span class=\"line\">    <span class=\"type\">int</span> flag=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; n; ++j) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cost[j]&gt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            flag= <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (flag==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;0 %d %d&quot;</span>,cost[<span class=\"number\">0</span>],cost[n<span class=\"number\">-1</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//构建转移方程</span></span><br><span class=\"line\"><span class=\"comment\">//    首先是初始化d【0】=a【0】</span></span><br><span class=\"line\"><span class=\"comment\">//    然后是d【i】=a【i】或者是d【i】=d【i-1】+a【i】</span></span><br><span class=\"line\">    <span class=\"type\">int</span> d[n];</span><br><span class=\"line\">    d[<span class=\"number\">0</span>]=cost[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"type\">int</span> s[n];</span><br><span class=\"line\"><span class=\"comment\">//    这是起点</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> k = <span class=\"number\">1</span>; k &lt; n; ++k) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (d[k<span class=\"number\">-1</span>]+cost[k]&gt;cost[k])&#123;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\">            d[k]=d[k<span class=\"number\">-1</span>]+cost[k];</span><br><span class=\"line\">            s[k]=s[k<span class=\"number\">-1</span>];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            d[k]=cost[k];</span><br><span class=\"line\"><span class=\"comment\">//            更新起点</span></span><br><span class=\"line\">            s[k]=k;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">int</span> p=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> l = <span class=\"number\">0</span>; l &lt;n ; ++l) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (d[l]&gt;d[p])&#123;</span><br><span class=\"line\">            p=l;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    cout&lt;&lt;d[p]&lt;&lt;<span class=\"string\">&quot; &quot;</span>&lt;&lt;cost[s[p]]&lt;&lt;<span class=\"string\">&quot; &quot;</span>&lt;&lt;cost[p];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","tags":[{"name":"pat","slug":"pat","permalink":"http://yoursite.com/tags/pat/"},{"name":"动态规划","slug":"动态规划","permalink":"http://yoursite.com/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"}]},{"title":"a1006","date":"2020-06-25T13:18:40.000Z","path":"2020/06/25/a1006/","content":"<h1 id=\"a1006\"><a href=\"#a1006\" class=\"headerlink\" title=\"a1006\"></a><a href=\"https://pintia.cn/problem-sets/994805342720868352/problems/994805516654460928\">a1006</a></h1><h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>给出最早走了和最迟走的人。</p>\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><p>通过把时间转化为秒，然后再利用sought函数进行排序。就可以给出答案。</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;map&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cmath&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;set&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stack&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;queue&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//cin用多了超市</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> maxn=<span class=\"number\">100100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">node</span>&#123;</span><br><span class=\"line\">    string  name;</span><br><span class=\"line\">    <span class=\"type\">int</span> start;</span><br><span class=\"line\">    <span class=\"type\">int</span> end;</span><br><span class=\"line\">&#125;stu[maxn];</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">cmp11</span><span class=\"params\">(node a,node b)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a.start&lt;b.start;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">cmp12</span><span class=\"params\">(node a,node b)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a.end&gt;b.end;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> n;</span><br><span class=\"line\">    cin&gt;&gt;n ;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">        string name;</span><br><span class=\"line\">        <span class=\"type\">int</span> h1,h2,m1,m2,s1,s2;</span><br><span class=\"line\">        cin&gt;&gt;name;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d:%d:%d %d:%d:%d&quot;</span>,&amp;h1,&amp;m1,&amp;s1,&amp;h2,&amp;m2,&amp;s2);</span><br><span class=\"line\">        <span class=\"type\">int</span> start=h1*<span class=\"number\">3600</span>+m1*<span class=\"number\">60</span>+s1;</span><br><span class=\"line\">        <span class=\"type\">int</span> end=h2*<span class=\"number\">3600</span>+m2*<span class=\"number\">60</span>+s2;</span><br><span class=\"line\">        stu[i].name=name;</span><br><span class=\"line\">        stu[i].start=start;</span><br><span class=\"line\">        stu[i].end=end;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">sort</span>(stu,stu+n,cmp11);</span><br><span class=\"line\">    cout&lt;&lt;stu[<span class=\"number\">0</span>].name;</span><br><span class=\"line\">    <span class=\"built_in\">sort</span>(stu,stu+n,cmp12);</span><br><span class=\"line\">    cout&lt;&lt;<span class=\"string\">&quot; &quot;</span>&lt;&lt;stu[<span class=\"number\">0</span>].name;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","tags":[{"name":"pat","slug":"pat","permalink":"http://yoursite.com/tags/pat/"},{"name":"排序","slug":"排序","permalink":"http://yoursite.com/tags/%E6%8E%92%E5%BA%8F/"}]},{"title":"a1005","date":"2020-06-25T13:18:36.000Z","path":"2020/06/25/a1005/","content":"<h1 id=\"a1005\"><a href=\"#a1005\" class=\"headerlink\" title=\"a1005\"></a><a href=\"https://pintia.cn/problem-sets/994805342720868352/problems/994805519074574336\">a1005</a></h1><h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>给出一个数，把它的和加起来。然后再用英语来表达出他的和。</p>\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><p>通过字符串来进行加减，然后再利用哈希表来进行查值输出。</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;map&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cmath&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;set&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stack&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;queue&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//cin用多了超市</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> maxn=<span class=\"number\">100100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    string string1;</span><br><span class=\"line\">    cin&gt;&gt;string1;</span><br><span class=\"line\">    <span class=\"type\">int</span> ans=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; string1.<span class=\"built_in\">length</span>(); ++i) &#123;</span><br><span class=\"line\">        ans+=string1[i]-<span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    string string2=<span class=\"built_in\">to_string</span>(ans);</span><br><span class=\"line\">    string out[<span class=\"number\">10</span>]=&#123;<span class=\"string\">&quot;zero&quot;</span>,<span class=\"string\">&quot;one&quot;</span>,<span class=\"string\">&quot;two&quot;</span>,<span class=\"string\">&quot;three&quot;</span>,<span class=\"string\">&quot;four&quot;</span>,<span class=\"string\">&quot;five&quot;</span>,<span class=\"string\">&quot;six&quot;</span>,<span class=\"string\">&quot;seven&quot;</span>,<span class=\"string\">&quot;eight&quot;</span>,<span class=\"string\">&quot;nine&quot;</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; string2.<span class=\"built_in\">length</span>(); ++j) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (j==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            cout&lt;&lt;out[string2[j]-<span class=\"string\">&#x27;0&#x27;</span>];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            cout&lt;&lt;<span class=\"string\">&quot; &quot;</span>&lt;&lt;out[string2[j]-<span class=\"string\">&#x27;0&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","tags":[{"name":"pat","slug":"pat","permalink":"http://yoursite.com/tags/pat/"},{"name":"水题","slug":"水题","permalink":"http://yoursite.com/tags/%E6%B0%B4%E9%A2%98/"}]},{"title":"a1004","date":"2020-06-25T13:18:31.000Z","path":"2020/06/25/a1004/","content":"","tags":[]},{"title":"a1003","date":"2020-06-25T13:18:27.000Z","path":"2020/06/25/a1003/","content":"<h1 id=\"a1003\"><a href=\"#a1003\" class=\"headerlink\" title=\"a1003\"></a><a href=\"https://pintia.cn/problem-sets/994805342720868352/problems/994805523835109376\">a1003</a></h1><h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>根据距离人数构成最短路径，如果距离相等，选择人数多的，最后输出有几条最短路径和最多几个人</p>\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><p>最短路径的代码正常写法</p>\n<h3 id=\"0-首先初始化\"><a href=\"#0-首先初始化\" class=\"headerlink\" title=\"0.首先初始化\"></a>0.首先初始化</h3><p>G的所有值设置为maxn，距离d也设置maxn，visited设置false</p>\n<h3 id=\"1-首先是选出距离的点\"><a href=\"#1-首先是选出距离的点\" class=\"headerlink\" title=\"1.首先是选出距离的点\"></a>1.首先是选出距离的点</h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> less=<span class=\"number\">-1</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> min=maxn;</span><br><span class=\"line\"><span class=\"comment\">//        首先找到最小编</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (d[i]&lt;min&amp;&amp;!visited[i])&#123;</span><br><span class=\"line\">                less=i;</span><br><span class=\"line\">                min=d[i];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-异常检查\"><a href=\"#2-异常检查\" class=\"headerlink\" title=\"2.异常检查\"></a>2.异常检查</h2><p>就是如果没找到最短的边那就结束</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (less==<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-设置为访问过，并且通过这个点的周围所有点更新d\"><a href=\"#3-设置为访问过，并且通过这个点的周围所有点更新d\" class=\"headerlink\" title=\"3.设置为访问过，并且通过这个点的周围所有点更新d\"></a>3.设置为访问过，并且通过这个点的周围所有点更新d</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">visited[less]= <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"comment\">//        通过这个最短点找与他相连的其他点，通过这个桥梁更新距离</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; n; ++j) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!visited[j]&amp;&amp;G[less][j]!=maxn)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (d[less]+G[less][j]&lt;d[j])&#123;</span><br><span class=\"line\">                    d[j]=d[less]+G[less][j];</span><br><span class=\"line\">                    ren[j]=cost[j]+ren[less];</span><br><span class=\"line\">                    times[j]=times[less];</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (d[less]+G[less][j]==d[j])&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (cost[j]+ren[less]&gt;ren[j])&#123;</span><br><span class=\"line\">                        ren[j]=cost[j]+ren[less];</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    times[j]+=times[less];</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-完整的代码\"><a href=\"#4-完整的代码\" class=\"headerlink\" title=\"4.完整的代码\"></a>4.完整的代码</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;map&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cmath&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;set&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stack&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;queue&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//cin用多了超市</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> maxn=<span class=\"number\">100100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> n,m,c1,c2;</span><br><span class=\"line\">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;c1&gt;&gt;c2;</span><br><span class=\"line\">    <span class=\"type\">int</span> cost[n];</span><br><span class=\"line\">    <span class=\"type\">int</span> d[n];</span><br><span class=\"line\">    <span class=\"built_in\">fill</span>(d,d+n,maxn);</span><br><span class=\"line\">    <span class=\"type\">bool</span> visited[n];</span><br><span class=\"line\">    <span class=\"built_in\">fill</span>(visited,visited+n, <span class=\"literal\">false</span>);</span><br><span class=\"line\">    <span class=\"type\">int</span> G[n][n];</span><br><span class=\"line\">    <span class=\"built_in\">fill</span>(G[<span class=\"number\">0</span>],G[<span class=\"number\">0</span>]+n*n,maxn);</span><br><span class=\"line\">    <span class=\"type\">int</span> ren[n];</span><br><span class=\"line\">    <span class=\"built_in\">fill</span>(ren,ren+n,<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">        cin&gt;&gt;cost[i];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; m; ++j) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> p,q,t;</span><br><span class=\"line\">        cin&gt;&gt;p&gt;&gt;q&gt;&gt;t;</span><br><span class=\"line\">        G[p][q]=G[q][p]=t;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    d[c1]=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> times[n];</span><br><span class=\"line\">    <span class=\"built_in\">fill</span>(times,times+n,<span class=\"number\">0</span>);</span><br><span class=\"line\">    times[c1]=<span class=\"number\">1</span>;</span><br><span class=\"line\">    ren[c1]=cost[c1];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> k = <span class=\"number\">0</span>; k &lt; n; ++k) &#123;</span><br><span class=\"line\"><span class=\"comment\">//        寻找最短的点</span></span><br><span class=\"line\">        <span class=\"type\">int</span> less=<span class=\"number\">-1</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> min=maxn;</span><br><span class=\"line\"><span class=\"comment\">//        首先找到最小编</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (d[i]&lt;min&amp;&amp;!visited[i])&#123;</span><br><span class=\"line\">                less=i;</span><br><span class=\"line\">                min=d[i];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"comment\">//        没找到直接返回</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (less==<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        visited[less]= <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"comment\">//        通过这个最短点找与他相连的其他点，通过这个桥梁更新距离</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; n; ++j) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!visited[j]&amp;&amp;G[less][j]!=maxn)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (d[less]+G[less][j]&lt;d[j])&#123;</span><br><span class=\"line\">                    d[j]=d[less]+G[less][j];</span><br><span class=\"line\">                    ren[j]=cost[j]+ren[less];</span><br><span class=\"line\">                    times[j]=times[less];</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (d[less]+G[less][j]==d[j])&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (cost[j]+ren[less]&gt;ren[j])&#123;</span><br><span class=\"line\">                        ren[j]=cost[j]+ren[less];</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    times[j]+=times[less];</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    cout&lt;&lt;times[c2]&lt;&lt;<span class=\"string\">&quot; &quot;</span>&lt;&lt;ren[c2];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","tags":[{"name":"pat","slug":"pat","permalink":"http://yoursite.com/tags/pat/"},{"name":"图","slug":"图","permalink":"http://yoursite.com/tags/%E5%9B%BE/"},{"name":"最短路径","slug":"最短路径","permalink":"http://yoursite.com/tags/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/"}]},{"title":"a1002","date":"2020-06-25T13:18:07.000Z","path":"2020/06/25/a1002/","content":"<h1 id=\"a1002\"><a href=\"#a1002\" class=\"headerlink\" title=\"a1002\"></a><a href=\"https://pintia.cn/problem-sets/994805342720868352/problems/994805526272000000\">a1002</a></h1><h2 id=\"题目大意。\"><a href=\"#题目大意。\" class=\"headerlink\" title=\"题目大意。\"></a>题目大意。</h2><p>两个多项式相加。</p>\n<h2 id=\"解决方法。\"><a href=\"#解决方法。\" class=\"headerlink\" title=\"解决方法。\"></a>解决方法。</h2><p>构建一个双精度的数组。同时在构建一个索引表。这个索引表来看一共有哪几个是要加入的指数，如果系数为零，那么就把它给加入到索引表里面。然后进行加法运算，如果最后的系数还是为零，那么就减少一个要输出的数值。最后再使用short来进行排序，按倒叙的方法来输入所有的值。</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;map&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cmath&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;set&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stack&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;queue&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//cin用多了超市</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> maxn=<span class=\"number\">10010</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> n,zhishu;</span><br><span class=\"line\">    <span class=\"type\">double</span> xishu;</span><br><span class=\"line\">    <span class=\"type\">double</span> ans[<span class=\"number\">1000</span>];</span><br><span class=\"line\">    <span class=\"built_in\">fill</span>(ans,ans+<span class=\"number\">1000</span>,<span class=\"number\">0.0</span>);</span><br><span class=\"line\">    <span class=\"type\">int</span> temp[<span class=\"number\">1000</span>];</span><br><span class=\"line\">    <span class=\"type\">int</span> time=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> count=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">2</span>; ++i) &#123;</span><br><span class=\"line\">        cin&gt;&gt;n;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt;  n; ++j) &#123;</span><br><span class=\"line\">            cin&gt;&gt;zhishu&gt;&gt;xishu;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (ans[zhishu]==<span class=\"number\">0.0</span>)&#123;</span><br><span class=\"line\">                temp[time]=zhishu;</span><br><span class=\"line\">                time++;</span><br><span class=\"line\">                count++;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            ans[zhishu]+=xishu;</span><br><span class=\"line\"><span class=\"comment\">//            如多相加为0</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (ans[zhishu]==<span class=\"number\">0.0</span>)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                count--;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    cout&lt;&lt;count;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">sort</span>(temp,temp+time);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> k = time<span class=\"number\">-1</span>; k &gt;=<span class=\"number\">0</span> ; --k) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ans[temp[k]]!=<span class=\"number\">0.0</span>)&#123;</span><br><span class=\"line\">            cout&lt;&lt;<span class=\"string\">&quot; &quot;</span>&lt;&lt;temp[k]&lt;&lt;<span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%.1lf&quot;</span>,ans[temp[k]]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","tags":[{"name":"pat","slug":"pat","permalink":"http://yoursite.com/tags/pat/"},{"name":"水题","slug":"水题","permalink":"http://yoursite.com/tags/%E6%B0%B4%E9%A2%98/"}]},{"title":"a1001","date":"2020-06-25T13:16:15.000Z","path":"2020/06/25/a1001/","content":"<h1 id=\"a1001\"><a href=\"#a1001\" class=\"headerlink\" title=\"a1001\"></a><a href=\"https://pintia.cn/problem-sets/994805342720868352/problems/994805528788582400\">a1001</a></h1><h2 id=\"题目大意\"><a href=\"#题目大意\" class=\"headerlink\" title=\"题目大意\"></a>题目大意</h2><p>计算结果并且用英式符号来表达。 就是每三位用一个逗号来表达。</p>\n<h2 id=\"解决方法。\"><a href=\"#解决方法。\" class=\"headerlink\" title=\"解决方法。\"></a>解决方法。</h2><p>通过把他们的和变成字符串。然后从后往前便利了每三位取模等于零，那就是要添加逗号的地方。但是了最后一个和第一个不能要呀逗号。同时还要考虑到这个字符串的正负性。</p>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;map&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;cmath&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;set&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stack&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;queue&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//cin用多了超市</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">int</span> maxn=<span class=\"number\">10010</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> a,b;</span><br><span class=\"line\">    cin&gt;&gt;a&gt;&gt;b;</span><br><span class=\"line\">    <span class=\"type\">int</span> c=a+b;</span><br><span class=\"line\">    string  d=<span class=\"built_in\">to_string</span>(c);</span><br><span class=\"line\">    <span class=\"type\">int</span> count=<span class=\"number\">0</span>;</span><br><span class=\"line\">    string  temp=<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (c&lt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        cout&lt;&lt;<span class=\"string\">&quot;-&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = d.<span class=\"built_in\">length</span>()<span class=\"number\">-1</span>; i &gt;=<span class=\"number\">1</span>; --i) &#123;</span><br><span class=\"line\">            count++;</span><br><span class=\"line\">            temp=d[i]+temp;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (count%<span class=\"number\">3</span>==<span class=\"number\">0</span>&amp;&amp;i!=d.<span class=\"built_in\">length</span>()<span class=\"number\">-1</span>&amp;&amp;i!=<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\"><span class=\"comment\">//                cout&lt;&lt;&#x27;,&#x27;;</span></span><br><span class=\"line\">                temp=<span class=\"string\">&#x27;,&#x27;</span>+temp;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = d.<span class=\"built_in\">length</span>()<span class=\"number\">-1</span>; i &gt;=<span class=\"number\">0</span>; --i) &#123;</span><br><span class=\"line\">            count++;</span><br><span class=\"line\">            temp=d[i]+temp;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (count%<span class=\"number\">3</span>==<span class=\"number\">0</span>&amp;&amp;i!=d.<span class=\"built_in\">length</span>()<span class=\"number\">-1</span>&amp;&amp;i!=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                temp=<span class=\"string\">&#x27;,&#x27;</span>+temp;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    cout&lt;&lt;temp;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","tags":[{"name":"pat","slug":"pat","permalink":"http://yoursite.com/tags/pat/"},{"name":"水题","slug":"水题","permalink":"http://yoursite.com/tags/%E6%B0%B4%E9%A2%98/"}]},{"title":"pat输入","date":"2020-06-25T09:59:08.000Z","path":"2020/06/25/pat输入/","content":"<h1 id=\"输入方法\"><a href=\"#输入方法\" class=\"headerlink\" title=\"输入方法\"></a>输入方法</h1><h2 id=\"1-eof\"><a href=\"#1-eof\" class=\"headerlink\" title=\"1.eof\"></a>1.eof</h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span>(<span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;n)!=EOF)&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-条件读入\"><a href=\"#2-条件读入\" class=\"headerlink\" title=\"2.条件读入\"></a>2.条件读入</h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span>(<span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>,&amp;n)!=<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-for\"><a href=\"#3-for\" class=\"headerlink\" title=\"3.for\"></a>3.for</h2>","tags":[{"name":"pat","slug":"pat","permalink":"http://yoursite.com/tags/pat/"},{"name":"输入","slug":"输入","permalink":"http://yoursite.com/tags/%E8%BE%93%E5%85%A5/"}]},{"title":"单纯形方法","date":"2019-09-07T07:00:21.000Z","path":"2019/09/07/单纯形方法/","content":"<h1 id=\"单纯形方法\"><a href=\"#单纯形方法\" class=\"headerlink\" title=\"单纯形方法\"></a>单纯形方法</h1><h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><h3 id=\"1-第一步：化标准形\"><a href=\"#1-第一步：化标准形\" class=\"headerlink\" title=\"1.第一步：化标准形\"></a>1.第一步：化标准形</h3><p><img src=\"https://images2017.cnblogs.com/blog/1092891/201801/1092891-20180107213728799-361504213.png\" alt=\"示例图片\"></p>\n<h4 id=\"标准型的规定\"><a href=\"#标准型的规定\" class=\"headerlink\" title=\"标准型的规定\"></a>标准型的规定</h4><h5 id=\"1-目标函数要求max\"><a href=\"#1-目标函数要求max\" class=\"headerlink\" title=\"1.目标函数要求max\"></a>1.目标函数要求max</h5><h5 id=\"2-约束条件均为等式\"><a href=\"#2-约束条件均为等式\" class=\"headerlink\" title=\"2.约束条件均为等式\"></a>2.约束条件均为等式</h5><h5 id=\"3-决策变量为非负约束\"><a href=\"#3-决策变量为非负约束\" class=\"headerlink\" title=\"3.决策变量为非负约束\"></a>3.决策变量为非负约束</h5><h4 id=\"最终结果\"><a href=\"#最终结果\" class=\"headerlink\" title=\"最终结果\"></a>最终结果</h4><p><img src=\"https://images2017.cnblogs.com/blog/1092891/201801/1092891-20180107213813096-1714683258.png\" alt=\"图片\"></p>\n<h3 id=\"2-第二步：构建单纯形表\"><a href=\"#2-第二步：构建单纯形表\" class=\"headerlink\" title=\"2.第二步：构建单纯形表\"></a>2.第二步：构建单纯形表</h3><h4 id=\"1-找出基向量，就是他们系数组成的矩阵是单位向量\"><a href=\"#1-找出基向量，就是他们系数组成的矩阵是单位向量\" class=\"headerlink\" title=\"1.找出基向量，就是他们系数组成的矩阵是单位向量\"></a>1.找出基向量，就是他们系数组成的矩阵是单位向量</h4><h4 id=\"2-把z函数的系数也加入这个矩阵，除了自己的系数是1，其余都为0，用行变换变成只有1个1，其余列上都为0\"><a href=\"#2-把z函数的系数也加入这个矩阵，除了自己的系数是1，其余都为0，用行变换变成只有1个1，其余列上都为0\" class=\"headerlink\" title=\"2.把z函数的系数也加入这个矩阵，除了自己的系数是1，其余都为0，用行变换变成只有1个1，其余列上都为0\"></a><em><strong>2.把z函数的系数也加入这个矩阵，除了自己的系数是1，其余都为0，用行变换变成只有1个1，其余列上都为0</strong></em></h4><p><img src=\"https://images2017.cnblogs.com/blog/1092891/201801/1092891-20180107213844346-2035122277.png\" alt=\"图片\"></p>\n<h3 id=\"3-第三步：求解\"><a href=\"#3-第三步：求解\" class=\"headerlink\" title=\"3.第三步：求解\"></a>3.第三步：求解</h3><h4 id=\"1-找出θi里最大的所对应那一列\"><a href=\"#1-找出θi里最大的所对应那一列\" class=\"headerlink\" title=\"1.找出θi里最大的所对应那一列\"></a>1.找出θi里最大的所对应那一列</h4><p>​\t\t如图，应该是3最大，对应的就是x2那一列，x2就是换入变量，再求b&#x2F;aij,就是b那一列除x2对应的那一列，那个最小就是，那个元素的行向量对应的向量换出变量（b&gt;0才可以除，若都小于等于0，则无解）12&#x2F;3&#x3D;4,9&#x2F;1&#x3D;9,4小，x3就是换出变量</p>\n<h4 id=\"2-把x2那一列化成010，保证只有x2与x3相交的为1，其他的都为0，在x2列\"><a href=\"#2-把x2那一列化成010，保证只有x2与x3相交的为1，其他的都为0，在x2列\" class=\"headerlink\" title=\"2.把x2那一列化成010，保证只有x2与x3相交的为1，其他的都为0，在x2列\"></a>2.把x2那一列化成010，保证只有x2与x3相交的为1，其他的都为0，在x2列<!--应该是001，这里的是θi在第一行，我们的是在最后一行--></h4><p><img src=\"https://images2017.cnblogs.com/blog/1092891/201801/1092891-20180107214818862-1198445671.png\" alt=\"图片\"></p>\n<h4 id=\"3-重复1-2两步，直到z的系数都小于等于0\"><a href=\"#3-重复1-2两步，直到z的系数都小于等于0\" class=\"headerlink\" title=\"3.重复1,2两步，直到z的系数都小于等于0\"></a>3.重复1,2两步，直到z的系数都小于等于0</h4><p>此时x1是换入，x4是换出，变成001</p>\n<p><img src=\"https://images2017.cnblogs.com/blog/1092891/201801/1092891-20180107215054862-1636502575.png\"></p>\n<h3 id=\"4-结束\"><a href=\"#4-结束\" class=\"headerlink\" title=\"4.结束\"></a>4.结束</h3><p>当θi都小于等于0是结束，x*&#x3D;（3,3,0,0）T，z&#x3D;15</p>\n<h3 id=\"5-总结\"><a href=\"#5-总结\" class=\"headerlink\" title=\"5.总结\"></a>5.总结</h3><h4 id=\"解的分类\"><a href=\"#解的分类\" class=\"headerlink\" title=\"解的分类\"></a>解的分类</h4><h6 id=\"1-唯一最优解\"><a href=\"#1-唯一最优解\" class=\"headerlink\" title=\"1.唯一最优解\"></a>1.唯一最优解</h6><p>当所有非基变量的检验数都小于零，则原问题有唯一最优解</p>\n<h6 id=\"2-无穷多个最优解\"><a href=\"#2-无穷多个最优解\" class=\"headerlink\" title=\"2.无穷多个最优解\"></a>2.无穷多个最优解</h6><p>当所有非基变量的检验数<strong>都小于等于零，注意有等于零的检验数</strong>，则有无穷多个最优解，有0</p>\n<p>非基向量就可以随便加也无影响，所以是无穷个</p>\n<h6 id=\"3-无界解\"><a href=\"#3-无界解\" class=\"headerlink\" title=\"3.无界解\"></a>3.<a href=\"https://www.baidu.com/s?wd=%E6%97%A0%E7%95%8C&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao\">无界</a>解</h6><p>当任意一个大于零的非基变量的检验数，其对应的ajk（求最小比值的分母）都小于等于零时，则原问题有<a href=\"https://www.baidu.com/s?wd=%E6%97%A0%E7%95%8C&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao\">无界</a>解</p>\n<p>就是b&#x2F;aij&lt;&#x3D;0,无法找到换出的变量</p>\n<h6 id=\"4-无可行解\"><a href=\"#4-无可行解\" class=\"headerlink\" title=\"4.无可行解\"></a>4.无可行解</h6><p>添加人工变量后的问题，当所有非基变量的检验数都小于等于零，而基变量中有人工变量时，则原问题无可行解</p>\n","tags":[{"name":"线性代数","slug":"线性代数","permalink":"http://yoursite.com/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/"},{"name":"运筹学","slug":"运筹学","permalink":"http://yoursite.com/tags/%E8%BF%90%E7%AD%B9%E5%AD%A6/"}]},{"title":"Boot","date":"2019-09-04T15:08:42.000Z","path":"2019/09/04/Boot/","content":"","tags":[]},{"title":"动态规划","date":"2019-07-26T06:41:10.000Z","path":"2019/07/26/动态规划/","content":"<h1 id=\"动态规划\"><a href=\"#动态规划\" class=\"headerlink\" title=\"动态规划\"></a>动态规划</h1><h2 id=\"1-定义\"><a href=\"#1-定义\" class=\"headerlink\" title=\"1.定义\"></a>1.定义</h2><blockquote>\n<p><strong>动态规划算法介绍</strong></p>\n<p>1)动态规划(<strong>Dynamic</strong> <strong>Programming</strong>)算法的核心思想是：将大问题划分为小问题进行解决，从而一步步获取最优解的处理算法</p>\n<p>●</p>\n<p>2)动态规划算法与分治算法类似，其基本思想也是将待求解问题分解成若干个子问题，先求解子问题，然后从这些子问题的解得到原问题的解。</p>\n<p>●</p>\n<p>3)与分治法不同的是，<strong>适合于用动态规划求解的问题，经分解得到子问题往往不是互相独立的****。</strong> ( 即下一个子阶段的求解是建立在上一个子阶段的解的基础上，进行进一步的求解 )</p>\n<p>●</p>\n<p>4)动态规划可以通过<strong>填****表的方式</strong>来逐步推进，得到最优解.</p>\n</blockquote>\n<h2 id=\"2-背包问题\"><a href=\"#2-背包问题\" class=\"headerlink\" title=\"2.背包问题\"></a>2.背包问题</h2><p><a href=\"https://imgchr.com/i/entZOU\"><img src=\"https://s2.ax1x.com/2019/07/26/entZOU.md.png\" alt=\"entZOU.md.png\"></a></p>\n<h2 id=\"3-解决思路\"><a href=\"#3-解决思路\" class=\"headerlink\" title=\"3.解决思路\"></a>3.解决思路</h2><p><a href=\"https://imgchr.com/i/enttmD\"><img src=\"https://s2.ax1x.com/2019/07/26/enttmD.md.png\" alt=\"enttmD.md.png\"></a></p>\n<h2 id=\"4-个人理解\"><a href=\"#4-个人理解\" class=\"headerlink\" title=\"4.个人理解\"></a>4.个人理解</h2><p>构建数组，行是在前一行新加的物品，猎是增加的重量，最大不过背包能加的重量。当新加一个物品时看这个是否超重，如果超重，那就把上一行的价值赋值到下面来；如果没有超重，那就选取最大值（在上一行的这个，和这个物品的价值+v【i-1】【j-w【i】】）来选取最大值，直到填完所有表，最后一个就是最好的。</p>\n<h2 id=\"5-代码讲解\"><a href=\"#5-代码讲解\" class=\"headerlink\" title=\"5.代码讲解\"></a>5.代码讲解</h2><p><strong>注意一个坑，物品的下标是从0开始的，但是在表里是第一行开始的，所以在找重量是需要i-1</strong></p>\n<p>如果需要记录是拿几个弄出最有解，设置一个数组path，当用心加的物品时最大就把path【i】【j】设置为1，就从最后面找，当path为1时，j&#x3D;j-w【i-1】</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span>[] weight=&#123;<span class=\"number\">1</span>,<span class=\"number\">4</span>,<span class=\"number\">3</span>&#125;;</span><br><span class=\"line\">        <span class=\"type\">int</span>[] val=&#123;<span class=\"number\">1500</span>,<span class=\"number\">3000</span>,<span class=\"number\">2000</span>&#125;;</span><br><span class=\"line\">        <span class=\"type\">int</span> m=<span class=\"number\">4</span>;<span class=\"comment\">//定义背包重量为4kg</span></span><br><span class=\"line\">        <span class=\"type\">int</span>[][] v=<span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[weight.length+<span class=\"number\">1</span>][m+<span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"type\">int</span>[][] path=<span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[weight.length+<span class=\"number\">1</span>][m+<span class=\"number\">1</span>];<span class=\"comment\">//定义路径</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>; i &lt; v.length; i++) &#123;<span class=\"comment\">//从第一个物品出发</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>; j &lt; v[<span class=\"number\">0</span>].length; j++) &#123;<span class=\"comment\">//从第1kg出发</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (weight[i-<span class=\"number\">1</span>]&gt;j)&#123;<span class=\"comment\">//新加的物品的重量大于背包重量(从1开始，但是wuti还是从0开始要减去1</span></span><br><span class=\"line\">                    v[i][j]=v[i-<span class=\"number\">1</span>][j];<span class=\"comment\">//没加物品时背包的价值</span></span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (v[i-<span class=\"number\">1</span>][j]&gt;val[i-<span class=\"number\">1</span>]+v[i-<span class=\"number\">1</span>][j-weight[i-<span class=\"number\">1</span>]])&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                        v[i][j]=v[i-<span class=\"number\">1</span>][j];</span><br><span class=\"line\">                    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        path[i][j]=<span class=\"number\">1</span>;</span><br><span class=\"line\">                        v[i][j]=val[i-<span class=\"number\">1</span>]+v[i-<span class=\"number\">1</span>][j-weight[i-<span class=\"number\">1</span>]];</span><br><span class=\"line\"></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> i=v.length-<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> j=v[<span class=\"number\">0</span>].length-<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (i&gt;=<span class=\"number\">0</span>&amp;&amp;j&gt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (path[i][j]==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                System.out.println(i+<span class=\"string\">&quot;放进去了&quot;</span>);</span><br><span class=\"line\">                j=j-weight[i-<span class=\"number\">1</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            i--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"动态规划","slug":"动态规划","permalink":"http://yoursite.com/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"},{"name":"算法","slug":"算法","permalink":"http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"汉诺塔","date":"2019-07-26T06:30:56.000Z","path":"2019/07/26/汉诺塔/","content":"<h1 id=\"汉诺塔\"><a href=\"#汉诺塔\" class=\"headerlink\" title=\"汉诺塔\"></a>汉诺塔</h1><h2 id=\"1-分治定义\"><a href=\"#1-分治定义\" class=\"headerlink\" title=\"1.分治定义\"></a>1.分治定义</h2><p>分治法在每一层递归上都有三个步骤：</p>\n<p>1)分解：将原问题分解为若干个规模较小，相互独立，与原问题形式相同的子问题</p>\n<p>2)解决：若子问题规模较小而容易被解决则直接解，否则递归地解各个子问题</p>\n<p>3)合并：将各个子问题的解合并为原问题的解。</p>\n<blockquote>\n<p>if |P|≤n0</p>\n<p>   then return(ADHOC(P))</p>\n<p>&#x2F;&#x2F;将P分解为较小的子问题 P1 ,P2 ,…,Pk</p>\n<p>for i←1 to k</p>\n<p>do yi ← Divide-and-Conquer(Pi)   递归解决Pi</p>\n<p>T ← MERGE(y1,y2,…,yk)   合并子问题</p>\n<p>return(T)</p>\n</blockquote>\n<blockquote>\n<p>其中|P|表示问题P的规模；n0为一阈值，表示当问题P的规模不超过n0时，问题已容易直接解出，不必再继续分解。ADHOC(P)是该分治法中的基本子算法，用于直接解小规模的问题P。因此，当P的规模不超过n0时直接用算法ADHOC(P)求解。算法MERGE(y1,y2,…,yk)是该分治法中的合并子算法，用于将P的子问题P1<br>,P2 ,…,Pk的相应的解y1,y2,…,yk合并为P的解。</p>\n</blockquote>\n<h2 id=\"2-汉诺塔定义\"><a href=\"#2-汉诺塔定义\" class=\"headerlink\" title=\"2.汉诺塔定义\"></a>2.汉诺塔定义</h2><blockquote>\n<p>Ø汉诺塔的传说</p>\n<p>汉诺塔：汉诺塔（又称河内塔）问题是源于印度一个古老传说的益智玩具。大梵天创造世界的时候做了三根<a href=\"https://baike.baidu.com/item/%E9%87%91%E5%88%9A%E7%9F%B3/80698\">金刚石</a>柱子，在一根柱子上从下往上按照大小顺序摞着64片黄金圆盘。大梵天命令婆罗门把圆盘从下面开始按大小顺序重新摆放在另一根柱子上。并且规定，在小圆盘上不能放大圆盘，在三根柱子之间一次只能移动一个圆盘。</p>\n<p>假如每秒钟一次，共需多长时间呢？移完这些金片需要5845.54亿年以上，太阳系的预期寿命据说也就是数百亿年。真的过了5845.54亿年，地球上的一切生命，连同梵塔、庙宇等，都早已经灰飞烟灭。</p>\n</blockquote>\n<h2 id=\"3-解决思路\"><a href=\"#3-解决思路\" class=\"headerlink\" title=\"3.解决思路\"></a>3.解决思路</h2><p>Ø汉诺塔游戏的<strong>演示</strong>和<strong>思路分析</strong>:    </p>\n<p>1)如果是有一个盘， A-&gt;C</p>\n<p>如果我们有 n &gt;&#x3D; 2 情况，我们总是可以看做是两个盘 1.最下边的盘 2. 上面的盘</p>\n<p>1)先把 最上面的盘 A-&gt;B</p>\n<p>2)把最下边的盘 A-&gt;C</p>\n<p>3)把B塔的所有盘 从 B-&gt;C   </p>\n<h2 id=\"4-个人理解\"><a href=\"#4-个人理解\" class=\"headerlink\" title=\"4.个人理解\"></a>4.个人理解</h2><p>把牌分为两部分，最下面一个，和上面的所有，先把最上面所有的（n-1）移动到b盘（借助c盘的帮助），再把最下面的一个移动到c盘，最后再把b盘上的所有移动到c盘（借助a盘的帮助），把规模为n的问题分为n-1,1，n-1的三个问题，递归基就是只有一个元素，那就把元素从a到c</p>\n<h2 id=\"5-代码讲解\"><a href=\"#5-代码讲解\" class=\"headerlink\" title=\"5.代码讲解\"></a>5.代码讲解</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        solve(<span class=\"number\">4</span>,<span class=\"string\">&#x27;a&#x27;</span>,<span class=\"string\">&#x27;b&#x27;</span>,<span class=\"string\">&#x27;c&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//n个塔借组b使他从a到c</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">solve</span><span class=\"params\">(<span class=\"type\">int</span> n,<span class=\"type\">char</span> a,<span class=\"type\">char</span> b,<span class=\"type\">char</span> c)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (n==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;第1个盘从&quot;</span>+a+<span class=\"string\">&quot;到&quot;</span>+c);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            solve(n-<span class=\"number\">1</span>,a,c,b);<span class=\"comment\">//吧最上面的pan全部移到b上</span></span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;第&quot;</span>+n+<span class=\"string\">&quot;个盘从&quot;</span>+a+<span class=\"string\">&quot;到&quot;</span>+c);<span class=\"comment\">//这个ac是指起点到终点，不是a点和c点</span></span><br><span class=\"line\">            solve(n-<span class=\"number\">1</span>,b,a,c);<span class=\"comment\">//再把b上的pan全部移到c上</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"算法","slug":"算法","permalink":"http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"},{"name":"分治","slug":"分治","permalink":"http://yoursite.com/tags/%E5%88%86%E6%B2%BB/"}]},{"title":"广度优先","date":"2019-07-26T05:51:11.000Z","path":"2019/07/26/广度优先/","content":"<h1 id=\"广度优先\"><a href=\"#广度优先\" class=\"headerlink\" title=\"广度优先\"></a>广度优先</h1><h1 id=\"1-定义\"><a href=\"#1-定义\" class=\"headerlink\" title=\"1.定义\"></a>1.定义</h1><p>1)访问初始结点v并标记结点v为已访问。</p>\n<p>2)结点v入队列</p>\n<p>3)当队列非空时，继续执行，否则算法结束。</p>\n<p>4)出队列，取得队头结点u。</p>\n<p>5)查找结点u的第一个邻接结点w。</p>\n<p>6)若结点u的邻接结点w不存在，则转到步骤3；否则循环执行以下三个步骤：</p>\n<p>6.1 若结点w尚未被访问，则访问结点w并标记为已访问。 </p>\n<p>6.2 结点w入队列 </p>\n<p>6.3 查找结点u的继w邻接结点后的下一个邻接结点w，转到步骤6。</p>\n<h2 id=\"2-个人理解\"><a href=\"#2-个人理解\" class=\"headerlink\" title=\"2.个人理解\"></a>2.个人理解</h2><p>广度优先就是遍历他的所有的子节点再遍历他的子节点的子节点，直到为空才停止（遍历市也是要威访问过的），同样万一有断点，所以需要for循环一遍</p>\n<h1 id=\"3-代码讲解\"><a href=\"#3-代码讲解\" class=\"headerlink\" title=\"3.代码讲解\"></a>3.代码讲解</h1><p>需要一个队列来进行排序，先压入所有节点标为已经访问过的，再排出一个节点，并把这个节点的子节点全部压入标记已经访问，当队列为空才停止</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">bfs</span><span class=\"params\">(<span class=\"type\">int</span> i,<span class=\"type\">int</span>[][] arr,<span class=\"type\">boolean</span>[] visited)</span>&#123;</span><br><span class=\"line\">        Queue&lt;Integer&gt; queue=<span class=\"keyword\">new</span> <span class=\"title class_\">LinkedList</span>&lt;&gt;();</span><br><span class=\"line\">        System.out.print(i+<span class=\"string\">&quot;-&gt;&quot;</span>);</span><br><span class=\"line\">        queue.add(i);</span><br><span class=\"line\">        visited[i]=<span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (!queue.isEmpty())&#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> v=queue.remove();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; j &lt; arr.length; j++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (arr[v][j]==<span class=\"number\">1</span>&amp;&amp;!visited[j])&#123;</span><br><span class=\"line\">                    System.out.print(j+<span class=\"string\">&quot;-&gt;&quot;</span>);</span><br><span class=\"line\">                    visited[j]=<span class=\"literal\">true</span>;</span><br><span class=\"line\">                    queue.add(j);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>同样也有断点需要全部for一遍</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (!visited[i])&#123;</span><br><span class=\"line\">               <span class=\"comment\">//depthfs(i,arr,visited);</span></span><br><span class=\"line\">               dfs(i,arr,visited);</span><br><span class=\"line\">               <span class=\"comment\">//brofs(i,arr,visited);</span></span><br><span class=\"line\">               <span class=\"comment\">//bfs(i,arr,visited);</span></span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"图","slug":"图","permalink":"http://yoursite.com/tags/%E5%9B%BE/"},{"name":"算法","slug":"算法","permalink":"http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"深度优先","date":"2019-07-24T19:53:22.000Z","path":"2019/07/25/深度优先/","content":"<h1 id=\"深度优先\"><a href=\"#深度优先\" class=\"headerlink\" title=\"深度优先\"></a>深度优先</h1><h2 id=\"1-定义\"><a href=\"#1-定义\" class=\"headerlink\" title=\"1.定义\"></a>1.定义</h2><p><strong>深度优先遍历算法步骤</strong></p>\n<p>1)访问初始结点v，并标记结点v为已访问。</p>\n<p>2)查找结点v的第一个邻接结点w。</p>\n<p>3)若w存在，则继续执行4，如果w不存在，则回到第1步，将从v的下一个结点继续。</p>\n<p>4)若w未被访问，对w进行深度优先遍历递归（即把w当做另一个v，然后进行步骤123）。</p>\n<p>5)查找结点v的w邻接结点的下一个邻接结点，转到步骤3。</p>\n<h2 id=\"2-个人理解\"><a href=\"#2-个人理解\" class=\"headerlink\" title=\"2.个人理解\"></a>2.个人理解</h2><p>先设置第一个点为已经访问过的再看这个点与其他拿几个点连接过，并且那些点没有访问过，那么久把这个点递归dfs（递归基停止是都访问过就直接跳回上一个</p>\n<h2 id=\"3-代码讲解\"><a href=\"#3-代码讲解\" class=\"headerlink\" title=\"3.代码讲解\"></a>3.代码讲解</h2><p>首先设置为已经访问过的，在用for循环看邻接矩阵是否这两个相连并没有访问过，那么久把这个点用dfs在递归</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">dfs</span><span class=\"params\">(<span class=\"type\">int</span> i,<span class=\"type\">int</span>[][] arr,<span class=\"type\">boolean</span>[] visited)</span>&#123;</span><br><span class=\"line\">       visited[i]=<span class=\"literal\">true</span>;</span><br><span class=\"line\">       System.out.print(i+<span class=\"string\">&quot;-&gt;&quot;</span>);</span><br><span class=\"line\">       <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; j &lt; arr.length; j++) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (arr[i][j]==<span class=\"number\">1</span>&amp;&amp;!visited[j])&#123;</span><br><span class=\"line\">               dfs(j,arr,visited);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面只是访问的所有相连的节点，万一还有断点，所以需要for循环所有节点</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (!visited[i])&#123;</span><br><span class=\"line\">               <span class=\"comment\">//depthfs(i,arr,visited);</span></span><br><span class=\"line\">               dfs(i,arr,visited);</span><br><span class=\"line\">               <span class=\"comment\">//brofs(i,arr,visited);</span></span><br><span class=\"line\">               <span class=\"comment\">//bfs(i,arr,visited);</span></span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"图","slug":"图","permalink":"http://yoursite.com/tags/%E5%9B%BE/"},{"name":"算法","slug":"算法","permalink":"http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"基数排序","date":"2019-07-24T07:20:22.000Z","path":"2019/07/24/基数排序/","content":"<h1 id=\"基数排序\"><a href=\"#基数排序\" class=\"headerlink\" title=\"基数排序\"></a>基数排序</h1><h2 id=\"1-定义\"><a href=\"#1-定义\" class=\"headerlink\" title=\"1.定义\"></a>1.定义</h2><p>1)将所有待比较数值统一为同样的数位长度，数位较短的数前面补零。然后，从最低位开始，依次进行一次排序。这样从最低位排序一直到最高位排序完成以后, 数列就变成一个有序序列。</p>\n<h2 id=\"2-个人理解\"><a href=\"#2-个人理解\" class=\"headerlink\" title=\"2.个人理解\"></a>2.个人理解</h2><p>首先获取最大值，看他有几位数就循环几次，首先构建10个队列，从0到9，首先看数组里元素的个位数，按个位数是i依次加入到为i的队列里，然后再把数组重新赋值，从队列0移除所有元素，一直到队列9，再从个位数j获取放到队列j里，直到循环结束</p>\n<h2 id=\"3-图示讲解\"><a href=\"#3-图示讲解\" class=\"headerlink\" title=\"3.图示讲解\"></a>3.图示讲解</h2><p><a href=\"https://imgchr.com/i/eEIKfK\"><img src=\"https://s2.ax1x.com/2019/07/24/eEIKfK.md.png\" alt=\"eEIKfK.md.png\"></a></p>\n<p><a href=\"https://imgchr.com/i/eEI16e\"><img src=\"https://s2.ax1x.com/2019/07/24/eEI16e.md.png\" alt=\"eEI16e.md.png\"></a></p>\n<p><a href=\"https://imgchr.com/i/eEIJ0A\"><img src=\"https://s2.ax1x.com/2019/07/24/eEIJ0A.md.png\" alt=\"eEIJ0A.md.png\"></a></p>\n<h2 id=\"4-代码讲解\"><a href=\"#4-代码讲解\" class=\"headerlink\" title=\"4.代码讲解\"></a>4.代码讲解</h2><p>找出最大值，看是几位就循环几次，然后依次获取个位数加入对应的队列再给arr赋值把队列清空，在获取十位，直到结束</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span>[] arr=&#123;<span class=\"number\">53</span>,<span class=\"number\">63</span>,<span class=\"number\">542</span>,<span class=\"number\">748</span>,<span class=\"number\">14</span>,<span class=\"number\">214</span>&#125;;</span><br><span class=\"line\">        <span class=\"type\">int</span> max=arr[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (arr[i]&gt;max)&#123;</span><br><span class=\"line\">                max=arr[i];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> count=(max+<span class=\"string\">&quot;&quot;</span>).length();<span class=\"comment\">//要循环的次数</span></span><br><span class=\"line\">        Queue&lt;Integer&gt; [] queues=<span class=\"keyword\">new</span> <span class=\"title class_\">Queue</span>[<span class=\"number\">10</span>];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; queues.length; i++) &#123;</span><br><span class=\"line\">            queues[i]=<span class=\"keyword\">new</span> <span class=\"title class_\">LinkedList</span>&lt;&gt;();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>,n=<span class=\"number\">1</span> ; i &lt; count; i++,n*=<span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; j &lt; arr.length; j++) &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> tem=arr[j]/n%<span class=\"number\">10</span>;<span class=\"comment\">//获取数字</span></span><br><span class=\"line\">                queues[tem].add(arr[j]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"type\">int</span> t=<span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; j &lt; queues.length; j++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">while</span> (!queues[j].isEmpty())&#123;</span><br><span class=\"line\">                    arr[t]=queues[j].remove();</span><br><span class=\"line\"></span><br><span class=\"line\">                    t++;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class=\"line\">            System.out.println(arr[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"排序","slug":"排序","permalink":"http://yoursite.com/tags/%E6%8E%92%E5%BA%8F/"},{"name":"算法","slug":"算法","permalink":"http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"归并排序","date":"2019-07-24T07:00:02.000Z","path":"2019/07/24/归并排序/","content":"<h1 id=\"归并排序\"><a href=\"#归并排序\" class=\"headerlink\" title=\"归并排序\"></a>归并排序</h1><h2 id=\"1-定义\"><a href=\"#1-定义\" class=\"headerlink\" title=\"1.定义\"></a>1.定义</h2><p><strong>归<strong><strong>并排序（</strong></strong>MERGE-SORT<strong><strong>）是利用</strong></strong>归并<strong><strong>的思想实现的排序方法，该算法采用经典的</strong></strong>分治<strong><strong>（</strong></strong>divide-and-conquer<strong><strong>）策略（分治法将问题</strong></strong>分**</strong>(divide)<strong><strong>成一些小的问题然后递归求解，而</strong></strong>治****(conquer)<strong><strong>的阶段则将分的阶段得到的各答案</strong></strong>“<strong><strong>修补</strong></strong>“<strong><strong>在一起，即分而治之</strong></strong>)**<strong>。</strong></p>\n<h2 id=\"2-0个人理解\"><a href=\"#2-0个人理解\" class=\"headerlink\" title=\"2.0个人理解\"></a>2.0个人理解</h2><p>先把数组一直分 分成n组直到每组只有一个元素，然后在对每两组元素进行合并（因为他就是两组两组的分的就是用middle来分），合并时就先狗一个空数组，同时设置l1，l2为每一组元素的开头，再比较arr【l1】yuarr【l2】的大小，晓得就假如新数组，并++，最后再把这个数组的元素拷贝到原数组里。</p>\n<h2 id=\"3-图示讲解\"><a href=\"#3-图示讲解\" class=\"headerlink\" title=\"3.图示讲解\"></a>3.图示讲解</h2><p><a href=\"https://imgchr.com/i/eEfgzQ\"><img src=\"https://s2.ax1x.com/2019/07/24/eEfgzQ.md.png\" alt=\"eEfgzQ.md.png\"></a></p>\n<h2 id=\"4-0代码讲解\"><a href=\"#4-0代码讲解\" class=\"headerlink\" title=\"4.0代码讲解\"></a>4.0代码讲解</h2><h3 id=\"4-1不断分组的代码\"><a href=\"#4-1不断分组的代码\" class=\"headerlink\" title=\"4.1不断分组的代码\"></a>4.1不断分组的代码</h3><p>终止条件同样也是l》&#x3D;r，否则就是取中间值middle，再划分两组，最后进行合并</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span>  <span class=\"title function_\">mergeSort</span><span class=\"params\">(<span class=\"type\">int</span> left,<span class=\"type\">int</span> right,<span class=\"type\">int</span>[] arr)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (left&gt;=right)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> mid=(left+right)/<span class=\"number\">2</span>;</span><br><span class=\"line\">        mergeSort(left,mid,arr);</span><br><span class=\"line\">        mergeSort(mid+<span class=\"number\">1</span>,right,arr);</span><br><span class=\"line\">        merge(left,right,mid,arr);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-2合并代码\"><a href=\"#4-2合并代码\" class=\"headerlink\" title=\"4.2合并代码\"></a>4.2合并代码</h3><p>找到两个数组收元素，i一个是left，j另一个是mid+1，新开一个数组copy，长度是right-left+1进行循环，当i&lt;&#x3D;mid,j&lt;&#x3D;right,比较arr【i】与arr【j】的大小，那个小，copy【k】就是那个，并且k++，小的那个下标j++，当有一个超过mid，那就一直是copy【k++】&#x3D;arr【j+&#x3D;】，若是超过right，那就是copy【k++】&#x3D;arr【i++】，最后再把copy里的元素放回arr里</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">merge</span><span class=\"params\">(<span class=\"type\">int</span> left,<span class=\"type\">int</span> right,<span class=\"type\">int</span> mid,<span class=\"type\">int</span>[] arr)</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> i=left;</span><br><span class=\"line\">        <span class=\"type\">int</span> j=mid+<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> [] aux=<span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[right-left+<span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"type\">int</span> t=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (i&lt;=mid&amp;&amp;j&lt;=right)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (arr[i]&lt;arr[j])&#123;</span><br><span class=\"line\">                aux[t]=arr[i];</span><br><span class=\"line\">                t++;</span><br><span class=\"line\">                i++;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                aux[t]=arr[j];</span><br><span class=\"line\">                t++;</span><br><span class=\"line\">                j++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (i&lt;=mid)&#123;</span><br><span class=\"line\">            aux[t]=arr[i];</span><br><span class=\"line\">            t++;</span><br><span class=\"line\">            i++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (j&lt;=right)&#123;</span><br><span class=\"line\">            aux[t]=arr[j];</span><br><span class=\"line\">            t++;</span><br><span class=\"line\">            j++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> p=left;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">k</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; k &lt; aux.length; k++) &#123;</span><br><span class=\"line\">            arr[p+k]=aux[k];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"排序","slug":"排序","permalink":"http://yoursite.com/tags/%E6%8E%92%E5%BA%8F/"},{"name":"算法","slug":"算法","permalink":"http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"sss","date":"2019-07-23T06:45:41.000Z","path":"2019/07/23/快排/","content":"<h1 id=\"快排\"><a href=\"#快排\" class=\"headerlink\" title=\"快排\"></a>快排</h1><h2 id=\"1-0定义\"><a href=\"#1-0定义\" class=\"headerlink\" title=\"1.0定义\"></a>1.0定义</h2><blockquote>\n<p><strong>快<strong><strong>速排序（</strong></strong>Quicksort<strong><strong>）是对冒泡排序的一种改进</strong></strong>。<strong><strong>基</strong></strong>本思想****是：通过一趟排序将要排序的数据分割成独立的两部分，其中一部分的所有数据都比另外一部分的所有数据都要小，然后再按此方法对这两部分数据分别进行快速排序，整个排序过程可以递归进行，以此达到整个数据变成有序序列</strong></p>\n</blockquote>\n<h2 id=\"2-个人理解\"><a href=\"#2-个人理解\" class=\"headerlink\" title=\"2.个人理解\"></a>2.个人理解</h2><p>快排运用了分而治之的思想，先把数组分成两个区域，一个是小于value的区域，一个是大于value的区域，在对这两个区域里的进行分解，直到只有一个元素才停止，先用sort算法分成两个区域，并把value的下标取出，然后再分成左区域和右区域，再这里面进行找下标再区分，直到l&gt;&#x3D;r</p>\n<h2 id=\"3-图片讲解\"><a href=\"#3-图片讲解\" class=\"headerlink\" title=\"3.图片讲解\"></a>3.图片讲解</h2><p><a href=\"https://imgchr.com/i/eEcqte\"><img src=\"https://s2.ax1x.com/2019/07/24/eEcqte.md.png\" alt=\"eEcqte.md.png\"></a></p>\n<h2 id=\"4-0代码讲解\"><a href=\"#4-0代码讲解\" class=\"headerlink\" title=\"4.0代码讲解\"></a>4.0代码讲解</h2><p>首先要两个代码，一个是不断进行分左区域和区域，另一个就是分大于value和小于value，最后的出下标返回来进行左右划分</p>\n<h3 id=\"4-1不断划分左右区域\"><a href=\"#4-1不断划分左右区域\" class=\"headerlink\" title=\"4.1不断划分左右区域\"></a>4.1不断划分左右区域</h3><p>条件终止是l》&#x3D;r</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">quickSort2</span><span class=\"params\">(<span class=\"type\">int</span>[] arr,<span class=\"type\">int</span> left,<span class=\"type\">int</span> right)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (left&gt;=right)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> v=qucik(arr,left,right);</span><br><span class=\"line\">        quickSort2(arr,left,v-<span class=\"number\">1</span>);</span><br><span class=\"line\">        quickSort2(arr,v+<span class=\"number\">1</span>,right);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-2获取下标，并同时对数组进行分区域\"><a href=\"#4-2获取下标，并同时对数组进行分区域\" class=\"headerlink\" title=\"4.2获取下标，并同时对数组进行分区域\"></a>4.2获取下标，并同时对数组进行分区域</h3><p>首先设置l&#x3D;left+1，r&#x3D;right，l往右移动，r往左移动，value先设置为arr【left】，当arr【l】&gt;value时停止否则l++，r就是arr【r】&lt;value时，停止，否则就是r–，当l与r都停止时候就把arr【l】yuarr【r】进行交换，如何l++，r–停止条件也是l&gt;r。跳出循环时，把arr【r】与arr【left】进行交换，最后把r返回就行。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">qucik</span><span class=\"params\">(<span class=\"type\">int</span>[] arr,<span class=\"type\">int</span> left,<span class=\"type\">int</span> right)</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> l=left+<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> r=right;</span><br><span class=\"line\">        <span class=\"type\">int</span> val=arr[left];</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (l&lt;=r)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (l&lt;=right&amp;&amp;arr[l]&lt;val)&#123;</span><br><span class=\"line\">                l++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (r&gt;=left+<span class=\"number\">1</span>&amp;&amp;arr[r]&gt;val)&#123;</span><br><span class=\"line\">                r--;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (l&gt;r)&#123;</span><br><span class=\"line\">                <span class=\"comment\">//说明已经排好了</span></span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"type\">int</span> tem=arr[l];</span><br><span class=\"line\">            arr[l]=arr[r];</span><br><span class=\"line\">            arr[r]=tem;</span><br><span class=\"line\">            l++;</span><br><span class=\"line\">            r--;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//跳出循环把，r与left交换，因为是以left威大小来分的</span></span><br><span class=\"line\">        <span class=\"type\">int</span> tem=arr[left];</span><br><span class=\"line\">        arr[left]=arr[r];</span><br><span class=\"line\">        arr[r]=tem;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> r;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"排序","slug":"排序","permalink":"http://yoursite.com/tags/%E6%8E%92%E5%BA%8F/"},{"name":"算法","slug":"算法","permalink":"http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"希尔排序","date":"2019-07-16T13:28:24.000Z","path":"2019/07/16/希尔排序/","content":"<h1 id=\"希尔排序\"><a href=\"#希尔排序\" class=\"headerlink\" title=\"希尔排序\"></a>希尔排序</h1><h2 id=\"1-思路\"><a href=\"#1-思路\" class=\"headerlink\" title=\"1.思路\"></a>1.思路</h2><p>把整个数组先找出中间数mid&#x3D;（length&#x2F;2),用mid的个数分成5组，用插入排序，排每一组，再把mid&#x3D;mid&#x2F;2,再分成mid组，知道mid&#x3D;&#x3D;0才停止。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> arr.length/<span class=\"number\">2</span>; i &gt;<span class=\"number\">0</span>; i/=<span class=\"number\">2</span>) &#123;<span class=\"comment\">//分组</span></span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://imgchr.com/i/eE6XLV\"><img src=\"https://s2.ax1x.com/2019/07/24/eE6XLV.md.png\" alt=\"eE6XLV.md.png\"></a></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> i; j &lt;arr.length ; j++) &#123;<span class=\"comment\">//选择排序，从mid开始数，找j-i来比较，</span></span><br><span class=\"line\">                <span class=\"type\">int</span> k=j-i;</span><br><span class=\"line\">                <span class=\"type\">int</span> tem=arr[j];<span class=\"comment\">//要插入的元素</span></span><br><span class=\"line\">                <span class=\"keyword\">while</span> (k&gt;=<span class=\"number\">0</span>&amp;&amp;tem&lt;arr[k])&#123;</span><br><span class=\"line\">                    arr[k+i]=arr[k];</span><br><span class=\"line\">                    k-=i;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                arr[k+i]=tem;</span><br><span class=\"line\">            &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2完整代码\"><a href=\"#2完整代码\" class=\"headerlink\" title=\"2完整代码\"></a>2完整代码</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> class 希尔排序 &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span>[] arr=&#123;<span class=\"number\">8</span>,<span class=\"number\">9</span>,<span class=\"number\">1</span>,<span class=\"number\">7</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">5</span>,<span class=\"number\">4</span>,<span class=\"number\">6</span>,<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\"><span class=\"comment\">//        for (int i = arr.length/2; i &gt;0 ; i/=2) &#123;//要分的组数</span></span><br><span class=\"line\"><span class=\"comment\">//            for (int j = i; j &lt;arr.length ; j++) &#123;//从哪里形成组数</span></span><br><span class=\"line\"><span class=\"comment\">//                for (int k = j-i; k&gt;=0 ; k-=i) &#123;//形成组，夸区域</span></span><br><span class=\"line\"><span class=\"comment\">//                    if (arr[k+i]&lt;arr[k])&#123;</span></span><br><span class=\"line\"><span class=\"comment\">//                        int tem=arr[k+i];</span></span><br><span class=\"line\"><span class=\"comment\">//                        arr[k+i]=arr[k];</span></span><br><span class=\"line\"><span class=\"comment\">//                        arr[k]=tem;</span></span><br><span class=\"line\"><span class=\"comment\">//                    &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//                &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//            &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//        &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//优化希尔排序，用移位法</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> arr.length/<span class=\"number\">2</span>; i &gt;<span class=\"number\">0</span>; i/=<span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> i; j &lt;arr.length ; j++) &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> k=j-i;</span><br><span class=\"line\">                <span class=\"type\">int</span> tem=arr[j];<span class=\"comment\">//要插入的元素</span></span><br><span class=\"line\">                <span class=\"keyword\">while</span> (k&gt;=<span class=\"number\">0</span>&amp;&amp;tem&lt;arr[k])&#123;</span><br><span class=\"line\">                    arr[k+i]=arr[k];</span><br><span class=\"line\">                    k-=i;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                arr[k+i]=tem;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class=\"line\">            System.out.print(arr[i]+<span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"排序","slug":"排序","permalink":"http://yoursite.com/tags/%E6%8E%92%E5%BA%8F/"},{"name":"算法","slug":"算法","permalink":"http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"八皇后","date":"2019-07-12T15:31:31.000Z","path":"2019/07/12/八皇后/","content":"<h1 id=\"八皇后问题\"><a href=\"#八皇后问题\" class=\"headerlink\" title=\"八皇后问题\"></a>八皇后问题</h1><h2 id=\"1来源\"><a href=\"#1来源\" class=\"headerlink\" title=\"1来源\"></a>1来源</h2><blockquote>\n<p>八皇后问题，是一个古老而著名的问题，是<strong>回溯算法的典型案例</strong>。该问题是国际西洋棋棋手马克斯·贝瑟尔于1848年提出：在8×8格的国际象棋上摆放八个皇后，使其不能互相攻击，即：<strong>任****意两个皇后都不能处于同一行、同一列或同一斜线上，问有多少种摆法</strong>。</p>\n</blockquote>\n<h2 id=\"2思路\"><a href=\"#2思路\" class=\"headerlink\" title=\"2思路\"></a>2思路</h2><h3 id=\"2-1构建思路\"><a href=\"#2-1构建思路\" class=\"headerlink\" title=\"2.1构建思路\"></a>2.1构建思路</h3><p>构建一个int【8】的数组，i是x，arr【i】是y，这样就形成了坐标</p>\n<h3 id=\"2-2检测冲突\"><a href=\"#2-2检测冲突\" class=\"headerlink\" title=\"2.2检测冲突\"></a>2.2检测冲突</h3><p>直线就是arr【i】与arr【i-1】.。。arr【0】这些值是否相等，斜线就是x的变化值与y的变化值是否相等即i-j&#x3D;&#x3D;arr【i】-arr【j】</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">check</span><span class=\"params\">(<span class=\"type\">int</span>[] arr,<span class=\"type\">int</span> n)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//检测是否冲突</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; n; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (arr[n]==arr[i]||Math.abs(n-i)==Math.abs(arr[n]-arr[i]))&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-3放旗子思路\"><a href=\"#2-3放旗子思路\" class=\"headerlink\" title=\"2.3放旗子思路\"></a>2.3放旗子思路</h3><p>从第0个位置开始放就是arr【i】&#x3D;&#x3D;0开始，用for写到8，如果不冲突就放下一个，也是for从0到8，当i&#x3D;&#x3D;8就是放完了就返回到上一个，看把arr【i】往后移动会不会也成功</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">put</span><span class=\"params\">(<span class=\"type\">int</span> max,<span class=\"type\">int</span> n,<span class=\"type\">int</span>[] arr)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (n==max)&#123;</span><br><span class=\"line\">            print(arr);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//System.out.println(count);</span></span><br><span class=\"line\">            System.out.println();</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; max; i++) &#123;</span><br><span class=\"line\">            arr[n]=i;<span class=\"comment\">//先放在第一位在后裔</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (check(arr,n))&#123;</span><br><span class=\"line\">                put(max,n+<span class=\"number\">1</span>,arr);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3完整代码\"><a href=\"#3完整代码\" class=\"headerlink\" title=\"3完整代码\"></a>3完整代码</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> class 八皇后 &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> max=<span class=\"number\">8</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span>[] arr=<span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[max];</span><br><span class=\"line\">        put(max,<span class=\"number\">0</span>,arr);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">check</span><span class=\"params\">(<span class=\"type\">int</span>[] arr,<span class=\"type\">int</span> n)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//检测是否冲突</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; n; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (arr[n]==arr[i]||Math.abs(n-i)==Math.abs(arr[n]-arr[i]))&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">put</span><span class=\"params\">(<span class=\"type\">int</span> max,<span class=\"type\">int</span> n,<span class=\"type\">int</span>[] arr)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (n==max)&#123;</span><br><span class=\"line\">            print(arr);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//System.out.println(count);</span></span><br><span class=\"line\">            System.out.println();</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; max; i++) &#123;</span><br><span class=\"line\">            arr[n]=i;<span class=\"comment\">//先放在第一位在后裔</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (check(arr,n))&#123;</span><br><span class=\"line\">                put(max,n+<span class=\"number\">1</span>,arr);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">print</span><span class=\"params\">(<span class=\"type\">int</span>[] arr)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt;arr.length ; i++) &#123;</span><br><span class=\"line\">            System.out.print(arr[i]+<span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"数据结构","slug":"数据结构","permalink":"http://yoursite.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"递归","slug":"递归","permalink":"http://yoursite.com/tags/%E9%80%92%E5%BD%92/"}]},{"title":"迷宫回溯","date":"2019-07-12T15:18:17.000Z","path":"2019/07/12/迷宫回溯/","content":"<h1 id=\"迷宫问题\"><a href=\"#迷宫问题\" class=\"headerlink\" title=\"迷宫问题\"></a>迷宫问题</h1><h2 id=\"1定义\"><a href=\"#1定义\" class=\"headerlink\" title=\"1定义\"></a>1定义</h2><p>定义走过通路为2，墙壁为1，未经过的是0，已经走过了的不是通路3，当终点为2时就是成功</p>\n<h2 id=\"2方法\"><a href=\"#2方法\" class=\"headerlink\" title=\"2方法\"></a>2方法</h2><p>当终点是2直接返回成功，当为0时，我们先定义他是2，再走访他周围四个点，当周围有路可走就是通路返回true，如果周围都不是（1,3,2）已近走过了的和是墙，那就返回false</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">setWay</span><span class=\"params\">(<span class=\"type\">int</span>[][] map,<span class=\"type\">int</span> i, <span class=\"type\">int</span> j)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (map[<span class=\"number\">6</span>][<span class=\"number\">5</span>]==<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(map[i][j]==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            map[i][j]=<span class=\"number\">2</span>;<span class=\"comment\">//先假设为通路</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (setWay(map,i+<span class=\"number\">1</span>,j))&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (setWay(map,i,j+<span class=\"number\">1</span>))&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>  <span class=\"keyword\">if</span> (setWay(map,i-<span class=\"number\">1</span>,j))&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (setWay(map,i,j-<span class=\"number\">1</span>))&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> &#123;<span class=\"comment\">//当四周都是false走不通</span></span><br><span class=\"line\">                map[i][j]=<span class=\"number\">3</span>;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;<span class=\"comment\">//1,2，3都是false，已近走过货不能用</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"数据结构","slug":"数据结构","permalink":"http://yoursite.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"递归","slug":"递归","permalink":"http://yoursite.com/tags/%E9%80%92%E5%BD%92/"}]},{"title":"逆波兰","date":"2019-07-12T14:52:17.000Z","path":"2019/07/12/逆波兰/","content":"<h1 id=\"逆波兰算法\"><a href=\"#逆波兰算法\" class=\"headerlink\" title=\"逆波兰算法\"></a>逆波兰算法</h1><h2 id=\"1后缀表达式\"><a href=\"#1后缀表达式\" class=\"headerlink\" title=\"1后缀表达式\"></a>1后缀表达式</h2><blockquote>\n<p>从左至右扫描表达式，遇到数字时，将数字压入堆栈，遇到运算符时，弹出栈顶的两个数，用运算符对它们做相应的计算（次顶元素<br>和 栈顶元素），并将结果入栈；重复上述过程直到表达式最右端，最后运算得出的值即为表达式的结果</p>\n</blockquote>\n<blockquote>\n<p>例如: (3+4)×5-6 对应的后缀表达式就是 <strong>3 4 + 5 × 6 -</strong> <strong>,</strong> <strong>针对<strong><strong>后</strong></strong>缀表达式求值步骤<strong><strong>如</strong></strong>下**</strong>:**</p>\n<p>1)从左至右扫描，将3和4压入堆栈；</p>\n<p>2)遇到+运算符，因此弹出4和3（4为栈顶元素，3为次顶元素），计算出3+4的值，得7，再将7入栈；</p>\n<p>3)将5入栈；</p>\n<p>4)接下来是×运算符，因此弹出5和7，计算出7×5&#x3D;35，将35入栈；</p>\n<p>5)将6入栈；</p>\n<p>6)最后是-运算符，计算出35-6的值，即29，由此得出最终结果  </p>\n</blockquote>\n<p>按照操作顺序来计算（所读取的是数字就加入，是符号就弹出，并进行求和</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String string=<span class=\"string\">&quot;30 4 + 5 * 6 -&quot;</span>;</span><br><span class=\"line\">      String[] strings=s2.split(<span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">      Stack&lt;Integer&gt; stack=<span class=\"keyword\">new</span> <span class=\"title class_\">Stack</span>&lt;&gt;();</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; strings.length; i++) &#123;</span><br><span class=\"line\">          <span class=\"type\">String</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> strings[i];</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (s.matches(<span class=\"string\">&quot;\\\\d+&quot;</span>))&#123;</span><br><span class=\"line\">              stack.push(Integer.parseInt(s));</span><br><span class=\"line\">          &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">              <span class=\"type\">int</span> num1=stack.pop();</span><br><span class=\"line\">              <span class=\"type\">int</span> num2=stack.pop();</span><br><span class=\"line\">              <span class=\"type\">int</span> res=<span class=\"number\">0</span>;</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (s.equals(<span class=\"string\">&quot;+&quot;</span>))&#123;</span><br><span class=\"line\">                  res=num1+num2;</span><br><span class=\"line\">              &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(s.equals(<span class=\"string\">&quot;-&quot;</span>))&#123;</span><br><span class=\"line\">                  res=num2-num1;</span><br><span class=\"line\">              &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(s.equals(<span class=\"string\">&quot;*&quot;</span>))&#123;</span><br><span class=\"line\">                  res=num1*num2;</span><br><span class=\"line\">              &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                  res=num2/num1;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">              stack.push(res);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"2中缀转后缀的原理\"><a href=\"#2中缀转后缀的原理\" class=\"headerlink\" title=\"2中缀转后缀的原理\"></a>2中缀转后缀的原理</h2><blockquote>\n<p>1)初始化两个栈：运算符栈s1和储存中间结果的栈s2；</p>\n<p>2)从左至右扫描中缀表达式；</p>\n<p>3)遇到操作数时，将其压s2；</p>\n<p>4)遇到运算符时，比较其与s1栈顶运算符的优先级：</p>\n<p>(1)如果s1为空，或栈顶运算符为左括号“(”，则直接将此运算符入栈；</p>\n<p>(2)否则，若优先级比栈顶运算符的高，也将运算符压入s1；</p>\n<p>(3)否则，将s1栈顶的运算符弹出并压入到s2中，再次转到(4-1)与s1中新的栈顶运算符相比较；</p>\n<p>5)遇到括号时：<br> (1) 如果是左括号“(”，则直接压入s1<br> (2) 如果是右括号“)”，则依次弹出s1栈顶的运算符，并压入s2，直到遇到左括号为止，此时将这一对括号丢弃</p>\n<p>6)重复步骤2至5，直到表达式的最右边</p>\n<p>7)将s1中剩余的运算符依次弹出并压入s2</p>\n<p>8)依次弹出s2中的元素并输出，<strong>结果的逆序即为中缀表达式对应的后缀表达****式</strong>  </p>\n</blockquote>\n<p>一个栈，一个list，栈收集符号，list收集数字最初，档位空或者“（”直接加入栈，优先级高也是直接加入，直到是优先级比较低的，那就直接把栈顶弹出去给加到list里，再用操作符与弹出后的比优先级，如果是“）”，也是弹到list，直到操作符为“（”，弹出这个操作符“（”，然后进行下一趟，操作代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> List&lt;String&gt; <span class=\"title function_\">produce</span><span class=\"params\">(List&lt;String&gt; list)</span>&#123;</span><br><span class=\"line\">        Stack&lt;String&gt; stack1=<span class=\"keyword\">new</span> <span class=\"title class_\">Stack</span>&lt;&gt;();</span><br><span class=\"line\">        List&lt;String&gt; list1=<span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class=\"line\">            String s1=list.get(i);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (s1.matches(<span class=\"string\">&quot;\\\\d+&quot;</span>))&#123;</span><br><span class=\"line\">                list1.add(s1);</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (stack1.isEmpty())&#123;</span><br><span class=\"line\">                    stack1.push(s1);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s1.equals(<span class=\"string\">&quot;(&quot;</span>))&#123;</span><br><span class=\"line\">                    stack1.push(s1);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s1.equals(<span class=\"string\">&quot;)&quot;</span>))&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">while</span> (!stack1.peek().equals(<span class=\"string\">&quot;(&quot;</span>))&#123;</span><br><span class=\"line\">                        list1.add(stack1.pop());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    stack1.pop();<span class=\"comment\">//弹出左括号</span></span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (priority(s1)&lt;=priority(stack1.peek()))&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">while</span> (!stack1.isEmpty()&amp;&amp;priority(s1)&lt;=priority(stack1.peek()))&#123;</span><br><span class=\"line\">                        list1.add(stack1.pop());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    stack1.push(s1);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    stack1.push(s1);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (!stack1.isEmpty())&#123;</span><br><span class=\"line\">            list1.add(stack1.pop());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> list1;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3完整的代码\"><a href=\"#3完整的代码\" class=\"headerlink\" title=\"3完整的代码\"></a>3完整的代码</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Stack;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> class 逆波兰 &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//String string=&quot;4 5 * 8 - 60 + 8 2 / +&quot;;</span></span><br><span class=\"line\">        String s1=<span class=\"string\">&quot;1+((2+3)*4)-5&quot;</span>;</span><br><span class=\"line\">        List&lt;String&gt; list=list(s1);</span><br><span class=\"line\">        List&lt;String&gt; list1=produce(list);</span><br><span class=\"line\">        String s2=<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; list1.size(); i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i!=list1.size()-<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                s2+=list1.get(i)+<span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                s2+=list1.get(i);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(s2);</span><br><span class=\"line\">        String string=<span class=\"string\">&quot;30 4 + 5 * 6 -&quot;</span>;</span><br><span class=\"line\">        String[] strings=s2.split(<span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">        Stack&lt;Integer&gt; stack=<span class=\"keyword\">new</span> <span class=\"title class_\">Stack</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; strings.length; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> strings[i];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (s.matches(<span class=\"string\">&quot;\\\\d+&quot;</span>))&#123;</span><br><span class=\"line\">                stack.push(Integer.parseInt(s));</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> num1=stack.pop();</span><br><span class=\"line\">                <span class=\"type\">int</span> num2=stack.pop();</span><br><span class=\"line\">                <span class=\"type\">int</span> res=<span class=\"number\">0</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (s.equals(<span class=\"string\">&quot;+&quot;</span>))&#123;</span><br><span class=\"line\">                    res=num1+num2;</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(s.equals(<span class=\"string\">&quot;-&quot;</span>))&#123;</span><br><span class=\"line\">                    res=num2-num1;</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(s.equals(<span class=\"string\">&quot;*&quot;</span>))&#123;</span><br><span class=\"line\">                    res=num1*num2;</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    res=num2/num1;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                stack.push(res);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(stack.peek());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">priority</span><span class=\"params\">(String val)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (val.equals(<span class=\"string\">&quot;+&quot;</span>)||val.equals(<span class=\"string\">&quot;-&quot;</span>))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (val.equals(<span class=\"string\">&quot;*&quot;</span>)||val.equals(<span class=\"string\">&quot;/&quot;</span>))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> List&lt;String&gt; <span class=\"title function_\">list</span><span class=\"params\">(String string)</span>&#123;</span><br><span class=\"line\">        List&lt;String&gt; list = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; string.length(); i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">char</span> ch=string.charAt(i);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (ch&gt;=<span class=\"string\">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class=\"string\">&#x27;9&#x27;</span>)&#123;</span><br><span class=\"line\">                String addn=<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">                addn+=ch;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> i+<span class=\"number\">1</span>; j &lt; string.length(); j++) &#123;</span><br><span class=\"line\">                    <span class=\"type\">char</span> ch2=string.charAt(j);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (ch2&gt;=<span class=\"string\">&#x27;0&#x27;</span>&amp;&amp;ch2&lt;=<span class=\"string\">&#x27;9&#x27;</span>)&#123;</span><br><span class=\"line\">                        addn+=ch2;</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        i=j-<span class=\"number\">1</span>;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                list.add(addn);</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                list.add(<span class=\"string\">&quot;&quot;</span>+ch);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> list;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//生产逆波兰</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> List&lt;String&gt; <span class=\"title function_\">produce</span><span class=\"params\">(List&lt;String&gt; list)</span>&#123;</span><br><span class=\"line\">        Stack&lt;String&gt; stack1=<span class=\"keyword\">new</span> <span class=\"title class_\">Stack</span>&lt;&gt;();</span><br><span class=\"line\">        List&lt;String&gt; list1=<span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class=\"line\">            String s1=list.get(i);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (s1.matches(<span class=\"string\">&quot;\\\\d+&quot;</span>))&#123;</span><br><span class=\"line\">                list1.add(s1);</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (stack1.isEmpty())&#123;</span><br><span class=\"line\">                    stack1.push(s1);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s1.equals(<span class=\"string\">&quot;(&quot;</span>))&#123;</span><br><span class=\"line\">                    stack1.push(s1);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s1.equals(<span class=\"string\">&quot;)&quot;</span>))&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">while</span> (!stack1.peek().equals(<span class=\"string\">&quot;(&quot;</span>))&#123;</span><br><span class=\"line\">                        list1.add(stack1.pop());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    stack1.pop();<span class=\"comment\">//弹出左括号</span></span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (priority(s1)&lt;=priority(stack1.peek()))&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">while</span> (!stack1.isEmpty()&amp;&amp;priority(s1)&lt;=priority(stack1.peek()))&#123;</span><br><span class=\"line\">                        list1.add(stack1.pop());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    stack1.push(s1);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    stack1.push(s1);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (!stack1.isEmpty())&#123;</span><br><span class=\"line\">            list1.add(stack1.pop());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> list1;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"数据结构","slug":"数据结构","permalink":"http://yoursite.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"栈","slug":"栈","permalink":"http://yoursite.com/tags/%E6%A0%88/"}]},{"title":"栈计算器","date":"2019-07-11T15:23:41.000Z","path":"2019/07/11/栈计算器/","content":"<h1 id=\"构建栈计算器\"><a href=\"#构建栈计算器\" class=\"headerlink\" title=\"构建栈计算器\"></a>构建栈计算器</h1><h2 id=\"1-思路\"><a href=\"#1-思路\" class=\"headerlink\" title=\"1.思路\"></a>1.思路</h2><p>一个个扫描每个字节看尸数字还是符号，分别加入不同的栈构建两个栈，一个数字栈，一个符号栈，符号栈威空直接压入或者要压的元素比栈顶的元素优先级高，就压入，否则就弹出两个数字和一个符号，计算结果，然后压入数字栈，再用那个符号与栈顶的符号比较，直到结束。</p>\n<h2 id=\"2-bug如果是多位数，会变成多个个位数不是百位数等\"><a href=\"#2-bug如果是多位数，会变成多个个位数不是百位数等\" class=\"headerlink\" title=\"2.bug如果是多位数，会变成多个个位数不是百位数等\"></a>2.bug如果是多位数，会变成多个个位数不是百位数等</h2><p>解决方法，扫描是数字接着扫直到不是数字才停止</p>\n<h2 id=\"3-代码\"><a href=\"#3-代码\" class=\"headerlink\" title=\"3.代码\"></a>3.代码</h2><h3 id=\"3-1分辨是符号还是数字\"><a href=\"#3-1分辨是符号还是数字\" class=\"headerlink\" title=\"3.1分辨是符号还是数字\"></a>3.1分辨是符号还是数字</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isoper</span><span class=\"params\">(<span class=\"type\">char</span> ch)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ch==<span class=\"string\">&#x27;-&#x27;</span>||ch==<span class=\"string\">&#x27;+&#x27;</span>||ch==<span class=\"string\">&#x27;/&#x27;</span>||ch==<span class=\"string\">&#x27;*&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-2符号优先级\"><a href=\"#3-2符号优先级\" class=\"headerlink\" title=\"3.2符号优先级\"></a>3.2符号优先级</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">priority</span><span class=\"params\">(<span class=\"type\">int</span> val)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (val==<span class=\"string\">&#x27;+&#x27;</span>||val==<span class=\"string\">&#x27;-&#x27;</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (val==<span class=\"string\">&#x27;/&#x27;</span>||val==<span class=\"string\">&#x27;*&#x27;</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-3计算两个弹出的结果\"><a href=\"#3-3计算两个弹出的结果\" class=\"headerlink\" title=\"3.3计算两个弹出的结果\"></a>3.3计算两个弹出的结果</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">result</span><span class=\"params\">(<span class=\"type\">int</span> num1,<span class=\"type\">int</span> num2,<span class=\"type\">int</span> oper)</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> res=<span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (oper)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;+&#x27;</span>:</span><br><span class=\"line\">                res= num1+num2;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;-&#x27;</span>:</span><br><span class=\"line\">                res= num2-num1;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;*&#x27;</span>:</span><br><span class=\"line\">                res=num1*num2;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;/&#x27;</span>:</span><br><span class=\"line\">                res=num2/num1;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-4主要代码\"><a href=\"#3-4主要代码\" class=\"headerlink\" title=\"3.4主要代码\"></a>3.4主要代码</h3><blockquote>\n<h2 id=\"1-思路-1\"><a href=\"#1-思路-1\" class=\"headerlink\" title=\"1.思路\"></a>1.思路</h2><p>一个个扫描每个字节看尸数字还是符号，分别加入不同的栈构建两个栈，一个数字栈，一个符号栈，符号栈威空直接压入或者要压的元素比栈顶的元素优先级高，就压入，否则就弹出两个数字和一个符号，计算结果，然后压入数字栈，再用那个符号与栈顶的符号比较，直到结束。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">      Stack&lt;Integer&gt; num=<span class=\"keyword\">new</span> <span class=\"title class_\">Stack</span>&lt;&gt;();</span><br><span class=\"line\">      Stack&lt;Character&gt; oper=<span class=\"keyword\">new</span> <span class=\"title class_\">Stack</span>&lt;&gt;();</span><br><span class=\"line\">        String express=<span class=\"string\">&quot;322+3*6-2&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; express.length(); i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">char</span> ch=express.charAt(i);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (isoper(ch))&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!oper.isEmpty())&#123;</span><br><span class=\"line\">                    <span class=\"type\">char</span> ch1=oper.peek();</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (priority(ch)&lt;=priority(ch1))&#123;</span><br><span class=\"line\">                        <span class=\"type\">int</span> num1=num.pop();</span><br><span class=\"line\">                        <span class=\"type\">int</span> num2=num.pop();</span><br><span class=\"line\">                        <span class=\"type\">char</span> ch3=oper.pop();</span><br><span class=\"line\">                        <span class=\"type\">int</span> result=result(num1,num2,ch3);</span><br><span class=\"line\">                        num.push(result);</span><br><span class=\"line\">                        oper.push(ch);</span><br><span class=\"line\">                    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        oper.push(ch);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    oper.push(ch);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//num.push(ch-48);</span></span><br><span class=\"line\">                <span class=\"comment\">//如果出现多位数，不是分开加入</span></span><br><span class=\"line\">                String addn=<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">                addn+=ch;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> i+<span class=\"number\">1</span>; j &lt;express.length() ; j++) &#123;</span><br><span class=\"line\">                    <span class=\"type\">char</span> ch2=express.charAt(j);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (isoper(ch2))&#123;</span><br><span class=\"line\">                        i=j-<span class=\"number\">1</span>;</span><br><span class=\"line\">                        <span class=\"comment\">//跳出去就是i+1，这个j会被跳过</span></span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        addn+=ch2;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                num.push(Integer.parseInt(addn));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (!oper.isEmpty())&#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> num1=num.pop();</span><br><span class=\"line\">            <span class=\"type\">int</span> num2=num.pop();</span><br><span class=\"line\">            <span class=\"type\">char</span> ch=oper.pop();</span><br><span class=\"line\">            <span class=\"type\">int</span> result=result(num1,num2,ch);</span><br><span class=\"line\">            num.push(result);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(num.peek());</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"数据结构","slug":"数据结构","permalink":"http://yoursite.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"栈的应用","slug":"栈的应用","permalink":"http://yoursite.com/tags/%E6%A0%88%E7%9A%84%E5%BA%94%E7%94%A8/"}]},{"title":"反转链表","date":"2019-07-11T14:10:25.000Z","path":"2019/07/11/反转链表/","content":"<h1 id=\"反转链表解决\"><a href=\"#反转链表解决\" class=\"headerlink\" title=\"反转链表解决\"></a>反转链表解决</h1><blockquote>\n<p>反转一个单链表。</p>\n<p><strong>示例:</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">输入: <span class=\"number\">1</span>-&gt;<span class=\"number\">2</span>-&gt;<span class=\"number\">3</span>-&gt;<span class=\"number\">4</span>-&gt;<span class=\"number\">5</span>-&gt;NULL</span><br><span class=\"line\">输出: <span class=\"number\">5</span>-&gt;<span class=\"number\">4</span>-&gt;<span class=\"number\">3</span>-&gt;<span class=\"number\">2</span>-&gt;<span class=\"number\">1</span>-&gt;NULL</span><br></pre></td></tr></table></figure>\n</blockquote>\n<p>解决思路：先构建一个虚拟头节点dummyhead，通过遍历获取每一个节点cur，插入在虚拟头节点那个树上了，具体是cur.next&#x3D;dummyhead.next,dummyhead.next&#x3D;cur，这句话是把cur指向dummyhead的下一个节点（前一个节点），然后dummyhead再指向cur，cur再遍历最后返回dummyhead。next就行</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> ListNode <span class=\"title function_\">re</span><span class=\"params\">(ListNode head)</span>&#123;</span><br><span class=\"line\">        ListNode reverse=<span class=\"keyword\">new</span> <span class=\"title class_\">ListNode</span>(-<span class=\"number\">1</span>);</span><br><span class=\"line\">        ListNode cur=head.next;</span><br><span class=\"line\">        ListNode next;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (cur!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">            next=cur.next;</span><br><span class=\"line\">            cur.next=reverse.next;<span class=\"comment\">//把获取的这个节点指向rever节点的下一个</span></span><br><span class=\"line\">            <span class=\"comment\">//1  2  3原来的</span></span><br><span class=\"line\">            <span class=\"comment\">//0reverse</span></span><br><span class=\"line\">            <span class=\"comment\">//先是1.next=null，再0指向1   0  1  null</span></span><br><span class=\"line\">            reverse.next=cur;<span class=\"comment\">//重新链接，使revers节点下一个变成获取的</span></span><br><span class=\"line\">            cur=next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        head.next=reverse.next;<span class=\"comment\">//reverse已经被取代了</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> head;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"数据结构","slug":"数据结构","permalink":"http://yoursite.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"链表","slug":"链表","permalink":"http://yoursite.com/tags/%E9%93%BE%E8%A1%A8/"}]},{"title":"循环链表","date":"2019-07-11T13:50:31.000Z","path":"2019/07/11/循环链表/","content":"<h1 id=\"解决约瑟夫环\"><a href=\"#解决约瑟夫环\" class=\"headerlink\" title=\"解决约瑟夫环\"></a>解决约瑟夫环</h1><blockquote>\n<p>约瑟夫环（<a href=\"https://baike.baidu.com/item/%E7%BA%A6%E7%91%9F%E5%A4%AB%E9%97%AE%E9%A2%98/3857719\">约瑟夫问题</a>）是一个数学的应用问题：已知n个人（以编号1，2，3…n分别表示）围坐在一张圆桌周围。从编号为k的人开始报数，数到m的那个人出列；他的下一个人又从1开始报数，数到m的那个人又出列；依<a href=\"https://baike.baidu.com/item/%E6%AD%A4\">此</a>规律重复下去，直到圆桌周围的人全部出列。通常解决这类问题时我们把编号从0~n-1，最后 [1]  结果+1即为原问题的解。</p>\n</blockquote>\n<p>首先定义一个环形链表，先初始化n个人，用for语句，形成环形链表，定义一个head，cur，boy（待插入的），从1开始，游戏就是1开始。如果j&#x3D;1，就新建boy把boy当head，然后cur.next&#x3D;cur自身形成环形。不是，就把cur.next&#x3D;boy,boy.next&#x3D;head,cur&#x3D;boy,形成环。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ListNode first=<span class=\"literal\">null</span>;</span><br><span class=\"line\">     ListNode help=<span class=\"literal\">null</span>;<span class=\"comment\">//解决约瑟夫问题的节点</span></span><br><span class=\"line\">     ListNode cur=<span class=\"literal\">null</span>;</span><br><span class=\"line\">     <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>; i &lt;=n; i++) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">if</span> (i==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">             ListNode boy=<span class=\"keyword\">new</span> <span class=\"title class_\">ListNode</span>(i);</span><br><span class=\"line\">             first=boy;</span><br><span class=\"line\">             cur=boy;</span><br><span class=\"line\">             cur.next=first;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">         &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">             ListNode boy=<span class=\"keyword\">new</span> <span class=\"title class_\">ListNode</span>(i);</span><br><span class=\"line\">             cur.next=boy;</span><br><span class=\"line\">             boy.next=first;</span><br><span class=\"line\">             cur=boy;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">     &#125;</span><br></pre></td></tr></table></figure>\n\n<p>解决思路，通过便利，使help在head的前一个，就是help.next&#x3D;head,如果要改变开始顺序，就把head，help移动k-1次，从k开始</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">help=first;</span><br><span class=\"line\">      <span class=\"keyword\">while</span> (help.next!=first)&#123;</span><br><span class=\"line\">          help=help.next;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">//初始化，在最初规定的位置</span></span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; start- <span class=\"number\">1</span>; i++) &#123;</span><br><span class=\"line\">          first=first.next;</span><br><span class=\"line\">          help=help.next;</span><br><span class=\"line\">      &#125;</span><br></pre></td></tr></table></figure>\n\n<p>解决方法，当head！&#x3D;help（不都为空)才成立，和初始化差不多，移动m-1，head&#x3D;head.next，help。next&#x3D;head，最终跳出循环，方法结束。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> (first!=help) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; m - <span class=\"number\">1</span>; i++) &#123;</span><br><span class=\"line\">                first=first.next;</span><br><span class=\"line\">                help=help.next;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(first.val);</span><br><span class=\"line\">            first=first.next;</span><br><span class=\"line\">            help.next=first;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.print(first.val+<span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>最终完整代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">josephu</span><span class=\"params\">(<span class=\"type\">int</span> start,<span class=\"type\">int</span> m,<span class=\"type\">int</span> n)</span>&#123;</span><br><span class=\"line\">        ListNode first=<span class=\"literal\">null</span>;</span><br><span class=\"line\">        ListNode help=<span class=\"literal\">null</span>;</span><br><span class=\"line\">        ListNode cur=<span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>; i &lt;=n; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                ListNode boy=<span class=\"keyword\">new</span> <span class=\"title class_\">ListNode</span>(i);</span><br><span class=\"line\">                first=boy;</span><br><span class=\"line\">                cur=boy;</span><br><span class=\"line\">                cur.next=first;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                ListNode boy=<span class=\"keyword\">new</span> <span class=\"title class_\">ListNode</span>(i);</span><br><span class=\"line\">                cur.next=boy;</span><br><span class=\"line\">                boy.next=first;</span><br><span class=\"line\">                cur=boy;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        help=first;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (help.next!=first)&#123;</span><br><span class=\"line\">            help=help.next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//初始化，在最初规定的位置</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; start- <span class=\"number\">1</span>; i++) &#123;</span><br><span class=\"line\">            first=first.next;</span><br><span class=\"line\">            help=help.next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (first!=help) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; m - <span class=\"number\">1</span>; i++) &#123;</span><br><span class=\"line\">                first=first.next;</span><br><span class=\"line\">                help=help.next;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(first.val);</span><br><span class=\"line\">            first=first.next;</span><br><span class=\"line\">            help.next=first;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.print(first.val+<span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","tags":[{"name":"数据结构","slug":"数据结构","permalink":"http://yoursite.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"算法","slug":"算法","permalink":"http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"First Blog","date":"2019-05-29T15:04:14.000Z","path":"2019/05/29/First-Blog/","content":"<h1 id=\"First-Blog\"><a href=\"#First-Blog\" class=\"headerlink\" title=\"First Blog\"></a>First Blog</h1><p><u><em>第一篇blog，大家好</em></u></p>\n","tags":[{"name":"日常","slug":"日常","permalink":"http://yoursite.com/tags/%E6%97%A5%E5%B8%B8/"},{"name":"闲谈","slug":"闲谈","permalink":"http://yoursite.com/tags/%E9%97%B2%E8%B0%88/"}]}]